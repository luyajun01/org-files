<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>R<sub>WIKI</sub></title>
<meta name="generator" content="Org mode" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2019 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body>
<div id="content">
<h1 class="title">R<sub>WIKI</sub></h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org4a07692">1. 问题</a>
<ul>
<li><a href="#orgfb0bad1">1.1. 如何快速地删除确定的行？</a></li>
<li><a href="#org2c75830">1.2. 如何对两个不同长度的向量作 map2?</a></li>
</ul>
</li>
<li><a href="#org5972d59">2. R 语言编程规范</a>
<ul>
<li><a href="#orgbdd0367">2.1. 帮助文档</a></li>
<li><a href="#org13f67bd">2.2. <span class="todo TODO">TODO</span> 工作空间</a></li>
<li><a href="#orgd249320">2.3. 输入和输出</a></li>
<li><a href="#orgc5e9da7">2.4. Rstudio vim 快捷键</a></li>
</ul>
</li>
<li><a href="#org378b92c">3. R 环境配置</a>
<ul>
<li><a href="#org5cc8297">3.1. 重要的开始文件地址</a></li>
<li><a href="#org1f164cd">3.2. 获取错误信息</a></li>
<li><a href="#orgb45e8fe">3.3. Rprofile 文件</a></li>
<li><a href="#orga59541f">3.4. .Renviron ﬁle</a></li>
<li><a href="#org86172e9">3.5. option</a></li>
<li><a href="#org06b6635">3.6. 环境</a>
<ul>
<li><a href="#orga3826b0">3.6.1. assign</a></li>
<li><a href="#orga852363">3.6.2. get</a></li>
<li><a href="#org65ed56b">3.6.3. exists</a></li>
<li><a href="#org368ff1e">3.6.4. ls</a></li>
<li><a href="#org6a7a2b0">3.6.5. rm</a></li>
<li><a href="#org84782dd">3.6.6. find</a></li>
<li><a href="#orgd6d418f">3.6.7. brew</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgf2e4163">4. 常见 R 函数</a>
<ul>
<li><a href="#orga331ada">4.1. 显示对象个数</a>
<ul>
<li><a href="#org44e10b9">4.1.1. 搜索对象</a></li>
</ul>
</li>
<li><a href="#org9f3760e">4.2. 对象大小</a></li>
<li><a href="#org9a9ca33">4.3. 删除某个对象</a></li>
<li><a href="#org36167b7">4.4. 向环境中添加/删除对象</a></li>
<li><a href="#org4377b6d">4.5. 捕获错误</a></li>
<li><a href="#org126f075">4.6. 改变其他环境</a>
<ul>
<li><a href="#org4b6fa01">4.6.1. 用户目录</a></li>
</ul>
</li>
<li><a href="#orgb253df6">4.7. namespace 概念</a></li>
<li><a href="#orga25790e">4.8. profiling</a></li>
<li><a href="#orgcf62cd5">4.9. 科学计算</a>
<ul>
<li><a href="#orgc9fe278">4.9.1. fivenum</a></li>
</ul>
</li>
<li><a href="#org097b846">4.10. paste</a></li>
<li><a href="#orgd2ecf07">4.11. cat</a></li>
<li><a href="#org60b237d">4.12. as.POSIXct</a></li>
<li><a href="#orgd880188">4.13. format</a></li>
<li><a href="#org3e9dc2c">4.14. rep</a></li>
<li><a href="#org37fc36c">4.15. seq</a></li>
<li><a href="#org812b960">4.16. stack</a></li>
<li><a href="#orga0e81a7">4.17. complete.cases</a></li>
<li><a href="#orga757f78">4.18. 数据精度问题</a></li>
<li><a href="#org251112c">4.19. while</a></li>
<li><a href="#org8585b3a">4.20. setNames</a></li>
<li><a href="#orged29077">4.21. {(.)}</a></li>
<li><a href="#orge780464">4.22. sys.call</a></li>
<li><a href="#orgc9b9f54">4.23. make.call</a></li>
<li><a href="#orgc6fe06a">4.24. range</a></li>
</ul>
</li>
<li><a href="#org12c9825">5. 导入数据</a>
<ul>
<li><a href="#org027374b">5.1. fread/fwrite</a></li>
<li><a href="#orgecaf788">5.2. spark<sub>read</sub><sub>parquet</sub>/spark<sub>write</sub><sub>parquet</sub></a></li>
<li><a href="#org4cc1e0b">5.3. spark<sub>read</sub><sub>csv</sub>/spark<sub>write</sub><sub>csv</sub></a></li>
<li><a href="#orgd8f1952">5.4. get<sub>file</sub><sub>from</sub><sub>hdfs</sub>/push<sub>file</sub><sub>to</sub><sub>hdfs</sub></a>
<ul>
<li><a href="#org0f34524">5.4.1. 读取一个文件夹下多个 csv 文件</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgb2c9c5c">6. 数据处理</a>
<ul>
<li><a href="#org57453dd">6.1. 宽表处理</a>
<ul>
<li><a href="#orgc528755">6.1.1. 常用宽表查询地址</a></li>
<li><a href="#orgacada7f">6.1.2. 读取 jason 数据</a></li>
<li><a href="#org958d7fa">6.1.3. 利用 sparklyr 对 spark 中的 dataframe 复制行</a></li>
<li><a href="#org5de82cf">6.1.4. 本地数据框转成 hdfs</a></li>
<li><a href="#orga43a8ad">6.1.5. 本地数据转化成 h2o frame</a></li>
<li><a href="#org4e41c74">6.1.6. sdf<sub>solidate</sub></a></li>
<li><a href="#org1fdc692">6.1.7. hdfs.load</a></li>
</ul>
</li>
<li><a href="#orga7c975d">6.2. 数据类型转换</a>
<ul>
<li><a href="#org8ab4fe3">6.2.1. 数据切分</a></li>
<li><a href="#org8045f34">6.2.2. 重塑数据(reshape data)</a></li>
<li><a href="#org8180a3c">6.2.3. 非标准计算</a>
<ul>
<li><a href="#orgb29b69b">6.2.3.1. Base</a>
<ul>
<li><a href="#org7e50528">6.2.3.1.1. parse</a></li>
<li><a href="#org9985349">6.2.3.1.2. deparse</a></li>
<li><a href="#orgb18f1fd">6.2.3.1.3. quote</a></li>
<li><a href="#orgd34e5fa">6.2.3.1.4. eval</a></li>
</ul>
</li>
<li><a href="#orga9a4e1a">6.2.3.2. tidyeval</a>
<ul>
<li><a href="#orge1bed29">6.2.3.2.1. quo</a></li>
<li><a href="#orgfe31fe0">6.2.3.2.2. parse<sub>expr</sub>()</a></li>
<li><a href="#orgefeb74e">6.2.3.2.3. exec</a></li>
<li><a href="#orgaab59ff">6.2.3.2.4. f<sub>rhs</sub></a></li>
<li><a href="#orgaaf8b2d">6.2.3.2.5. expr<sub>text</sub>()</a></li>
<li><a href="#orga0ee7d3">6.2.3.2.6. new<sub>formula</sub></a></li>
<li><a href="#org063fdd4">6.2.3.2.7. call2</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#org682b787">6.3. 单变量分析</a></li>
<li><a href="#org6b027fb">6.4. 多变量分析</a>
<ul>
<li><a href="#orge5ef2ee">6.4.1. 二维列联表</a></li>
<li><a href="#org3668339">6.4.2. 三维列联表</a></li>
<li><a href="#org8855450">6.4.3. 卡方独立性检验</a></li>
<li><a href="#orgbe3dd0b">6.4.4. 二变量关系</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org0717bb8">7. 字符型数据</a>
<ul>
<li><a href="#org078aad6">7.1. 常见函数</a></li>
<li><a href="#org042df2c">7.2. 字符大小写</a></li>
<li><a href="#org313e2b8">7.3. 字符串取子集</a>
<ul>
<li><a href="#orgccc4895">7.3.1. 返回字符数</a></li>
<li><a href="#orge4d6387">7.3.2. 正则表达式匹配</a></li>
<li><a href="#org1f4513a">7.3.3. 分组与回溯引用</a></li>
<li><a href="#org2ec45fd">7.3.4. 字符串替换</a></li>
<li><a href="#org64ea39d">7.3.5. 字符串排序</a></li>
<li><a href="#orgc0197fd">7.3.6. 字符串拆分</a></li>
<li><a href="#orgfa80fa1">7.3.7. 字符串连接</a></li>
<li><a href="#org4add6ec">7.3.8. 字符串重编码</a></li>
<li><a href="#org8b54bba">7.3.9. 字符串转为命令</a></li>
<li><a href="#org7ec3046">7.3.10. append</a></li>
<li><a href="#org1ced595">7.3.11. 返回两个数据框不相同的位置</a></li>
<li><a href="#org1bba5ba">7.3.12. 删掉重复行</a></li>
<li><a href="#orge3ff1a0">7.3.13. 如何对数列（array）进行维度变换?</a></li>
<li><a href="#orgb018580">7.3.14. 如何对矩阵按行（列）作计算？</a></li>
<li><a href="#orgc20dae5">7.3.15. 注释大段的 R 脚本</a></li>
<li><a href="#orgc59fea2">7.3.16. 如何对数据框（data.frame）的某列作数学变换？</a></li>
<li><a href="#orge2be2ad">7.3.17. 如何对不规则数组进行统计分析？</a></li>
<li><a href="#orgad22c4b">7.3.18. 判断数据框的列是否为数字</a></li>
<li><a href="#org014c7b6">7.3.19. 如何将数据标准化？</a></li>
<li><a href="#org8745359">7.3.20. 如何做交叉列联表？（table）</a></li>
</ul>
</li>
<li><a href="#orgf37327c">7.4. 4 list 型数据</a>
<ul>
<li><a href="#org3c517dd">7.4.1. data.frame</a></li>
<li><a href="#org7516b81">7.4.2. do.call</a></li>
<li><a href="#orga185468">7.4.3. c()</a></li>
</ul>
</li>
<li><a href="#org293ae1d">7.5. 5 因子型数据</a></li>
<li><a href="#orgda32aea">7.6. 6 日期型数据</a></li>
<li><a href="#org5a16e7f">7.7. 7 TODO: BOOLEN 数据</a>
<ul>
<li><a href="#orgde1d230">7.7.1. 布尔代数</a></li>
<li><a href="#orgb8af946">7.7.2. 比较两个对象是否相等</a></li>
<li><a href="#orge4312f9">7.7.3. 取偶数位置值</a></li>
</ul>
</li>
<li><a href="#orga9b7c14">7.8. JSON 数据</a></li>
</ul>
</li>
<li><a href="#org3163024">8. 模型</a>
<ul>
<li><a href="#org782df4e">8.1. 求解没有常数项的线性回归模型</a>
<ul>
<li><a href="#org3682e29">8.1.1. 如何使用正交多项式回归？</a></li>
<li><a href="#orgb9350fe">8.1.2. 如何进行典型相关分析？</a></li>
<li><a href="#org2f537a8">8.1.3. R 的 SPSS 版本</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org57de9d5">9. 作图</a>
<ul>
<li><a href="#org38348d5">9.1. ggplot2</a>
<ul>
<li><a href="#org2d12044">9.1.1. theme<sub>set</sub></a></li>
<li><a href="#org970f09a">9.1.2. element<sub>markdown</sub></a></li>
<li><a href="#orgc3a580d">9.1.3. 散点图</a></li>
<li><a href="#orgf4e712f">9.1.4. 分面</a></li>
<li><a href="#orgd16c01d">9.1.5. 密度图</a></li>
<li><a href="#org95cba66">9.1.6. 线图</a></li>
<li><a href="#orge961b0d">9.1.7. 拟合线图</a></li>
<li><a href="#orgae10d74">9.1.8. 密度图</a></li>
</ul>
</li>
<li><a href="#orgbd70e9f">9.2. patchwork</a></li>
</ul>
</li>
<li><a href="#orgc7b1f8c">10. 表格、results 输出</a>
<ul>
<li><a href="#org0b6a5d9">10.1. reprex</a></li>
</ul>
</li>
<li><a href="#org2f1929c">11. parallel 并行运算</a>
<ul>
<li>
<ul>
<li><a href="#orgf0a2a60">11.0.1. 如何加速 R 的运行速度？</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgf64e952">12. Packages</a>
<ul>
<li><a href="#org07cca67">12.1. Base</a>
<ul>
<li><a href="#org3810a91">12.1.1. c</a></li>
<li><a href="#org30e06b1">12.1.2. matrix</a></li>
<li><a href="#org7ee43a8">12.1.3. data.frame</a></li>
<li><a href="#org1dc30d7">12.1.4. factor</a></li>
<li><a href="#org472e426">12.1.5. list</a></li>
<li><a href="#org8767116">12.1.6. missing/out of bound indices</a></li>
<li><a href="#orgc654b28">12.1.7. head/tail</a></li>
<li><a href="#org9fe8f80">12.1.8. date</a></li>
<li><a href="#org00b450b">12.1.9. cat</a></li>
<li><a href="#org92834a5">12.1.10. which</a></li>
<li><a href="#orgb970142">12.1.11. warning</a></li>
<li><a href="#orgbc1165b">12.1.12. stop</a></li>
<li><a href="#orgac5b54d">12.1.13. message</a></li>
<li><a href="#org7cf54c8">12.1.14. toString</a></li>
<li><a href="#org33ae4f1">12.1.15. tryCatch</a></li>
<li><a href="#org04b3a66">12.1.16. rbind</a></li>
<li><a href="#org0914e54">12.1.17. rawconversion</a></li>
<li><a href="#org16d9f4d">12.1.18. all.names</a></li>
<li><a href="#org7ccca91">12.1.19. apply</a></li>
<li><a href="#org01d6475">12.1.20. aggregate</a></li>
<li><a href="#orgf966943">12.1.21. ave</a></li>
<li><a href="#orgf2ff9f8">12.1.22. aperm</a></li>
<li><a href="#orgfc59915">12.1.23. any</a></li>
<li><a href="#org654aca1">12.1.24. all</a></li>
<li><a href="#orgf56137d">12.1.25. anyNA</a></li>
<li><a href="#orgb073998">12.1.26. expression</a></li>
<li><a href="#org582f57f">12.1.27. call</a></li>
<li><a href="#org4bfd287">12.1.28. 科学计算符号</a></li>
<li><a href="#orgf586997">12.1.29. reduce</a></li>
<li><a href="#org4025fb8">12.1.30. reduce2</a></li>
<li><a href="#org5678aeb">12.1.31. get</a></li>
<li><a href="#org13c7f26">12.1.32. assign</a></li>
<li><a href="#orgebb9ea2">12.1.33. attr</a></li>
<li><a href="#org4217ebd">12.1.34. body</a></li>
<li><a href="#org57b7ce3">12.1.35. strrep</a></li>
<li><a href="#orgdeb0316">12.1.36. utils</a>
<ul>
<li><a href="#org25eacef">12.1.36.1. adist</a></li>
<li><a href="#orgcfc19b9">12.1.36.2. apropos</a></li>
<li><a href="#org81a9c0f">12.1.36.3. person</a></li>
<li><a href="#org03d3eb4">12.1.36.4. roman</a></li>
<li><a href="#orgd386b9e">12.1.36.5. askYesNo</a></li>
<li><a href="#orgeaeb8ae">12.1.36.6. bibentry</a></li>
<li><a href="#org66014ee">12.1.36.7. browseEnv</a></li>
<li><a href="#org9ad6174">12.1.36.8. browseURL</a></li>
<li><a href="#org7d0e6f2">12.1.36.9. browseVignettes</a></li>
<li><a href="#orge13848c">12.1.36.10. bug.report</a></li>
<li><a href="#orgb0d5020">12.1.36.11. capture.output</a></li>
<li><a href="#orgf0a63cf">12.1.36.12. changedFiles</a></li>
<li><a href="#orgc19483f">12.1.36.13. citation</a></li>
<li><a href="#orge186de8">12.1.36.14. cite</a></li>
<li><a href="#orga666477">12.1.36.15. clipboard</a></li>
<li><a href="#orgc47314e">12.1.36.16. txtProgressBar</a></li>
<li><a href="#org4cc1d38">12.1.36.17. combn</a></li>
<li><a href="#org37bfd56">12.1.36.18. compareVersion</a></li>
<li><a href="#org149cbb9">12.1.36.19. compile</a></li>
<li><a href="#orgd1d8340">12.1.36.20. data</a></li>
<li><a href="#org4570f42">12.1.36.21. demo</a></li>
<li><a href="#org016191e">12.1.36.22. file.edit</a></li>
<li><a href="#orga42a6d2">12.1.36.23. select.list</a></li>
<li><a href="#orgca9beac">12.1.36.24. stack/unstack</a></li>
<li><a href="#org8288ccc">12.1.36.25. fix</a></li>
</ul>
</li>
<li><a href="#orgb322325">12.1.37. data.matrix</a></li>
<li><a href="#org9320f6d">12.1.38. get</a></li>
<li><a href="#orgfe5c1eb">12.1.39. cut</a></li>
<li><a href="#orgf21e381">12.1.40. stop</a></li>
<li><a href="#org2fb5032">12.1.41. data.class</a></li>
<li><a href="#orge6d23e2">12.1.42. substitute</a></li>
<li><a href="#orgaca2e9c">12.1.43. deparse</a></li>
</ul>
</li>
<li><a href="#orgae2e4da">12.2. dplyr</a>
<ul>
<li><a href="#orgefac555">12.2.1. filter</a>
<ul>
<li><a href="#orgc88a28d">12.2.1.1. filter<sub>all</sub></a></li>
<li><a href="#orgf5c4a0b">12.2.1.2. filter<sub>at</sub></a></li>
<li><a href="#org4939145">12.2.1.3. filter<sub>if</sub></a></li>
</ul>
</li>
<li><a href="#orgbdc8bb9">12.2.2. first/last/nth</a></li>
<li><a href="#orge47a3ff">12.2.3. across</a></li>
<li><a href="#org7782330">12.2.4. c<sub>cross</sub></a></li>
<li><a href="#org79ad1d6">12.2.5. arrange</a></li>
<li><a href="#orgcef2716">12.2.6. select</a>
<ul>
<li><a href="#orge06b93f">12.2.6.1. select<sub>all</sub>(),select<sub>at</sub>(),select<sub>if</sub>()</a></li>
</ul>
</li>
<li><a href="#orgae38ace">12.2.7. pull</a></li>
<li><a href="#orgc4cccbe">12.2.8. group<sub>by</sub></a>
<ul>
<li><a href="#org76baf5f">12.2.8.1. group<sub>by</sub><sub>all,group</sub><sub>by</sub><sub>at,group</sub><sub>by</sub><sub>if</sub></a></li>
<li><a href="#org224bd33">12.2.8.2. group<sub>cols,group</sub><sub>rows</sub></a></li>
<li><a href="#org50c713a">12.2.8.3. group<sub>data</sub>()</a></li>
<li><a href="#org92a135d">12.2.8.4. group<sub>split</sub></a></li>
<li><a href="#org11a8c4d">12.2.8.5. group<sub>keys</sub></a></li>
<li><a href="#org5881c0b">12.2.8.6. group<sub>trim</sub></a></li>
<li><a href="#orgcea5910">12.2.8.7. group<sub>map</sub>()</a></li>
<li><a href="#orgd4c33f4">12.2.8.8. group<sub>modify</sub>()</a></li>
<li><a href="#org22d4f5e">12.2.8.9. group<sub>nest</sub></a></li>
<li><a href="#orgfb1e73b">12.2.8.10. group<sub>size</sub>/n<sub>groups</sub></a></li>
<li><a href="#org184aa7e">12.2.8.11. ungroup</a></li>
<li><a href="#orgf149d74">12.2.8.12. group<sub>indices</sub></a></li>
<li><a href="#org414c257">12.2.8.13. groups/group<sub>vars</sub></a></li>
</ul>
</li>
<li><a href="#org0cd6ee3">12.2.9. context</a></li>
<li><a href="#org42b79a3">12.2.10. rename</a></li>
<li><a href="#org4e8046d">12.2.11. mutate</a>
<ul>
<li><a href="#org6b5e013">12.2.11.1. mutate<sub>all</sub></a></li>
<li><a href="#orgd570e22">12.2.11.2. mutate<sub>if</sub></a></li>
<li><a href="#org63fc78d">12.2.11.3. mutate<sub>at</sub>()</a></li>
</ul>
</li>
<li><a href="#org9b88660">12.2.12. transmute</a></li>
<li><a href="#org9c30e38">12.2.13. add<sub>column</sub>()/add<sub>row</sub>()</a></li>
<li><a href="#org2de9f92">12.2.14. bind<sub>rows\bind</sub><sub>cols</sub></a></li>
<li><a href="#org8ef186a">12.2.15. summarise</a>
<ul>
<li><a href="#orgae7738c">12.2.15.1. summarise<sub>each</sub>()</a></li>
<li><a href="#org6956596">12.2.15.2. summarise<sub>at</sub></a></li>
<li><a href="#org0509053">12.2.15.3. summarise<sub>all</sub></a></li>
</ul>
</li>
<li><a href="#org33f6891">12.2.16. sample<sub>n</sub></a></li>
<li><a href="#org4710573">12.2.17. tally</a></li>
<li><a href="#org7d37902">12.2.18. add<sub>tally</sub></a></li>
<li><a href="#org1e57e7b">12.2.19. count</a></li>
<li><a href="#orge630039">12.2.20. distinct</a>
<ul>
<li><a href="#org51537e0">12.2.20.1. distinct<sub>at</sub></a></li>
<li><a href="#org738bfaa">12.2.20.2. distinct<sub>if</sub></a></li>
<li><a href="#org1d8f91e">12.2.20.3. distinct<sub>all</sub></a></li>
</ul>
</li>
<li><a href="#org1cc99cb">12.2.21. do()</a></li>
<li><a href="#org5e0556d">12.2.22. n<sub>distinct</sub>()</a></li>
<li><a href="#org1f4cfee">12.2.23. slice()</a></li>
<li><a href="#org613b59a">12.2.24. between()</a></li>
<li><a href="#orgdf018e2">12.2.25. case<sub>when</sub>()</a></li>
<li><a href="#org025cf66">12.2.26. if<sub>else</sub>()</a></li>
<li><a href="#org899bccb">12.2.27. na<sub>if</sub>()</a></li>
<li><a href="#orgc438fb9">12.2.28. recode()</a></li>
<li><a href="#orgdf8fde0">12.2.29. recode<sub>factor</sub>()</a></li>
<li><a href="#org3ee0105">12.2.30. near()</a></li>
<li><a href="#org5d9ebba">12.2.31. rowwise()</a></li>
<li><a href="#org67f4b0a">12.2.32. all<sub>equal</sub>()</a></li>
<li><a href="#org130f32e">12.2.33. rownames<sub>to</sub><sub>column</sub>/column<sub>to</sub><sub>rownames</sub></a></li>
<li><a href="#orge660a56">12.2.34. do</a></li>
<li><a href="#orge2e2ab1">12.2.35. tbl<sub>df</sub>()</a></li>
<li><a href="#org2a8e97e">12.2.36. src<sub>dbi</sub>()</a></li>
<li><a href="#orgb188c18">12.2.37. coalesce()</a></li>
<li><a href="#orgc143f0a">12.2.38. separate<sub>rows</sub></a></li>
<li><a href="#orgb7252fe">12.2.39. separate</a></li>
<li><a href="#org3b06a32">12.2.40. combine()</a></li>
<li><a href="#org38631d7">12.2.41. ranking()</a></li>
<li><a href="#orge279077">12.2.42. order<sub>by</sub>()</a></li>
<li><a href="#orgf224ca8">12.2.43. join</a></li>
<li><a href="#org5aa02d2">12.2.44. lead-lag</a></li>
<li><a href="#orgbc9f57e">12.2.45. set manipulation</a></li>
</ul>
</li>
<li><a href="#orgbb8d4d3">12.3. dbplyr</a>
<ul>
<li><a href="#org8492fa3">12.3.1. sql<sub>render</sub></a></li>
<li><a href="#orga0ff1ed">12.3.2. translate<sub>sql</sub>()</a></li>
</ul>
</li>
<li><a href="#orgc9abb97">12.4. purrr</a>
<ul>
<li><a href="#org8360b65">12.4.1. accumulate</a></li>
<li><a href="#org5dce560">12.4.2. accumulate2</a></li>
<li><a href="#orga0192a9">12.4.3. simplify</a></li>
<li><a href="#orgcc41438">12.4.4. working with list</a>
<ul>
<li><a href="#org66e24f4">12.4.4.1. array<sub>branch</sub></a></li>
<li><a href="#org93768e4">12.4.4.2. array<sub>tree</sub></a></li>
<li><a href="#org03cd13f">12.4.4.3. cross</a></li>
<li><a href="#orgd7a99c6">12.4.4.4. cross2</a></li>
<li><a href="#orgd9fa8e5">12.4.4.5. cross<sub>df</sub></a></li>
<li><a href="#org390627c">12.4.4.6. set<sub>names</sub></a></li>
</ul>
</li>
<li><a href="#org1c8253f">12.4.5. assign<sub>in</sub></a></li>
<li><a href="#orgb27e79c">12.4.6. modify<sub>in</sub></a></li>
<li><a href="#org434be7a">12.4.7. pluck</a></li>
<li><a href="#org0a2bcf8">12.4.8. map</a></li>
<li><a href="#org6fc61a9">12.4.9. exec</a></li>
<li><a href="#orgee8013a">12.4.10. every</a></li>
<li><a href="#org5923c49">12.4.11. some</a></li>
<li><a href="#orgbe0f21d">12.4.12. keep</a></li>
<li><a href="#org77728ba">12.4.13. reshape lists</a>
<ul>
<li><a href="#org8294220">12.4.13.1. flatten</a></li>
<li><a href="#org5a1219c">12.4.13.2. flatten<sub>chr</sub>/flatten<sub>dfr</sub>/flatten<sub>int</sub>/flatten<sub>lgl</sub></a></li>
<li><a href="#orgc890b89">12.4.13.3. transpose</a></li>
</ul>
</li>
<li><a href="#orgb5b9f7c">12.4.14. append</a></li>
<li><a href="#org80bafdb">12.4.15. prepend</a></li>
<li><a href="#org9f0edd4">12.4.16. has<sub>element</sub></a></li>
<li><a href="#org3117002">12.4.17. compact</a></li>
<li><a href="#org9577728">12.4.18. split</a></li>
<li><a href="#org6519ef2">12.4.19. modify function behavior</a>
<ul>
<li><a href="#org6c65c31">12.4.19.1. compose</a></li>
<li><a href="#org984ae56">12.4.19.2. lift</a>
<ul>
<li><a href="#orgd1f04af">12.4.19.2.1. lift<sub>dl</sub></a></li>
<li><a href="#orgbe6ff18">12.4.19.2.2. lift<sub>vl</sub></a></li>
</ul>
</li>
<li><a href="#org8584a3e">12.4.19.3. rerun</a></li>
<li><a href="#orgf82b8fd">12.4.19.4. negate</a></li>
<li><a href="#orged8c415">12.4.19.5. safely</a></li>
<li><a href="#org4ed13e4">12.4.19.6. partial</a></li>
<li><a href="#org044ad87">12.4.19.7. quietly</a></li>
<li><a href="#org839fa1b">12.4.19.8. possibly</a></li>
</ul>
</li>
<li><a href="#org0f60f96">12.4.20. invoke</a></li>
<li><a href="#org00ddfec">12.4.21. invoke<sub>map</sub></a></li>
<li><a href="#orgafaa77c">12.4.22. exec</a></li>
<li><a href="#orgd7e2c6c">12.4.23. map</a>
<ul>
<li><a href="#orgcca8d78">12.4.23.1. map<sub>lgl</sub></a></li>
<li><a href="#orgb08dd6d">12.4.23.2. map<sub>chr</sub></a></li>
<li><a href="#org95d195a">12.4.23.3. map<sub>int</sub></a></li>
<li><a href="#orgbb4c2e2">12.4.23.4. map<sub>dbl</sub></a></li>
<li><a href="#orga4f6da6">12.4.23.5. map<sub>at</sub></a></li>
</ul>
</li>
<li><a href="#org97349c1">12.4.24. map<sub>if</sub></a></li>
<li><a href="#org129f915">12.4.25. as<sub>mapper</sub></a></li>
<li><a href="#org1fa794b">12.4.26. map2</a></li>
<li><a href="#org160a263">12.4.27. pmap</a></li>
<li><a href="#orgbd41ded">12.4.28. pwalk</a></li>
<li><a href="#orgde3f9bf">12.4.29. list<sub>modify</sub></a></li>
<li><a href="#orge1ce197">12.4.30. imap_</a></li>
<li><a href="#org768a334">12.4.31. lmap</a></li>
<li><a href="#orgdfa4ca4">12.4.32. modify</a></li>
<li><a href="#orgbe0244a">12.4.33. vec<sub>depth</sub></a></li>
<li><a href="#orgedec014">12.4.34. reduce</a></li>
<li><a href="#org2c88a7c">12.4.35. detect</a></li>
<li><a href="#orgcc59a9f">12.4.36. detect<sub>index</sub></a></li>
<li><a href="#org041b751">12.4.37. head<sub>while</sub>/tail<sub>while</sub></a></li>
<li><a href="#org83ca9bd">12.4.38. rep<sub>along</sub></a></li>
<li><a href="#org015870e">12.4.39. %||%</a></li>
<li><a href="#org562ea35">12.4.40. as<sub>mapper</sub></a></li>
<li><a href="#orgc8f2f7f">12.4.41. as<sub>vector</sub></a></li>
<li><a href="#orga77e782">12.4.42. attr<sub>getter</sub></a></li>
<li><a href="#org4e0bf6e">12.4.43. join (TO) lists</a>
<ul>
<li><a href="#org3ba8b05">12.4.43.1. append</a></li>
<li><a href="#orge5f2fdb">12.4.43.2. prepend</a></li>
<li><a href="#org52582ab">12.4.43.3. splice</a></li>
</ul>
</li>
<li><a href="#orge379322">12.4.44. set<sub>names</sub></a></li>
</ul>
</li>
<li><a href="#org0f72ed1">12.5. furrr</a>
<ul>
<li><a href="#org00aac7a">12.5.1. future<sub>imap</sub><sub>chr</sub></a></li>
<li><a href="#org364f58a">12.5.2. future<sub>map</sub></a></li>
<li><a href="#org17f378f">12.5.3. future<sub>map2</sub></a></li>
<li><a href="#orgd2fce62">12.5.4. future<sub>pmap</sub></a></li>
</ul>
</li>
<li><a href="#orgdc81d6b">12.6. plyr</a>
<ul>
<li><a href="#orga658308">12.6.1. rbind.fill</a></li>
<li><a href="#org5c2f1fa">12.6.2. join<sub>all</sub></a></li>
<li><a href="#org7a0c347">12.6.3. mlply</a></li>
<li><a href="#orgc4d80ab">12.6.4. each</a></li>
<li><a href="#org68cb447">12.6.5. failwith</a></li>
<li><a href="#org31b1678">12.6.6. round<sub>any</sub></a></li>
<li><a href="#org6110d38">12.6.7. ddply</a></li>
<li><a href="#org02e09a5">12.6.8. adply</a></li>
<li><a href="#org698ba0e">12.6.9. colwise</a></li>
</ul>
</li>
<li><a href="#org12984ce">12.7. pryr</a>
<ul>
<li><a href="#org5e141ea">12.7.1. %.%</a></li>
<li><a href="#orgb762954">12.7.2. otype</a></li>
<li><a href="#org4e478da">12.7.3. %&lt;a-%</a></li>
<li><a href="#org1bd0cca">12.7.4. %&lt;d-%</a></li>
<li><a href="#org6c6cd05">12.7.5. %&lt;c-%</a></li>
<li><a href="#org6a57248">12.7.6. typename</a></li>
<li><a href="#org04763a3">12.7.7. address</a></li>
<li><a href="#orgaa71d3c">12.7.8. inspect</a></li>
<li><a href="#org26fb1ec">12.7.9. f</a></li>
<li><a href="#org89e05e5">12.7.10. make<sub>call</sub></a></li>
<li><a href="#org5e2a732">12.7.11. f<sub>capture</sub></a></li>
<li><a href="#org0a6e2bb">12.7.12. f<sub>eval</sub></a></li>
<li><a href="#org1aaa252">12.7.13. dots<sub>capture</sub></a></li>
<li><a href="#orgce462bb">12.7.14. fget</a></li>
<li><a href="#org7fe2270">12.7.15. find<sub>funs</sub></a></li>
<li><a href="#orgf617a97">12.7.16. modify<sub>lang</sub></a></li>
<li><a href="#org2dee16f">12.7.17. object<sub>size</sub></a></li>
<li><a href="#org6c11546">12.7.18. find<sub>uses</sub></a></li>
<li><a href="#orgec1fa6f">12.7.19. partial</a></li>
<li><a href="#orgee5f8b3">12.7.20. rebind</a></li>
<li><a href="#orgbae01ae">12.7.21. lazy<sub>eval</sub></a></li>
</ul>
</li>
<li><a href="#org8b593b5">12.8. tidyr</a>
<ul>
<li><a href="#org2a1fd9f">12.8.1. chop()</a></li>
<li><a href="#orga818f62">12.8.2. unchop()</a></li>
<li><a href="#org02df4e4">12.8.3. complete()</a></li>
<li><a href="#org9aa1915">12.8.4. expand</a></li>
<li><a href="#org5d8a2d0">12.8.5. expand<sub>grid</sub></a></li>
<li><a href="#orgecf6842">12.8.6. drop<sub>na</sub></a></li>
<li><a href="#org9cb55b4">12.8.7. extract</a></li>
<li><a href="#orgdae9d38">12.8.8. unite</a></li>
<li><a href="#org06b001d">12.8.9. fill</a></li>
<li><a href="#org81650d1">12.8.10. full<sub>seq</sub></a></li>
<li><a href="#orga97f333">12.8.11. gather</a></li>
<li><a href="#org09a8e9a">12.8.12. spread</a></li>
<li><a href="#org451d505">12.8.13. nest/unnest</a></li>
<li><a href="#org1d2d14a">12.8.14. pack</a></li>
<li><a href="#orgf8bd9bb">12.8.15. hoist</a></li>
<li><a href="#org331b9fd">12.8.16. unnest<sub>wider</sub></a></li>
<li><a href="#org781fcee">12.8.17. unnest<sub>longer</sub></a></li>
<li><a href="#org7e76366">12.8.18. unnest<sub>auto</sub></a></li>
<li><a href="#orgba092c3">12.8.19. replace<sub>na</sub></a></li>
<li><a href="#orgdaf7bd6">12.8.20. pivoting</a>
<ul>
<li><a href="#org3d740b2">12.8.20.1. pivot<sub>longer</sub></a></li>
<li><a href="#org3f31a29">12.8.20.2. pivot<sub>wider</sub></a></li>
</ul>
</li>
<li><a href="#orga02d7f7">12.8.21. uncount</a></li>
<li><a href="#org4d6ae1f">12.8.22. separate</a>
<ul>
<li><a href="#orgf8aaae2">12.8.22.1. separate<sub>rows</sub></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org554ac3c">12.9. magrittr</a>
<ul>
<li><a href="#org7db068c">12.9.1. set<sub>rownames</sub>()</a></li>
<li><a href="#orgdbcaf88">12.9.2. extract</a></li>
<li><a href="#org165759f">12.9.3. %&gt;%/%&lt;&gt;%/%T&gt;%/%$%</a></li>
<li><a href="#org3b6a227">12.9.4. inset</a></li>
<li><a href="#orga5087de">12.9.5. inset2</a></li>
<li><a href="#orgd8fbca7">12.9.6. <span class="todo TODO">TODO</span> crossing()</a></li>
</ul>
</li>
<li><a href="#org8a0a1bd">12.10. tidymodel</a>
<ul>
<li><a href="#orgfe16220">12.10.1. crayon</a>
<ul>
<li><a href="#orgf2540f9">12.10.1.1. %+%</a></li>
</ul>
</li>
<li><a href="#org2dc285a">12.10.2. broom</a></li>
<li><a href="#org9427924">12.10.3. tidy</a></li>
<li><a href="#org53c014d">12.10.4. glance</a></li>
<li><a href="#org689f23e">12.10.5. augment</a></li>
<li><a href="#org23ba536">12.10.6. infer</a>
<ul>
<li><a href="#orgb2e7bc8">12.10.6.1. specify</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orge7b04cc">12.11. rlang</a>
<ul>
<li><a href="#orgfe621f9">12.11.1. missing</a></li>
<li><a href="#org753dd53">12.11.2. call2</a></li>
<li><a href="#orgf4a413d">12.11.3. is<sub>call</sub></a></li>
<li><a href="#orgd27e375">12.11.4. quo</a></li>
<li><a href="#orgadba107">12.11.5. get<sub>expr</sub></a></li>
<li><a href="#orge7e066b">12.11.6. eval<sub>tidy</sub></a></li>
<li><a href="#org65fed0c">12.11.7. seq2</a></li>
<li><a href="#org67f185f">12.11.8. type-predicates</a></li>
<li><a href="#org3094ec6">12.11.9. tidy-dots</a></li>
<li><a href="#org3079d5b">12.11.10. ensyms</a></li>
<li><a href="#orge478e93">12.11.11. list2</a></li>
<li><a href="#orgb854321">12.11.12. as<sub>function</sub></a></li>
<li><a href="#orgeaf206d">12.11.13. as<sub>label</sub></a></li>
<li><a href="#org6829c32">12.11.14. as<sub>name</sub></a></li>
<li><a href="#org0bf6e59">12.11.15. names2</a>
<ul>
<li><a href="#orgfa52c8c">12.11.15.1. nse-defuse</a>
<ul>
<li><a href="#org33eae65">12.11.15.1.1. expr()/enquo()</a></li>
</ul>
</li>
<li><a href="#org4ae3770">12.11.15.2. env<sub>get</sub></a></li>
<li><a href="#org909c871">12.11.15.3. env<sub>print</sub></a></li>
<li><a href="#org2aa0002">12.11.15.4. f<sub>text</sub></a></li>
<li><a href="#orgb1df2e0">12.11.15.5. f<sub>rhs</sub>/f<sub>lhs</sub></a></li>
<li><a href="#orga358e99">12.11.15.6. env<sub>bind</sub></a></li>
<li><a href="#orge24623a">12.11.15.7. vector-construcion</a></li>
<li><a href="#org8b61e93">12.11.15.8. missing</a></li>
<li><a href="#orgfeb73e0">12.11.15.9. quasiquotation</a>
<ul>
<li><a href="#org46b96de">12.11.15.9.1. !!</a></li>
<li><a href="#org3dd862a">12.11.15.9.2. !!!</a></li>
</ul>
</li>
<li><a href="#org95281c8">12.11.15.10. new<sub>list</sub>/new<sub>logical</sub></a></li>
<li><a href="#org073c56b">12.11.15.11. %|%</a></li>
<li><a href="#org09675d9">12.11.15.12. %||%</a></li>
</ul>
</li>
<li><a href="#org120caab">12.11.16. rsample</a>
<ul>
<li><a href="#org47ee43c">12.11.16.1. bootstraps</a></li>
</ul>
</li>
<li><a href="#orgb875d62">12.11.17. tibble</a>
<ul>
<li><a href="#org5ecd490">12.11.17.1. add<sub>row</sub></a></li>
<li><a href="#org3cc9d9b">12.11.17.2. add<sub>column</sub></a></li>
<li><a href="#org272b9e6">12.11.17.3. as<sub>tibble</sub></a></li>
<li><a href="#org683df92">12.11.17.4. enframe</a></li>
<li><a href="#orgbf03c9f">12.11.17.5. deframe</a></li>
<li><a href="#org449a558">12.11.17.6. has<sub>rownames</sub></a></li>
<li><a href="#orgb85b08b">12.11.17.7. glimpse</a></li>
<li><a href="#org86d95ec">12.11.17.8. is<sub>tibble</sub></a></li>
<li><a href="#orgc8115c3">12.11.17.9. type<sub>sum</sub></a></li>
<li><a href="#org44f01f6">12.11.17.10. subsetting</a></li>
<li><a href="#org113d106">12.11.17.11. tribble</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgf7bebd4">12.12. abind</a></li>
<li><a href="#org7552909">12.13. glue</a>
<ul>
<li><a href="#orgdc3ed74">12.13.1. glue</a></li>
<li><a href="#orgf3413bd">12.13.2. glue<sub>collapse</sub></a></li>
<li><a href="#org9ec84fb">12.13.3. glue<sub>data</sub></a></li>
<li><a href="#orgf6ccc57">12.13.4. glue<sub>col</sub></a></li>
<li><a href="#org3d01a7d">12.13.5. glue<sub>sql</sub></a></li>
</ul>
</li>
<li><a href="#orgbd4150d">12.14. unglue<sub>data</sub></a></li>
<li><a href="#org1257745">12.15. data.table</a>
<ul>
<li><a href="#org6264bce">12.15.1. as.data.table</a></li>
<li><a href="#orga4b9a6c">12.15.2. address</a></li>
<li><a href="#org896eaf5">12.15.3. %between%</a></li>
<li><a href="#org85c33d3">12.15.4. %inrange%</a></li>
<li><a href="#org408522a">12.15.5. all.equal</a></li>
<li><a href="#org1f42c71">12.15.6. duplicated</a></li>
<li><a href="#org9df63fe">12.15.7. anyDuplicated</a></li>
<li><a href="#org5a06b30">12.15.8. uniqueN</a></li>
<li><a href="#org6093efe">12.15.9. IDateTime</a>
<ul>
<li><a href="#org810929d">12.15.9.1. as.ITime</a></li>
</ul>
</li>
<li><a href="#org085fb27">12.15.10. roll</a>
<ul>
<li><a href="#orgbf81e3f">12.15.10.1. froll</a></li>
</ul>
</li>
<li><a href="#org717e70d">12.15.11. nafill</a></li>
<li><a href="#org3921e0b">12.15.12. melt</a></li>
<li><a href="#org475f6e2">12.15.13. %like%</a></li>
<li><a href="#orgeb3fc46">12.15.14. chmatch</a></li>
<li><a href="#orgfbfa99a">12.15.15. %chin%</a></li>
<li><a href="#org04ec66a">12.15.16. na.omit</a></li>
<li><a href="#org5a10cc3">12.15.17. rleid</a></li>
<li><a href="#org79d7d35">12.15.18. tstrsplit</a></li>
</ul>
</li>
<li><a href="#orga7518c5">12.16. readr</a>
<ul>
<li><a href="#orgc398cdc">12.16.1. parse<sub>*</sub></a></li>
<li><a href="#org44bc04e">12.16.2. type<sub>convert</sub></a></li>
</ul>
</li>
<li><a href="#orgbe9ed46">12.17. stringr</a>
<ul>
<li><a href="#org17ab774">12.17.1. 其他类型的模式</a>
<ul>
<li><a href="#orgba5c7f9">12.17.1.1. regex()</a>
<ul>
<li><a href="#org78857c8">12.17.1.1.1. ignore<sub>case</sub> = TRUE</a></li>
<li><a href="#org93535cb">12.17.1.1.2. multiline = TRUE</a></li>
<li><a href="#orga296bc4">12.17.1.1.3. comments = TRUE</a></li>
<li><a href="#org03465d9">12.17.1.1.4. dotall = TRUE</a></li>
</ul>
</li>
<li><a href="#orgb03064d">12.17.1.2. fixed()</a></li>
<li><a href="#orgca41e43">12.17.1.3. coll()</a></li>
<li><a href="#org3f66514">12.17.1.4. boundary</a></li>
<li><a href="#orga27f153">12.17.1.5. 匹配.</a></li>
<li><a href="#org3bce782">12.17.1.6. 匹配\</a></li>
<li><a href="#org8888e6a">12.17.1.7. 锚点</a></li>
<li><a href="#orgb26fd51">12.17.1.8. 匹配多个字符</a></li>
</ul>
</li>
<li><a href="#orge981edf">12.17.2. str<sub>c</sub></a></li>
<li><a href="#orge926e98">12.17.3. str<sub>length</sub></a></li>
<li><a href="#org2fea3cd">12.17.4. str<sub>sub</sub></a></li>
<li><a href="#org3392852">12.17.5. str<sub>sort</sub></a></li>
<li><a href="#orgb5ba2c2">12.17.6. str<sub>order</sub></a></li>
<li><a href="#orgf38d35f">12.17.7. str<sub>dup</sub></a></li>
<li><a href="#org0760677">12.17.8. str<sub>pad</sub></a></li>
<li><a href="#orge2d4b46">12.17.9. str<sub>detect</sub></a></li>
<li><a href="#orgbb0a064">12.17.10. str<sub>remove</sub></a></li>
<li><a href="#org3895a76">12.17.11. str<sub>subset</sub></a></li>
<li><a href="#org63f9b57">12.17.12. str<sub>count</sub></a></li>
<li><a href="#org0e034ed">12.17.13. str<sub>view</sub></a>
<ul>
<li><a href="#orgb52f4a7">12.17.13.1. str<sub>view</sub><sub>all</sub></a></li>
</ul>
</li>
<li><a href="#org6a00b6b">12.17.14. str<sub>to</sub><sub>lower</sub>/str<sub>to</sub><sub>upper</sub></a></li>
<li><a href="#org9268437">12.17.15. str<sub>to</sub><sub>title</sub></a></li>
<li><a href="#orga67815b">12.17.16. str<sub>to</sub><sub>sentence</sub></a></li>
<li><a href="#org99919c1">12.17.17. str<sub>extract</sub></a></li>
<li><a href="#orgd8680ed">12.17.18. str<sub>match</sub></a></li>
<li><a href="#orge460b60">12.17.19. str<sub>which</sub></a></li>
<li><a href="#orgbd4b9cc">12.17.20. str<sub>replace</sub></a>
<ul>
<li><a href="#orgdd9773f">12.17.20.1. str<sub>replace</sub><sub>all</sub></a></li>
</ul>
</li>
<li><a href="#org7c16ca7">12.17.21. str<sub>split</sub></a></li>
<li><a href="#org25ed4fe">12.17.22. str<sub>split</sub><sub>fixed</sub></a></li>
<li><a href="#org288e66f">12.17.23. str<sub>locate</sub></a></li>
<li><a href="#orgc9d78f7">12.17.24. str<sub>wrap</sub></a></li>
<li><a href="#orge99d91e">12.17.25. str<sub>trim</sub></a></li>
<li><a href="#orgebda3d2">12.17.26. str<sub>starts</sub></a></li>
<li><a href="#org6e0aac5">12.17.27. str<sub>end</sub></a></li>
<li><a href="#orgc9cb431">12.17.28. grepl</a></li>
<li><a href="#org7572334">12.17.29. str<sub>glue</sub></a></li>
<li><a href="#org59b48d3">12.17.30. str<sub>glue</sub><sub>data</sub></a></li>
<li><a href="#org1ef6e01">12.17.31. str<sub>squish</sub></a></li>
<li><a href="#org800c74b">12.17.32. str<sub>flatten</sub></a></li>
<li><a href="#orge20da17">12.17.33. word</a></li>
<li><a href="#org97db18b">12.17.34. invert<sub>match</sub></a></li>
</ul>
</li>
<li><a href="#orgd6c6054">12.18. stringi</a>
<ul>
<li><a href="#org2988f47">12.18.1. stri<sub>extract</sub><sub>all</sub><sub>words</sub></a></li>
<li><a href="#orgba23ec0">12.18.2. stri<sub>flatten</sub></a></li>
<li><a href="#orgb464ddb">12.18.3. stri<sub>rand</sub><sub>strings</sub></a></li>
<li><a href="#orgd9fd732">12.18.4. stri<sub>reverse</sub></a></li>
</ul>
</li>
<li><a href="#orga1e84cd">12.19. assertthat</a>
<ul>
<li><a href="#org0498383">12.19.1. has<sub>name</sub></a></li>
<li><a href="#orgcb6fcc4">12.19.2. has<sub>attr</sub></a></li>
<li><a href="#org1cb559f">12.19.3. assert-is</a></li>
<li><a href="#org4429b95">12.19.4. assert<sub>that</sub></a>
<ul>
<li><a href="#orga6f4963">12.19.4.1. assert<sub>that</sub></a></li>
<li><a href="#org6a24bca">12.19.4.2. see<sub>if</sub></a></li>
</ul>
</li>
<li><a href="#orga6635dd">12.19.5. not<sub>empty</sub></a></li>
<li><a href="#orgc9e1427">12.19.6. noNA</a></li>
<li><a href="#orge0f1edf">12.19.7. is<sub>dir</sub></a></li>
</ul>
</li>
<li><a href="#orge1605da">12.20. parallel</a>
<ul>
<li><a href="#org5cb5d23">12.20.1. clusterApply</a></li>
</ul>
</li>
<li><a href="#org5c681d3">12.21. rlang</a>
<ul>
<li><a href="#org8c903a5">12.21.1. vocabulary</a>
<ul>
<li><a href="#org7714e82">12.21.1.1. symbol</a></li>
<li><a href="#orga8fe885">12.21.1.2. environment</a></li>
<li><a href="#org50f8c85">12.21.1.3. constant</a></li>
<li><a href="#org392e367">12.21.1.4. call object</a></li>
<li><a href="#org920dbae">12.21.1.5. code</a></li>
<li><a href="#org7b21546">12.21.1.6. expression</a></li>
<li><a href="#orgaffa814">12.21.1.7. quosure</a></li>
</ul>
</li>
<li><a href="#org8da7504">12.21.2. quoting code</a>
<ul>
<li><a href="#orgcb8cf52">12.21.2.1. quosures</a></li>
<li><a href="#org5a87ca9">12.21.2.2. expression</a></li>
</ul>
</li>
<li><a href="#org3339fd0">12.21.3. parsing and deparsing</a></li>
<li><a href="#org5c1eca2">12.21.4. building calls</a></li>
<li><a href="#org5f061e4">12.21.5. evaluation</a>
<ul>
<li><a href="#orgf695545">12.21.5.1. quoted expression</a></li>
<li><a href="#org6c600e1">12.21.5.2. quosures</a></li>
</ul>
</li>
<li><a href="#orgd3630a3">12.21.6. quasiquotation(!!,!!!,:=)</a>
<ul>
<li><a href="#org2eb837e">12.21.6.1. quotation</a></li>
<li><a href="#org7ec79d2">12.21.6.2. quasiquotation</a></li>
</ul>
</li>
<li><a href="#orgb2479ae">12.21.7. programming recipes</a></li>
<li><a href="#orgfed7f6b">12.21.8. functions</a>
<ul>
<li><a href="#orgee5a3d8">12.21.8.1. sym</a></li>
<li><a href="#org9299249">12.21.8.2. {{.}} (curly-curly operator)</a></li>
<li><a href="#orgee1de56">12.21.8.3. &#x2026; argument</a></li>
<li><a href="#org3a94ffb">12.21.8.4. expr,exprs,enquo</a></li>
<li><a href="#orgcce187d">12.21.8.5. %|%</a></li>
<li><a href="#org5f6ca6a">12.21.8.6. exec</a></li>
<li><a href="#org7064577">12.21.8.7. pairlist2</a></li>
<li><a href="#org3d5ece5">12.21.8.8. f<sub>rhs</sub></a></li>
<li><a href="#org53843bd">12.21.8.9. f<sub>lhs</sub></a></li>
<li><a href="#orgec25690">12.21.8.10. fn<sub>body</sub></a></li>
<li><a href="#org99c3201">12.21.8.11. fn<sub>env</sub></a></li>
<li><a href="#org4bb0ad4">12.21.8.12. f<sub>text</sub></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org56f2b79">12.22. blorr</a>
<ul>
<li><a href="#org8909ada">12.22.1. blr<sub>plot</sub><sub>leverage</sub></a></li>
</ul>
</li>
<li><a href="#orgf982332">12.23. caret</a>
<ul>
<li><a href="#org134bc28">12.23.1. confusionMatrix</a></li>
</ul>
</li>
<li><a href="#org7758330">12.24. tibble</a>
<ul>
<li><a href="#orgf2d1829">12.24.1. new<sub>tibble</sub></a></li>
<li><a href="#org82b8ab3">12.24.2. enframe</a></li>
<li><a href="#orgd373aaa">12.24.3. deframe</a></li>
<li><a href="#org1a15d6f">12.24.4. trunc<sub>mat</sub></a></li>
</ul>
</li>
<li><a href="#orgf41d3b6">12.25. cli</a>
<ul>
<li><a href="#org43a09bf">12.25.1. ansi-styles</a>
<ul>
<li><a href="#org1c60032">12.25.1.1. col<sub>blue</sub></a></li>
<li><a href="#org466da2a">12.25.1.2. col<sub>red</sub></a></li>
</ul>
</li>
<li><a href="#org91fbb6d">12.25.2. style<sub>italic</sub></a></li>
<li><a href="#orgea7b10e">12.25.3. combine<sub>ansi</sub><sub>styles</sub></a></li>
<li><a href="#org649d03e">12.25.4. cat<sub>line</sub></a></li>
<li><a href="#org76d76db">12.25.5. cat<sub>bullet</sub></a></li>
<li><a href="#orge0c5f17">12.25.6. boxx</a></li>
<li><a href="#org0da24d9">12.25.7. custom spinner</a></li>
<li><a href="#org241b260">12.25.8. cli<sub>alert</sub></a></li>
<li><a href="#orgd84b6df">12.25.9. cli<sub>alert</sub><sub>success</sub></a></li>
</ul>
</li>
<li><a href="#orgffd9a7c">12.26. clipr</a></li>
<li><a href="#orgc0c1d07">12.27. janitor</a>
<ul>
<li><a href="#org885329f">12.27.1. row<sub>to</sub><sub>names</sub></a></li>
<li><a href="#orgabcc373">12.27.2. tabyl</a></li>
<li><a href="#orgf6af0b1">12.27.3. remove<sub>constant</sub></a></li>
<li><a href="#org28cd62b">12.27.4. get<sub>dupes</sub></a></li>
<li><a href="#orgfbb152d">12.27.5. adorn<sub>total</sub></a></li>
<li><a href="#org9d616ed">12.27.6. adorn<sub>percentages</sub></a></li>
<li><a href="#org506c580">12.27.7. adorn<sub>ns</sub></a></li>
<li><a href="#org8c16e9b">12.27.8. adorn<sub>title</sub></a></li>
<li><a href="#org9415f0d">12.27.9. top<sub>levels</sub></a></li>
<li><a href="#org16b664c">12.27.10. clean<sub>names</sub></a></li>
<li><a href="#org89cab9a">12.27.11. adorn<sub>rounding</sub></a></li>
</ul>
</li>
<li><a href="#orga7eee06">12.28. parallel</a>
<ul>
<li><a href="#orgac1f3cc">12.28.1. mclapply</a></li>
<li><a href="#org65ab167">12.28.2. mcMap</a></li>
<li><a href="#org91259b1">12.28.3. parSapply</a></li>
</ul>
</li>
<li><a href="#orgeedee08">12.29. tidyselect</a>
<ul>
<li><a href="#org61659ea">12.29.1. vars<sub>select</sub></a></li>
<li><a href="#orgf00cbb6">12.29.2. vars<sub>pull</sub></a></li>
<li><a href="#org4ce6552">12.29.3. eval<sub>select</sub></a></li>
<li><a href="#org3a4de33">12.29.4. vars<sub>rename</sub></a></li>
<li><a href="#org20e750d">12.29.5. poker<sub>vars</sub>/peek<sub>vars</sub></a></li>
<li><a href="#orgbf693d5">12.29.6. eval<sub>rename</sub></a></li>
<li><a href="#orgeac1c61">12.29.7. where</a></li>
</ul>
</li>
<li><a href="#orge8c988c">12.30. forcats</a>
<ul>
<li><a href="#org9ac7255">12.30.1. as<sub>factor</sub></a></li>
<li><a href="#orge09b93d">12.30.2. fct<sub>anon</sub></a></li>
<li><a href="#org49add48">12.30.3. fct<sub>c</sub></a></li>
<li><a href="#org874977e">12.30.4. fct<sub>collapse</sub></a></li>
<li><a href="#org98bc8ed">12.30.5. fct<sub>count</sub></a></li>
<li><a href="#orgfdef633">12.30.6. fct<sub>cross</sub></a></li>
<li><a href="#org83ccfef">12.30.7. fct<sub>expand</sub></a></li>
<li><a href="#org67929b5">12.30.8. fct<sub>explicit</sub><sub>na</sub></a></li>
<li><a href="#org9db9d99">12.30.9. fct<sub>inorder</sub>/fct<sub>infreq</sub>/fct<sub>inseq</sub></a></li>
<li><a href="#orgbfe88c9">12.30.10. fct<sub>lump</sub></a></li>
<li><a href="#orgbe537c9">12.30.11. fct<sub>match</sub></a></li>
<li><a href="#orgf86f9c6">12.30.12. fct<sub>other</sub></a></li>
<li><a href="#org19f3672">12.30.13. fct<sub>recode</sub></a></li>
<li><a href="#org99fe9c2">12.30.14. fct<sub>relabel</sub></a></li>
<li><a href="#org0111ac1">12.30.15. fct<sub>relevel</sub></a></li>
<li><a href="#org434c4d4">12.30.16. fct<sub>reorder</sub></a></li>
<li><a href="#org4cf8a10">12.30.17. fct<sub>rev</sub></a></li>
<li><a href="#orga643d50">12.30.18. fct<sub>shift</sub></a></li>
<li><a href="#orgc6ebfa9">12.30.19. fct<sub>shuffle</sub></a></li>
<li><a href="#orga77334d">12.30.20. fct<sub>unify</sub></a></li>
<li><a href="#orgb35b225">12.30.21. fct<sub>unique</sub></a></li>
<li><a href="#orgfa765ed">12.30.22. fct<sub>lump</sub><sub>*</sub></a>
<ul>
<li><a href="#org6603f13">12.30.22.1. fct<sub>lump</sub><sub>min</sub></a></li>
</ul>
</li>
<li><a href="#orgb37084c">12.30.23. lvls</a></li>
<li><a href="#org7120763">12.30.24. lvls<sub>union</sub></a></li>
</ul>
</li>
<li><a href="#org138d52e">12.31. lubridate</a>
<ul>
<li><a href="#org72af46b">12.31.1. 创建日期或时间</a>
<ul>
<li><a href="#org7057bed">12.31.1.1. 通过字符串创建</a></li>
<li><a href="#org27afd74">12.31.1.2. ymd<sub>hms</sub></a></li>
<li><a href="#org1256ece">12.31.1.3. 通过各个成分创建</a></li>
<li><a href="#org0f6ea78">12.31.1.4. 通过其他类型数据创建</a></li>
<li><a href="#orgeab1653">12.31.1.5. year/month/mday/yday/wday/hour/&#x2026;..</a></li>
<li><a href="#org8aedab9">12.31.1.6. update</a></li>
</ul>
</li>
<li><a href="#org8c8ee8b">12.31.2. 获取成分</a></li>
<li><a href="#org58eb8c4">12.31.3. 设置成分</a></li>
<li><a href="#org1d157b1">12.31.4. mdy</a></li>
<li><a href="#org3f8aa43">12.31.5. stamp</a></li>
<li><a href="#org0b6165f">12.31.6. 时间间隔</a></li>
<li><a href="#orge3802c2">12.31.7. 阶段</a></li>
<li><a href="#orgd15d53f">12.31.8. 区间</a></li>
<li><a href="#org1ca8a87">12.31.9. 时区</a></li>
<li><a href="#org0e6ef6b">12.31.10. 其他函数</a>
<ul>
<li><a href="#orge7b1bd9">12.31.10.1. with<sub>tz</sub></a></li>
<li><a href="#orgab21dea">12.31.10.2. force<sub>tz</sub></a></li>
<li><a href="#org16060ef">12.31.10.3. now()</a></li>
<li><a href="#org31048a5">12.31.10.4. ymd<sub>hms</sub></a></li>
<li><a href="#org8e45b67">12.31.10.5. as<sub>date</sub></a></li>
<li><a href="#org64fb714">12.31.10.6. as<sub>datetime</sub></a></li>
<li><a href="#orgc1b6b57">12.31.10.7. %m+% %m-%</a></li>
<li><a href="#org0ffc75c">12.31.10.8. leap<sub>year</sub></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org6b9015d">12.32. DBI</a>
<ul>
<li><a href="#org027aef2">12.32.1. dbGetQuery</a></li>
</ul>
</li>
<li><a href="#org88e97b9">12.33. sparklyr</a>
<ul>
<li><a href="#org0fe8d44">12.33.1. spark<sub>web</sub></a></li>
<li><a href="#orga13d63c">12.33.2. 复制多行数据</a></li>
<li><a href="#org8dd0f97">12.33.3. <span class="todo TODO">TODO</span> 矩阵相乘</a></li>
<li><a href="#org502c568">12.33.4. 添加日期</a></li>
</ul>
</li>
<li><a href="#orgd0347d2">12.34. readr</a>
<ul>
<li><a href="#orge59eadc">12.34.1. parse<sub>number</sub></a></li>
</ul>
</li>
<li><a href="#orgae8e645">12.35. remedy</a></li>
<li><a href="#org5083b17">12.36. vctrs</a>
<ul>
<li><a href="#orgab766ad">12.36.1. vec<sub>c</sub></a></li>
<li><a href="#orgce29c02">12.36.2. vec<sub>assert</sub></a></li>
<li><a href="#orgb378c57">12.36.3. vec<sub>is</sub></a></li>
<li><a href="#orgebc50d7">12.36.4. vec<sub>bind</sub></a></li>
<li><a href="#org273a64e">12.36.5. vec<sub>compare</sub></a></li>
<li><a href="#orgb3f0a50">12.36.6. vec<sub>duplicate</sub><sub>any</sub>/vec<sub>duplicate</sub><sub>detect</sub></a></li>
<li><a href="#org72d573b">12.36.7. vec<sub>match</sub></a></li>
<li><a href="#org36c2dec">12.36.8. vec<sub>in</sub></a></li>
<li><a href="#org27f0a4f">12.36.9. vec<sub>chop</sub></a></li>
<li><a href="#org7459d74">12.36.10. vec<sub>unchop</sub></a></li>
<li><a href="#orgd1936f8">12.36.11. vec<sub>cast</sub></a></li>
<li><a href="#org7360860">12.36.12. vec<sub>equal</sub></a></li>
<li><a href="#org7dc6ec9">12.36.13. vec<sub>init</sub></a></li>
<li><a href="#orgd34a196">12.36.14. vec<sub>seq</sub><sub>along</sub>/vec<sub>init</sub><sub>along</sub></a></li>
<li><a href="#orgc50821d">12.36.15. vec<sub>order</sub></a></li>
<li><a href="#org1c6a392">12.36.16. vec<sub>sort</sub></a></li>
<li><a href="#orgff5420c">12.36.17. vec<sub>count</sub></a></li>
<li><a href="#orgf1cec1b">12.36.18. vec<sub>size</sub></a></li>
<li><a href="#orgadb6c72">12.36.19. vec<sub>slice</sub></a></li>
<li><a href="#org97085f2">12.36.20. vec<sub>assign</sub></a></li>
<li><a href="#orgb6d489b">12.36.21. vec<sub>recycle</sub>/vec<sub>recycle</sub><sub>common</sub></a></li>
<li><a href="#org4fd4db2">12.36.22. vec<sub>repeat</sub></a></li>
<li><a href="#org0c4880b">12.36.23. vec<sub>split</sub></a></li>
<li><a href="#org3e16a1a">12.36.24. vec<sub>unique</sub></a></li>
<li><a href="#org4e5b065">12.36.25. vec<sub>ptype</sub></a>
<ul>
<li><a href="#org910c30b">12.36.25.1. vec<sub>ptype</sub><sub>show</sub></a></li>
</ul>
</li>
<li><a href="#org5289449">12.36.26. vec<sub>arith</sub></a></li>
<li><a href="#orgd602483">12.36.27. vec<sub>as</sub><sub>location</sub></a></li>
<li><a href="#org4e988d6">12.36.28. vec<sub>type</sub></a></li>
<li><a href="#org7931305">12.36.29. %0%</a></li>
<li><a href="#orgdd31468">12.36.30. vec<sub>cast.glue</sub></a></li>
</ul>
</li>
<li><a href="#orgb7b0ed9">12.37. slider</a>
<ul>
<li><a href="#org0fc6e29">12.37.1. block</a></li>
<li><a href="#org5250cac">12.37.2. hop</a></li>
<li><a href="#org5bea656">12.37.3. slide2</a></li>
<li><a href="#org7393d81">12.37.4. slide<sub>period</sub></a></li>
</ul>
</li>
<li><a href="#org44379f8">12.38. Rcpp</a>
<ul>
<li><a href="#orgae64c19">12.38.1. cppFunction</a></li>
<li><a href="#org0d2ce18">12.38.2. sourceCpp</a></li>
</ul>
</li>
<li><a href="#orgea6e5a4">12.39. usethis</a>
<ul>
<li><a href="#org362e7e0">12.39.1. ui<sub>done</sub></a></li>
<li><a href="#orge5dffb7">12.39.2. ui<sub>todo</sub></a></li>
<li><a href="#org115c04e">12.39.3. ui<sub>oops</sub></a></li>
<li><a href="#org787a03c">12.39.4. ui<sub>info</sub></a></li>
<li><a href="#org6071107">12.39.5. ui<sub>yeah</sub></a></li>
<li><a href="#org3bb7c9e">12.39.6. rename<sub>file</sub></a></li>
</ul>
</li>
<li><a href="#orgd139fec">12.40. fs</a>
<ul>
<li><a href="#org49aa6d8">12.40.1. is<sub>dir</sub></a></li>
<li><a href="#org0aec594">12.40.2. file<sub>copy</sub></a></li>
<li><a href="#org0534c22">12.40.3. dir<sub>exists</sub></a></li>
<li><a href="#org70c2270">12.40.4. dir<sub>ls</sub></a></li>
<li><a href="#org73ec2d0">12.40.5. dir<sub>tree</sub></a></li>
<li><a href="#orgac87653">12.40.6. dir<sub>info</sub></a></li>
<li><a href="#org2e3dde4">12.40.7. dir<sub>map</sub></a></li>
</ul>
</li>
<li><a href="#org2d923dd">12.41. Rcpp</a>
<ul>
<li><a href="#org27d5d5a">12.41.1. wrap</a></li>
<li><a href="#orgacc9f8e">12.41.2. as()</a></li>
<li><a href="#org3b4c33f">12.41.3. RObject 类</a></li>
<li><a href="#orge06d69f">12.41.4. IntegerVector 类</a></li>
<li><a href="#org0f4a647">12.41.5. NumericVector 类</a></li>
<li><a href="#orga69703c">12.41.6. 排序</a></li>
<li><a href="#orgeb160b6">12.41.7. 向量子集</a></li>
<li><a href="#org6da646c">12.41.8. NumericMatrix 类</a></li>
</ul>
</li>
<li><a href="#orgca0e9c4">12.42. pillar</a></li>
<li><a href="#org3a73832">12.43. intrval</a>
<ul>
<li><a href="#org1f3850f">12.43.1. %[]%</a></li>
<li><a href="#org913b506">12.43.2. %()%</a></li>
<li><a href="#org5a2f9bc">12.43.3. %[o]%</a></li>
<li><a href="#org943dcb0">12.43.4. %(o)%</a></li>
<li><a href="#org4518ced">12.43.5. %[]o[]%</a></li>
</ul>
</li>
<li><a href="#org005c309">12.44. reprex</a></li>
<li><a href="#org2e0279d">12.45. h2o</a>
<ul>
<li><a href="#orgfb1a722">12.45.1. h2o.performance</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org8fc6d22">13. 专题</a>
<ul>
<li><a href="#org705e3ad">13.1. 缺失值处理</a>
<ul>
<li>
<ul>
<li><a href="#org79c6369">13.1.0.1. 如何删掉缺失值？</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orge4fda19">13.2. 向量化计算</a>
<ul>
<li><a href="#org6d0e67e">13.2.1. for 循环</a></li>
<li><a href="#org59c059d">13.2.2. apply</a></li>
<li><a href="#org75fbec8">13.2.3. lapply</a></li>
<li><a href="#org271f9eb">13.2.4. sapply</a></li>
<li><a href="#org5b1fed2">13.2.5. vapply</a></li>
<li><a href="#org417a10b">13.2.6. mapply</a></li>
<li><a href="#org56fec34">13.2.7. tapply</a></li>
</ul>
</li>
<li><a href="#org7d11eae">13.3. TODO:并行化运算</a>
<ul>
<li>
<ul>
<li><a href="#org384f7b2">13.3.0.1. future</a></li>
</ul>
</li>
<li><a href="#orgd1fe72c">13.3.1. foreach</a>
<ul>
<li><a href="#orgb1783cd">13.3.1.1. %do%</a></li>
<li><a href="#orgdcceb72">13.3.1.2. when</a></li>
<li><a href="#org718a58e">13.3.1.3. %dopar%</a></li>
<li><a href="#org4310288">13.3.1.4. furrr</a></li>
<li><a href="#org2bbf0de">13.3.1.5. dofuture</a></li>
<li><a href="#org4b843fb">13.3.1.6. future.apply</a></li>
</ul>
</li>
<li><a href="#org60a7d55">13.3.2. 文件批量处理</a></li>
<li><a href="#org1268375">13.3.3. 高级编程技巧</a>
<ul>
<li><a href="#orgb615ae1">13.3.3.1. missing</a></li>
<li><a href="#org1e6d56d">13.3.3.2. stopifnot</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org8aa2986">13.4. 3.sql 查询</a></li>
<li><a href="#org8a416f2">13.5. mifi model package</a>
<ul>
<li><a href="#org24a1d36">13.5.1. mf<sub>dm</sub><sub>data</sub><sub>library</sub></a></li>
</ul>
</li>
<li><a href="#org249c344">13.6. 数据比对</a></li>
<li><a href="#org9b091ab">13.7. 识别异常字符</a></li>
<li><a href="#org13d9439">13.8. 进度条</a></li>
<li><a href="#orgaa3d26d">13.9. </a></li>
</ul>
</li>
</ul>
</div>
</div>
<ul class="org-ul">
<li><a href='index.html'>Index</a></li>

<li>Related: <a href='统计.html'>统计</a></li>
</ul>

<p>
+begin<sub>quote</sub>
这个文档专门用于记录 R 语言在使用过程中的心得体会，避免今后 coding 的重复劳动。
#+end<sub>quote</sub>
</p>

<div id="org4a07692" class="outline-2">
<h2 id="org4a07692"><span class="section-number-2">1</span> 问题</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="orgfb0bad1" class="outline-3">
<h3 id="orgfb0bad1"><span class="section-number-3">1.1</span> 如何快速地删除确定的行？</h3>
</div>
<div id="org2c75830" class="outline-3">
<h3 id="org2c75830"><span class="section-number-3">1.2</span> 如何对两个不同长度的向量作 map2?</h3>
<div class="outline-text-3" id="text-1-2">
<p>
比如：c("1","2","3"),c("1","2")month 想要得到 c("11","12","21","22","23")
</p>

<div class="org-src-container">
<pre class="src src-R">purrr::cross(list(<span style="color: #8b2252;">"1"</span>,<span style="color: #8b2252;">"2"</span>,<span style="color: #8b2252;">"3"</span>),list(<span style="color: #8b2252;">"1"</span>,<span style="color: #8b2252;">"2"</span>))
<span style="color: #008b8b;">library</span>(tidyverse)
list(
    c(<span style="color: #8b2252;">"1"</span>,<span style="color: #8b2252;">"2"</span>,<span style="color: #8b2252;">"3"</span>),
    c(<span style="color: #8b2252;">"1"</span>,<span style="color: #8b2252;">"2"</span>)
) <span style="color: #008b8b;">%&gt;%</span> cross() <span style="color: #008b8b;">%&gt;%</span> 
    map(lift(str_c))
</pre>
</div>
</div>
</div>
</div>

<div id="org5972d59" class="outline-2">
<h2 id="org5972d59"><span class="section-number-2">2</span> R 语言编程规范</h2>
<div class="outline-text-2" id="text-2">
<p>
缩进：使用两个空格来缩进，不要用 tab 键（制表符），当括号内发生换行时，另起一行与括号内的第一个字符对齐。
</p>

<p>
空格：只使用单空格，在二元操作符和操作数之间插入空格，不要在函数名称和参数列表之间添加空格。
</p>

<p>
块：左括号“{”不能独占一行，右括号"}"应该独占一行。块内部的代码用两个空格缩进。
</p>

<p>
命名：用小写字母命名对象，并用句号分隔。
</p>
</div>

<div id="orgbdd0367" class="outline-3">
<h3 id="orgbdd0367"><span class="section-number-3">2.1</span> 帮助文档</h3>
<div class="outline-text-3" id="text-2-1">
<div class="org-src-container">
<pre class="src src-R">help.start() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25171;&#24320;&#24110;&#21161;&#25991;&#26723;&#39318;&#39029;</span>
help(<span style="color: #8b2252;">"foo"</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25110;&#65311;foo &#26597;&#30475;&#20989;&#25968;foo&#30340;&#24110;&#21161;</span>
help.search(<span style="color: #8b2252;">"foo"</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25110;&#65311;&#65311;foo &#20197;foo&#20026;&#20851;&#38190;&#35789;&#25628;&#32034;&#26412;&#22320;&#24110;&#21161;&#25991;&#26723;</span>
example(<span style="color: #8b2252;">"foo"</span>)
example(<span style="color: #8b2252;">"lapply"</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20989;&#25968;lapply &#30340;&#20351;&#29992;&#31034;&#20363; </span>
RSiteSearch(<span style="color: #8b2252;">"foo"</span>)                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20197;foo&#20026;&#20851;&#38190;&#35789;&#25628;&#32034;&#22312;&#32447;&#25991;&#26723;&#21644;&#37038;&#20214;</span>
apropos(<span style="color: #8b2252;">"foo"</span>,mode = <span style="color: #8b2252;">"function"</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21015;&#20986;&#21517;&#31216;&#20013;&#21547;&#26377;foo &#30340;&#25152;&#26377;&#21487;&#29992;&#20989;&#25968;</span>
data()<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21015;&#20986;&#24403;&#21069;&#24050;&#21152;&#36733;&#21253;&#20013;&#25152;&#21547;&#26377;&#30340;&#25152;&#26377;&#21487;&#29992;&#31034;&#20363;&#25968;&#25454;&#38598;</span>
vignette() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21015;&#20986;&#24403;&#21069;&#24050;&#23433;&#35013;&#21253;&#20013;&#25152;&#26377;&#21487;&#29992;&#30340;vignette&#25991;&#26723;</span>
vignette(<span style="color: #8b2252;">"foo"</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20026;&#20027;&#39064;foo &#26174;&#31034;&#25351;&#23450;&#30340;vignette &#25991;&#26723;</span>
</pre>
</div>
</div>
</div>

<div id="org13f67bd" class="outline-3">
<h3 id="org13f67bd"><span class="section-number-3">2.2</span> <span class="todo TODO">TODO</span> 工作空间</h3>
<div class="outline-text-3" id="text-2-2">
<div class="org-src-container">
<pre class="src src-R">getwd() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26174;&#31034;&#24403;&#21069;&#30340;&#24037;&#20316;&#30446;&#24405;</span>
<span style="color: #008b8b;">setwd</span>() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20462;&#25913;&#24403;&#21069;&#30340;&#24037;&#20316;&#30446;&#24405;&#20026;mydirectory</span>
ls()    <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21015;&#20986;&#24403;&#21069;&#24037;&#20316;&#31354;&#38388;&#20013;&#30340;&#23545;&#35937;</span>
ls.str() <span style="color: #b22222;">#</span><span style="color: #b22222;">you want more than just a list of names</span>
<span style="color: #008b8b;">rm</span>(objectlist)  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#31227;&#38500;&#65288;&#21024;&#38500;&#65289;&#19968;&#20010;&#25110;&#22810;&#20010;&#23545;&#35937;</span>
help(options)   <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26174;&#31034;&#21487;&#29992;&#36873;&#39033;&#30340;&#35828;&#26126;</span>
<span style="color: #008b8b;">options</span>()       <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26174;&#31034;&#25110;&#35774;&#32622;&#24403;&#21069;&#30340;&#36873;&#39033;</span>
history(<span style="color: #b22222;">#</span><span style="color: #b22222;">) #&#26174;&#31034;&#26368;&#36817;&#29992;&#36807;&#30340;&#65283;&#20010;&#21629;&#20196;&#65288;&#40664;&#35748;&#20540;&#20026;25&#65289;</span>
savehistory(<span style="color: #8b2252;">"myfile"</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20445;&#23384;&#21629;&#20196;&#21382;&#21490;&#21040;&#25991;&#20214;myfile &#20013;&#65288;&#40664;&#35748;&#20540;&#20026;.Rhistory&#65289;</span>
loadhistory(<span style="color: #8b2252;">"myfile"</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36733;&#20837;&#19968;&#20010;&#21629;&#20196;&#21382;&#21490;&#25991;&#20214;&#65288;&#40664;&#35748;&#20540;&#20026;.Rhistory&#65289;</span>
save.image(<span style="color: #8b2252;">"myfile"</span>)  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20445;&#23384;&#24037;&#20316;&#31354;&#38388;&#21040;&#25991;&#20214;myfile &#20013;&#65288;&#40664;&#35748;&#20540;&#20026;.RData&#65289;</span>
save(objectlist,file = <span style="color: #8b2252;">"myfile"</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20445;&#23384;&#25351;&#23450;&#23545;&#35937;&#21040;&#19968;&#20010;&#25991;&#20214;&#20013;</span>
<span style="color: #008b8b;">load</span>(<span style="color: #8b2252;">"myfile"</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#35835;&#21462;&#19968;&#20010;&#24037;&#20316;&#31354;&#38388;&#21040;&#24403;&#21069;&#20250;&#35805;&#20013;&#65288;&#40664;&#35748;&#20540;&#20026;.RData&#65289;</span>
q() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36864;&#20986;R.</span>
</pre>
</div>
</div>
</div>

<div id="orgd249320" class="outline-3">
<h3 id="orgd249320"><span class="section-number-3">2.3</span> 输入和输出</h3>
<div class="outline-text-3" id="text-2-3">
<div class="org-src-container">
<pre class="src src-R"><span style="color: #008b8b;">source</span>(<span style="color: #8b2252;">"filenames"</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21487;&#22312;&#24403;&#21069;&#20250;&#35805;&#20013;&#25191;&#34892;&#19968;&#20010;&#33050;&#26412;</span>
sink(<span style="color: #8b2252;">"filenames"</span>,append = <span style="color: #228b22;">TRUE</span>,split = <span style="color: #228b22;">TRUE</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23558;&#36755;&#20986;&#37325;&#23450;&#21521;&#21040;&#25991;&#20214;filename &#20013;&#65292;&#22914;&#26524;&#25991;&#20214;&#24050;&#32463;&#23384;&#22312;&#65292;&#21017;&#23427;&#30340;&#20869;&#23481;&#23558;&#34987;&#35206;&#30422;&#65292;&#20351;&#29992;&#21442;&#25968;append=TRUE &#21487;&#20197;&#23558;&#25991;&#26412;&#36861;&#21152;&#21040;&#25991;&#20214;&#21518;&#65292;&#32780;&#19981;&#26159;&#35206;&#30422;&#23427;&#65292;&#21442;&#25968;split=TRUE &#21487;&#23558;&#36755;&#20986;&#21516;&#26102;&#21457;&#36865;&#21040;&#23631;&#24149;&#21644;&#36755;&#20986;&#25991;&#20214;&#20013;&#12290;</span>

pdf(<span style="color: #8b2252;">"filename.pdf"</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">pdf &#25991;&#20214;</span>
win.metafile(<span style="color: #8b2252;">"filename.wmf"</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">windows &#22270;&#20803;&#25991;&#20214;</span>
png(<span style="color: #8b2252;">"filename.png"</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">png&#25991;&#20214;</span>
jpeg(<span style="color: #8b2252;">"filename.jpg"</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">jpeg &#25991;&#20214;</span>
bmp(<span style="color: #8b2252;">"filename.bmp"</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">bmp &#25991;&#20214;</span>
postscript(<span style="color: #8b2252;">"filename.ps"</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">postscript &#25991;&#20214;</span>
</pre>
</div>
</div>
</div>

<div id="orgc5e9da7" class="outline-3">
<h3 id="orgc5e9da7"><span class="section-number-3">2.4</span> Rstudio vim 快捷键</h3>
<div class="outline-text-3" id="text-2-4">
<p>
谁用谁知道～
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">功能</td>
<td class="org-left">快捷键</td>
</tr>

<tr>
<td class="org-left">查询函数</td>
<td class="org-left">K</td>
</tr>

<tr>
<td class="org-left">将命令发送到 terminal</td>
<td class="org-left">ctrl+alt+Enter</td>
</tr>

<tr>
<td class="org-left">光标快速切换到 panel 上</td>
<td class="org-left">ctrl + 1</td>
</tr>

<tr>
<td class="org-left">光标切换到 console 上</td>
<td class="org-left">ctrl + 2</td>
</tr>

<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">&#xa0;</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

<div id="org378b92c" class="outline-2">
<h2 id="org378b92c"><span class="section-number-2">3</span> R 环境配置</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="org5cc8297" class="outline-3">
<h3 id="org5cc8297"><span class="section-number-3">3.1</span> 重要的开始文件地址</h3>
<div class="outline-text-3" id="text-3-1">
<p>
R<sub>HOME</sub> 是安装 R 的文件地址。HOME 是用户的 home 文件。
</p>
<div class="org-src-container">
<pre class="src src-R">file.edit(file.path(<span style="color: #8b2252;">"~"</span>,<span style="color: #8b2252;">".Rprofile"</span>)) <span style="color: #b22222;"># </span><span style="color: #b22222;">edit .Rprofile in HOME</span>
file.edit(<span style="color: #8b2252;">".Rprofile"</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">edit project specific .Rprofile</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-R">user_renviron = path.expand(file.path(<span style="color: #8b2252;">"~"</span>, <span style="color: #8b2252;">".Renviron"</span>)) <span style="color: #a020f0;">if</span>(!file.exists(user_renviron)) <span style="color: #b22222;"># </span><span style="color: #b22222;">check to see if the file already exists</span>

                                                             file.create(user_renviron) file.edit(user_renviron) <span style="color: #b22222;"># </span><span style="color: #b22222;">open with another text editor if this fails  </span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">## </span><span style="color: #b22222;">delete all saved object</span>
<span style="color: #008b8b;">rm</span>(list = ls())
gc()
<span style="color: #008b8b;">library</span>(rlang)
<span style="color: #008b8b;">library</span>(tidyverse)
<span style="color: #008b8b;">library</span>(tidyr)
<span style="color: #008b8b;">library</span>(nycflights13)
<span style="color: #b22222;">## </span><span style="color: #b22222;">rscodeio::install_theme() #vs&#26679;&#24335;&#30340;&#30028;&#38754;</span>
<span style="color: #008b8b;">library</span>(data.table)
<span style="color: #008b8b;">library</span>(styler) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20195;&#30721;&#32654;&#35266;</span>
<span style="color: #008b8b;">library</span>(lintr) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#26816;&#26597;&#20195;&#30721;&#38169;&#35823;</span>
<span style="color: #008b8b;">library</span>(languageserver)
<span style="color: #008b8b;">options</span>()<span style="color: #b22222;">#</span><span style="color: #b22222;">&#35774;&#32622;&#25110;&#26816;&#39564;&#20840;&#23616;&#21442;&#25968;&#65307;&#24120;&#29992;&#21442;&#25968;&#26377;&#65306;width&#65292;digits,error</span>
ls() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26174;&#31034;&#25628;&#32034;&#36335;&#24452;&#19979;&#23545;&#35937;&#65307;&#25351;&#23450; path=&#8220;path&#8221;&#26102;&#65292;&#25353;&#26679;&#24335;&#26465;&#20214;&#25628;&#32034;&#12290;</span>
ls.str()<span style="color: #b22222;">#</span><span style="color: #b22222;">&#25628;&#32034;&#36335;&#24452;&#19979;&#27599;&#20010;&#21464;&#37327;</span>
dir()<span style="color: #b22222;">#</span><span style="color: #b22222;">&#22312;&#24403;&#21069;&#30340;&#30446;&#24405;&#19979;&#26174;&#31034;&#25991;&#20214; = list.files()</span>
help(languageserver)
<span style="color: #b22222;">## </span><span style="color: #b22222;">only style with scope = "spaces" when using the Addin</span>
<span style="color: #008b8b;">options</span>(
  styler.addins_style_transformer = <span style="color: #8b2252;">"styler::tidyverse_style(scope = 'spaces')"</span>
)
                                      <span style="color: #b22222;"># </span><span style="color: #b22222;">Get a List of all files named with a key word, say all `.csv` files</span>
filenames <span style="color: #008b8b;">&lt;-</span> ist.files(<span style="color: #8b2252;">"C:/your/folder"</span>, pattern = glob2rx(<span style="color: #8b2252;">"*.csv"</span>), full.names = <span style="color: #228b22;">TRUE</span>)
                                      <span style="color: #b22222;"># </span><span style="color: #b22222;">Load and bind all data sets</span>
data <span style="color: #008b8b;">&lt;-</span> rbindlist(lapply(filenames, fread))
</pre>
</div>
</div>
</div>
<div id="org1f164cd" class="outline-3">
<h3 id="org1f164cd"><span class="section-number-3">3.2</span> 获取错误信息</h3>
<div class="outline-text-3" id="text-3-2">
<p>
可以用 try 来获取错误信息。
</p>
<div class="org-src-container">
<pre class="src src-R">good=try(<span style="color: #008b8b;">1</span>+<span style="color: #008b8b;">1</span>,silent = T)
good
bad=try(<span style="color: #008b8b;">1</span>+<span style="color: #8b2252;">"1"</span>,silent = T)
bad
<span style="color: #a020f0;">if</span>(class(bad) == <span style="color: #8b2252;">"try-error"</span>)
 <span style="color: #b22222;">## </span><span style="color: #b22222;">do something  </span>
</pre>
</div>
</div>
</div>
<div id="orgb45e8fe" class="outline-3">
<h3 id="orgb45e8fe"><span class="section-number-3">3.3</span> Rprofile 文件</h3>
<div class="outline-text-3" id="text-3-3">
<p>
R 环境中的默认设置环境放在 .Rprofile 文件下。
</p>
<div class="org-src-container">
<pre class="src src-R">file.edit(file.path(<span style="color: #8b2252;">"~"</span>, <span style="color: #8b2252;">".Rprofile"</span>)) <span style="color: #b22222;"># </span><span style="color: #b22222;">edit .Rprofile in HOME</span>
file.edit(<span style="color: #8b2252;">".Rprofile"</span>) <span style="color: #b22222;">## </span><span style="color: #b22222;">edit project specific .Rprofile </span>
</pre>
</div>
</div>
</div>
<div id="orga59541f" class="outline-3">
<h3 id="orga59541f"><span class="section-number-3">3.4</span> .Renviron ﬁle</h3>
<div class="outline-text-3" id="text-3-4">
<p>
这个文件是 R 环境文件，可以确定 R 的默认程序以及 load packages.
</p>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">R_LIBS_USER="~/R"</span>
R_LIBS_USER=<span style="color: #8b2252;">"/Library/Frameworks/R.framework/Versions/3.6/Resources/library"</span>
R_DEFAULT_PACKAGES=utils,grDevices,graphics,stats,methods,tidyverse,lubridate,vctrs  
</pre>
</div>

<div class="org-src-container">
<pre class="src src-R">user_renviron = path.expand(file.path(<span style="color: #8b2252;">"~"</span>, <span style="color: #8b2252;">".Renviron"</span>))
<span style="color: #a020f0;">if</span>(!file.exists(user_renviron)) <span style="color: #b22222;"># </span><span style="color: #b22222;">check to see if the file already exists</span>
    file.create(user_renviron)
file.edit(user_renviron) <span style="color: #b22222;"># </span><span style="color: #b22222;">open with another text editor if this fails    </span>
</pre>
</div>
</div>
</div>
<div id="org86172e9" class="outline-3">
<h3 id="org86172e9"><span class="section-number-3">3.5</span> option</h3>
<div class="outline-text-3" id="text-3-5">
<p>
forces R to import character data as character objects. 
</p>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #008b8b;">options</span>(stringsAsFactors=<span style="color: #228b22;">FALSE</span>)     
</pre>
</div>

<p>
option 参数包括
</p>

<div class="org-src-container">
<pre class="src src-R">add.smooth  <span style="color: #228b22;">TRUE</span>
check.bounds    <span style="color: #228b22;">FALSE</span>
continue    <span style="color: #8b2252;">"+ "</span>
digits  <span style="color: #008b8b;">7</span>
echo    <span style="color: #228b22;">TRUE</span>
encoding    <span style="color: #8b2252;">"native.enc"</span>
error   <span style="color: #228b22;">NULL</span>
expressions <span style="color: #008b8b;">5000</span>
keep.source interactive()
keep.source.pkgs    <span style="color: #228b22;">FALSE</span>
max.print   <span style="color: #008b8b;">99999</span>
OutDec  <span style="color: #8b2252;">"."</span>
prompt  <span style="color: #8b2252;">"&gt; "</span>
scipen  <span style="color: #008b8b;">0</span>
show.error.messages <span style="color: #228b22;">TRUE</span>
timeout <span style="color: #008b8b;">60</span>
verbose <span style="color: #228b22;">FALSE</span>
warn    <span style="color: #008b8b;">0</span>
warning.length  <span style="color: #008b8b;">1000</span>
width   <span style="color: #008b8b;">80</span>  
</pre>
</div>
</div>
</div>

<div id="org06b6635" class="outline-3">
<h3 id="org06b6635"><span class="section-number-3">3.6</span> 环境</h3>
<div class="outline-text-3" id="text-3-6">
<p>
在 R 中与其他事物一样，环境也是对象。在内部 R 将符号映射到 hash 表中。
</p>
</div>
<div id="orga3826b0" class="outline-4">
<h4 id="orga3826b0"><span class="section-number-4">3.6.1</span> assign</h4>
<div class="outline-text-4" id="text-3-6-1">
<p>
Assign a Value to a Name.
</p>

<p>
在 envir 环境中将名称 x 赋值给 value 对象。
</p>

<div class="org-src-container">
<pre class="src src-R">a <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">4</span>
assign(<span style="color: #8b2252;">"a[1]"</span>, <span style="color: #008b8b;">2</span>)
a[<span style="color: #008b8b;">1</span>] == <span style="color: #008b8b;">2</span>          <span style="color: #b22222;"># </span><span style="color: #b22222;">FALSE</span>
get(<span style="color: #8b2252;">"a[1]"</span>) == <span style="color: #008b8b;">2</span>   <span style="color: #b22222;"># </span><span style="color: #b22222;">TRUE  </span>
</pre>
</div>

<p>
这个函数很诡异，assign("a[1]", 2) 可以在环境中产生一个新的变量就是“a[1]”。 所以，通过 assign("a[1]", 2),可以产生一个临时的对象。
</p>
</div>
</div>

<div id="orga852363" class="outline-4">
<h4 id="orga852363"><span class="section-number-4">3.6.2</span> get</h4>
<div class="outline-text-4" id="text-3-6-2">
<div class="org-src-container">
<pre class="src src-R">ls()
a <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">4</span>
assign(<span style="color: #8b2252;">"a[1]"</span>, <span style="color: #008b8b;">2</span>)
a[<span style="color: #008b8b;">1</span>] == <span style="color: #008b8b;">2</span>          <span style="color: #b22222;"># </span><span style="color: #b22222;">FALSE</span>
get(<span style="color: #8b2252;">"a[1]"</span>)
</pre>
</div>
</div>
</div>

<div id="org65ed56b" class="outline-4">
<h4 id="org65ed56b"><span class="section-number-4">3.6.3</span> exists</h4>
<div class="outline-text-4" id="text-3-6-3">
<p>
判断在环境中 envir 中是否定义了名称 X.
</p>

<div class="org-src-container">
<pre class="src src-R">exists(<span style="color: #8b2252;">"ls"</span>, fg)  
</pre>
</div>
</div>
</div>

<div id="org368ff1e" class="outline-4">
<h4 id="org368ff1e"><span class="section-number-4">3.6.4</span> ls</h4>
<div class="outline-text-4" id="text-3-6-4">
<div class="org-src-container">
<pre class="src src-R">ls(pattern = <span style="color: #8b2252;">"a"</span>)      
ls.str(mode = <span style="color: #8b2252;">"list"</span>) <span style="color: #b22222;">##</span><span style="color: #b22222;">- what are the structured objects I have defined?</span>
lsf.str() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21015;&#20986;&#21487;&#20197;&#29992;&#30340;&#20989;&#25968;</span>
</pre>
</div>
</div>
</div>

<div id="org6a7a2b0" class="outline-4">
<h4 id="org6a7a2b0"><span class="section-number-4">3.6.5</span> rm</h4>
<div class="outline-text-4" id="text-3-6-5">
<div class="org-src-container">
<pre class="src src-R">rm      
</pre>
</div>
</div>
</div>

<div id="org84782dd" class="outline-4">
<h4 id="org84782dd"><span class="section-number-4">3.6.6</span> find</h4>
<div class="outline-text-4" id="text-3-6-6">
<p>
可以在现有的 package 中查询函数名称。
</p>

<div class="org-src-container">
<pre class="src src-R">find(<span style="color: #8b2252;">"dotplot"</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "package:lattice"  </span>
</pre>
</div>
</div>
</div>

<div id="orgd6d418f" class="outline-4">
<h4 id="orgd6d418f"><span class="section-number-4">3.6.7</span> brew</h4>
<div class="outline-text-4" id="text-3-6-7">
<p>
下面这个函数让你知道 R session 所有信息。
</p>
<div class="org-src-container">
<pre class="src src-R">browseURL(paste(<span style="color: #8b2252;">'file://'</span>,file.path(getwd(),<span style="color: #8b2252;">'brew-test-2.html'</span>),sep=<span style="color: #8b2252;">''</span>))      
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="orgf2e4163" class="outline-2">
<h2 id="orgf2e4163"><span class="section-number-2">4</span> 常见 R 函数</h2>
<div class="outline-text-2" id="text-4">
</div>
<div id="orga331ada" class="outline-3">
<h3 id="orga331ada"><span class="section-number-3">4.1</span> 显示对象个数</h3>
<div class="outline-text-3" id="text-4-1">
<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">1</span>
y <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">2</span>
z <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">3</span>
objects()
</pre>
</div>
</div>
<div id="org44e10b9" class="outline-4">
<h4 id="org44e10b9"><span class="section-number-4">4.1.1</span> 搜索对象</h4>
<div class="outline-text-4" id="text-4-1-1">
<p>
apropos() 函数可以在全局环境空间中搜索所有可用对象。当不能确切想起函数名称时，这个函数特别有用。
</p>
<div class="org-src-container">
<pre class="src src-R">apropos(<span style="color: #8b2252;">"str_"</span>)  
</pre>
</div>

<p>
dir() 函数可以列出一个目录下的所有文件。dir() 函数的 pattern 参数可以是一个正则表达式，此时它只返回与这个模式相匹配的文件名。
</p>
<div class="org-src-container">
<pre class="src src-R">dir(pattern = <span style="color: #8b2252;">"\\.Rmd$"</span>)  
</pre>
</div>
</div>
</div>
</div>
<div id="org9f3760e" class="outline-3">
<h3 id="org9f3760e"><span class="section-number-3">4.2</span> 对象大小</h3>
<div class="outline-text-3" id="text-4-2">
<div class="org-src-container">
<pre class="src src-R">format(object.size(df), units = <span style="color: #8b2252;">"KB"</span>)
<span style="color: #b22222;">#</span><span style="color: #b22222;">[1] "1.3 Kb"     </span>
</pre>
</div>
</div>
</div>

<div id="org9a9ca33" class="outline-3">
<h3 id="org9a9ca33"><span class="section-number-3">4.3</span> 删除某个对象</h3>
<div class="outline-text-3" id="text-4-3">
<div class="org-src-container">
<pre class="src src-R"><span style="color: #008b8b;">rm</span>(x)
objects()
</pre>
</div>
</div>
</div>

<div id="org36167b7" class="outline-3">
<h3 id="org36167b7"><span class="section-number-3">4.4</span> 向环境中添加/删除对象</h3>
<div class="outline-text-3" id="text-4-4">
<div class="org-src-container">
<pre class="src src-R">     <span style="color: #008b8b;">attach</span>() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23558;&#25968;&#25454;&#26694;&#28155;&#21152;&#21040;R &#30340;&#25628;&#32034;&#36335;&#24452;&#20013;</span>
     <span style="color: #008b8b;">detach</span>(name,pos = <span style="color: #008b8b;">2</span>,unload = <span style="color: #228b22;">FALSE</span>)
<span style="color: #008b8b;">detach</span>(<span style="color: #8b2252;">"package:tidyverse"</span>,unload = <span style="color: #228b22;">TRUE</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">unload the package.</span>
</pre>
</div>
</div>
</div>

<div id="org4377b6d" class="outline-3">
<h3 id="org4377b6d"><span class="section-number-3">4.5</span> 捕获错误</h3>
<div class="outline-text-3" id="text-4-5">
<div class="org-src-container">
<pre class="src src-R">res <span style="color: #008b8b;">&lt;-</span> try({x <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">1</span>},silent = <span style="color: #228b22;">TRUE</span>)
res
res <span style="color: #008b8b;">&lt;-</span> try({open(<span style="color: #8b2252;">"file that doesn't exist"</span>)},silent = <span style="color: #228b22;">TRUE</span>)
res
</pre>
</div>
</div>
</div>

<div id="org126f075" class="outline-3">
<h3 id="org126f075"><span class="section-number-3">4.6</span> 改变其他环境</h3>
<div class="outline-text-3" id="text-4-6">
</div>
<div id="org4b6fa01" class="outline-4">
<h4 id="org4b6fa01"><span class="section-number-4">4.6.1</span> 用户目录</h4>
<div class="outline-text-4" id="text-4-6-1">
<div class="org-src-container">
<pre class="src src-R">normalizePath(<span style="color: #8b2252;">'~'</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26174;&#31034;&#29992;&#25143;&#30446;&#24405;      </span>
</pre>
</div>

<p>
&lt;&lt;-操作符，var &lt;&lt;- value。它会使解释器首先在当前环境中检索寻找符号 var。如果解释器无法在当前环境中找到符号 var，那么接下来就会在父环境中继续寻找。解释器将这样递归地在各个环境中寻找直到找到该符号或达到全局环境。
</p>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #008b8b;">rm</span>(x)
<span style="color: #0000ff;">doesnt.assign.x</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>(i) {x <span style="color: #008b8b;">&lt;-</span> i}
doesnt.assign.x(<span style="color: #008b8b;">4</span>)
x
<span style="color: #0000ff;">assign.x</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>(i){x <span style="color: #008b8b;">&lt;&lt;-</span> i}
assign.x(<span style="color: #008b8b;">4</span>)
x
</pre>
</div>
</div>
</div>
</div>

<div id="orgb253df6" class="outline-3">
<h3 id="orgb253df6"><span class="section-number-3">4.7</span> namespace 概念</h3>
<div class="outline-text-3" id="text-4-7">
<p>
命名空间（NAMESPACE）是 R 包管理包内对象的一个途径，它可以控制哪些 R 对象是对用户可见的，哪些对象是从别的包导入（import），哪些对象从本包导出（export）。为什么要有这么个玩意儿存在？主要是为了更好管理你的一堆对象。写 R 包时，有时候可能会遇到某些函数只是为了另外的函数的代码更短而从中抽象、独立出来的，这些小函数仅仅供你自己使用，对用户没什么帮助，他们不需要看见这些函数，这样你就可以在包的根目录下创建一个 NAMESPACE 文件，里面写上 export(函数名)来导出那些需要对用户可见的函数。自 R 2.14.0 开始，命名空间是 R 包的强制组成部分，所有的包必须有命名空间，如果没有的话，R会自动创建。
</p>

<p>
前面我们也提到 DESCRIPTION 文件中有 Imports 一栏，这里设置的包通常是你只需要其部分功能的包，例如我只想在我的包中使用 foo 包中的 bar()函数，那么 Imports 中就需要填 foo，而 NAMESPACE 中则需要写 importFrom(foo, bar)，在自己的包的源代码中则可以直接调用 bar()函数，R会从 NAMESPACE 看出这个 bar()对象是从哪里来的。
</p>
</div>
</div>

<div id="orga25790e" class="outline-3">
<h3 id="orga25790e"><span class="section-number-3">4.8</span> profiling</h3>
<div class="outline-text-3" id="text-4-8">
<div class="org-src-container">
<pre class="src src-R"><span style="color: #008b8b;">library</span>(profvis)
profvis(expr = {
                                   <span style="color: #b22222;"># </span><span style="color: #b22222;">Stage 1: load packages </span>
    <span style="color: #008b8b;">library</span>(<span style="color: #8b2252;">"rnoaa"</span>) 
    <span style="color: #008b8b;">library</span>(<span style="color: #8b2252;">"ggplot2"</span>)
                                   <span style="color: #b22222;"># </span><span style="color: #b22222;">Stage 2: load and process data </span>
    out = readRDS(<span style="color: #8b2252;">"data/out-ice.Rds"</span>) 
    df = dplyr::rbind_all(out, id = <span style="color: #8b2252;">"Year"</span>)
                                   <span style="color: #b22222;"># </span><span style="color: #b22222;">Stage 3: visualise output</span>
    ggplot(df, aes(long, lat, group = paste(group, Year))) + geom_path(aes(colour = Year))
    ggsave(<span style="color: #8b2252;">"figures/icesheet-test.png"</span>)
}, interval = <span style="color: #008b8b;">0.01</span>, prof_output = <span style="color: #8b2252;">"ice-prof"</span>)       
</pre>
</div>
</div>
</div>
<div id="orgcf62cd5" class="outline-3">
<h3 id="orgcf62cd5"><span class="section-number-3">4.9</span> 科学计算</h3>
<div class="outline-text-3" id="text-4-9">
<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">9</span>; names(x) <span style="color: #008b8b;">&lt;-</span> x
<span style="color: #b22222;"># </span><span style="color: #b22222;">Multiplication &amp; Power Tables</span>
x <span style="color: #008b8b;">%o%</span> x
<span style="color: #b22222;">## </span><span style="color: #b22222;">1  2  3  4  5  6  7  8  9</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">1 1  2  3  4  5  6  7  8  9</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">2 2  4  6  8 10 12 14 16 18</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">3 3  6  9 12 15 18 21 24 27</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">4 4  8 12 16 20 24 28 32 36</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">5 5 10 15 20 25 30 35 40 45</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">6 6 12 18 24 30 36 42 48 54</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">7 7 14 21 28 35 42 49 56 63</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">8 8 16 24 32 40 48 56 64 72</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">9 9 18 27 36 45 54 63 72 81</span>
outer(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">9</span>,<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">9</span>)     
</pre>
</div>
</div>
<div id="orgc9fe278" class="outline-4">
<h4 id="orgc9fe278"><span class="section-number-4">4.9.1</span> fivenum</h4>
<div class="outline-text-4" id="text-4-9-1">
<p>
Returns Tukey's five number summary (minimum, lower-hinge, median, upper-hinge, maximum) for the input data.
</p>

<div class="org-src-container">
<pre class="src src-R">fivenum(c(rnorm(<span style="color: #008b8b;">100</span>), -<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">1</span>/<span style="color: #008b8b;">0</span>))
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1]       -Inf -0.6801212 -0.1037386  0.5176428        Inf </span>
</pre>
</div>
</div>
</div>
</div>

<div id="org097b846" class="outline-3">
<h3 id="org097b846"><span class="section-number-3">4.10</span> paste</h3>
<div class="outline-text-3" id="text-4-10">
<p>
sep 用来横向拼接向量，比如把第一个向量和第二个向量按元素顺序逐对拼起来，而 collapse 是把一个向量内部所有元素按一个分隔符拼接为单个字符串。总结一下，sep 返回的仍然是一个向量，每个元素是所有向量中的相应位置上的元素拼出来的；而 collapse 把字符向量“坍缩”为一个字符串。
</p>
<div class="org-src-container">
<pre class="src src-R">paste(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>, <span style="color: #8b2252;">"a"</span>)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] "1 a" "2 a" "3 a"</span>
paste(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>, <span style="color: #8b2252;">"a"</span>, sep = <span style="color: #8b2252;">"-"</span>)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] "1-a" "2-a" "3-a"</span>
paste(letters[<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">10</span>], collapse = <span style="color: #8b2252;">"~"</span>)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] "a~b~c~d~e~f~g~h~i~j"</span>
paste(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>, <span style="color: #8b2252;">"a"</span>, sep = <span style="color: #8b2252;">"-"</span>, collapse = <span style="color: #8b2252;">"+"</span>)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] "1-a+2-a+3-a"</span>
</pre>
</div>
</div>
</div>
<div id="orgd2ecf07" class="outline-3">
<h3 id="orgd2ecf07"><span class="section-number-3">4.11</span> cat</h3>
<div class="outline-text-3" id="text-4-11">
<p>
Concatenate and Print.
</p>
<div class="org-src-container">
<pre class="src src-R">iter <span style="color: #008b8b;">&lt;-</span> stats::rpois(<span style="color: #008b8b;">1</span>, lambda = <span style="color: #008b8b;">10</span>)
<span style="color: #b22222;">## </span><span style="color: #b22222;">print an informative message</span>
cat(<span style="color: #8b2252;">"iteration = "</span>, iter <span style="color: #008b8b;">&lt;-</span> iter + <span style="color: #008b8b;">1</span>, <span style="color: #8b2252;">"\n"</span>) <span style="color: #008b8b;">%&gt;%</span> str()
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; iteration =  13 </span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  NULL  </span>
</pre>
</div>
</div>
</div>
<div id="org60b237d" class="outline-3">
<h3 id="org60b237d"><span class="section-number-3">4.12</span> as.POSIXct</h3>
<div class="outline-text-3" id="text-4-12">
<div class="org-src-container">
<pre class="src src-R">as.character(<span style="color: #8b2252;">"1998-03-16"</span>, format=<span style="color: #8b2252;">'%m/%d/%Y'</span>)
                                   <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "1998-03-16"</span>
x <span style="color: #008b8b;">&lt;-</span> as.POSIXct(c(<span style="color: #8b2252;">'1998-03-16'</span>, <span style="color: #8b2252;">'2015-11-22'</span>))
as.character(x)
                                   <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "1998-03-16" "2015-11-22"</span>
as.character(x, format=<span style="color: #8b2252;">'%Y.%m.%d'</span>)
                                   <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "1998.03.16" "2015.11.22"</span>
as.character(<span style="color: #8b2252;">"1998-03-16"</span>, format=<span style="color: #8b2252;">'%m/%d/%Y'</span>)
                                   <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "1998-03-16"</span>
x <span style="color: #008b8b;">&lt;-</span> as.POSIXct(<span style="color: #8b2252;">'1998-03-16 13:15:45'</span>)
as.character(x)
                                   <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "1998-03-16 13:15:45"</span>
as.character(x, format=<span style="color: #8b2252;">'%H:%M:%S'</span>)
                                   <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "13:15:45"</span>
</pre>
</div>
</div>
</div>
<div id="orgd880188" class="outline-3">
<h3 id="orgd880188"><span class="section-number-3">4.13</span> format</h3>
<div class="outline-text-3" id="text-4-13">
<p>
当向文本中插入数值时，format() 函数非常有用，可以使用这个函数来设置 digits 的数值，避免打印出不必要的小数位，还可以设置 big.mark,从而使得数值更加可读。
</p>

<p>
Date-time Conversion Functions to and from Character.
</p>
<div class="org-src-container">
<pre class="src src-R">format(as.POSIXct(<span style="color: #8b2252;">"2010-01-01"</span>), <span style="color: #8b2252;">"%Y.%m.%d"</span>)
<span style="color: #b22222;">#</span><span style="color: #b22222;">[1] "2010.01.01"  </span>
</pre>
</div>
</div>
</div>
<div id="org3e9dc2c" class="outline-3">
<h3 id="org3e9dc2c"><span class="section-number-3">4.14</span> rep</h3>
<div class="outline-text-3" id="text-4-14">
<div class="org-src-container">
<pre class="src src-R">rep(<span style="color: #008b8b;">1</span>,time=<span style="color: #008b8b;">5</span>)
                                   <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 1 1 1 1 1</span>
rep(c(<span style="color: #008b8b;">1</span>,<span style="color: #008b8b;">2</span>), each=<span style="color: #008b8b;">5</span>)
                                   <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [1] 1 1 1 1 1 2 2 2 2 2</span>
</pre>
</div>
</div>
</div>
<div id="org37fc36c" class="outline-3">
<h3 id="org37fc36c"><span class="section-number-3">4.15</span> seq</h3>
<div class="outline-text-3" id="text-4-15">
<p>
by	
number: increment of the sequence.
</p>

<p>
length.out	
desired length of the sequence. A non-negative number, which for seq and seq.int will be rounded up if fractional.
</p>
<div class="org-src-container">
<pre class="src src-R">seq(<span style="color: #008b8b;">0</span>,<span style="color: #008b8b;">100</span>,by = <span style="color: #008b8b;">5</span>)
                                   <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [1]   0   5  10  15  20  25  30  35  40  45  50  55  60  65  70  75  80</span>
                                   <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [18]  85  90  95 100</span>
seq(<span style="color: #008b8b;">0</span>,<span style="color: #008b8b;">100</span>,length.out = <span style="color: #008b8b;">5</span>)
                                   <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1]   0  25  50  75 100</span>
</pre>
</div>
</div>
</div>
<div id="org812b960" class="outline-3">
<h3 id="org812b960"><span class="section-number-3">4.16</span> stack</h3>
<div class="outline-text-3" id="text-4-16">
<p>
这个函数非常像 gather。
</p>
<div class="org-src-container">
<pre class="src src-R">f1 <span style="color: #008b8b;">&lt;-</span> factor(<span style="color: #8b2252;">"a"</span>)
f2 <span style="color: #008b8b;">&lt;-</span> factor(<span style="color: #8b2252;">"b"</span>)
<span style="color: #008b8b;">library</span>(dplyr)
combine(list(a=<span style="color: #008b8b;">1</span>, b=<span style="color: #008b8b;">2</span>))
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 1 2</span>
stack(list(a=<span style="color: #008b8b;">1</span>, b=<span style="color: #008b8b;">2</span>))
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   values ind</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1      1   a</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2      2   b  </span>
</pre>
</div>
</div>
</div>
<div id="orga0e81a7" class="outline-3">
<h3 id="orga0e81a7"><span class="section-number-3">4.17</span> complete.cases</h3>
<div class="outline-text-3" id="text-4-17">
<p>
A logical vector specifying which observations/rows have no missing values across the entire sequence.
</p>
<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> airquality[, -<span style="color: #008b8b;">1</span>] <span style="color: #b22222;"># </span><span style="color: #b22222;">x is a regression design matrix</span>
y <span style="color: #008b8b;">&lt;-</span> airquality[,  <span style="color: #008b8b;">1</span>]
complete.cases(x)
                                   <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   [1]  TRUE  TRUE  TRUE  TRUE FALSE FALSE  TRUE  TRUE  TRUE  TRUE FALSE</span>
                                   <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [12]  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE     </span>
</pre>
</div>
</div>
</div>
<div id="orga757f78" class="outline-3">
<h3 id="orga757f78"><span class="section-number-3">4.18</span> 数据精度问题</h3>
<div class="outline-text-3" id="text-4-18">
<p>
下面的问题值得注意。
</p>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #008b8b;">0.1</span>+<span style="color: #008b8b;">0.05</span>==<span style="color: #008b8b;">0.15</span>
                                   <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] FALSE</span>
isTRUE(all.equal(<span style="color: #008b8b;">0.1</span>+<span style="color: #008b8b;">0.05</span>, <span style="color: #008b8b;">0.15</span>))
<span style="color: #b22222;">#</span><span style="color: #b22222;">TRUE</span>
</pre>
</div>
</div>
</div>
<div id="org251112c" class="outline-3">
<h3 id="org251112c"><span class="section-number-3">4.19</span> while</h3>
<div class="outline-text-3" id="text-4-19">
<p>
while 循环重复地执行一个语句，直到条件不为真为此。
</p>
<div class="org-src-container">
<pre class="src src-R">i <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">10</span>
<span style="color: #a020f0;">while</span>(i &gt; <span style="color: #008b8b;">0</span>) {
    print(<span style="color: #8b2252;">"Hello"</span>);
    i <span style="color: #008b8b;">&lt;-</span> i -<span style="color: #008b8b;">1</span>
}
                                   <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "Hello"</span>
                                   <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "Hello"</span>
                                   <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "Hello"</span>
                                   <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "Hello"</span>
                                   <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "Hello"</span>
                                   <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "Hello"</span>
                                   <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "Hello"</span>
                                   <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "Hello"</span>
                                   <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "Hello"</span>
                                   <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "Hello"     </span>
</pre>
</div>
</div>
</div>
<div id="org8585b3a" class="outline-3">
<h3 id="org8585b3a"><span class="section-number-3">4.20</span> setNames</h3>
<div class="outline-text-3" id="text-4-20">
<div class="org-src-container">
<pre class="src src-R">setNames(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>, c(<span style="color: #8b2252;">"foo"</span>, <span style="color: #8b2252;">"bar"</span>, <span style="color: #8b2252;">"baz"</span>))
                                   <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; foo bar baz </span>
                                   <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   1   2   3</span>
</pre>
</div>
</div>
</div>
<div id="orged29077" class="outline-3">
<h3 id="orged29077"><span class="section-number-3">4.21</span> {(.)}</h3>
<div class="outline-text-3" id="text-4-21">
<p>
这个用法第一次看到，很迷人～
</p>

<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> list(
    a = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>,
    b = letters[<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>]
)

y <span style="color: #008b8b;">&lt;-</span> list(
    a = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>,
    c = letters[<span style="color: #008b8b;">3</span>:<span style="color: #008b8b;">5</span>]
)

df1 <span style="color: #008b8b;">&lt;-</span> new_tibble(x, nrow = <span style="color: #008b8b;">3</span>)
df2 <span style="color: #008b8b;">&lt;-</span> new_tibble(y, nrow = <span style="color: #008b8b;">3</span>)

df1 <span style="color: #008b8b;">%&gt;%</span>
    group_by(a) <span style="color: #008b8b;">%&gt;%</span>
    {
        left_join(
        (.) <span style="color: #008b8b;">%&gt;%</span>
        summarise(n()),
        (.) <span style="color: #008b8b;">%&gt;%</span>
        summarise(n_distinct(b)),
        by = <span style="color: #8b2252;">"a"</span>
        )
    }
                                   <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; # A tibble: 3 x 3</span>
                                   <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;       a `n()` `n_distinct(b)`</span>
                                   <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   &lt;int&gt; &lt;int&gt;           &lt;int&gt;</span>
                                   <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1     1     1               1</span>
                                   <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2     2     1               1</span>
                                   <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3     3     1               1</span>
</pre>
</div>
</div>
</div>
<div id="orge780464" class="outline-3">
<h3 id="orge780464"><span class="section-number-3">4.22</span> sys.call</h3>
<div class="outline-text-3" id="text-4-22">
<p>
functions to access the function call stack.
these functions provide access to environments.
</p>

<p>
这个命令对于 capture arguments 特别管用！
</p>

<div class="org-src-container">
<pre class="src src-R">sys.call(which =  <span style="color: #008b8b;">0</span>)  
</pre>
</div>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #0000ff;">f</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>(a, b, ...) {
    mc <span style="color: #008b8b;">&lt;-</span> as.list(sys.call())[-<span style="color: #008b8b;">1</span>]
    <span style="color: #a020f0;">return</span>(mc)
}

f(a = <span style="color: #008b8b;">3</span>, c = <span style="color: #008b8b;">3</span>)  
</pre>
</div>
</div>
</div>
<div id="orgc9b9f54" class="outline-3">
<h3 id="orgc9b9f54"><span class="section-number-3">4.23</span> make.call</h3>
<div class="outline-text-3" id="text-4-23">
<div class="org-src-container">
<pre class="src src-R"><span style="color: #0000ff;">inner1</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>(a, b, c) { 
    <span style="color: #a020f0;">return</span>(a + b + c$first + c$second)
}
<span style="color: #0000ff;">outer3</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>(a, b, c) {
    mycall <span style="color: #008b8b;">&lt;-</span> match.call()
    mycall[[<span style="color: #008b8b;">1</span>]] <span style="color: #008b8b;">&lt;-</span> as.symbol(<span style="color: #8b2252;">"inner1"</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">use inner 1</span>
    eval(mycall)
}
outer3(-<span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">2</span>, list(first = <span style="color: #008b8b;">3</span>, second = <span style="color: #008b8b;">4</span>))     
</pre>
</div>
</div>
</div>

<div id="orgc6fe06a" class="outline-3">
<h3 id="orgc6fe06a"><span class="section-number-3">4.24</span> range</h3>
<div class="outline-text-3" id="text-4-24">
<p>
可以看作是 min,max.
</p>
<div class="org-src-container">
<pre class="src src-R">df <span style="color: #008b8b;">&lt;-</span> dplyr::tibble(
                 group = c(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">1</span>),
                 item_id = c(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">2</span>),
                 item_name = c(<span style="color: #8b2252;">"a"</span>, <span style="color: #8b2252;">"b"</span>, <span style="color: #8b2252;">"b"</span>),
                 value1 = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>,
                 value2 = <span style="color: #008b8b;">4</span>:<span style="color: #008b8b;">6</span>
             )
df
df <span style="color: #008b8b;">%&gt;%</span> map_if(is.numeric, range)
df <span style="color: #008b8b;">%&gt;%</span> 
    summarise(list(range(value1))) <span style="color: #008b8b;">%&gt;%</span> 
    unnest()
</pre>
</div>
</div>
</div>
</div>

<div id="org12c9825" class="outline-2">
<h2 id="org12c9825"><span class="section-number-2">5</span> 导入数据</h2>
<div class="outline-text-2" id="text-5">
</div>
<div id="org027374b" class="outline-3">
<h3 id="org027374b"><span class="section-number-3">5.1</span> fread/fwrite</h3>
<div class="outline-text-3" id="text-5-1">
<div class="org-src-container">
<pre class="src src-R"><span style="color: #008b8b;">library</span>(data.table)
modelpath <span style="color: #008b8b;">&lt;-</span> <span style="color: #8b2252;">"/home/work/rstudio-home/luyajun/project/project/juxinli_fqz"</span>
fread(<span style="color: #8b2252;">"/home/work/rstudio-home/luyajun/project/main_model_ws_cluster/rh_model/train_woe_data.csv"</span>, integer64 = <span style="color: #8b2252;">"character"</span>, data.table = F)
fwrite(app, <span style="color: #8b2252;">"/home/work/rstudio-home/luyajun/mifi_model_test/model/main_model/app.csv"</span>)
fwrite(app, sprintf(<span style="color: #8b2252;">"%s/dataset_sep.csv"</span>, modelpath))
fread(sprintf(<span style="color: #8b2252;">"%s/dataset_sep.csv"</span>, modelpath), integer64 = <span style="color: #8b2252;">"character"</span>, data.table = F)

model_data_new <span style="color: #008b8b;">%&gt;%</span> 
    fwrite(sprintf(<span style="color: #8b2252;">"%s/dataset_sep.csv"</span>, modelpath))
</pre>
</div>
</div>
</div>

<div id="orgecaf788" class="outline-3">
<h3 id="orgecaf788"><span class="section-number-3">5.2</span> spark<sub>read</sub><sub>parquet</sub>/spark<sub>write</sub><sub>parquet</sub></h3>
<div class="outline-text-3" id="text-5-2">
<p>
此函数可以迅速将 spark object 存储到 hdfs 上
</p>

<div class="org-src-container">
<pre class="src src-R">spark_write_parquet(sdf_data3, path = <span style="color: #8b2252;">"/user/h_data_platform/platform/mifi/mifimodel_antifraud_jxl_rule_replace_br/data"</span>, mode = <span style="color: #8b2252;">"overwrite"</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#38656;&#27880;&#24847;sdf_data3&#24517;&#39035;&#26159;&#19968;&#20010;spark object</span>
hj_parser=spark_read_parquet(sc, <span style="color: #8b2252;">"hj_parser"</span>,path = sprintf(<span style="color: #8b2252;">"%s/hujin_parser_1017"</span>, hdfs_report_path), memory = F)
sdf_data <span style="color: #008b8b;">&lt;-</span> spark_read_csv(sc, <span style="color: #8b2252;">"sdf_data"</span>,path = sprintf(<span style="color: #8b2252;">"%s/data1.csv"</span>, hdfs_report_path)) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#34920;&#21517;&#24212;&#35813;&#35201;&#21462;</span>
</pre>
</div>
</div>
</div>

<div id="org4cc1e0b" class="outline-3">
<h3 id="org4cc1e0b"><span class="section-number-3">5.3</span> spark<sub>read</sub><sub>csv</sub>/spark<sub>write</sub><sub>csv</sub></h3>
<div class="outline-text-3" id="text-5-3">
<div class="org-src-container">
<pre class="src src-R">spark_read_csv(sc, name = <span style="color: #8b2252;">"sdf_ri_6_30_data"</span>, memory = F, overwrite = T, delimiter = <span style="color: #8b2252;">"\t"</span>,
               path = <span style="color: #8b2252;">"/user/h_mifi/user/luyajun/data/label_6_30_reject_model/label_all_score.csv"</span>)     
</pre>
</div>
<p>
注意在 spark<sub>write</sub><sub>csv</sub> 函数中，path 是一个文件夹名称，而非文件本身名称，而且这个文件夹不能提前在 hdfs 中新建！
</p>
<div class="org-src-container">
<pre class="src src-R">df_hj_feature <span style="color: #008b8b;">%&gt;%</span> 
    sdf_repartition(<span style="color: #008b8b;">1</span>) <span style="color: #008b8b;">%&gt;%</span>
    spark_write_csv(path = sprintf(<span style="color: #8b2252;">"%s/hujin_data_validate_data_1_30_20191101_20200223"</span>,hdfspath))     
</pre>
</div>
</div>
</div>
<div id="orgd8f1952" class="outline-3">
<h3 id="orgd8f1952"><span class="section-number-3">5.4</span> get<sub>file</sub><sub>from</sub><sub>hdfs</sub>/push<sub>file</sub><sub>to</sub><sub>hdfs</sub></h3>
<div class="outline-text-3" id="text-5-4">
<div class="org-src-container">
<pre class="src src-R">  hdfs_data_path <span style="color: #008b8b;">&lt;-</span> <span style="color: #8b2252;">"/user/h_mifi/user/luyajun/data/data/model/cluster"</span>
  get_file_from_hdfs(sprintf(<span style="color: #8b2252;">"%s/train_cluster_data.csv"</span>, hdfs_data_path), modelpath)
  <span style="color: #8b2252;">"/user/h_mifi/user/luyajun/data/bairong"</span>)
  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#27880;&#24847;push_file_to_hdfs &#24517;&#39035;&#36825;&#26679;&#30340;&#24418;&#24335;&#65281;&#65281;</span>
  push_file_to_hdfs(sprintf(<span style="color: #8b2252;">"%s/model_data.csv"</span>, modelpath), <span style="color: #8b2252;">"/user/h_mifi/user/luyajun/model/pboc/data/data/model_data.csv"</span>)
  <span style="color: #b22222;">###</span><span style="color: #b22222;">&#33719;&#21462;hdfs&#25968;&#25454;&#24182;&#36716;&#25442;&#20026;&#26412;&#22320;&#25968;&#25454;</span>
hdfs &#34987;&#35823;&#21024;&#25968;&#25454;&#21040;&#19979;&#38754;&#36825;&#20010;&#36335;&#24452;&#21435;&#23547;&#25214;!!
  /user/h_mifi/.Trash/Current/user/h_mifi/user/luyajun


  <span style="color: #b22222;">###</span><span style="color: #cc9393;">TODO</span><span style="color: #b22222;">:&#22238;&#22836;&#35797;&#35797;&#65281;&#65281;&#65281;</span>
  mf_load_remote_to_local_cluster(hdfs_path, local_path,
                                  num_partitions = <span style="color: #008b8b;">50</span>)
</pre>
</div>
</div>
<div id="org0f34524" class="outline-4">
<h4 id="org0f34524"><span class="section-number-4">5.4.1</span> 读取一个文件夹下多个 csv 文件</h4>
<div class="outline-text-4" id="text-5-4-1">
<div class="org-src-container">
<pre class="src src-R">raw_data = bind_rows(lapply(
    list.files(path = sprintf(<span style="color: #8b2252;">"%s/train_data_hj_zc_um_tx_br_09m_12m"</span>, modelpath), pattern = <span style="color: #8b2252;">"*.csv"</span>), 
    <span style="color: #a020f0;">function</span>(x){fread(file = sprintf(<span style="color: #8b2252;">"%s/train_data_hj_zc_um_tx_br_09m_12m/%s"</span>, modelpath, x) , integer64 = <span style="color: #8b2252;">"character"</span>, data.table = F)}))      
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="orgb2c9c5c" class="outline-2">
<h2 id="orgb2c9c5c"><span class="section-number-2">6</span> 数据处理</h2>
<div class="outline-text-2" id="text-6">
</div>
<div id="org57453dd" class="outline-3">
<h3 id="org57453dd"><span class="section-number-3">6.1</span> 宽表处理</h3>
<div class="outline-text-3" id="text-6-1">
</div>
<div id="orgc528755" class="outline-4">
<h4 id="orgc528755"><span class="section-number-4">6.1.1</span> 常用宽表查询地址</h4>
<div class="outline-text-4" id="text-6-1-1">
<div class="org-src-container">
<pre class="src src-R">mf_dm_data_library()
mf_dm_data_library() <span style="color: #008b8b;">%&gt;%</span> pull(hdfs_path) <span style="color: #008b8b;">%&gt;%</span> str_match(<span style="color: #8b2252;">"fact"</span>)
</pre>
</div>

<p>
这部分因为工作原因，所以特别添加。
</p>
</div>
</div>
<div id="orgacada7f" class="outline-4">
<h4 id="orgacada7f"><span class="section-number-4">6.1.2</span> 读取 jason 数据</h4>
<div class="outline-text-4" id="text-6-1-2">
<div class="org-src-container">
<pre class="src src-R">hujin <span style="color: #008b8b;">&lt;-</span> spark_read_parquet(sc, name = <span style="color: #8b2252;">"hujin"</span>, path = <span style="color: #8b2252;">"/user/h_mifi/user/jiyue/output_anti_fraud_blacklist_query_log"</span>, memory = F) <span style="color: #008b8b;">%&gt;%</span> filter(date &gt;= <span style="color: #008b8b;">20190801</span> &amp; date &lt;= <span style="color: #008b8b;">20190924</span> &amp; source == <span style="color: #008b8b;">44</span>)
head(hujin <span style="color: #008b8b;">%&gt;%</span> select(response),<span style="color: #008b8b;">2</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#24555;&#36895;&#30475;&#19979;jason&#25968;&#25454;&#32467;&#26500;</span>
</pre>
</div>

<p>
jason 的数据形式很像 Python 中的字典型数据。
![jason<sub>data</sub>](img/jason<sub>data.PNG</sub>)
</p>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">###</span><span style="color: #b22222;">&#21033;&#29992;get_json_object&#21629;&#20196;&#23436;&#25104;&#21464;&#37327;&#25552;&#21462;-------------------------------</span>
hujin_parser <span style="color: #008b8b;">&lt;-</span> hujin <span style="color: #008b8b;">%&gt;%</span>
    mutate(
        xiaomi_id = get_json_object(response, <span style="color: #8b2252;">"$.entity.xiaomiId"</span>),
        create_time = get_json_object(response, <span style="color: #8b2252;">"$.entity.createTime"</span>),
        update_time = get_json_object(response, <span style="color: #8b2252;">"$.entity.updateTime"</span>),
        data = get_json_object(response, <span style="color: #8b2252;">"$.entity.data"</span>)
    )
</pre>
</div>
</div>
</div>

<div id="org958d7fa" class="outline-4">
<h4 id="org958d7fa"><span class="section-number-4">6.1.3</span> 利用 sparklyr 对 spark 中的 dataframe 复制行</h4>
<div class="outline-text-4" id="text-6-1-3">
<div class="org-src-container">
<pre class="src src-R">df_tbl <span style="color: #008b8b;">%&gt;%</span> 
    mutate(arr = explode(array(<span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">1</span>))) <span style="color: #008b8b;">%&gt;%</span>  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22797;&#21046;3&#34892;</span>
    select(-arr)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">or&#21516;&#26679;&#25805;&#20316;</span>
<span style="color: #008b8b;">library</span>(rlang)
df_tbl <span style="color: #008b8b;">%&gt;%</span>  
    mutate(arr = !!rlang::parse_quo(
                              paste(<span style="color: #8b2252;">"explode(array("</span>, paste(rep(<span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">3</span>), collapse = <span style="color: #8b2252;">","</span>), <span style="color: #8b2252;">"))"</span>)
                          )) <span style="color: #008b8b;">%&gt;%</span> select(-arr)

                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21442;&#32771;&#38142;&#25509; https://stackoverflow.com/questions/44530564/r-how-to-replicate-rows-in-a-spark-dataframe-using-sparklyr</span>

</pre>
</div>
</div>
</div>

<div id="org5de82cf" class="outline-4">
<h4 id="org5de82cf"><span class="section-number-4">6.1.4</span> 本地数据框转成 hdfs</h4>
<div class="outline-text-4" id="text-6-1-4">
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">###</span><span style="color: #b22222;">&#36825;&#20010;&#24212;&#35813;&#24456;&#24555;--------------------------------------------</span>
to_sdf(df, sc, repartition = <span style="color: #228b22;">NULL</span>, ncores = <span style="color: #008b8b;">12</span>, part_size = <span style="color: #008b8b;">512</span>)
</pre>
</div>
</div>
</div>

<div id="orga43a8ad" class="outline-4">
<h4 id="orga43a8ad"><span class="section-number-4">6.1.5</span> 本地数据转化成 h2o frame</h4>
<div class="outline-text-4" id="text-6-1-5">
<p>
据说这个函数比 as<sub>h2o</sub><sub>frame</sub> 快很多
</p>
<div class="org-src-container">
<pre class="src src-R">my_as_h2o_frame(df, use_parquet = F)
</pre>
</div>
</div>
</div>

<div id="org4e41c74" class="outline-4">
<h4 id="org4e41c74"><span class="section-number-4">6.1.6</span> sdf<sub>solidate</sub></h4>
<div class="outline-text-4" id="text-6-1-6">
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">##</span><span style="color: #b22222;">saves an sdf to a parquet on hdfs and then read it back as a new sdf. This is useful to avoid spark OOM in situations where the spark workflow is too long.</span>
my_sdf_solidate(sdf)
</pre>
</div>
</div>
</div>

<div id="org1fdc692" class="outline-4">
<h4 id="org1fdc692"><span class="section-number-4">6.1.7</span> hdfs.load</h4>
<div class="outline-text-4" id="text-6-1-7">
<div class="org-src-container">
<pre class="src src-R">hdfs.load(path)<span style="color: #b22222;">#</span><span style="color: #b22222;">Arguments,path:an hdfs path to a .rda file</span>
</pre>
</div>
</div>
</div>
</div>

<div id="orga7c975d" class="outline-3">
<h3 id="orga7c975d"><span class="section-number-3">6.2</span> 数据类型转换</h3>
<div class="outline-text-3" id="text-6-2">
<p>
list to matrix:注意在 list to matrix 过程中，字符型变量也会转换为数字型
</p>
<div class="org-src-container">
<pre class="src src-R">list1=data.frame(x1=c(<span style="color: #008b8b;">1</span>,<span style="color: #008b8b;">2</span>,<span style="color: #008b8b;">3</span>,<span style="color: #008b8b;">3</span>,<span style="color: #008b8b;">2</span>,<span style="color: #008b8b;">1</span>),x2=letters[<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">6</span>])
<span style="color: #0000ff;">list2mat</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>(data){
  output <span style="color: #008b8b;">&lt;-</span> matrix(unlist(data), ncol = dim(data)[<span style="color: #008b8b;">2</span>])
  <span style="color: #a020f0;">return</span>(output)
}
list2mat(list1)
data.matrix(list1)
</pre>
</div>
</div>
<div id="org8ab4fe3" class="outline-4">
<h4 id="org8ab4fe3"><span class="section-number-4">6.2.1</span> 数据切分</h4>
<div class="outline-text-4" id="text-6-2-1">
<p>
可以利用 purrr 包进行数据切分。
</p>
<div class="org-src-container">
<pre class="src src-R">ins
typeof(mtcars$gear)
mtcars <span style="color: #008b8b;">%&gt;%</span>
  split(.$cyl)
</pre>
</div>
</div>
</div>

<div id="org8045f34" class="outline-4">
<h4 id="org8045f34"><span class="section-number-4">6.2.2</span> 重塑数据(reshape data)</h4>
<div class="outline-text-4" id="text-6-2-2">
<p>
melt:这个函数可以将 data.frame 数据拉直
tibble:构建一个数据框
gather：可以将多列原始数据进行合并，按照一定组名，这样可以更好 ggplot2
spread：将一列数据分割成多列，多用于 char 型数据
unite:是 spread 的逆操作，可以将多个序列连接起来
</p>

<div class="org-src-container">
<pre class="src src-R">  <span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
ceshi <span style="color: #008b8b;">&lt;-</span> tibble(a = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>, b = <span style="color: #008b8b;">4</span>:<span style="color: #008b8b;">6</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#26500;&#24314;&#19968;&#20010;&#25968;&#25454;&#26694;</span>
ceshi
melt(ceshi) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#23558;&#25968;&#25454;&#26694;&#25289;&#30452;</span>
melt(smiths)
dcast(smiths, time + subject ~ .)
stocks <span style="color: #008b8b;">&lt;-</span> tibble(
  time = as.Date(<span style="color: #8b2252;">"2009-01-01"</span>) + <span style="color: #008b8b;">0</span>:<span style="color: #008b8b;">9</span>,
  X = rnorm(<span style="color: #008b8b;">10</span>, <span style="color: #008b8b;">0</span>, <span style="color: #008b8b;">1</span>),
  Y = rnorm(<span style="color: #008b8b;">10</span>, <span style="color: #008b8b;">0</span>, <span style="color: #008b8b;">2</span>),
  Z = rnorm(<span style="color: #008b8b;">10</span>, <span style="color: #008b8b;">0</span>, <span style="color: #008b8b;">4</span>)
)
<span style="color: #b22222;">##</span><span style="color: #b22222;">&#36825;&#37324;&#21464;&#37327;&#30340;&#20540;&#26159;&#19968;&#20010;&#32500;&#24230;&#65292;&#25226;&#20540;&#20840;&#37096;&#25289;&#30452;</span>
head(stocks)
s <span style="color: #008b8b;">&lt;-</span> gather(stocks, <span style="color: #8b2252;">"stock"</span>, <span style="color: #8b2252;">"price"</span>, -time) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#36825;&#37324; stock &#28041;&#21450;&#20102;&#32452;&#65292;&#20063;&#23601;&#26159; key&#65292;price &#26159;&#20540;,value</span>
  head(s)

more example

<span style="color: #b22222;">## </span><span style="color: #b22222;">Section:&#22914;&#26524;&#25968;&#25454;&#38271;&#24230;&#19968;&#26679;</span>
<span style="color: #b22222;">################################################</span>
score <span style="color: #008b8b;">&lt;-</span> data.frame(score1 = c(<span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">3</span>), score2 = c(<span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">3</span>, <span style="color: #008b8b;">4</span>))
melt(score, measured = c(<span style="color: #8b2252;">"score1"</span>, <span style="color: #8b2252;">"score2"</span>))
gather(score, <span style="color: #8b2252;">"score"</span>, <span style="color: #8b2252;">"value"</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#36825;&#26679;&#23601;&#33021;&#23454;&#29616;&#20998;&#32452;</span>
score <span style="color: #008b8b;">&lt;-</span> list(score1 = c(<span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">3</span>), score2 = c(<span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">3</span>, <span style="color: #008b8b;">4</span>, <span style="color: #008b8b;">5</span>))
score <span style="color: #008b8b;">&lt;-</span> data.frame(score1 = c(<span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">3</span>, <span style="color: #228b22;">NA</span>), score2 = c(<span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">3</span>, <span style="color: #008b8b;">4</span>, <span style="color: #008b8b;">5</span>))
<span style="color: #b22222;">###</span><span style="color: #b22222;">&#21015;&#30340;&#21512;&#24182;--------------------------</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#21512;&#24182;&#21015;</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">unite()&#30452;&#25509;&#20351;&#29992;&#21015;&#21517;&#21363;&#21487;&#65292;unite_()&#38656;&#35201;&#22312;&#21015;&#21517;&#20004;&#36793;&#20351;&#29992;&#24341;&#21495;</span>
iris <span style="color: #008b8b;">%&gt;%</span> head
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26500;&#36896;&#20102;&#19968;&#20010;&#26032;&#30340;&#21464;&#37327; unite_sepal&#65292;&#26681;&#25454; sepal.length&#65292;Sepal.Width &#20004;&#20010;&#21464;&#37327;&#36827;&#34892;&#21512;&#24182;</span>
demo <span style="color: #008b8b;">&lt;-</span> iris <span style="color: #008b8b;">%&gt;%</span>
  unite(unite_sepal, Sepal.Length, Sepal.Width, sep=<span style="color: #8b2252;">"_"</span>, remove=<span style="color: #228b22;">TRUE</span>) <span style="color: #008b8b;">%&gt;%</span>
  unite_(<span style="color: #8b2252;">"unite_petal"</span>, c(<span style="color: #8b2252;">"Petal.Length"</span>, <span style="color: #8b2252;">"Petal.Width"</span>), sep=<span style="color: #8b2252;">"_"</span>, remove=<span style="color: #228b22;">TRUE</span>)
<span style="color: #b22222;">#</span><span style="color: #b22222;">separate &#26159; unite &#30340;&#36870;&#25805;&#20316;</span>
demo <span style="color: #008b8b;">%&gt;%</span>
  separate(unite_sepal, c(<span style="color: #8b2252;">"Sepal.Length"</span>, <span style="color: #8b2252;">"Sepal.Width"</span>), sep=<span style="color: #8b2252;">"_"</span>) <span style="color: #008b8b;">%&gt;%</span>
  separate_(<span style="color: #8b2252;">"unite_petal"</span>, c(<span style="color: #8b2252;">"Petal.Length"</span>, <span style="color: #8b2252;">"Petal.Width"</span>), sep=<span style="color: #8b2252;">"_"</span>)
<span style="color: #b22222;">## </span><span style="color: #b22222;">Section:&#22914;&#26524;&#25968;&#25454;&#38271;&#24230;&#19981;&#30456;&#21516;</span>
<span style="color: #b22222;">################################################</span>
<span style="color: #008b8b;">library</span>(rowr)
score <span style="color: #008b8b;">&lt;-</span> cbind.fill(score1 = c(<span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">3</span>), score2 = c(<span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">3</span>, <span style="color: #008b8b;">4</span>, <span style="color: #008b8b;">5</span>), fill = <span style="color: #228b22;">NA</span>)
colnames(score) <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #8b2252;">"score1"</span>, <span style="color: #8b2252;">"score2"</span>)
a <span style="color: #008b8b;">&lt;-</span> gather(score, <span style="color: #8b2252;">"score"</span>, <span style="color: #8b2252;">"value"</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#36825;&#26679;&#23601;&#33021;&#23454;&#29616;&#20998;&#32452;</span>
a <span style="color: #008b8b;">%&lt;&gt;%</span> as.tibble()
str(a)
head(a)
ggplot(a, aes(x = score, y = value, colour = score)) + geom_point(aes(score, value))
stroms <span style="color: #008b8b;">&lt;-</span> tibble(date=c(<span style="color: #8b2252;">"2019,01,01"</span>))
tidyr::separate(stroms,date,c(<span style="color: #8b2252;">"y"</span>,<span style="color: #8b2252;">"m"</span>,<span style="color: #8b2252;">"d"</span>))

s <span style="color: #008b8b;">%&gt;%</span>
  separate(price, c(<span style="color: #8b2252;">"stock"</span>, <span style="color: #8b2252;">"price"</span>))
gather()
separate()
df <span style="color: #008b8b;">&lt;-</span> data.frame(x = c(<span style="color: #228b22;">NA</span>, <span style="color: #8b2252;">"a.b"</span>, <span style="color: #8b2252;">"a.d"</span>, <span style="color: #8b2252;">"b.c"</span>))
head(df)
df <span style="color: #008b8b;">%&gt;%</span> separate(x, c(<span style="color: #8b2252;">"A"</span>, <span style="color: #8b2252;">"B"</span>)) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#23558;&#23383;&#31526;&#20998;&#38548;&#24320;&#20102;</span>

df <span style="color: #008b8b;">&lt;-</span> data.frame(x = c(<span style="color: #8b2252;">"a:1"</span>, <span style="color: #8b2252;">"a:2"</span>, <span style="color: #8b2252;">"c:4"</span>, <span style="color: #8b2252;">"d"</span>, <span style="color: #228b22;">NA</span>))
df <span style="color: #008b8b;">%&gt;%</span>
  separate(x, c(<span style="color: #8b2252;">"key"</span>, <span style="color: #8b2252;">"value"</span>), <span style="color: #8b2252;">":"</span>) <span style="color: #008b8b;">%&gt;%</span>
  str()
df <span style="color: #008b8b;">%&gt;%</span>
  separate(x, c(<span style="color: #8b2252;">"key"</span>, <span style="color: #8b2252;">"value"</span>), <span style="color: #8b2252;">":"</span>, convert = <span style="color: #228b22;">TRUE</span>) <span style="color: #008b8b;">%&gt;%</span>
  str()

df <span style="color: #008b8b;">&lt;-</span> expand_grid(x = c(<span style="color: #8b2252;">"a"</span>, <span style="color: #228b22;">NA</span>), y = c(<span style="color: #8b2252;">"b"</span>, <span style="color: #228b22;">NA</span>))
df

df <span style="color: #008b8b;">%&gt;%</span> unite(<span style="color: #8b2252;">"z"</span>, x:y, remove = <span style="color: #228b22;">FALSE</span>)

<span style="color: #b22222;"># </span><span style="color: #b22222;">Implicit missings ---------------------------------------------------------</span>
df <span style="color: #008b8b;">&lt;-</span> tibble(
  year    = c(<span style="color: #008b8b;">2010</span>, <span style="color: #008b8b;">2010</span>, <span style="color: #008b8b;">2010</span>, <span style="color: #008b8b;">2010</span>, <span style="color: #008b8b;">2012</span>, <span style="color: #008b8b;">2012</span>, <span style="color: #008b8b;">2012</span>),
  qtr     = c(   <span style="color: #008b8b;">1</span>,    <span style="color: #008b8b;">2</span>,    <span style="color: #008b8b;">3</span>,    <span style="color: #008b8b;">4</span>,    <span style="color: #008b8b;">1</span>,    <span style="color: #008b8b;">2</span>,    <span style="color: #008b8b;">3</span>),
  return = rnorm(<span style="color: #008b8b;">7</span>)
)
df <span style="color: #008b8b;">%&gt;%</span> expand(year, qtr)
df <span style="color: #008b8b;">%&gt;%</span> expand(year = <span style="color: #008b8b;">2010</span>:<span style="color: #008b8b;">2012</span>, qtr) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21152;&#20102;&#19968;&#24180;&#30340;&#25968;&#25454;</span>
df <span style="color: #008b8b;">%&gt;%</span> expand(year = full_seq(year, <span style="color: #008b8b;">1</span>), qtr)
df <span style="color: #008b8b;">%&gt;%</span> complete(year = full_seq(year, <span style="color: #008b8b;">1</span>), qtr) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#30456;&#24403;&#20110;&#23545;&#21407;&#26377;&#25968;&#25454;&#20570;&#20102;&#25193;&#20805;</span>
full_seq(c(<span style="color: #008b8b;">2010</span>,<span style="color: #008b8b;">2010</span>,<span style="color: #008b8b;">2011</span>),<span style="color: #008b8b;">1</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#30456;&#24403;&#20110;&#21435;&#37325;&#20102;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">You can also choose to fill in missing values</span>
df <span style="color: #008b8b;">&lt;-</span> tibble(
  group = c(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">1</span>),
  item_id = c(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">2</span>),
  item_name = c(<span style="color: #8b2252;">"a"</span>, <span style="color: #8b2252;">"b"</span>, <span style="color: #8b2252;">"b"</span>),
  value1 = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>,
  value2 = <span style="color: #008b8b;">4</span>:<span style="color: #008b8b;">6</span>
)
df
df <span style="color: #008b8b;">%&gt;%</span> nesting(item_id)
df <span style="color: #008b8b;">%&gt;%</span> complete(group, nesting(item_id, item_name))
df <span style="color: #008b8b;">%&gt;%</span> complete(group, nesting(item_id, item_name), fill = list(value1 = <span style="color: #008b8b;">0</span>))
<span style="color: #b22222;">###</span><span style="color: #b22222;">&#21861;&#21483; nest?--------------------------</span>
df <span style="color: #008b8b;">&lt;-</span> tibble(x = c(<span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">3</span>), y = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">6</span>, z = <span style="color: #008b8b;">6</span>:<span style="color: #008b8b;">1</span>)
df
<span style="color: #b22222;"># </span><span style="color: #b22222;">Note that we get one row of output for each unique combination of</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">non-nested variables</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36825;&#20010;&#25805;&#20316;&#26159;&#25226;&#20004;&#20010;&#21464;&#37327;&#25968;&#25454;&#36830;&#25509;&#25104; list &#31867;&#22411;&#65292;&#25226; x &#20316;&#20102;&#21435;&#37325;&#22788;&#29702;&#65292;&#30041;&#19979;&#20102; y &#21644; z &#30340;&#20449;&#24687;</span>
(df <span style="color: #008b8b;">%&gt;%</span> nest(data = c(y, z)))$data
<span style="color: #b22222;"># </span><span style="color: #b22222;">chop does something similar, but retains individual columns</span>
(df <span style="color: #008b8b;">%&gt;%</span> chop(c(y, z)))$z
<span style="color: #b22222;"># </span><span style="color: #b22222;">use tidyselect syntax and helpers, just like in dplyr::select()</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">one_of("")&#26159;&#21487;&#20197;&#26367;&#25442; select &#30340;&#21151;&#33021;</span>
(df <span style="color: #008b8b;">%&gt;%</span> nest(data = one_of(<span style="color: #8b2252;">"y"</span>, <span style="color: #8b2252;">"z"</span>)))$data
iris <span style="color: #008b8b;">%&gt;%</span> select(Species) <span style="color: #008b8b;">%&gt;%</span> unique()
(iris <span style="color: #008b8b;">%&gt;%</span> nest(data = -Species))$data <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21487;&#20197;&#23558;&#25968;&#25454;&#25353;&#29031;&#19968;&#20010;&#31867;&#21035;&#36827;&#34892;&#20998;&#32452;</span>
iris <span style="color: #008b8b;">%&gt;%</span>
  nest(petal = starts_with(<span style="color: #8b2252;">"Petal"</span>), sepal = starts_with(<span style="color: #8b2252;">"Sepal"</span>))
iris <span style="color: #008b8b;">%&gt;%</span>
  nest(width = contains(<span style="color: #8b2252;">"Width"</span>), length = contains(<span style="color: #8b2252;">"Length"</span>))
<span style="color: #b22222;"># </span><span style="color: #b22222;">Nesting a grouped data frame nests all variables apart from the group vars</span>
fish_encounters <span style="color: #008b8b;">%&gt;%</span>
  group_by(fish) <span style="color: #008b8b;">%&gt;%</span>
  nest()
<span style="color: #b22222;"># </span><span style="color: #b22222;">Nesting is often useful for creating per group models</span>
mtcars <span style="color: #008b8b;">%&gt;%</span>
  group_by(cyl) <span style="color: #008b8b;">%&gt;%</span>
  nest() <span style="color: #008b8b;">%&gt;%</span>
  mutate(models = lapply(data, <span style="color: #a020f0;">function</span>(df) lm(mpg ~ wt, data = df)))
<span style="color: #b22222;"># </span><span style="color: #b22222;">unnest() is primarily designed to work with lists of data frames</span>
df <span style="color: #008b8b;">&lt;-</span> tibble(
  x = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>,
  y = list(
    <span style="color: #228b22;">NULL</span>,
    tibble(a = <span style="color: #008b8b;">1</span>, b = <span style="color: #008b8b;">2</span>),
    tibble(a = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>, b = <span style="color: #008b8b;">3</span>:<span style="color: #008b8b;">1</span>)
  )
)
df
df <span style="color: #008b8b;">%&gt;%</span> unnest(y)
df <span style="color: #008b8b;">%&gt;%</span> unnest(y, keep_empty = <span style="color: #228b22;">TRUE</span>)
<span style="color: #b22222;"># </span><span style="color: #b22222;">You can unnest multiple columns simultaneously</span>
df <span style="color: #008b8b;">&lt;-</span> tibble(
  a = list(c(<span style="color: #8b2252;">"a"</span>, <span style="color: #8b2252;">"b"</span>), <span style="color: #8b2252;">"c"</span>),
  b = list(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">3</span>),
  c = c(<span style="color: #008b8b;">11</span>, <span style="color: #008b8b;">22</span>)
)
df <span style="color: #008b8b;">%&gt;%</span> unnest(c(a, b))
<span style="color: #b22222;"># </span><span style="color: #b22222;">Compare with unnesting one column at a time, which generates</span>
                                        <span style="color: #b22222;"># </span><span style="color: #b22222;">the Cartesian product</span>
df <span style="color: #008b8b;">%&gt;%</span> unnest(a) <span style="color: #008b8b;">%&gt;%</span> unnest(b)
df <span style="color: #008b8b;">%&gt;%</span> unnest(a)

</pre>
</div>
</div>
</div>
<div id="org8180a3c" class="outline-4">
<h4 id="org8180a3c"><span class="section-number-4">6.2.3</span> 非标准计算</h4>
<div class="outline-text-4" id="text-6-2-3">
<p>
流程：read-eval-print 是读入文本，然后进行解析，然后求值，最后打印，这个就是我们日常看到的命令行操作。
</p>

<ul class="org-ul">
<li>语法解析：substitute(), parse(), deparse()</li>
<li>表达式构造：quote()</li>
<li>表达式求值：eval(), source()</li>
<li>表达式：expression()</li>
</ul>
</div>

<div id="orgb29b69b" class="outline-5">
<h5 id="orgb29b69b"><span class="section-number-5">6.2.3.1</span> Base</h5>
<div class="outline-text-5" id="text-6-2-3-1">
</div>
<div id="org7e50528" class="outline-6">
<h6 id="org7e50528"><span class="section-number-6">6.2.3.1.1</span> parse</h6>
<div class="outline-text-6" id="text-6-2-3-1-1">
<p>
parse 主要负责把字符解析为 R 语言表达式。表达式是可以被求值的代码。在 R 中解析有三种不同的变种：
</p>

<ul class="org-ul">
<li>the read-eval-print loop</li>
<li>parsing of text files</li>
<li>parsing of character strings</li>
</ul>

<div class="org-src-container">
<pre class="src src-R">parse(text = <span style="color: #8b2252;">"1+2"</span>)
parse(text = <span style="color: #8b2252;">"1+2"</span>) <span style="color: #008b8b;">%&gt;%</span> class
</pre>
</div>
</div>
</div>




<div id="org9985349" class="outline-6">
<h6 id="org9985349"><span class="section-number-6">6.2.3.1.2</span> deparse</h6>
<div class="outline-text-6" id="text-6-2-3-1-2">
<p>
和 parse 相反，deparse 是把 R 表达式逆解析为字符。
</p>

<div class="org-src-container">
<pre class="src src-R">deparse(<span style="color: #008b8b;">1</span>+<span style="color: #008b8b;">1</span>=<span style="color: #008b8b;">2</span>)
</pre>
</div>
</div>
</div>

<div id="orgb18f1fd" class="outline-6">
<h6 id="orgb18f1fd"><span class="section-number-6">6.2.3.1.3</span> quote</h6>
<div class="outline-text-6" id="text-6-2-3-1-3">
<p>
quote 则是用于捕捉未计算的表达式。
</p>

<div class="org-src-container">
<pre class="src src-R">quote(<span style="color: #008b8b;">1</span>+<span style="color: #008b8b;">2</span>)
quote(<span style="color: #008b8b;">1</span>+<span style="color: #008b8b;">2</span>) <span style="color: #008b8b;">%&gt;%</span> typeof
                                        <span style="color: #b22222;">#  </span><span style="color: #b22222;">"language"</span>
</pre>
</div>
</div>
</div>

<div id="orgd34e5fa" class="outline-6">
<h6 id="orgd34e5fa"><span class="section-number-6">6.2.3.1.4</span> eval</h6>
<div class="outline-text-6" id="text-6-2-3-1-4">
<p>
quote 是捕捉表达式，不进行计算（求值），将由 eval 来完成对表达式进行计算（求值）。
</p>

<div class="org-src-container">
<pre class="src src-R">eval(quote(<span style="color: #008b8b;">1</span>+<span style="color: #008b8b;">2</span>))
</pre>
</div>

<p>
一般是用 parse 从字符串（或者是硬盘上的文件）解析成一个 expression 对象，是表达式列表，不是一个表达式。
</p>
<div class="org-src-container">
<pre class="src src-R">eval(parse(text = <span style="color: #8b2252;">"1+2"</span>))
</pre>
</div>

<p>
表达式的操作和计算在 eval 遇到未定义的变量时首先是全局环境，如果有指定环境，则进入指定环境找，还会根据需要找到子环境的父环境中去。
</p>
<div class="org-src-container">
<pre class="src src-R">q <span style="color: #008b8b;">&lt;-</span> quote(<span style="color: #008b8b;">1</span>+<span style="color: #008b8b;">2</span>)
q
as.list(q)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&#19979;&#38754;&#21487;&#20197;&#25805;&#20316;&#36825;&#20010;&#34920;&#36798;&#24335;&#65292;&#21464;&#25104;1-2</span>
q[[<span style="color: #008b8b;">1</span>]]
q[[<span style="color: #008b8b;">1</span>]] <span style="color: #008b8b;">&lt;-</span> <span style="color: #000000; background-color: #ffffff;">`-`</span>
q
eval(q)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&#19979;&#38754;&#25805;&#20316;&#21487;&#20197;&#21464;&#25104;1*2</span>
q[[<span style="color: #008b8b;">1</span>]] <span style="color: #008b8b;">&lt;-</span> quote(<span style="color: #000000; background-color: #ffffff;">`*`</span>)

eval(quote(<span style="color: #008b8b;">1</span>+a)) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22914;&#26524;&#34987;&#35745;&#31639;&#23545;&#35937;&#27809;&#26377;&#25214;&#21040;&#65292;&#37027;&#20040;&#35745;&#31639;&#23601;&#20250;&#20986;&#38169;</span>
a <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">2</span>
eval(quote(<span style="color: #008b8b;">1</span>+a))
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21363;&#20351;&#21464;&#37327;&#26159;&#23384;&#22312;&#30340;&#65292;&#20294;&#26159;&#22914;&#26524;&#21464;&#37327;&#25442;&#20102;&#26032;&#29615;&#22659;&#65292;&#30452;&#25509;&#35745;&#31639;&#20063;&#26159;&#38169;&#35823;&#30340;</span>
new <span style="color: #008b8b;">&lt;-</span> new.env()
new$b <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">2</span>
eval(quote(<span style="color: #008b8b;">1</span>+b))
                                      <span style="color: #b22222;"># </span><span style="color: #b22222;">Error in eval(quote(1 + b)) : object 'b' not found</span>
eval(quote(<span style="color: #008b8b;">1</span>+b),envir = new)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&#29238;&#29615;&#22659;&#19982;&#23376;&#29615;&#22659;</span>
son <span style="color: #008b8b;">&lt;-</span> new.env(parent = new)
son$c <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">3</span>
eval(quote(<span style="color: #008b8b;">1</span>+b+c)) <span style="color: #b22222;">#</span><span style="color: #b22222;">Error in eval(quote(1 + b + c)) : object 'b' not found</span>
eval(quote(<span style="color: #008b8b;">1</span>+b+c),envir = new) <span style="color: #b22222;">#</span><span style="color: #b22222;">Error in 1 + b + c : non-numeric argument to binary operator</span>
eval(quote(<span style="color: #008b8b;">1</span>+b+c),envir = son)

</pre>
</div>

<p>
more example
</p>

<div class="org-src-container">
<pre class="src src-R">  <span style="color: #008b8b;">rm</span>(list = ls())
  a1 <span style="color: #008b8b;">&lt;-</span> quote(mean(mtcars$wt))
  a1 <span style="color: #b22222;">#</span><span style="color: #b22222;">mean(mtcars$wt)</span>
  a2 <span style="color: #008b8b;">&lt;-</span> expression(mean(mtcars$wt))
  a2 <span style="color: #b22222;">#</span><span style="color: #b22222;">expression(mean(mtcars$wt))</span>
  a3 <span style="color: #008b8b;">&lt;-</span> parse(text = <span style="color: #8b2252;">"mean(mtcars$wt)"</span>)
  a3 <span style="color: #b22222;">#</span><span style="color: #b22222;">expression(mean(mtcars$wt))</span>
  all.equal(a1,a2)
                                        <span style="color: #b22222;">#</span><span style="color: #b22222;">[1] "Modes of target, current: call, expression"</span>
  <span style="color: #b22222;">#</span><span style="color: #b22222;">[2] "target, current do not match when deparsed"</span>
  all.equal(a1,a3)
  all.equal(a2,a3)<span style="color: #b22222;"># </span><span style="color: #b22222;">[1] "Attributes: &lt; target is NULL, current is list &gt;"</span>
                                        <span style="color: #b22222;">#</span><span style="color: #b22222;">[2] "current is not list-like"</span>
a3[<span style="color: #008b8b;">1</span>]
  a3[[<span style="color: #008b8b;">1</span>]]
  all.equal(a1,a3[[<span style="color: #008b8b;">1</span>]])
                                        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23545;&#34920;&#36798;&#24335;&#36827;&#34892;&#27714;&#20540;</span>
  eval(a1)
  eval(a2)
  eval(a3)
  deparse(a1) <span style="color: #b22222;">#</span><span style="color: #b22222;">"mean(mtcars$wt)"</span>
  deparse(a2)
  deparse(a3)
</pre>
</div>

<p>
先看一个例子：
</p>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
<span style="color: #008b8b;">library</span>(magrittr)
df <span style="color: #008b8b;">&lt;-</span> tibble(x = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>, y = <span style="color: #008b8b;">3</span>:<span style="color: #008b8b;">1</span>)
filter(df, x == <span style="color: #008b8b;">1</span>)
my_var <span style="color: #008b8b;">&lt;-</span> x                                        <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Error in eval(expr, envir, enclos): object 'x' not found</span>
filter(df, my_var == <span style="color: #008b8b;">1</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Error: object 'my_var' not found</span>
</pre>
</div>

<p>
明明 my<sub>var</sub> 是 x，但是 filter 就是不起作用。再举一个例子：
</p>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
<span style="color: #0000ff;">greet</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>(name) {
  <span style="color: #8b2252;">"How do you do, name?"</span>
}
greet(<span style="color: #8b2252;">"Hadley"</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36825;&#20010; name &#21464;&#37327;&#19981;&#36215;&#20316;&#29992;</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
<span style="color: #0000ff;">mutate_y</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>(df) {
  mutate(df, y = a + x)
}
df1 <span style="color: #008b8b;">&lt;-</span> tibble(x = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>)
a <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">10</span>
mutate_y(df1)
</pre>
</div>


<p>
近期在做聚信力多头规则替换时，发现此方法可以解决 fro 循环问题，真的十分方便。
</p>
<div class="org-src-container">
<pre class="src src-R">sdf_first_provider_mean_score <span style="color: #008b8b;">&lt;-</span> eval(parse(text=paste0(<span style="color: #8b2252;">"list("</span>, paste0(<span style="color: #8b2252;">"sdf_data_provider %&gt;% select(time, first_provider_name,second_provider_name,score) %&gt;%filter(time=="</span>,date,<span style="color: #8b2252;">") %&gt;% mutate(score=as.numeric(score)) %&gt;% group_by(first_provider_name) %&gt;% summarise(mean_score_"</span>,str_sub(date,<span style="color: #008b8b;">5</span>,<span style="color: #008b8b;">8</span>),<span style="color: #8b2252;">"=mean(score,na.rm = TRUE)%&gt;% round(3))"</span>,collapse = <span style="color: #8b2252;">','</span>),paste0(<span style="color: #8b2252;">")"</span>))))

<span style="color: #b22222;">## </span><span style="color: #b22222;">&#21487;&#20197;&#37197;&#21512;seq&#36827;&#34892;&#20351;&#29992;&#21487;&#20197;&#22788;&#29702;vector&#31867;&#22411;&#25968;&#25454;&#65292;&#20197;&#36798;&#21040;for&#24490;&#29615;&#30340;&#25928;&#26524;</span>
first_provider_mean_score_left_join <span style="color: #008b8b;">&lt;-</span> eval(parse(text=paste0(paste0(<span style="color: #8b2252;">"sdf_first_provider_mean_score[[1]]"</span>), paste0(<span style="color: #8b2252;">" %&gt;% left_join(sdf_first_provider_mean_score[["</span>,seq(<span style="color: #008b8b;">2</span>,length(date)),<span style="color: #8b2252;">"]],by = 'first_provider_name')"</span>) <span style="color: #008b8b;">%&gt;%</span> paste(collapse = <span style="color: #8b2252;">""</span>)))) <span style="color: #008b8b;">%&gt;%</span> my_sdf_collect()
</pre>
</div>
<p>
一般情况下，上述查询语句的等价于下面查询语句，可以看出真的很长。
</p>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;"># </span><span style="color: #b22222;">first_provider_score_mean &lt;- data.frame(</span>
<span style="color: #b22222;">#   </span><span style="color: #b22222;">sdf_data_provider %&gt;% select(time, first_provider_name,second_provider_name,score) %&gt;%</span>
<span style="color: #b22222;">#   </span><span style="color: #b22222;">filter(time=="20191203") %&gt;%</span>
<span style="color: #b22222;">#   </span><span style="color: #b22222;">mutate(score=as.numeric(score)) %&gt;%</span>
<span style="color: #b22222;">#   </span><span style="color: #b22222;">group_by(first_provider_name) %&gt;%</span>
<span style="color: #b22222;">#   </span><span style="color: #b22222;">summarise(mean_score_12_03=mean(score,na.rm = TRUE)%&gt;% round(3)),</span>
<span style="color: #b22222;">#   </span><span style="color: #b22222;">sdf_data_provider %&gt;% select(time, first_provider_name,second_provider_name,score) %&gt;%</span>
<span style="color: #b22222;">#   </span><span style="color: #b22222;">filter(time=="20191204") %&gt;%</span>
<span style="color: #b22222;">#   </span><span style="color: #b22222;">mutate(score=as.numeric(score)) %&gt;%</span>
<span style="color: #b22222;">#   </span><span style="color: #b22222;">group_by(first_provider_name) %&gt;%</span>
<span style="color: #b22222;">#   </span><span style="color: #b22222;">summarise(mean_score_12_04=mean(score,na.rm = TRUE)%&gt;% round(3)),</span>
<span style="color: #b22222;">#   </span><span style="color: #b22222;">sdf_data_provider %&gt;% select(time, first_provider_name,second_provider_name,score) %&gt;%</span>
<span style="color: #b22222;">#   </span><span style="color: #b22222;">filter(time=="20191205") %&gt;%</span>
<span style="color: #b22222;">#   </span><span style="color: #b22222;">mutate(score=as.numeric(score)) %&gt;%</span>
<span style="color: #b22222;">#   </span><span style="color: #b22222;">group_by(first_provider_name) %&gt;%</span>
<span style="color: #b22222;">#   </span><span style="color: #b22222;">summarise(mean_score_12_05=mean(score,na.rm = TRUE)%&gt;% round(3)),</span>
<span style="color: #b22222;">#   </span><span style="color: #b22222;">sdf_data_provider %&gt;% select(time, first_provider_name,second_provider_name,score) %&gt;%</span>
<span style="color: #b22222;">#   </span><span style="color: #b22222;">filter(time=="20191206") %&gt;%</span>
<span style="color: #b22222;">#   </span><span style="color: #b22222;">mutate(score=as.numeric(score)) %&gt;%</span>
<span style="color: #b22222;">#   </span><span style="color: #b22222;">group_by(first_provider_name) %&gt;%</span>
<span style="color: #b22222;">#   </span><span style="color: #b22222;">summarise(mean_score_12_06=mean(score,na.rm = TRUE)%&gt;% round(3)),</span>
<span style="color: #b22222;">#   </span><span style="color: #b22222;">sdf_data_provider %&gt;% select(time, first_provider_name,second_provider_name,score) %&gt;%</span>
<span style="color: #b22222;">#   </span><span style="color: #b22222;">filter(time=="20191207") %&gt;%</span>
<span style="color: #b22222;">#   </span><span style="color: #b22222;">mutate(score=as.numeric(score)) %&gt;%</span>
<span style="color: #b22222;">#   </span><span style="color: #b22222;">group_by(first_provider_name) %&gt;%</span>
<span style="color: #b22222;">#   </span><span style="color: #b22222;">summarise(mean_score_12_07=mean(score,na.rm = TRUE)%&gt;% round(3))) %&gt;% select(first_provider_name,mean_score_12_03,mean_score_12_04,mean_score_12_05,mean_score_12_06,mean_score_12_07)</span>
</pre>
</div>
</div>
</div>
</div>
<div id="orga9a4e1a" class="outline-5">
<h5 id="orga9a4e1a"><span class="section-number-5">6.2.3.2</span> tidyeval</h5>
<div class="outline-text-5" id="text-6-2-3-2">
</div>
<div id="orge1bed29" class="outline-6">
<h6 id="orge1bed29"><span class="section-number-6">6.2.3.2.1</span> quo</h6>
<div class="outline-text-6" id="text-6-2-3-2-1">
<p>
主要是为了方便传递表达式，更好地写函数。比如，有一个场景：给一个数据集 df,对指定变量 a 进行分组，然后对指定变量 b 进行求均值。如果这个场景只是出现一次，那么写几行命令实现一下需求就跳过去了。如果在分析中多次遇到这一场景，那么这个时候最好的办法就是写一个 group<sub>mean</sub> 函数，在需要的时候就可以直接调用，简洁，易读，减少代码的复制粘贴。
</p>

<p>
Quosure- an expression that has been saved with on environment.a quosure can be evalued an expression that with on environment. 
</p>

<div class="org-src-container">
<pre class="src src-R">  <span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
  a <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">1</span>
  b <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">2</span>
q <span style="color: #008b8b;">&lt;-</span> quo(a+b)
  q
  qs <span style="color: #008b8b;">&lt;-</span> quos(a,b)
  rlang::parse_expr(a)
  <span style="color: #0000ff;">group_mean</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>(data,group_var,mean_var,varnames){
      data <span style="color: #008b8b;">%&gt;%</span>
          group_by(!!group_var) <span style="color: #008b8b;">%&gt;%</span>
          summarise(!!varnames :=mean(!!mean_var))
  }

  group_mean(data=mtcars,
             group_var=quo(cyl),
             mean_var=quo(mpg),
             varnames=<span style="color: #8b2252;">"mpg"</span>)

</pre>
</div>

<p>
!!是表示 <b>立即对表达式求值，</b> 与 quo 搭配使用。使用 rlang 非标准计算涉及到＝时需要写成:=。在调用 group<sub>mean</sub> 时还需要写 quo,这个看起来比较麻烦，不够简洁。可以利用 enquo 重新定义这个函数。
</p>

<p>
The bang-bang operator \(!!\) forces a single object. One common case for \(!!\) is to substitute an
environment-variable (created with \(<-)\) with a data-variable (inside a data frame).也就是说!!varnames 会提醒 R 替换数据变量，变成环境变量。
</p>

<p>
!!(bang-bang) 主要作用是 unquote a single argument in a function call.
</p>

<div class="org-src-container">
<pre class="src src-R">a <span style="color: #008b8b;">&lt;-</span> sym(<span style="color: #8b2252;">"y"</span>)
b <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">1</span>
expr(f(!!a, !!b))
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; f(y, 1)  </span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-R">  <span style="color: #0000ff;">second_provider_mean_score_date</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>(date,varnames){
  data_provider <span style="color: #008b8b;">%&gt;%</span> select(time, first_provider_name,second_provider_name,score) <span style="color: #008b8b;">%&gt;%</span> 
  filter(time==date) <span style="color: #008b8b;">%&gt;%</span> 
  mutate(score=as.numeric(score)) <span style="color: #008b8b;">%&gt;%</span> 
  group_by(second_provider_name) <span style="color: #008b8b;">%&gt;%</span> 
  summarise(!!varnames:=mean(score,na.rm = <span style="color: #228b22;">TRUE</span>))
}
slist <span style="color: #008b8b;">&lt;-</span> list()
<span style="color: #a020f0;">for</span>(i <span style="color: #a020f0;">in</span> <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">5</span>){
slist[[i]]<span style="color: #008b8b;">&lt;-</span> second_provider_mean_score_date(date[i],paste0(<span style="color: #8b2252;">"mean_score_"</span>,date[i]))  
}
slist[[<span style="color: #008b8b;">1</span>]] <span style="color: #008b8b;">%&gt;%</span> 
  left_join(
  slist[[<span style="color: #008b8b;">2</span>]],by = <span style="color: #8b2252;">"second_provider_name"</span>
)<span style="color: #008b8b;">%&gt;%</span> left_join(
  slist[[<span style="color: #008b8b;">3</span>]],by = <span style="color: #8b2252;">"second_provider_name"</span>
)<span style="color: #008b8b;">%&gt;%</span> left_join(
  slist[[<span style="color: #008b8b;">4</span>]],by = <span style="color: #8b2252;">"second_provider_name"</span>
)<span style="color: #008b8b;">%&gt;%</span> left_join(
  slist[[<span style="color: #008b8b;">5</span>]],by = <span style="color: #8b2252;">"second_provider_name"</span>
  ) <span style="color: #008b8b;">%&gt;%</span> as.data.frame() <span style="color: #008b8b;">%&gt;%</span> group_by(mean_score_20191205)<span style="color: #008b8b;">%&gt;%</span> arrange(desc(mean_score_20191205))<span style="color: #008b8b;">%&gt;%</span> kable(caption = <span style="color: #8b2252;">"2019&#24180;12&#26376;3&#26085;&#33267;7&#26085;second_provider&#21508;&#28192;&#36947;&#20154;&#32676;score&#22343;&#20540;&#21464;&#21270;&#24773;&#20917;"</span>)
</pre>
</div>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #0000ff;">group_mean</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>(data,group_var,mean_var,varnames){
group_var_e <span style="color: #008b8b;">&lt;-</span> enquo(group_var)
mean_var_e <span style="color: #008b8b;">&lt;-</span> enquo(mean_var)
  data <span style="color: #008b8b;">%&gt;%</span>
      group_by(!!group_var_e) <span style="color: #008b8b;">%&gt;%</span>

          summarise(!!varnames :=mean(!!mean_var_e))
  }
  group_mean(data=mtcars,
             group_var=cyl,
             mean_var=mpg,
             varnames=<span style="color: #8b2252;">"mpg"</span>)
</pre>
</div>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #008b8b;">library</span>(dplyr)
var=sym(<span style="color: #8b2252;">"height"</span>)
var <span style="color: #008b8b;">%&gt;%</span> typeof()
<span style="color: #b22222;">#</span><span style="color: #b22222;">var &lt;- parse(text = "height")</span>
starwars <span style="color: #008b8b;">%&gt;%</span>
    summarise(avg = mean(!!var,na.rm = <span style="color: #228b22;">TRUE</span>))
</pre>
</div>
<p>
The big-bang operator !!! forces-splice a list of objects.
</p>

<div class="org-src-container">
<pre class="src src-R">vars <span style="color: #008b8b;">&lt;-</span> syms(c(<span style="color: #8b2252;">"height"</span>, <span style="color: #8b2252;">"mass"</span>))

<span style="color: #b22222;"># </span><span style="color: #b22222;">Force-splicing is equivalent to supplying the elements separately</span>
starwars <span style="color: #008b8b;">%&gt;%</span> select(!!!vars)
starwars <span style="color: #008b8b;">%&gt;%</span> select(height, mass)
</pre>
</div>
</div>
</div>

<div id="orgfe31fe0" class="outline-6">
<h6 id="orgfe31fe0"><span class="section-number-6">6.2.3.2.2</span> parse<sub>expr</sub>()</h6>
<div class="outline-text-6" id="text-6-2-3-2-2">
<p>
rlang::parse<sub>expr</sub>() convert a string to an expression.
parse<sub>exprs</sub> 是 parse<sub>expr</sub> 的加强版，可以处理多个字符串。在 eval<sub>tidy</sub> 函数之外，还有轻量级的 eval,就是 eval<sub>bare</sub>.
两个函数差别不大，eval<sub>bare</sub> 不能接收数据，eval<sub>tidy</sub> 可以接收数据。
</p>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
<span style="color: #008b8b;">library</span>(rlang)
<span style="color: #008b8b;">library</span>(dplyr)
 e <span style="color: #008b8b;">&lt;-</span> parse_expr(<span style="color: #8b2252;">"a+b"</span>)
 parse_expr(<span style="color: #8b2252;">"mean(mtcars$wt)"</span>) <span style="color: #008b8b;">%&gt;%</span> eval_tidy()
 parse_exprs(<span style="color: #8b2252;">"mean(mtcars$wt); mean(mtcars$am)"</span>) <span style="color: #008b8b;">%&gt;%</span> eval_tidy()
 parse_expr(<span style="color: #8b2252;">"mean(mtcars$wt)"</span>) <span style="color: #008b8b;">%&gt;%</span> eval_bare() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22914;&#26524;&#19981;&#28041;&#21363;&#26032;&#30340;&#25968;&#25454;&#65292;&#23601;&#21487;&#20197;&#20351;&#29992;eval_bare,&#22914;&#26524;&#38656;&#35201;&#29992;&#21040;&#25968;&#25454;&#65292;&#37027;&#20040;&#23601;&#38656;&#35201;&#29992;eval_tidy &#36827;&#34892;&#27714;&#20540;</span>
 parse_expr(<span style="color: #8b2252;">"mean(wt)"</span>) <span style="color: #008b8b;">%&gt;%</span> eval_tidy(data=mtcars)
parse_expr(<span style="color: #8b2252;">"mean(wt)"</span>) <span style="color: #008b8b;">%&gt;%</span> eval_bare() <span style="color: #b22222;">#</span><span style="color: #b22222;">Error in mean(wt) : &#25214;&#19981;&#21040;&#23545;&#35937;'wt'</span>
</pre>
</div>
</div>
</div>

<div id="orgefeb74e" class="outline-6">
<h6 id="orgefeb74e"><span class="section-number-6">6.2.3.2.3</span> exec</h6>
<div class="outline-text-6" id="text-6-2-3-2-3">
<p>
To call a function with arguments stored in a list (if the function doesn't support dynamic dots). Splice the list of arguments with !!!.
</p>

<div class="org-src-container">
<pre class="src src-R"> args <span style="color: #008b8b;">&lt;-</span> list(x=c(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">10</span>,<span style="color: #008b8b;">100</span>,<span style="color: #228b22;">NA</span>),na.rm = <span style="color: #228b22;">TRUE</span>)
 args
  exec(<span style="color: #8b2252;">"mean"</span>,!!!args)
  fs <span style="color: #008b8b;">&lt;-</span> list(a = <span style="color: #a020f0;">function</span>()<span style="color: #8b2252;">"a"</span>,b = <span style="color: #a020f0;">function</span>()<span style="color: #8b2252;">"b"</span>)
fs
  lapply(fs,exec)
                                        <span style="color: #b22222;"># </span><span style="color: #b22222;">Compare to do.call it will not automatically inline expressions</span>
                                        <span style="color: #b22222;"># </span><span style="color: #b22222;">into the evaluated call.</span>
  x <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">10</span>
  args <span style="color: #008b8b;">&lt;-</span> exprs(x1 = x+<span style="color: #008b8b;">1</span>,x2 = x*<span style="color: #008b8b;">2</span>)
  exec(list,!!!args)
  do.call(list,args) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21487;&#20197;&#30475;&#20986;do.call &#30452;&#25509;&#21487;&#20197;&#32473;&#20986;&#21464;&#37327;&#25968;&#20540;</span>
  f <span style="color: #008b8b;">&lt;-</span> disp~cyl
  exec(<span style="color: #8b2252;">"lm"</span>,f,data = mtcars)
</pre>
</div>
</div>
</div>

<div id="orgaab59ff" class="outline-6">
<h6 id="orgaab59ff"><span class="section-number-6">6.2.3.2.4</span> f<sub>rhs</sub></h6>
<div class="outline-text-6" id="text-6-2-3-2-4">
<p>
f<sub>rhs</sub> extracts the righthand side, f<sub>lhs</sub> extracts the lefthand side, and f<sub>env</sub> extracts the environment. All functions throw an error if f is not a formula.
</p>

<div class="org-src-container">
<pre class="src src-R">f_rhs(~ <span style="color: #008b8b;">1</span> + <span style="color: #008b8b;">2</span> + <span style="color: #008b8b;">3</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1 + 2 + 3</span>
f_rhs(~ x)
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; x</span>
f_rhs(~ <span style="color: #8b2252;">"A"</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "A"</span>
f_rhs(<span style="color: #008b8b;">1</span> ~ <span style="color: #008b8b;">2</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 2</span>

f_lhs(~ y) 
f_lhs(x ~ y)
f_env(~ x)
</pre>
</div>
</div>
</div>

<div id="orgaaf8b2d" class="outline-6">
<h6 id="orgaaf8b2d"><span class="section-number-6">6.2.3.2.5</span> expr<sub>text</sub>()</h6>
<div class="outline-text-6" id="text-6-2-3-2-5">
<p>
expr<sub>text</sub>() turns the expression into a single string, which might be multi-line.
</p>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #0000ff;">fn</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>(x) expr_label(substitute(x))
fn(x:y)
                                        <span style="color: #b22222;"># </span><span style="color: #b22222;">Strings are encoded</span>
expr_label(<span style="color: #8b2252;">"a\nb"</span>)

                                        <span style="color: #b22222;"># </span><span style="color: #b22222;">Names and expressions are quoted with ``</span>
expr_label(quote(x))
                                        <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "`x`"</span>
expr_label(quote(a + b + c))


</pre>
</div>
</div>
</div>

<div id="orga0ee7d3" class="outline-6">
<h6 id="orga0ee7d3"><span class="section-number-6">6.2.3.2.6</span> new<sub>formula</sub></h6>
<div class="outline-text-6" id="text-6-2-3-2-6">
<div class="org-src-container">
<pre class="src src-R">new_formula(quote(a), quote(b))
new_formula(<span style="color: #228b22;">NULL</span>,quote(b))
</pre>
</div>
</div>
</div>

<div id="org063fdd4" class="outline-6">
<h6 id="org063fdd4"><span class="section-number-6">6.2.3.2.7</span> call2</h6>
<div class="outline-text-6" id="text-6-2-3-2-7">
<p>
quote function call are one of the two types of symbolic objects in r.
</p>
<div class="org-src-container">
<pre class="src src-R">  <span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
<span style="color: #008b8b;">library</span>(rlang)
  arg <span style="color: #008b8b;">&lt;-</span> list(x=<span style="color: #008b8b;">4</span>,base=<span style="color: #008b8b;">2</span>)
  log(x=<span style="color: #008b8b;">4</span>,base = <span style="color: #008b8b;">2</span>)
  call2(<span style="color: #8b2252;">"log"</span>,x=<span style="color: #008b8b;">4</span>,base=<span style="color: #008b8b;">2</span>)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-R">  <span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
  quo(g1)
  quo(a+b+c)
  quo(<span style="color: #8b2252;">"a"</span>)
  my_summarise(df,quo(g1))
  <span style="color: #0000ff;">my_summarise</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>(df, group_var) {
    df <span style="color: #008b8b;">%&gt;%</span>
      group_by(!! group_var) <span style="color: #008b8b;">%&gt;%</span>
      summarise(a = mean(a))
  }
  df <span style="color: #008b8b;">&lt;-</span> tibble(
    g1 = c(<span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">2</span>),
    g2 = c(<span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">1</span>),
    a = sample(<span style="color: #008b8b;">5</span>),
    b = sample(<span style="color: #008b8b;">5</span>)
  )
  my_summarise(df,quo(g1))<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36825;&#23601;&#21487;&#20197;&#20102;&#65281;&#65281;&#65281;</span>

df <span style="color: #008b8b;">%&gt;%</span> group_by(g1) <span style="color: #008b8b;">%&gt;%</span> summarise(mean(a))
  my_summarise(df,g1)
</pre>
</div>

<p>
parse 函数用于解析文件，解析字符串就是 parse 中用 text 参数表示。deparse 是相反的，是把 R 表达式逆解析为字符。
parse: covert a string to a saved expression.
</p>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
parse(text = <span style="color: #8b2252;">"1+2"</span>)
parse(text = <span style="color: #8b2252;">"1+2"</span>) <span style="color: #008b8b;">%&gt;%</span> class()
parse(text = <span style="color: #8b2252;">"1+2"</span>) <span style="color: #008b8b;">%&gt;%</span> typeof()
deparse(expression(<span style="color: #008b8b;">1</span> + <span style="color: #008b8b;">2</span>))
</pre>
</div>
<p>
quote 则是用于捕捉未计算的表达式。
</p>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
quote(<span style="color: #008b8b;">1</span> + <span style="color: #008b8b;">2</span>)
quote(<span style="color: #008b8b;">1</span> + <span style="color: #008b8b;">2</span>) <span style="color: #008b8b;">%&gt;%</span> typeof()
quote(<span style="color: #008b8b;">1</span> + <span style="color: #008b8b;">2</span>) <span style="color: #008b8b;">%&gt;%</span> class()
</pre>
</div>

<ul class="org-ul">
<li>eval 来完成对表达式进行计算（求值）</li>
</ul>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
eval(quote(<span style="color: #008b8b;">1</span> + <span style="color: #008b8b;">2</span>))
eval(parse(text = <span style="color: #8b2252;">"1+2"</span>))
</pre>
</div>

<p>
一般是用 parse 从字符串（或者是硬盘上的文件）解析成一个 expression 对象，是表达式列表，而后使用 eval()函数对表达式求解。
</p>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
q <span style="color: #008b8b;">&lt;-</span> quote(<span style="color: #008b8b;">1</span> + <span style="color: #008b8b;">2</span>)
q <span style="color: #008b8b;">&lt;-</span> as.list(q)
q <span style="color: #008b8b;">&lt;-</span> <span style="color: #8b2252;">"-"</span>
q
eval(parse(q))
q
</pre>
</div>

<p>
## 数据值预览
```{r}
data &lt;- data.frame(score1 = rnorm(100), score2 = rnorm(100))
head(data)
str(data)
data %&gt;% head(10) #显示前 10 行
data %&gt;% tail(-1) #减去第一行
data %&gt;% tail(10) #显示后 10 行
```
</p>

<p>
## 缺失值分析在 sparklyr 中，常用 na.replace()函数对缺失值进行插补。
</p>
<div class="org-src-container">
<pre class="src src-R">  <span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
data <span style="color: #008b8b;">&lt;-</span> data.frame(score1 = c(<span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">3</span>), score2 = c(<span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">3</span>, <span style="color: #008b8b;">4</span>))
inspect_na(data) <span style="color: #b22222;">#</span><span style="color: #b22222;">require inspect package</span>
<span style="color: #b22222;">###</span><span style="color: #b22222;">&#21024;&#38500;&#32570;&#22833;&#20540;</span>
data1 <span style="color: #008b8b;">&lt;-</span> data.frame(x=c(<span style="color: #228b22;">NA</span>,<span style="color: #008b8b;">1</span>,<span style="color: #008b8b;">2</span>))
drop_na(data1) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21024;&#38500; NA &#20540;</span>
data <span style="color: #008b8b;">&lt;-</span> data.frame(x=c(<span style="color: #228b22;">NA</span>,<span style="color: #008b8b;">1</span>,<span style="color: #008b8b;">2</span>),y=c(<span style="color: #008b8b;">1</span>,<span style="color: #008b8b;">2</span>,<span style="color: #228b22;">NA</span>))
data <span style="color: #008b8b;">%&gt;%</span> head
<span style="color: #b22222;">## </span><span style="color: #b22222;">x  y</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">1 NA  1</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">2  1  2</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">3  2 NA</span>
<span style="color: #b22222;">###</span><span style="color: #b22222;">drop_na--------------------------</span>
data <span style="color: #008b8b;">%&gt;%</span> drop_na(x,y) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21482;&#20445;&#30041;&#20840;&#20026;&#38750;&#31354;&#30340;&#25968;&#20540;&#34892;</span>
data <span style="color: #008b8b;">%&gt;%</span> drop_na(x) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21024;&#38500; x &#20026; NA &#30340;&#34892;</span>
<span style="color: #b22222;">###</span><span style="color: #b22222;">&#32570;&#22833;&#20540;&#22635;&#34917;--------------------------</span>
<span style="color: #b22222;">##</span><span style="color: #b22222;">Currently either "down" (the default), "up", "downup" (i.e. first down and then up) or "updown" (first up and then down)</span>
data <span style="color: #008b8b;">%&gt;%</span> fill(x,.direction = c(<span style="color: #8b2252;">"updown"</span>)) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26681;&#25454;&#26368;&#38752;&#36817;&#19979;&#38754;&#30340;&#25968;&#20540;&#26469;&#22635;&#20805;&#25554;&#34917;</span>
data <span style="color: #008b8b;">%&gt;%</span> replace_na()
?replace_na
data <span style="color: #008b8b;">&lt;-</span> tibble(x=c(<span style="color: #008b8b;">1</span>,<span style="color: #008b8b;">2</span>,<span style="color: #228b22;">NA</span>),y=c(<span style="color: #8b2252;">"a"</span>,<span style="color: #228b22;">NA</span>,<span style="color: #8b2252;">"b"</span>))
<span style="color: #b22222;">###</span><span style="color: #b22222;">&#32570;&#22833;&#20540;&#22635;&#20805;--------------------------</span>
replace_na(data,replace = list(x=<span style="color: #008b8b;">1</span>,y=<span style="color: #8b2252;">"down"</span>))
<span style="color: #b22222;">## </span><span style="color: #b22222;">A tibble: 3 x 2</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">x y</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">1 a</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">2 down</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">1 b</span>
df <span style="color: #008b8b;">&lt;-</span> tibble(
  group = c(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">1</span>),
  item_id = c(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">2</span>),
  item_name = c(<span style="color: #8b2252;">"a"</span>, <span style="color: #8b2252;">"b"</span>, <span style="color: #8b2252;">"b"</span>),
  value1 = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>,
  value2 = <span style="color: #008b8b;">4</span>:<span style="color: #008b8b;">6</span>
)
<span style="color: #b22222;">###</span><span style="color: #b22222;">more examples--------------------------</span>
num_mean <span style="color: #008b8b;">&lt;-</span> mean(data$num, na.rm = <span style="color: #228b22;">TRUE</span>)
type_mode <span style="color: #008b8b;">&lt;-</span> as.character(data$type[which.max(table(data$type))])
data <span style="color: #008b8b;">&lt;-</span> replace_na(data = data, replace = list(num = num_mean, 
                                                 + type = type_mode))
</pre>
</div>
</div>
</div>
</div>
</div>
</div>

<div id="org682b787" class="outline-3">
<h3 id="org682b787"><span class="section-number-3">6.3</span> 单变量分析</h3>
<div class="outline-text-3" id="text-6-3">
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
summary(data)                                        <span style="color: #b22222;"># </span><span style="color: #b22222;">return min,1st quantile,median,mean,3rd quantile, max</span>
<span style="color: #008b8b;">library</span>(moments)
skewness(data) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20559;&#24230;</span>
kurtosis(data) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23792;&#24230;</span>
<span style="color: #b22222;">##</span><span style="color: #b22222;">summary statisics</span>
<span style="color: #0000ff;">mystats</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>(x,na.omit=<span style="color: #228b22;">FALSE</span>){
    <span style="color: #a020f0;">if</span>(na.omit)
        x=x[!is.na(x)]
    m=mean(x)
    n=length(x)
    s=sd(x)
    skew=sum((x-m)^<span style="color: #008b8b;">3</span>/s^<span style="color: #008b8b;">3</span>)/n
    kurt=sum((x-m)^<span style="color: #008b8b;">4</span>/s^<span style="color: #008b8b;">4</span>)/n-<span style="color: #008b8b;">3</span>
    <span style="color: #a020f0;">return</span>(c(n=n,mean=m,stdev=s,skew=skew,kurtosis=kurt))
}
mystats(data.matrix(data))
sapply(data, mystats) <span style="color: #b22222;">#</span><span style="color: #b22222;">return statstics</span>
<span style="color: #008b8b;">library</span>(Hmisc)
describe(data) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21487;&#20197;&#30693;&#36947;&#32570;&#22833;&#20540;</span>
<span style="color: #008b8b;">library</span>(pastecs)
stat.desc(data,basic=T,desc = T,norm = T,p=<span style="color: #008b8b;">0.95</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21487;&#20197;&#30693;&#36947; NA &#20010;&#25968;</span>
missmap(data, main = <span style="color: #8b2252;">"Missing values vs observed"</span>)
sapply(data, <span style="color: #a020f0;">function</span>(x) length(unique(x))) <span style="color: #b22222;">#</span>
sapply(data,<span style="color: #a020f0;">function</span>(x) sum(is.na(x))) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#32570;&#22833;&#20540;&#20010;&#25968;</span>
</pre>
</div>
</div>
</div>

<div id="org6b027fb" class="outline-3">
<h3 id="org6b027fb"><span class="section-number-3">6.4</span> 多变量分析</h3>
<div class="outline-text-3" id="text-6-4">
</div>
<div id="orge5ef2ee" class="outline-4">
<h4 id="orge5ef2ee"><span class="section-number-4">6.4.1</span> 二维列联表</h4>
<div class="outline-text-4" id="text-6-4-1">
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
<span style="color: #b22222;">##</span><span style="color: #b22222;">&#21487;&#20197;&#29983;&#25104; SAS &#24418;&#24335;&#30340;&#32467;&#26524;</span>
<span style="color: #008b8b;">library</span>(gmodels)
CrossTable(data$score1,data$score2) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#29983;&#25104; CrossTable</span>
<span style="color: #b22222;">##</span><span style="color: #b22222;">dplyr &#24418;&#24335;</span>
case_when(mtcars$carb &lt;= <span style="color: #008b8b;">2</span> ~ <span style="color: #8b2252;">"low"</span>,
          mtcars$carb &gt; <span style="color: #008b8b;">2</span> ~ <span style="color: #8b2252;">"high"</span>) <span style="color: #008b8b;">%&gt;%</span> table
<span style="color: #b22222;">###</span><span style="color: #b22222;">compelete-------------------------- </span>
<span style="color: #b22222;">###</span><span style="color: #b22222;">&#36825;&#20010;&#20989;&#25968;&#21487;&#20197;&#24555;&#36895;&#25554;&#20837;&#20960;&#20010;&#29305;&#24449;,&#20854;&#20182;&#29305;&#24449;&#25554;&#20837;&#33258;&#28982;&#22343;&#20026; 0</span>
df <span style="color: #008b8b;">&lt;-</span> tibble(
    group = c(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">1</span>),
    item_id = c(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">2</span>),
    item_name = c(<span style="color: #8b2252;">"a"</span>, <span style="color: #8b2252;">"b"</span>, <span style="color: #8b2252;">"b"</span>),
    value1 = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>,
    value2 = <span style="color: #008b8b;">4</span>:<span style="color: #008b8b;">6</span>
)
df
df <span style="color: #008b8b;">%&gt;%</span> complete(group, nesting(item_id, item_name)) <span style="color: #008b8b;">%&gt;%</span> dim
expand(mtcars, vs, cyl)<span style="color: #b22222;">#</span><span style="color: #b22222;">&#30456;&#24403;&#20110; select &#21151;&#33021;</span>
mtcars <span style="color: #008b8b;">%&gt;%</span> colnames()
                                      <span style="color: #b22222;"># </span><span style="color: #b22222;">Only combinations of vs and cyl that appear in the data</span>
expand(mtcars,nesting(vs,cyl))
</pre>
</div>
</div>
</div>
<div id="org3668339" class="outline-4">
<h4 id="org3668339"><span class="section-number-4">6.4.2</span> 三维列联表</h4>
<div class="outline-text-4" id="text-6-4-2">
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
xtabs(~score1,data = data)
ftable(xtabs(~score1,data = data))
</pre>
</div>
</div>
</div>

<div id="org8855450" class="outline-4">
<h4 id="org8855450"><span class="section-number-4">6.4.3</span> 卡方独立性检验</h4>
<div class="outline-text-4" id="text-6-4-3">
<p>
chisq.test()函数可以对二维表的行变量和列变量进行卡方独立性检验。探讨的是样本的行变量与列变量是相互独立的概率。如果 P 值很小，那么就会拒绝原假设，原假设是两个样本之间相互独立。
</p>
</div>
</div>

<div id="orgbe3dd0b" class="outline-4">
<h4 id="orgbe3dd0b"><span class="section-number-4">6.4.4</span> 二变量关系</h4>
<div class="outline-text-4" id="text-6-4-4">
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
<span style="color: #008b8b;">library</span>(car)
states=as.data.frame(state.x77[,c(<span style="color: #8b2252;">"Murder"</span>,<span style="color: #8b2252;">"Population"</span>,<span style="color: #8b2252;">"Illiteracy"</span>)])
scatterplotMatrix(states,spread=<span style="color: #228b22;">FALSE</span>,lty.smooth=<span style="color: #008b8b;">2</span>)
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="org0717bb8" class="outline-2">
<h2 id="org0717bb8"><span class="section-number-2">7</span> 字符型数据</h2>
<div class="outline-text-2" id="text-7">
</div>
<div id="org078aad6" class="outline-3">
<h3 id="org078aad6"><span class="section-number-3">7.1</span> 常见函数</h3>
<div class="outline-text-3" id="text-7-1">
<div class="org-src-container">
<pre class="src src-R">nchar(<span style="color: #8b2252;">"a"</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">char size</span>

</pre>
</div>
</div>
</div>
<div id="org042df2c" class="outline-3">
<h3 id="org042df2c"><span class="section-number-3">7.2</span> 字符大小写</h3>
<div class="outline-text-3" id="text-7-2">
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
x <span style="color: #008b8b;">&lt;-</span> <span style="color: #8b2252;">"Mixed cAsE 124"</span>
tolower(x) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#23383;&#31526;&#20840;&#37096;&#23567;&#20889;</span>
toupper(x) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#23383;&#31526;&#20840;&#37096;&#22823;&#20889;</span>
</pre>
</div>
</div>
</div>

<div id="org313e2b8" class="outline-3">
<h3 id="org313e2b8"><span class="section-number-3">7.3</span> 字符串取子集</h3>
<div class="outline-text-3" id="text-7-3">
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
substr(<span style="color: #8b2252;">"abcdef"</span>, <span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">4</span>)
substring(<span style="color: #8b2252;">"abcdef"</span>, <span style="color: #008b8b;">2</span>,<span style="color: #008b8b;">6</span>)
substring(<span style="color: #8b2252;">"abcdef"</span>, <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">6</span>)
substring(<span style="color: #8b2252;">"abcdef"</span>, <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">6</span>, <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">6</span>)
str_sub(<span style="color: #8b2252;">"abcdef"</span>, <span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">4</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21644; substr &#19968;&#26679;&#30340;&#25928;&#26524;</span>
str_sub(<span style="color: #8b2252;">"abcdef"</span>, -<span style="color: #008b8b;">3</span>, -<span style="color: #008b8b;">1</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#38468;&#23646;&#34920;&#31034;&#20174;&#21518;&#24448;&#21069;&#25968;</span>
x=<span style="color: #8b2252;">"Sbcdef"</span>
str_sub(x, <span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">1</span>) <span style="color: #008b8b;">&lt;-</span> str_to_lower(str_sub(x, <span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">1</span>))<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21487;&#20197;&#29992; str_sub()&#20989;&#25968;&#30340;&#36171;&#20540;&#24418;&#24335;&#26469;&#20462;&#25913;&#23383;&#31526;&#20018;</span>
x <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #8b2252;">"123456789"</span>, <span style="color: #8b2252;">"abcdefghijklmnopq"</span>)
substr(x, c(<span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">4</span>), c(<span style="color: #008b8b;">4</span>, <span style="color: #008b8b;">5</span>, <span style="color: #008b8b;">8</span>))
substring(x, c(<span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">4</span>), c(<span style="color: #008b8b;">4</span>, <span style="color: #008b8b;">5</span>, <span style="color: #008b8b;">8</span>))
</pre>
</div>
</div>

<div id="orgccc4895" class="outline-4">
<h4 id="orgccc4895"><span class="section-number-4">7.3.1</span> 返回字符数</h4>
<div class="outline-text-4" id="text-7-3-1">
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
nchar(<span style="color: #8b2252;">"&#20320;&#22909;&#21527;&#65311;"</span>)
str_length(<span style="color: #8b2252;">"&#20320;&#22909;&#21527;&#65311;"</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36825;&#20004;&#20010;&#20989;&#25968;&#30456;&#21516;</span>
length(<span style="color: #8b2252;">"&#20320;&#22909;&#21527;&#65311;"</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#23383;&#31526;&#20018;&#30340;&#38271;&#24230;&#20026; 1</span>
</pre>
</div>
</div>
</div>

<div id="orge4d6387" class="outline-4">
<h4 id="orge4d6387"><span class="section-number-4">7.3.2</span> 正则表达式匹配</h4>
<div class="outline-text-4" id="text-7-3-2">
<p>
比如：字符 a 是否包括在字符 b 中
</p>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
x <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #8b2252;">"apple"</span>, <span style="color: #8b2252;">"banana"</span>, <span style="color: #8b2252;">"pear"</span>)
str_view(x, <span style="color: #8b2252;">"an"</span>)
grep(<span style="color: #8b2252;">"an"</span>,x,?an) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#36820;&#22238; false&#65292;true</span>
grep(<span style="color: #8b2252;">"[pe]"</span>,x) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21482;&#35201;&#26377; p/e &#23383;&#31526;&#37117;&#36820;&#22238; true</span>
a <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #8b2252;">"as"</span>, <span style="color: #8b2252;">"abcd"</span>, <span style="color: #8b2252;">"bcd"</span>, <span style="color: #8b2252;">"1_bcd"</span>)
b <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #8b2252;">"bcd"</span>)
c <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #8b2252;">"ads"</span>)
grepl(b, a) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#36820;&#22238; false&#65292;true</span>
grep(b, a) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#22312; x &#20013;&#25628;&#32034;&#26576;&#31181;&#27169;&#24335;&#12290;&#33509; fixed=FALSE&#65292;&#21017; pattern &#20026;&#19968;&#20010;&#27491;&#21017;&#34920;&#36798;&#24335;&#65292;&#36820;&#22238;&#30340;&#26159;&#20803;&#32032;&#30340;&#20301;&#32622;</span>
grep(b, a, ?bcd) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25628;&#32034;&#20197; bcd &#32467;&#23614;&#30340;&#23383;&#31526;&#20018;</span>
grep(<span style="color: #8b2252;">"A"</span>, c(<span style="color: #8b2252;">"b"</span>, <span style="color: #8b2252;">"A"</span>, <span style="color: #8b2252;">"c"</span>)) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21069;&#19968;&#20010;&#21442;&#25968;&#26159;&#23376;&#38598;&#65292;&#21518;&#19968;&#20010;&#21442;&#25968;&#26159;&#20840;&#38598;</span>
</pre>
</div>

<p>
给出一个更为复杂的例子
</p>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
x <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #8b2252;">"a_X01"</span>, <span style="color: #8b2252;">"b_X02"</span>, <span style="color: #8b2252;">"c_X01"</span>)
y <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #8b2252;">"a"</span>, <span style="color: #8b2252;">"b"</span>)
target <span style="color: #008b8b;">&lt;-</span> gsub(<span style="color: #8b2252;">"_X[0-9]+"</span>, <span style="color: #8b2252;">""</span>, x) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21305;&#37197; x &#21644; y</span>
intersect(y, target) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#24471;&#20986;&#21644; y &#30456;&#21305;&#37197;&#30340;&#23383;&#31526;</span>
</pre>
</div>

<p>
涉及到具体位置的匹配可以用 regexpr、gregexpr 和 regexec 三个函数进行匹配：
</p>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
text <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #8b2252;">"Hellow, Adam!"</span>, <span style="color: #8b2252;">"Hi, Adam!"</span>, <span style="color: #8b2252;">"How are you, Adam."</span>)
regexpr(<span style="color: #8b2252;">"Adam"</span>, text) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#31934;&#30830;&#36820;&#22238;</span>
gregexpr(<span style="color: #8b2252;">"Adam"</span>, text)<span style="color: #b22222;">#</span><span style="color: #b22222;">&#21644; regexpr &#19968;&#26679;&#65292;&#23427; return &#30340;&#26159; list &#22411;</span>
regexec(<span style="color: #8b2252;">"Adam"</span>, text)
</pre>
</div>

<ul class="org-ul">
<li>锚点</li>
</ul>

<p>
锚点在正则匹配中的作用就是快速定位字母位置。使用方法是：
</p>

<p>
^从字符串开头进行匹配；$从字符串末尾进行匹配。除此之外，还有其他模式的匹配选项，包括：
</p>

<p>
\d 可以匹配任意数字；\s 可以匹配任意空白字符（如空格、制表符和换行符）；[abc]可以匹配 a、b 或 c；[<sup>abc</sup>]可以匹配除 a、b、c 外的任意字符。想创建包含\d 或\s 的正则表达式，需要在字符串中对\进行转义，因此需要输入"\\d"或"\\s".除此之外，字符选项可以创建多个可选的模式，例如，abc|d..f 可以匹配 abc 或 deaf.
</p>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
x <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #8b2252;">"apple"</span>, <span style="color: #8b2252;">"banana"</span>, <span style="color: #8b2252;">"pear"</span>)
str_view(x, <span style="color: #8b2252;">"^a"</span>)
str_view(x,<span style="color: #8b2252;">"r$"</span>)
str_view(x,<span style="color: #8b2252;">"a$"</span>)
y <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #8b2252;">"summarize"</span>,<span style="color: #8b2252;">"summary"</span>,<span style="color: #8b2252;">"rowsum"</span>)
str_view(y,<span style="color: #8b2252;">"\bsum\b"</span>)
y <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #8b2252;">"summarize"</span>,<span style="color: #8b2252;">"summary"</span>,<span style="color: #8b2252;">"dsums"</span>,<span style="color: #8b2252;">"rowsum"</span>)
str_view(y,<span style="color: #8b2252;">"\bsum\b"</span>)
str_view(c(<span style="color: #8b2252;">"grey"</span>,<span style="color: #8b2252;">"gray"</span>),<span style="color: #8b2252;">"gr(e|a)y"</span>)
</pre>
</div>

<p>
正则表达式还有一项功能能够重复匹配字符多次
?：0次或 1 次；+：1次或多次；*：0次或多次；{n}：匹配 n 次；{n,}：匹配 n 次或更多次；{,m}：最多匹配 m 次；{n,m}：匹配 n 到 m 次。
</p>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
x <span style="color: #008b8b;">&lt;-</span> <span style="color: #8b2252;">"1888 is the longest year in Roman numerals: MDCCCLXXXVIII"</span>
str_view(x,<span style="color: #8b2252;">"CC?"</span>)
str_view(x,<span style="color: #8b2252;">"CC+"</span>)
str_view(x,<span style="color: #8b2252;">"C[LX]+"</span>)
str_view(x,<span style="color: #8b2252;">"C{2}"</span>)
str_view(x,<span style="color: #8b2252;">"C{2,}"</span>)
str_view(x,<span style="color: #8b2252;">"C{2,3}"</span>)
</pre>
</div>

<p>
默认的匹配方式是"贪婪的"：正则表达式会匹配尽量长的字符串，通过在正则表达式后面添加一个?，可以将匹配方式更改为“懒惰的”，即匹配尽量短的字符串。
</p>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
str_view(x,<span style="color: #8b2252;">"C{2,3}?"</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21482;&#21305;&#37197;&#21040; 2 &#20010; CC</span>
str_view(x,<span style="color: #8b2252;">"C[LX]+?"</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21482;&#21305;&#37197;&#21040; CL</span>
str_view(x,<span style="color: #8b2252;">"^.*$"</span>)
str_view(x,<span style="color: #8b2252;">"\\{.+\\}"</span>)
y <span style="color: #008b8b;">&lt;-</span> <span style="color: #8b2252;">"1888 is the longest year in R\\\\.w\\\\oman numerals: MDCCCLXXXVIII"</span>
str_view(y,<span style="color: #8b2252;">"\\{.+\\}"</span>)
str_view(y,<span style="color: #8b2252;">"\\\\{2}"</span>)
</pre>
</div>
</div>
</div>

<div id="org1f4513a" class="outline-4">
<h4 id="org1f4513a"><span class="section-number-4">7.3.3</span> 分组与回溯引用</h4>
<div class="outline-text-4" id="text-7-3-3">
<p>
括号还可以定义“分组”，可以通过回溯引用（如\1,\2）来引用这些分组。
</p>
</div>
</div>

<div id="org2ec45fd" class="outline-4">
<h4 id="org2ec45fd"><span class="section-number-4">7.3.4</span> 字符串替换</h4>
<div class="outline-text-4" id="text-7-3-4">
<p>
sub:在 x 中搜索 pattern，并以文本 replacement 将其替换。
</p>
<div class="org-src-container">
<pre class="src src-R">txt <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #8b2252;">"The"</span>, <span style="color: #8b2252;">"licenses"</span>, <span style="color: #8b2252;">"for"</span>, <span style="color: #8b2252;">"most"</span>, <span style="color: #8b2252;">"software"</span>, <span style="color: #8b2252;">"are"</span>,
         <span style="color: #8b2252;">"designed"</span>, <span style="color: #8b2252;">"to"</span>, <span style="color: #8b2252;">"take"</span>, <span style="color: #8b2252;">"away"</span>, <span style="color: #8b2252;">"your"</span>, <span style="color: #8b2252;">"freedom"</span>,
         <span style="color: #8b2252;">"to"</span>, <span style="color: #8b2252;">"share"</span>, <span style="color: #8b2252;">"and"</span>, <span style="color: #8b2252;">"change"</span>, <span style="color: #8b2252;">"it."</span>,
         <span style="color: #8b2252;">""</span>, <span style="color: #8b2252;">"By"</span>, <span style="color: #8b2252;">"contrast,"</span>, <span style="color: #8b2252;">"the"</span>, <span style="color: #8b2252;">"GNU"</span>, <span style="color: #8b2252;">"General"</span>, <span style="color: #8b2252;">"Public"</span>, <span style="color: #8b2252;">"License"</span>,
         <span style="color: #8b2252;">"is"</span>, <span style="color: #8b2252;">"intended"</span>, <span style="color: #8b2252;">"to"</span>, <span style="color: #8b2252;">"guarantee"</span>, <span style="color: #8b2252;">"your"</span>, <span style="color: #8b2252;">"freedom"</span>, <span style="color: #8b2252;">"to"</span>,
         <span style="color: #8b2252;">"share"</span>, <span style="color: #8b2252;">"and"</span>, <span style="color: #8b2252;">"change"</span>, <span style="color: #8b2252;">"free"</span>, <span style="color: #8b2252;">"software"</span>, <span style="color: #8b2252;">"--"</span>,
         <span style="color: #8b2252;">"to"</span>, <span style="color: #8b2252;">"make"</span>, <span style="color: #8b2252;">"sure"</span>, <span style="color: #8b2252;">"the"</span>, <span style="color: #8b2252;">"software"</span>, <span style="color: #8b2252;">"is"</span>,
         <span style="color: #8b2252;">"free"</span>, <span style="color: #8b2252;">"for"</span>, <span style="color: #8b2252;">"all"</span>, <span style="color: #8b2252;">"its"</span>, <span style="color: #8b2252;">"users"</span>)
sub(<span style="color: #8b2252;">"\\s"</span>, <span style="color: #8b2252;">"."</span>, <span style="color: #8b2252;">"Hello There"</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23558;&#20013;&#38388;&#30340;&#31354;&#26684;&#26367;&#25442;&#25104;.</span>
(ot <span style="color: #008b8b;">&lt;-</span> sub(pattern = <span style="color: #8b2252;">"[b-e]"</span>,replacement = <span style="color: #8b2252;">"."</span>, txt)) <span style="color: #b22222;">#</span><span style="color: #b22222;">txt&#20013;</span>
sub(pattern = <span style="color: #8b2252;">"b|e"</span>, replacement = <span style="color: #8b2252;">"."</span>, txt) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21482;&#20570;&#19968;&#27425;&#26367;&#25442;</span>
gsub(pattern = <span style="color: #8b2252;">"b|e"</span>, replacement = <span style="color: #8b2252;">"."</span>, txt) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25226;&#28385;&#36275;&#26465;&#20214;&#30340;&#21305;&#37197;&#20840;&#20570;&#26367;&#25442;</span>
</pre>
</div>

<p>
可以利用 chartr 替换特定的字符模式
</p>
<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> <span style="color: #8b2252;">"Mixed cAsE 124"</span>
chartr(<span style="color: #8b2252;">"iXs"</span>, <span style="color: #8b2252;">"why"</span>, x) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21482;&#35201;x&#20013;&#21547;&#26377;"iXs"&#65292;&#37027;&#20040;&#23601;&#26356;&#25442;&#20026;"why".</span>
chartr(<span style="color: #8b2252;">"a-cX"</span>, <span style="color: #8b2252;">"D-Fw"</span>, x)
</pre>
</div>
</div>
</div>

<div id="org64ea39d" class="outline-4">
<h4 id="org64ea39d"><span class="section-number-4">7.3.5</span> 字符串排序</h4>
<div class="outline-text-4" id="text-7-3-5">
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
x <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #8b2252;">"apple"</span>, <span style="color: #8b2252;">"eggplant"</span>, <span style="color: #8b2252;">"banana"</span>)
str_sort(x, locale = <span style="color: #8b2252;">"en"</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25353;&#29031;&#33521;&#35821;&#23383;&#27597;&#30340;&#39034;&#24207;&#25490;&#24207;</span>
</pre>
</div>
</div>
</div>

<div id="orgc0197fd" class="outline-4">
<h4 id="orgc0197fd"><span class="section-number-4">7.3.6</span> 字符串拆分</h4>
<div class="outline-text-4" id="text-7-3-6">
<p>
在 split 处分割字符向量 x 中的元素。
</p>
<div class="org-src-container">
<pre class="src src-R">strsplit(<span style="color: #8b2252;">"abc"</span>, <span style="color: #8b2252;">""</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#23558;&#23383;&#27573;&#20998;&#35010;&#25104;"a" "b" "c"</span>
strsplit(<span style="color: #8b2252;">"a_b"</span>,<span style="color: #8b2252;">"_"</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21487;&#20197;&#23558;&#8220;a_b&#8221;&#20998;&#25286;&#25104; &#8220;a&#8221;&#21644;&#8220;b&#8221;</span>
</pre>
</div>
</div>
</div>

<div id="orgfa80fa1" class="outline-4">
<h4 id="orgfa80fa1"><span class="section-number-4">7.3.7</span> 字符串连接</h4>
<div class="outline-text-4" id="text-7-3-7">
<p>
主要有三种函数可以解决这个问题：paste、str<sub>c</sub>、sprintf、glue 四个函数。
</p>
<div class="org-src-container">
<pre class="src src-R">paste(<span style="color: #8b2252;">"x"</span>, <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>, sep = <span style="color: #8b2252;">""</span>)
paste(<span style="color: #8b2252;">"x-"</span>, <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>,<span style="color: #8b2252;">"-y"</span>, sep = <span style="color: #8b2252;">""</span>)
paste(<span style="color: #8b2252;">"x-"</span>, c(<span style="color: #008b8b;">1</span>,<span style="color: #228b22;">NA</span>),<span style="color: #8b2252;">"-y"</span>, sep = <span style="color: #8b2252;">""</span>)
name <span style="color: #008b8b;">&lt;-</span> <span style="color: #8b2252;">"Hadley"</span>
time_of_day <span style="color: #008b8b;">&lt;-</span> <span style="color: #8b2252;">"morning"</span>
birthday <span style="color: #008b8b;">&lt;-</span> <span style="color: #228b22;">FALSE</span>
paste(<span style="color: #8b2252;">"Good "</span>, time_of_day, <span style="color: #8b2252;">" "</span>, name,<span style="color: #a020f0;">if</span> (birthday) <span style="color: #8b2252;">" and HAPPY BIRTHDAY"</span>,<span style="color: #8b2252;">"."</span>)
paste(<span style="color: #8b2252;">"Good "</span>, time_of_day, <span style="color: #8b2252;">" "</span>, name,<span style="color: #a020f0;">if</span> (birthday) <span style="color: #8b2252;">" and HAPPY BIRTHDAY"</span>,<span style="color: #8b2252;">"."</span>,sep = <span style="color: #8b2252;">""</span>)
str_c(<span style="color: #8b2252;">"x"</span>,<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>)
str_c(<span style="color: #8b2252;">"x"</span>,<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>,sep = <span style="color: #8b2252;">""</span>)
str_c(<span style="color: #8b2252;">"x-"</span>, c(<span style="color: #008b8b;">1</span>,<span style="color: #228b22;">NA</span>),<span style="color: #8b2252;">"-y"</span>, sep = <span style="color: #8b2252;">""</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">return "x-1-y" NA,&#36825;&#28857;&#21644;paste&#32467;&#26524;&#19981;&#21516;</span>
str_c(<span style="color: #8b2252;">"Good "</span>, time_of_day, <span style="color: #8b2252;">" "</span>, name,<span style="color: #a020f0;">if</span> (birthday) <span style="color: #8b2252;">" and HAPPY BIRTHDAY"</span>,<span style="color: #8b2252;">"."</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21644;paste&#30456;&#27604;&#65292;str_c&#20989;&#25968;&#40664;&#35748;sep=""</span>
str_c(c(<span style="color: #8b2252;">"x"</span>, <span style="color: #8b2252;">"y"</span>, <span style="color: #8b2252;">"z"</span>), sep = <span style="color: #8b2252;">", "</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">return "x" "y" "z"</span>
str_c(<span style="color: #8b2252;">"x"</span>, <span style="color: #8b2252;">"y"</span>, <span style="color: #8b2252;">"z"</span>, sep = <span style="color: #8b2252;">", "</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22914;&#26524;&#24819;&#29992;sep&#23454;&#29616;&#30456;&#21516;&#30340;&#32467;&#26524;&#65292;&#21482;&#38656;&#35201;&#25226;&#21521;&#37327;c()&#21435;&#25481;</span>
str_c(c(<span style="color: #8b2252;">"x"</span>, <span style="color: #8b2252;">"y"</span>, <span style="color: #8b2252;">"z"</span>), collapse = <span style="color: #8b2252;">", "</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">return "x, y, z",collapse&#21487;&#20197;&#23558;&#23383;&#31526;&#21521;&#37327;&#21512;&#24182;&#20026;&#23383;&#31526;&#20018;</span>
typeof(sprintf(<span style="color: #8b2252;">"x%d"</span>, <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">16</span>))
d <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">16</span>
glue::glue(<span style="color: #8b2252;">"x{d}"</span>)
</pre>
</div>

<p>
more example
</p>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #008b8b;">library</span>(glue)
name <span style="color: #008b8b;">&lt;-</span> <span style="color: #8b2252;">"Fred"</span>
age <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">50</span>
anniversary <span style="color: #008b8b;">&lt;-</span> as.Date(<span style="color: #8b2252;">"1991-10-12"</span>)
glue(
    <span style="color: #8b2252;">"My name is {name},"</span>,
    <span style="color: #8b2252;">" my age next year is {age + 1},"</span>,
    <span style="color: #8b2252;">' my anniversary is {format(anniversary, "%A, %B %d, %Y")}.'</span>
)
</pre>
</div>

<p>
glue<sub>data</sub>() 可以和 magrittr 的管道函数一起用 %&gt;% .
</p>
<div class="org-src-container">
<pre class="src src-R">mtcars <span style="color: #008b8b;">%&gt;%</span> head
  head(mtcars) <span style="color: #008b8b;">%&gt;%</span> glue_data(<span style="color: #8b2252;">"{rownames(.)} has {hp} hp"</span>)
  <span style="color: #b22222;">## </span><span style="color: #b22222;">Mazda RX4 has 110 hp</span>
  <span style="color: #b22222;">## </span><span style="color: #b22222;">Mazda RX4 Wag has 110 hp</span>
  <span style="color: #b22222;">## </span><span style="color: #b22222;">Datsun 710 has 93 hp</span>
  <span style="color: #b22222;">## </span><span style="color: #b22222;">Hornet 4 Drive has 110 hp</span>
  <span style="color: #b22222;">## </span><span style="color: #b22222;">Hornet Sportabout has 175 hp</span>
  <span style="color: #b22222;">## </span><span style="color: #b22222;">Valiant has 105 hp</span>
</pre>
</div>
</div>
</div>

<div id="org4add6ec" class="outline-4">
<h4 id="org4add6ec"><span class="section-number-4">7.3.8</span> 字符串重编码</h4>
<div class="outline-text-4" id="text-7-3-8">
<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> rep(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>, <span style="color: #008b8b;">3</span>)
recode(x, <span style="color: #8b2252;">"c(1,2)='A';  else='B'"</span>)
</pre>
</div>
</div>
</div>

<div id="org8b54bba" class="outline-4">
<h4 id="org8b54bba"><span class="section-number-4">7.3.9</span> 字符串转为命令</h4>
<div class="outline-text-4" id="text-7-3-9">
<p>
试想一个应用场景就是，在作 glm 拟合时，如果变量数很多，而且只需要提取部分变量作回归，那么需要把入模的变量提取出来进行建模。这时，利用 paste 将变量连接起来就变得很重要了。
</p>

<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">10</span>
a <span style="color: #008b8b;">&lt;-</span> <span style="color: #8b2252;">"print(x)"</span>
class(a)
eval(parse(text = a))
                                      <span style="color: #b22222;"># </span><span style="color: #b22222;">more example</span>
traindata = final_onehot_train_samples <span style="color: #008b8b;">%&gt;%</span> select(feat_model) <span style="color: #008b8b;">%&gt;%</span>
    bind_cols(train_test$train <span style="color: #008b8b;">%&gt;%</span> select(label,cluster)) <span style="color: #008b8b;">%&gt;%</span> mutate(cluster=as.factor(cluster))
formula = eval(parse(text = paste0(<span style="color: #8b2252;">"label ~ 1 +"</span>, paste(vars_cv_selected <span style="color: #008b8b;">%&gt;%</span> head(-<span style="color: #008b8b;">1</span>),collapse = <span style="color: #8b2252;">" + "</span>),<span style="color: #8b2252;">"+ (1|cluster) "</span>)))
glmm_fit <span style="color: #008b8b;">&lt;-</span> glmer(formula, data=traindata,nAGQ = <span style="color: #008b8b;">9</span>,family = binomial)
</pre>
</div>
</div>
</div>

<div id="org7ec3046" class="outline-4">
<h4 id="org7ec3046"><span class="section-number-4">7.3.10</span> append</h4>
<div class="outline-text-4" id="text-7-3-10">
<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">5</span>
(foo <span style="color: #008b8b;">&lt;-</span> c(x[<span style="color: #008b8b;">1</span>], <span style="color: #008b8b;">0</span>, x[<span style="color: #008b8b;">2</span>:<span style="color: #008b8b;">5</span>]))

append(x, <span style="color: #008b8b;">0</span>, after = <span style="color: #008b8b;">0</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25918;&#22312;&#31532;&#19968;&#20010;&#20803;&#32032;</span>
append(x, <span style="color: #008b8b;">0</span>, after = <span style="color: #008b8b;">1</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#22312;&#31532;&#19968;&#20010;&#20803;&#32032;&#20043;&#21518;&#28155;&#21152;0</span>
append(x, <span style="color: #008b8b;">0</span>, after = <span style="color: #008b8b;">2</span>)
</pre>
</div>
</div>
</div>

<div id="org1ced595" class="outline-4">
<h4 id="org1ced595"><span class="section-number-4">7.3.11</span> 返回两个数据框不相同的位置</h4>
<div class="outline-text-4" id="text-7-3-11">
<div class="org-src-container">
<pre class="src src-R">a <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">2</span>)
b <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">1</span>)
which(a != b)
a <span style="color: #008b8b;">&lt;-</span> data.frame(num = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>, lib = letters[<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>])
b <span style="color: #008b8b;">&lt;-</span> data.frame(num = c(<span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">0</span>), lib = letters[<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>])
which(a != b) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21482;&#36820;&#22238;&#19968;&#20010;&#34892;&#20540;</span>
which(a != b, arr.ind = <span style="color: #228b22;">TRUE</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#19981;&#20165;&#36820;&#22238;&#34892;&#20540;&#65292;&#36824;&#36820;&#22238;&#21015;&#20540;&#65292;arr.ind&#21442;&#25968;&#26159;array indices&#20043;&#24847;&#65292;&#36820;&#22238;&#25968;&#25454;&#26694;&#30340;&#34892;&#21015;&#20301;&#32622;</span>
</pre>
</div>
</div>
</div>

<div id="org1bba5ba" class="outline-4">
<h4 id="org1bba5ba"><span class="section-number-4">7.3.12</span> 删掉重复行</h4>
<div class="outline-text-4" id="text-7-3-12">
<div class="org-src-container">
<pre class="src src-R">  <span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
x <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #008b8b;">9</span>:<span style="color: #008b8b;">20</span>, <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">5</span>, <span style="color: #008b8b;">3</span>:<span style="color: #008b8b;">7</span>, <span style="color: #008b8b;">0</span>:<span style="color: #008b8b;">8</span>)
x
unique(x)
(xu <span style="color: #008b8b;">&lt;-</span> x[!duplicated(x)])
</pre>
</div>
</div>
</div>

<div id="orge3ff1a0" class="outline-4">
<h4 id="orge3ff1a0"><span class="section-number-4">7.3.13</span> 如何对数列（array）进行维度变换?</h4>
<div class="outline-text-4" id="text-7-3-13">
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
x <span style="color: #008b8b;">&lt;-</span> array(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">24</span>, <span style="color: #008b8b;">2</span>:<span style="color: #008b8b;">4</span>)
x
xt <span style="color: #008b8b;">&lt;-</span> aperm(x, c(<span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">3</span>))
dim(x) <span style="color: #b22222;"># </span><span style="color: #b22222;">(2,3,4)</span>
dim(xt) <span style="color: #b22222;"># </span><span style="color: #b22222;">(3,2,4)</span>
</pre>
</div>
</div>
</div>

<div id="orgb018580" class="outline-4">
<h4 id="orgb018580"><span class="section-number-4">7.3.14</span> 如何对矩阵按行（列）作计算？</h4>
<div class="outline-text-4" id="text-7-3-14">
<p>
使用函数 apply()进行计算。
</p>
<div class="org-src-container">
<pre class="src src-R">  <span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
vec <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">20</span>
mat <span style="color: #008b8b;">&lt;-</span> matrix(vec, ncol = <span style="color: #008b8b;">4</span>)
cumsum(vec)
mat
apply(mat, <span style="color: #008b8b;">2</span>, cumsum)
apply(mat, <span style="color: #008b8b;">1</span>, cumsum)
</pre>
</div>
</div>
</div>

<div id="orgc20dae5" class="outline-4">
<h4 id="orgc20dae5"><span class="section-number-4">7.3.15</span> 注释大段的 R 脚本</h4>
<div class="outline-text-4" id="text-7-3-15">
<p>
可以用这种形式注释掉大段的程序，第一次见到。
</p>
<div class="org-src-container">
<pre class="src src-R">  <span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
<span style="color: #a020f0;">if</span> (<span style="color: #228b22;">FALSE</span>) {
  x <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">1</span>
}
inser
</pre>
</div>
</div>
</div>

<div id="orgc59fea2" class="outline-4">
<h4 id="orgc59fea2"><span class="section-number-4">7.3.16</span> 如何对数据框（data.frame）的某列作数学变换？</h4>
<div class="outline-text-4" id="text-7-3-16">
<p>
transform 作用：为原数据框添加新的列，可以改变原变量列的值，也可以赋值 NULL 删除列变量用法：transform(‘data’, &#x2026;)，data 就是要修改的数据，'&#x2026;'代表要进行的修改，相当于 dlyr 包中的 mutate 函数。
</p>
<div class="org-src-container">
<pre class="src src-R">  <span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
transform(airquality, Ozone = -Ozone)
transform(airquality, new = -Ozone, Temp = (Temp - <span style="color: #008b8b;">32</span>) / <span style="color: #008b8b;">1.8</span>)
</pre>
</div>

<p>
with 函数的返回值是原语句的返回值。within 跟 with 功能相同，但返回值不同，within 会返回所有修改生效后的原始数据结构（列表、数据框等），但是需要注意书写方式哦。坑真多~
</p>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
mydata <span style="color: #008b8b;">&lt;-</span> data.frame(x1 = c(<span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">6</span>, <span style="color: #008b8b;">4</span>), x2 = c(<span style="color: #008b8b;">3</span>, <span style="color: #008b8b;">4</span>, <span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">8</span>))
(mydata <span style="color: #008b8b;">&lt;-</span> with(mydata, {
    sumx <span style="color: #008b8b;">&lt;-</span> x1 + x2
    meanx <span style="color: #008b8b;">&lt;-</span> (x1 + x2) / <span style="color: #008b8b;">2</span>
}))
(mydata <span style="color: #008b8b;">&lt;-</span> with(mydata, {
    list(sumx = x1 + x2, meanx = (x1 + x2) / <span style="color: #008b8b;">2</span>)
})) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#36825;&#26679;&#20070;&#20889;&#23601;&#21487;&#20197;&#36755;&#20986;&#25152;&#26377;&#21464;&#37327;&#20540;</span>
                                      <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21482;&#36820;&#22238; meanx &#20540;&#65292;sumx &#20540;&#19981;&#36820;&#22238;</span>
(mydata <span style="color: #008b8b;">&lt;-</span> within(mydata, sumx = x1 + x2, meanx = (x1 + x2) / <span style="color: #008b8b;">2</span>))
(mydata <span style="color: #008b8b;">&lt;-</span> within(mydata, {
    sumx <span style="color: #008b8b;">&lt;-</span> x1 + x2
    meanx <span style="color: #008b8b;">&lt;-</span> (x1 + x2) / <span style="color: #008b8b;">2</span>
})) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#27599;&#20010;&#26032;&#20462;&#25913;&#30340;&#20195;&#30721;&#37117;&#38656;&#35201;&#25442;&#34892;</span>
(mydata <span style="color: #008b8b;">&lt;-</span> within(mydata, {
    sumx <span style="color: #008b8b;">&lt;-</span> x1 + x2
    meanx <span style="color: #008b8b;">&lt;-</span> (x1 + x2) / <span style="color: #008b8b;">2</span>
}))
</pre>
</div>

<p>
by(data, INDICES, FUN, &#x2026;, simplify = TRUE):把 data 这个 data frame 按照 INDICES 的 factor 拆分成若干块小的 data frames，在每块小的 data frame 上运行函数 FUN。
</p>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
by(warpbreaks[, <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">2</span>], warpbreaks[, <span style="color: #8b2252;">"tension"</span>], summary)
by(
    warpbreaks, warpbreaks[, <span style="color: #8b2252;">"tension"</span>],
    <span style="color: #a020f0;">function</span>(x) lm(breaks ~ wool, data = x)
)
</pre>
</div>

<p>
### 求解两组平行向量的极值？
</p>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
x <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">10</span>
y <span style="color: #008b8b;">&lt;-</span> rev(x)
pmax(x, y)
pmin(x, y)
</pre>
</div>
</div>
</div>

<div id="orge2be2ad" class="outline-4">
<h4 id="orge2be2ad"><span class="section-number-4">7.3.17</span> 如何对不规则数组进行统计分析？</h4>
<div class="outline-text-4" id="text-7-3-17">
<p>
可以用 tapply(x,f,g)进行分析，x为向量，f为因子列，g为操作函数，相对数据框进行类似操作可以用 by 函数。
example:
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<tbody>
<tr>
<td class="org-right">value</td>
<td class="org-right">class</td>
<td class="org-right">sum</td>
</tr>

<tr>
<td class="org-right">1</td>
<td class="org-right">1</td>
<td class="org-right">1+4</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-right">2</td>
<td class="org-right">2</td>
</tr>

<tr>
<td class="org-right">3</td>
<td class="org-right">3</td>
<td class="org-right">3</td>
</tr>

<tr>
<td class="org-right">4</td>
<td class="org-right">1</td>
<td class="org-right">NA</td>
</tr>
</tbody>
</table>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
n <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">4</span>
fac <span style="color: #008b8b;">&lt;-</span> factor(rep(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>, len = n), levels = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">5</span>)
fac
table(fac)
tapply(<span style="color: #008b8b;">1</span>:n, fac, sum)
tapply(<span style="color: #008b8b;">1</span>:n, fac, sum)
tapply(<span style="color: #008b8b;">1</span>:n, fac, mean)
a <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #008b8b;">24</span>, <span style="color: #008b8b;">25</span>, <span style="color: #008b8b;">36</span>, <span style="color: #008b8b;">37</span>)
b <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #8b2252;">"q"</span>, <span style="color: #8b2252;">"w"</span>, <span style="color: #8b2252;">"q"</span>, <span style="color: #8b2252;">"w"</span>)
tapply(a, b, mean)
tapply(a, b, sum)
<span style="color: #008b8b;">attach</span>(warpbreaks) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#36825;&#20010; attach &#20989;&#25968;&#30340;&#21151;&#33021;&#23601;&#26159;&#23558;&#25968;&#25454;&#38598;&#37322;&#25918;&#20986;&#26469;</span>
tapply(breaks, list(wool, tension), mean) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#36824;&#33021;&#20570;&#21015;&#32852;&#34920;</span>
aggregate(breaks, list(wool, tension), mean) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#30456;&#24403;&#20110;&#23545; tapply &#32467;&#26524;&#20570;&#20102;&#36716;&#32622;</span>
</pre>
</div>
</div>
</div>

<div id="orgad22c4b" class="outline-4">
<h4 id="orgad22c4b"><span class="section-number-4">7.3.18</span> 判断数据框的列是否为数字</h4>
<div class="outline-text-4" id="text-7-3-18">
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
x <span style="color: #008b8b;">&lt;-</span> data.frame(x = c(<span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">3</span>), y = c(<span style="color: #8b2252;">"a"</span>, <span style="color: #8b2252;">"b"</span>, <span style="color: #8b2252;">"c"</span>))
sapply(x, is.numeric) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#36820;&#22238;&#25968;&#25454;&#26159;&#21542;&#20026;&#25968;&#23383;</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">&#36820;&#22238;&#20869;&#23384;&#20013;&#25152;&#26377;&#23545;&#35937;&#30340;&#21344;&#29992;&#22823;&#23567;</span>
sapply(ls(), <span style="color: #a020f0;">function</span>(x) round(object.size(get(x)) / <span style="color: #008b8b;">1024</span> / <span style="color: #008b8b;">1024</span>))
</pre>
</div>
</div>
</div>

<div id="org014c7b6" class="outline-4">
<h4 id="org014c7b6"><span class="section-number-4">7.3.19</span> 如何将数据标准化？</h4>
<div class="outline-text-4" id="text-7-3-19">
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
x <span style="color: #008b8b;">&lt;-</span> c(rnorm(<span style="color: #008b8b;">100</span>), <span style="color: #008b8b;">2</span> * rnorm(<span style="color: #008b8b;">30</span>))
m <span style="color: #008b8b;">&lt;-</span> scale(x, scale = F) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21482; centering</span>
n <span style="color: #008b8b;">&lt;-</span> scale(x, center = F) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21482; scaling</span>
l <span style="color: #008b8b;">&lt;-</span> scale(x) <span style="color: #b22222;">## </span><span style="color: #b22222;">&#40664;&#35748;&#30340;&#26159;&#19981;&#20165;&#20570; centering&#65292;&#36824;&#20570;&#20102; scaling</span>
</pre>
</div>
</div>
</div>

<div id="org8745359" class="outline-4">
<h4 id="org8745359"><span class="section-number-4">7.3.20</span> 如何做交叉列联表？（table）</h4>
<div class="outline-text-4" id="text-7-3-20">
<p>
table，xtab，ftable
</p>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
xtabs(cbind(ncases, ncontrols) ~ ., data = esoph)
ftable(xtabs(cbind(ncases, ncontrols) ~ ., data = esoph))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
                                      <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20197;&#21518;&#20294;&#20961;&#26377;$&#65292;&#27604;&#36739;&#22810;&#30340;&#25805;&#20316;&#65292;&#37117;&#21487;&#20197;&#29992; with &#26469;&#20889;&#65292;&#24456;&#26041;&#20415;&#30340;</span>
x <span style="color: #008b8b;">&lt;-</span> with(airquality, table(cut(Temp, quantile(Temp)), Month))
with(airquality, table(cut(Temp, quantile(Temp))))
with(airquality, cut(Temp, quantile(Temp)))
head(airquality)
head(x)
prop.table(x, <span style="color: #008b8b;">1</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">x &#26159;&#27714;&#35299;&#20986;&#20102;&#39057;&#25968;&#65292;prop.table &#27714;&#35299;&#20986;&#20102;&#27010;&#29575;</span>
</pre>
</div>

<p>
一个经典的例子：一个 data.frame 中对所有变量进行 table,然后计算其 pct.
</p>
<div class="org-src-container">
<pre class="src src-R">  mtcars <span style="color: #008b8b;">%&gt;%</span> 
      lapply(table) <span style="color: #008b8b;">%&gt;%</span> 
      lapply(as.data.frame) <span style="color: #008b8b;">%&gt;%</span> 
      Map(cbind,var = names(mtcars),.) <span style="color: #008b8b;">%&gt;%</span> 
      rbind_all() <span style="color: #008b8b;">%&gt;%</span> 
      group_by(var) <span style="color: #008b8b;">%&gt;%</span> 
      mutate(pct = Freq / sum(Freq))
<span style="color: #b22222;">#####</span>
  mtcars <span style="color: #008b8b;">%&gt;%</span> 
      map(table) <span style="color: #008b8b;">%&gt;%</span> 
      map(as.data.frame) <span style="color: #008b8b;">%&gt;%</span> 
      map2(.,names(.),cbind) <span style="color: #008b8b;">%&gt;%</span> 
      bind_rows() <span style="color: #008b8b;">%&gt;%</span> 
      set_names(<span style="color: #8b2252;">"Var1"</span>,<span style="color: #8b2252;">"Freq"</span>,<span style="color: #8b2252;">"var"</span>) <span style="color: #008b8b;">%&gt;%</span> 
      group_by(var) <span style="color: #008b8b;">%&gt;%</span> 
      mutate(pct=Freq/sum(Freq))
</pre>
</div>
</div>
</div>
</div>

<div id="orgf37327c" class="outline-3">
<h3 id="orgf37327c"><span class="section-number-3">7.4</span> 4 list 型数据</h3>
<div class="outline-text-3" id="text-7-4">
<p>
列表（list）是 R 的数据类型中最为复杂的一种。一般来说，列表就是一些对象（或成分，component）的有序集合。列表允许你整合若干（可能无关的）对象到单个对象名下。
</p>
</div>
<div id="org3c517dd" class="outline-4">
<h4 id="org3c517dd"><span class="section-number-4">7.4.1</span> data.frame</h4>
<div class="outline-text-4" id="text-7-4-1">
<p>
data.frame()来创建数据框，它以带命名的向量作为输入
</p>

<div class="org-src-container">
<pre class="src src-R"> <span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>

df <span style="color: #008b8b;">&lt;-</span> data.frame(
     x=<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>,
     y=c(<span style="color: #8b2252;">"a"</span>,<span style="color: #8b2252;">"b"</span>,<span style="color: #8b2252;">"c"</span>),
     <span style="color: #b22222;">#</span><span style="color: #b22222;">stringsAsFactors = T</span>
 )

 df <span style="color: #008b8b;">%&gt;%</span> str() 
 df <span style="color: #008b8b;">%&gt;%</span> typeof()
df <span style="color: #008b8b;">%&gt;%</span> class() 
</pre>
</div>

<p>
需要注意的是 data.frame() 的默认行为是把字符转换为因子，可以 stringsAsFactors=FALSE 避免这个行为。
</p>
</div>
</div>

<div id="org7516b81" class="outline-4">
<h4 id="org7516b81"><span class="section-number-4">7.4.2</span> do.call</h4>
<div class="outline-text-4" id="text-7-4-2">
<p>
do.call(what, args, quote = FALSE, envir = parent.frame())
what 要不是操作函数，要不是 function 的 string 形式,args 是 list 对象。
</p>
<div class="org-src-container">
<pre class="src src-R"> <span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
                                       <span style="color: #b22222;"># </span><span style="color: #b22222;">do.call</span>
a <span style="color: #008b8b;">&lt;-</span> do.call(rbind, list(data.frame(a = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">2</span>, b = <span style="color: #008b8b;">2</span>:<span style="color: #008b8b;">3</span>), data.frame(b = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">2</span>, a = <span style="color: #008b8b;">2</span>:<span style="color: #008b8b;">3</span>))) <span style="color: #b22222;"># </span><span style="color: #b22222;">rind &#26080;&#27861;&#30452;&#25509;&#23545; list &#31867;&#22411;&#36827;&#34892; rbind</span>
 a <span style="color: #008b8b;">%&gt;%</span> typeof
 t1 <span style="color: #008b8b;">&lt;-</span> do.call(kmeans, list(x = iris[, <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">4</span>], centers = <span style="color: #008b8b;">3</span>))
 rbindlist(list(data.frame(a = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">2</span>, b = <span style="color: #008b8b;">2</span>:<span style="color: #008b8b;">3</span>), data.frame(b = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">2</span>, a = <span style="color: #008b8b;">2</span>:<span style="color: #008b8b;">3</span>)))
 <span style="color: #b22222;">## </span><span style="color: #b22222;">&#38656;&#35201;&#27880;&#24847; rbindlist &#20989;&#25968;&#19981;&#33021;&#33258;&#21160;&#35782;&#21035;&#21464;&#37327;&#21517;</span>
                                       <span style="color: #b22222;"># </span><span style="color: #b22222;">more example</span>
 tmp <span style="color: #008b8b;">&lt;-</span> expand.grid(letters[<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">2</span>], <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>, c(<span style="color: #8b2252;">"+"</span>, <span style="color: #8b2252;">"-"</span>)) <span style="color: #b22222;"># </span><span style="color: #b22222;">list</span>
 tmp
 do.call(paste, c(tmp, sep = <span style="color: #8b2252;">""</span>))
 do.call(paste, list(as.name(<span style="color: #8b2252;">"A"</span>), as.name(<span style="color: #8b2252;">"B"</span>)), quote = <span style="color: #228b22;">TRUE</span>)
 <span style="color: #b22222;">##</span>
 A <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">2</span>
 <span style="color: #0000ff;">f</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>(x) print(x^<span style="color: #008b8b;">2</span>)
 env <span style="color: #008b8b;">&lt;-</span> new.env()
 assign(<span style="color: #8b2252;">"A"</span>, <span style="color: #008b8b;">10</span>, envir = env)
 assign(<span style="color: #8b2252;">"f"</span>, f, envir = env)
 <span style="color: #0000ff;">f</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>(x) print(x)
 f(A) <span style="color: #b22222;"># </span><span style="color: #b22222;">2</span>
 do.call(<span style="color: #8b2252;">"f"</span>, list(A)) <span style="color: #b22222;"># </span><span style="color: #b22222;">2</span>
 do.call(<span style="color: #8b2252;">"f"</span>, list(A), envir = env) <span style="color: #b22222;"># </span><span style="color: #b22222;">4</span>
 do.call(f, list(A), envir = env) <span style="color: #b22222;"># </span><span style="color: #b22222;">2</span>
 do.call(<span style="color: #8b2252;">"f"</span>, list(quote(A)), envir = env) <span style="color: #b22222;"># </span><span style="color: #b22222;">100</span>
 do.call(f, list(quote(A)), envir = env) <span style="color: #b22222;"># </span><span style="color: #b22222;">10</span>
 do.call(<span style="color: #8b2252;">"f"</span>, list(as.name(<span style="color: #8b2252;">"A"</span>)), envir = env) <span style="color: #b22222;"># </span><span style="color: #b22222;">100</span>
</pre>
</div>
</div>
</div>

<div id="orga185468" class="outline-4">
<h4 id="orga185468"><span class="section-number-4">7.4.3</span> c()</h4>
<div class="outline-text-4" id="text-7-4-3">
<p>
c() 可以将几个向量合并成一个。如果原子向量和列表同时存在，那么在合并之前，c() 会将原子向量强制转换成列表。当你试图合并不同类型的数据时，将向最灵活的类型进行强制转换。以灵活程度排序，从小到大依次为： <b>逻辑、整数、双精度浮点数和字符。</b>
</p>

<div class="org-src-container">
<pre class="src src-R">  <span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
c(<span style="color: #8b2252;">"a"</span>,<span style="color: #008b8b;">1</span>) <span style="color: #008b8b;">%&gt;%</span> str <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21487;&#20197;&#23558;&#25968;&#23383;&#22411;&#36716;&#21270;&#20026;char&#22411;</span>

  x <span style="color: #008b8b;">&lt;-</span> c(F,F,T) 
  as.numeric(x)
  sum(x) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#31455;&#28982;&#35745;&#31639;&#36923;&#36753;&#22411;&#65281;&#65281;</span>
  mean(x)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
<span style="color: #008b8b;">1</span> ==  <span style="color: #8b2252;">"1"</span> <span style="color: #b22222;">#</span><span style="color: #b22222;">[1] TRUE,&#31455;&#28982;&#21487;&#20197;&#36820;&#22238;TRUE</span>
-<span style="color: #008b8b;">1</span>&lt;F <span style="color: #b22222;">#</span><span style="color: #b22222;">[1] TRUE </span>
<span style="color: #8b2252;">"one"</span>&lt;<span style="color: #008b8b;">2</span>
</pre>
</div>


<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
x <span style="color: #008b8b;">&lt;-</span> list(list(<span style="color: #008b8b;">1</span>,<span style="color: #008b8b;">2</span>),c(<span style="color: #008b8b;">3</span>,<span style="color: #008b8b;">4</span>)) 
x <span style="color: #008b8b;">%&gt;%</span> typeof()
y <span style="color: #008b8b;">&lt;-</span> c(list(<span style="color: #008b8b;">1</span>,<span style="color: #008b8b;">2</span>),c(<span style="color: #008b8b;">3</span>,<span style="color: #008b8b;">4</span>)) 
y <span style="color: #008b8b;">%&gt;%</span> typeof() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#30475;&#21040;&#36825;&#26159;list&#22411;</span>
</pre>
</div>
</div>
</div>
</div>

<div id="org293ae1d" class="outline-3">
<h3 id="org293ae1d"><span class="section-number-3">7.5</span> 5 因子型数据</h3>
<div class="outline-text-3" id="text-7-5">
<p>
函数 factor()以一个整数向量的形式存储类别值，整数的取值范围是[1&#x2026; k]（其中 k 是名义型变量中唯一值的个数）。
</p>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
status <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #8b2252;">"poor"</span>, <span style="color: #8b2252;">"improved"</span>, <span style="color: #8b2252;">"excellent"</span>, <span style="color: #8b2252;">"poor"</span>)
factor(status, ordered = <span style="color: #228b22;">TRUE</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#35774;&#23450;&#20026;&#26377;&#24207;&#22240;&#23376;</span>
factor(status, ordered = <span style="color: #228b22;">TRUE</span>,levels = c(<span style="color: #8b2252;">"poor"</span>,<span style="color: #8b2252;">"improved"</span>,<span style="color: #8b2252;">"excellent"</span>))
factor(status) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#35774;&#23450;&#20026;&#21517;&#20041;&#21464;&#37327;</span>
data <span style="color: #008b8b;">&lt;-</span> data.frame(x = c(<span style="color: #8b2252;">"male"</span>, <span style="color: #8b2252;">"female"</span>, <span style="color: #8b2252;">"male"</span>))
</pre>
</div>

<p>
factors 应该常常和 rev 函数配合使用。
</p>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
rev(factor(letters))
factor(letters,levels = rev(letters))
</pre>
</div>
</div>
</div>

<div id="orgda32aea" class="outline-3">
<h3 id="orgda32aea"><span class="section-number-3">7.6</span> 6 日期型数据</h3>
<div class="outline-text-3" id="text-7-6">
<p>
计算日期间隔
</p>
<div class="org-src-container">
<pre class="src src-R">difftime()
today <span style="color: #008b8b;">&lt;-</span> Sys.Date()
dob <span style="color: #008b8b;">&lt;-</span> as.Date(<span style="color: #8b2252;">"1988-06-07"</span>)
difftime(today, dob, units = <span style="color: #8b2252;">"days"</span>)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-R">as.Date(dates, <span style="color: #8b2252;">"%Y.%m.%d"</span>)
dates <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #8b2252;">"1992.01.01"</span>)  
</pre>
</div>
</div>
</div>

<div id="org5a16e7f" class="outline-3">
<h3 id="org5a16e7f"><span class="section-number-3">7.7</span> 7 TODO: BOOLEN 数据</h3>
<div class="outline-text-3" id="text-7-7">
</div>
<div id="orgde1d230" class="outline-4">
<h4 id="orgde1d230"><span class="section-number-4">7.7.1</span> 布尔代数</h4>
<div class="outline-text-4" id="text-7-7-1">
<div class="org-src-container">
<pre class="src src-R">rep_len(F, <span style="color: #008b8b;">10</span>)
a <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #8b2252;">"1"</span>, <span style="color: #8b2252;">"2"</span>, <span style="color: #8b2252;">"4"</span>, <span style="color: #8b2252;">"4"</span>, <span style="color: #8b2252;">"6"</span>, <span style="color: #8b2252;">"5"</span>)
b <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #8b2252;">"2"</span>, <span style="color: #8b2252;">"5"</span>)
intersect(a, b)
union(a, b) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#30456;&#24403;&#20110;&#23558;&#25152;&#26377;&#19981;&#37325;&#22797;&#20803;&#32032;&#36830;&#25509;&#36215;&#26469;</span>
setdiff(a, b) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21482;&#26174;&#31034;&#19981;&#37325;&#22797;&#30340;&#20803;&#32032;</span>
setdiff(union(a, b), intersect(a, b))
</pre>
</div>
</div>
</div>

<div id="orgb8af946" class="outline-4">
<h4 id="orgb8af946"><span class="section-number-4">7.7.2</span> 比较两个对象是否相等</h4>
<div class="outline-text-4" id="text-7-7-2">
<div class="org-src-container">
<pre class="src src-R">x1=data.frame(x=c(<span style="color: #008b8b;">1</span>,<span style="color: #008b8b;">2</span>,<span style="color: #008b8b;">3</span>,<span style="color: #008b8b;">4</span>),y=c(<span style="color: #008b8b;">1</span>,<span style="color: #008b8b;">2</span>,<span style="color: #008b8b;">4</span>,<span style="color: #008b8b;">3</span>))
x2=data.frame(x=c(<span style="color: #008b8b;">1</span>,<span style="color: #008b8b;">2</span>,<span style="color: #008b8b;">3</span>,<span style="color: #008b8b;">4</span>),y=c(<span style="color: #008b8b;">1</span>,<span style="color: #008b8b;">2</span>,<span style="color: #008b8b;">3</span>,<span style="color: #008b8b;">4</span>))
all.equal(x1,x2)
identical(x1,x2) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21487;&#20197;&#26816;&#26597;&#20004;&#20010;&#23545;&#35937;&#26159;&#21542;&#23436;&#20840;&#19968;&#33268;</span>
x3 <span style="color: #008b8b;">&lt;-</span> data.frame(x=c(<span style="color: #008b8b;">1</span>,<span style="color: #008b8b;">2</span>,<span style="color: #008b8b;">3</span>,<span style="color: #008b8b;">4</span>),y=c(<span style="color: #008b8b;">1</span>,<span style="color: #008b8b;">2</span>,<span style="color: #008b8b;">3</span>,<span style="color: #008b8b;">4</span>))
identical(x2,x3)
</pre>
</div>
</div>
</div>

<div id="orge4312f9" class="outline-4">
<h4 id="orge4312f9"><span class="section-number-4">7.7.3</span> 取偶数位置值</h4>
<div class="outline-text-4" id="text-7-7-3">
<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #8b2252;">"1"</span>,<span style="color: #8b2252;">"2"</span>,<span style="color: #8b2252;">"3"</span>,<span style="color: #8b2252;">"4"</span>)
x[c(<span style="color: #228b22;">FALSE</span>,<span style="color: #228b22;">TRUE</span>)]
                                      <span style="color: #b22222;"># </span><span style="color: #b22222;">[1] "Component \"y\": Mean relative difference: 0.2857143"</span>
</pre>
</div>
</div>
</div>
</div>

<div id="orga9b7c14" class="outline-3">
<h3 id="orga9b7c14"><span class="section-number-3">7.8</span> JSON 数据</h3>
<div class="outline-text-3" id="text-7-8">
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">### </span><span style="color: #b22222;">&#20174; hive &#25968;&#25454;&#34920;&#30340; jason &#23545;&#35937;&#25552;&#21462; data--------------------------------</span>
hujin_parser <span style="color: #008b8b;">&lt;-</span> hujin <span style="color: #008b8b;">%&gt;%</span>
    mutate(
        xiaomi_id = get_json_object(response, <span style="color: #8b2252;">"$.entity.xiaomiId"</span>),
        create_time = get_json_object(response, <span style="color: #8b2252;">"$.entity.createTime"</span>),
        update_time = get_json_object(response, <span style="color: #8b2252;">"$.entity.updateTime"</span>),
        data = get_json_object(response, <span style="color: #8b2252;">"$.entity.data"</span>)
    )
</pre>
</div>
</div>
</div>
</div>

<div id="org3163024" class="outline-2">
<h2 id="org3163024"><span class="section-number-2">8</span> 模型</h2>
<div class="outline-text-2" id="text-8">
</div>
<div id="org782df4e" class="outline-3">
<h3 id="org782df4e"><span class="section-number-3">8.1</span> 求解没有常数项的线性回归模型</h3>
<div class="outline-text-3" id="text-8-1">
<div class="org-src-container">
<pre class="src src-R">result <span style="color: #008b8b;">&lt;-</span> lm(y ~ <span style="color: #008b8b;">0</span> + x1, data = data)
</pre>
</div>
</div>
<div id="org3682e29" class="outline-4">
<h4 id="org3682e29"><span class="section-number-4">8.1.1</span> 如何使用正交多项式回归？</h4>
<div class="outline-text-4" id="text-8-1-1">
<p>
考虑回归方程：
</p>

<p>
\[
y_{i}=\beta_{0}+\beta_{1} x_{i}+\beta_{2} x_{i}^{2}+\ldots+\beta_{k} x_{i}^{k}, i=1,2, \ldots, n
\]
</p>

<p>
当多项式的次数$k$比较大时，$x, x<sup>2</sup>, \ldots, x<sup>k</sup>$会出现线性相关问题。故需要使用正交多项式回归来克服这个缺点。在 R 中，使用 poly()函数：
</p>

<div class="org-src-container">
<pre class="src src-R">(z <span style="color: #008b8b;">&lt;-</span> poly(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">10</span>, <span style="color: #008b8b;">2</span>))
str(z)
<span style="color: #008b8b;">library</span>(ISLR)
<span style="color: #008b8b;">library</span>(ggplot2)
<span style="color: #008b8b;">attach</span>(Auto)
<span style="color: #008b8b;">library</span>(tidyverse)
<span style="color: #008b8b;">library</span>(magrittr)
fm2raw <span style="color: #008b8b;">&lt;-</span> lm(mpg ~ poly(horsepower, <span style="color: #008b8b;">2</span>, raw = <span style="color: #228b22;">TRUE</span>), Auto)
fm2raw <span style="color: #008b8b;">&lt;-</span> lm(mpg ~ poly(horsepower, <span style="color: #008b8b;">2</span>), Auto)
Auto <span style="color: #008b8b;">%&lt;&gt;%</span> mutate(pred = predict(fm2raw, newdata = Auto))
ggplot(Auto, aes(x = horsepower, y = mpg)) + geom_line(aes(y = pred)) + geom_point() + geom_smooth()
cor(poly(horsepower, <span style="color: #008b8b;">2</span>)) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#21152;&#20102; raw=TRUE&#65292;&#36825;&#20004;&#21015;&#25968;&#25454;&#23601;&#26159;&#24378;&#30456;&#20851;</span>
</pre>
</div>
</div>
</div>

<div id="orgb9350fe" class="outline-4">
<h4 id="orgb9350fe"><span class="section-number-4">8.1.2</span> 如何进行典型相关分析？</h4>
<div class="outline-text-4" id="text-8-1-2">
<p>
典型相关分析是用于研究两组随机变量之间法相关性的一种统计方法。它的基本原理是：为了从总体上把握两组指标之间的相关关系，分别在两组变量中提取有代表性的两个综合变量 U1 和 V1（分别为两个变量组中各变量的线性组合），利用这两个综合变量之间的相关关系来反映两组指标之间的整体相关性。
</p>
<div class="org-src-container">
<pre class="src src-R">  <span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
pop <span style="color: #008b8b;">&lt;-</span> LifeCycleSavings [, <span style="color: #008b8b;">2</span>:<span style="color: #008b8b;">3</span>]
oec <span style="color: #008b8b;">&lt;-</span> LifeCycleSavings [, -(<span style="color: #008b8b;">2</span>:<span style="color: #008b8b;">3</span>)]
cancor(pop, oec)
</pre>
</div>
</div>
</div>

<div id="org2f537a8" class="outline-4">
<h4 id="org2f537a8"><span class="section-number-4">8.1.3</span> R 的 SPSS 版本</h4>
<div class="outline-text-4" id="text-8-1-3">
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
<span style="color: #008b8b;">library</span>(Rcmdr)
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="org57de9d5" class="outline-2">
<h2 id="org57de9d5"><span class="section-number-2">9</span> 作图</h2>
<div class="outline-text-2" id="text-9">
</div>
<div id="org38348d5" class="outline-3">
<h3 id="org38348d5"><span class="section-number-3">9.1</span> ggplot2</h3>
<div class="outline-text-3" id="text-9-1">
<p>
字体大小
</p>
</div>

<div id="org2d12044" class="outline-4">
<h4 id="org2d12044"><span class="section-number-4">9.1.1</span> theme<sub>set</sub></h4>
<div class="outline-text-4" id="text-9-1-1">
<div class="org-src-container">
<pre class="src src-R"><span style="color: #008b8b;">library</span>(ggplot2)

                                  <span style="color: #b22222;"># </span><span style="color: #b22222;">Use theme_set() to apply a theme to all your plots!</span>
                                  <span style="color: #b22222;"># </span><span style="color: #b22222;">Bonus, use `base_size` to scale up the plot font!</span>
theme_set(theme_minimal(base_size = <span style="color: #008b8b;">30</span>)) 

ggplot(head(diamonds, <span style="color: #008b8b;">30</span>), aes(x = carat, y = depth)) + 
    geom_point()      
</pre>
</div>
</div>
</div>
<div id="org970f09a" class="outline-4">
<h4 id="org970f09a"><span class="section-number-4">9.1.2</span> element<sub>markdown</sub></h4>
<div class="outline-text-4" id="text-9-1-2">
<div class="org-src-container">
<pre class="src src-R">ggplot(head(diamonds, <span style="color: #008b8b;">30</span>), aes(x = carat, y = depth)) + 
    geom_point() + 
    labs(title = <span style="color: #8b2252;">"&lt;b style='color:#FF4848'&gt;Depth&lt;/b&gt; by *carat*"</span>) + 
    theme(plot.title = element_markdown(),
          plot.title.position = <span style="color: #8b2252;">"plot"</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">Bonus tip to totally left align the title!      </span>
</pre>
</div>
</div>
</div>

<div id="orgc3a580d" class="outline-4">
<h4 id="orgc3a580d"><span class="section-number-4">9.1.3</span> 散点图</h4>
<div class="outline-text-4" id="text-9-1-3">
<div class="org-src-container">
<pre class="src src-R">  <span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21333;&#20010;&#21464;&#37327;</span>
  ggplot(starwars) +
      geom_point(aes(x = height, y = mass))
                                        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#32676;&#32452;</span>

<span style="color: #b22222;">##</span><span style="color: #b22222;">&#21487;&#20197;&#23558;&#26080;&#24207;&#21464;&#37327;&#26144;&#23556;&#20026;&#26377;&#24207;&#22270;&#24418;&#23646;&#24615;&#65288;size&#65289;</span>
  ggplot(data = mpg) +
      geom_point(mapping = aes(x = displ,
                               y = hwy,
                               size = class))

                                        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21487;&#20197;&#20307;&#29616;3&#20010;&#21464;&#37327;&#20449;&#24687;</span>
  ggplot(data = mpg)+
      geom_point(mapping = aes(x = displ,y = hwy,color = class))

  ggplot(data = mpg)+
      geom_point(mapping = aes(x = displ,y = hwy,alpha = class)) <span style="color: #b22222;">#</span><span style="color: #b22222;">alpha&#25511;&#21046;&#36879;&#26126;&#24230;</span>

  ggplot(data = mpg)+
      geom_point(mapping = aes(x = displ,y = hwy,shape = class)) <span style="color: #b22222;">#</span><span style="color: #b22222;">shape &#25511;&#21046;&#19978;&#23631;&#30340;&#24418;&#29366;</span>

  ggplot(data = mpg)+
      geom_point(mapping = aes(x = displ,y = hwy,shape = <span style="color: #8b2252;">"blue"</span>)) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21487;&#20197;&#25511;&#21046;&#25152;&#26377;&#28857;&#30340;&#39068;&#33394;</span>
</pre>
</div>
</div>
</div>

<div id="orgf4e712f" class="outline-4">
<h4 id="orgf4e712f"><span class="section-number-4">9.1.4</span> 分面</h4>
<div class="outline-text-4" id="text-9-1-4">
<p>
将图分割成多个分面，这种方法适合添加分类变量。
</p>
<div class="org-src-container">
<pre class="src src-R">ggplot(data = mpg) +
    geom_point(mapping = aes(x = displ, y = hwy)) +
    facet_wrap(~class, nrow = <span style="color: #008b8b;">2</span>)

ggplot(data = mpg) +
    geom_point(mapping = aes(x = displ, y = hwy)) +
    facet_grid(drv ~ cyl)  
</pre>
</div>

<div class="org-src-container">
<pre class="src src-R">ggplot(data = mpg) +
    geom_smooth(mapping = aes(x = displ,
                              y = hwy))

ggplot(data = mpg) +
    geom_smooth(mapping = aes(x = displ,
                              y = hwy,
                              linetype = drv))  
</pre>
</div>

<div class="org-src-container">
<pre class="src src-R">ggplot(data = mpg) +
    geom_point(mapping = aes(x = displ,
                             y = hwy))+
    geom_smooth(mapping = aes(x = displ,
                              y = hwy,
                              color = drv))  
</pre>
</div>

<p>
### 直方图
</p>
<div class="org-src-container">
<pre class="src src-R">  <span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
<span style="color: #008b8b;">library</span>(ggplot2)
<span style="color: #008b8b;">library</span>(lattice)
<span style="color: #b22222;">###</span><span style="color: #b22222;">ggplot2 &#29256;&#26412;.--------------------------</span>
dat <span style="color: #008b8b;">&lt;-</span> data.frame(
  cond = factor(rep(c(<span style="color: #8b2252;">"A"</span>, <span style="color: #8b2252;">"B"</span>), each = <span style="color: #008b8b;">200</span>)),
  rating = c(rnorm(<span style="color: #008b8b;">200</span>), rnorm(<span style="color: #008b8b;">200</span>, mean = .8))
)
ggplot(dat, aes(x = rating)) + geom_histogram(binwidth = .5) <span style="color: #b22222;"># </span><span style="color: #b22222;">rating &#20316;&#20026;&#27178;&#36724;</span>

ggplot(dat, aes(x = rating)) +
  geom_histogram(
    binwidth = .5,
    colour = <span style="color: #8b2252;">"black"</span>, <span style="color: #b22222;"># </span><span style="color: #b22222;">&#36793;&#26694;&#39068;&#33394;</span>
    fill = <span style="color: #8b2252;">"white"</span> <span style="color: #b22222;"># </span><span style="color: #b22222;">&#22635;&#20805;&#39068;&#33394;</span>
  )
<span style="color: #b22222;">## </span><span style="color: #b22222;">&#23494;&#24230;&#22270;</span>
ggplot(dat, aes(x = rating)) + geom_density() <span style="color: #b22222;"># </span><span style="color: #b22222;">&#28155;&#21152;&#23494;&#24230;&#26354;&#32447;</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">&#23494;&#24230;&#22270;+&#30452;&#26041;&#22270;</span>
ggplot(dat, aes(x = rating)) +
  geom_histogram(aes(y = ..density..), <span style="color: #b22222;"># </span><span style="color: #b22222;">&#36825;&#19968;&#27493;&#24456;&#37325;&#35201;,&#20351;&#29992; density &#20195;&#26367; y &#36724;</span>
    binwidth = .5,
    colour = <span style="color: #8b2252;">"black"</span>, fill = <span style="color: #8b2252;">"white"</span>
  ) +
  geom_density(alpha = .2, fill = <span style="color: #8b2252;">"#FF6666"</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#37325;&#21472;&#37096;&#20998;&#37319;&#29992;&#36879;&#26126;&#35774;&#32622;</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">&#28155;&#21152;&#19968;&#26465;&#22343;&#20540;&#32447;(&#32418;&#33394;&#37096;&#20998;)</span>
ggplot(dat, aes(x = rating)) +
  geom_histogram(binwidth = .5, colour = <span style="color: #8b2252;">"black"</span>, fill = <span style="color: #8b2252;">"white"</span>) +
  geom_vline(aes(xintercept = mean(rating, na.rm = T)), <span style="color: #b22222;"># </span><span style="color: #b22222;">Ignore NA values for mean</span>
    color = <span style="color: #8b2252;">"red"</span>, linetype = <span style="color: #8b2252;">"dashed"</span>, size = <span style="color: #008b8b;">1</span>
  )
<span style="color: #b22222;">## </span><span style="color: #b22222;">&#22810;&#32452;&#25968;&#25454;&#30340;&#30452;&#26041;&#22270;&#21644;&#23494;&#24230;&#22270;</span>
<span style="color: #b22222;">###</span><span style="color: #b22222;">.cond &#20316;&#20026;&#21508;&#32452;&#30340;&#20998;&#31867;,&#20197;&#39068;&#33394;&#22635;&#20805;&#20316;&#20026;&#21306;&#21035;,position &#30340;&#22788;&#29702;&#24456;&#37325;&#35201;,&#20915;&#23450;&#25968;&#25454;&#23384;&#22312;&#37325;&#21472;&#26159;&#30340;&#22788;&#29702;&#26041;&#24335; "identity" &#19981;&#20570;&#22788;&#29702;,&#20294;&#26159;&#35774;&#32622;&#20102;&#36879;&#26126;--------------------------</span>
ggplot(dat, aes(x = rating, fill = cond)) +
  geom_histogram(binwidth = .5, alpha = .5, position = <span style="color: #8b2252;">"identity"</span>)
<span style="color: #b22222;"># </span><span style="color: #b22222;">Interleaved histograms</span>
ggplot(dat, aes(x = rating, fill = cond)) +
  geom_histogram(binwidth = .5, position = <span style="color: #8b2252;">"dodge"</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">dodge &#34920;&#31034;&#37325;&#21472;&#37096;&#20998;&#36827;&#34892;&#20559;&#31163;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#23494;&#24230;&#22270;</span>
ggplot(dat, aes(x = rating, colour = cond)) + geom_density()
<span style="color: #b22222;"># </span><span style="color: #b22222;">&#21322;&#36879;&#26126;&#30340;&#22635;&#20805;</span>
ggplot(dat, aes(x = rating, fill = cond)) + geom_density(alpha = .3)

<span style="color: #b22222;">#</span>
ggplot(dat, aes(x = rating)) + geom_histogram(binwidth = .5, colour = <span style="color: #8b2252;">"black"</span>, fill = <span style="color: #8b2252;">"white"</span>) +
  facet_grid(cond ~ .) <span style="color: #b22222;">## </span><span style="color: #b22222;">&#20998;&#38754;</span>


<span style="color: #b22222;"># </span><span style="color: #b22222;">lattice &#29256;&#26412;</span>
histogram(~ height | voice.part,
  data = singer, main = <span style="color: #8b2252;">"Distribution of Heights by Voice Pitch"</span>,
  xlab = <span style="color: #8b2252;">"Height (inches)"</span>
)
head(singer)

  <span style="color: #008b8b;">library</span>(ggplot2)
  ggplot(iris, aes(x=Sepal.Length, y=Sepal.Width)) +
      geom_point() +
      facet_grid( . ~ Species )
</pre>
</div>
</div>
</div>

<div id="orgd16c01d" class="outline-4">
<h4 id="orgd16c01d"><span class="section-number-4">9.1.5</span> 密度图</h4>
<div class="outline-text-4" id="text-9-1-5">
<div class="org-src-container">
<pre class="src src-R">  <span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
<span style="color: #008b8b;">attach</span>(mtcars)
<span style="color: #b22222;"># </span><span style="color: #b22222;">data("mtcars")</span>
gear <span style="color: #008b8b;">&lt;-</span> factor(gear,
  levels = c(<span style="color: #008b8b;">3</span>, <span style="color: #008b8b;">4</span>, <span style="color: #008b8b;">5</span>),
  labels = c(<span style="color: #8b2252;">"3 gears"</span>, <span style="color: #8b2252;">"4 gears"</span>, <span style="color: #8b2252;">"5 gears"</span>)
)
cyl <span style="color: #008b8b;">&lt;-</span> factor(cyl,
  levels = c(<span style="color: #008b8b;">4</span>, <span style="color: #008b8b;">6</span>, <span style="color: #008b8b;">8</span>),
  labels = c(<span style="color: #8b2252;">"4 cylinders"</span>, <span style="color: #8b2252;">"6 cylinders"</span>, <span style="color: #8b2252;">"8 cylinders"</span>)
)

<span style="color: #b22222;"># </span><span style="color: #b22222;">&#24320;&#22987;&#30011;&#22270;</span>

densityplot(~mpg,
  main = <span style="color: #8b2252;">"Density Plot"</span>,
  xlab = <span style="color: #8b2252;">"Miles per Gallon"</span>
)

head(mtcars)
densityplot(~ mpg | cyl,
  layout = c(<span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">3</span>), main = <span style="color: #8b2252;">"Density Plot by Number of Cylinders"</span>,
  xlab = <span style="color: #8b2252;">"Miles per Gallon"</span>
)

gear <span style="color: #008b8b;">&lt;-</span> factor(gear,
  levels = c(<span style="color: #008b8b;">3</span>, <span style="color: #008b8b;">4</span>, <span style="color: #008b8b;">5</span>),
  labels = c(<span style="color: #8b2252;">"3 gears"</span>, <span style="color: #8b2252;">"4 gears"</span>, <span style="color: #8b2252;">"5 gears"</span>)
)
cyl <span style="color: #008b8b;">&lt;-</span> factor(cyl,
  levels = c(<span style="color: #008b8b;">4</span>, <span style="color: #008b8b;">6</span>, <span style="color: #008b8b;">8</span>),
  labels = c(<span style="color: #8b2252;">"4 cylinders"</span>, <span style="color: #8b2252;">"6 cylinders"</span>, <span style="color: #8b2252;">"8 cylinders"</span>)
)

densityplot(~mpg,
  main = <span style="color: #8b2252;">"Density Plot"</span>,
  xlab = <span style="color: #8b2252;">"Miles per Gallon"</span>
)

mtcars$cyl <span style="color: #008b8b;">&lt;-</span> cyl.f

densityplot(~ mpg | cyl,
  main = <span style="color: #8b2252;">"Density Plot by Number of Cylinders"</span>,
  xlab = <span style="color: #8b2252;">"Miles per Gallon"</span>
)

bwplot(cyl ~ mpg | gear,
  main = <span style="color: #8b2252;">"Box Plots by Cylinders and Gears"</span>,
  xlab = <span style="color: #8b2252;">"Miles per Gallon"</span>, ylab = <span style="color: #8b2252;">"Cylinders"</span>
)


xyplot(decrease ~ treatment, OrchardSprays,
  groups = rowpos,
  type = <span style="color: #8b2252;">"a"</span>,
  auto.key =
    list(space = <span style="color: #8b2252;">"right"</span>, points = <span style="color: #228b22;">FALSE</span>, lines = <span style="color: #228b22;">TRUE</span>)
)

cloud(mpg ~ wt * qsec | cyl,
  main = <span style="color: #8b2252;">"3D Scatter Plots by Cylinders"</span>
)

dotplot(cyl ~ mpg | gear,
  main = <span style="color: #8b2252;">"Dot Plots by Number of Gears and Cylinders"</span>,
  xlab = <span style="color: #8b2252;">"Miles Per Gallon"</span>
)

plom(mtcars[c(<span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">3</span>, <span style="color: #008b8b;">4</span>, <span style="color: #008b8b;">5</span>, <span style="color: #008b8b;">6</span>)],
  main = <span style="color: #8b2252;">"Scatter Plot Matrix for mtcars Data"</span>
)

<span style="color: #008b8b;">detach</span>(mtcars)

dotplot(cyl ~ mpg | gear,
  main = <span style="color: #8b2252;">"Dot Plots by Number of Gears and Cylinders"</span>,
  xlab = <span style="color: #8b2252;">"Miles Per Gallon"</span>
)

<span style="color: #008b8b;">library</span>(lattice)
<span style="color: #0000ff;">panel.smoother</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>(x, y) {
  panel.xyplot(x, y) <span style="color: #b22222;"># </span><span style="color: #b22222;">show points</span>
  panel.loess(x, y) <span style="color: #b22222;"># </span><span style="color: #b22222;">show smoothed line</span>
}
<span style="color: #008b8b;">attach</span>(mtcars)
hp <span style="color: #008b8b;">&lt;-</span> cut(hp, <span style="color: #008b8b;">3</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">divide horse power into three bands</span>
xyplot(mpg ~ wt | hp,
  scales = list(cex = .8, col = <span style="color: #8b2252;">"red"</span>),
  panel = panel.smoother,
  xlab = <span style="color: #8b2252;">"Weight"</span>, ylab = <span style="color: #8b2252;">"Miles per Gallon"</span>,
  main = <span style="color: #8b2252;">"MGP vs Weight by Horse Power"</span>
)
</pre>
</div>
</div>
</div>

<div id="org95cba66" class="outline-4">
<h4 id="org95cba66"><span class="section-number-4">9.1.6</span> 线图</h4>
<div class="outline-text-4" id="text-9-1-6">
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
unemp_lux_data <span style="color: #008b8b;">%&gt;%</span>
    ggplot(aes(x = year, y = unemployment_rate_in_percent, group = <span style="color: #008b8b;">1</span>)) +
    geom_line()
</pre>
</div>
</div>
</div>

<div id="orge961b0d" class="outline-4">
<h4 id="orge961b0d"><span class="section-number-4">9.1.7</span> 拟合线图</h4>
<div class="outline-text-4" id="text-9-1-7">
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
fm2raw <span style="color: #008b8b;">&lt;-</span> lm(mpg ~ poly(horsepower, <span style="color: #008b8b;">2</span>), Auto) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20808;&#25311;&#21512;</span>
Auto <span style="color: #008b8b;">%&lt;&gt;%</span> mutate(pred = predict(fm2raw, newdata = Auto)) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#23558;&#27169;&#22411;&#39044;&#27979;&#32467;&#26524;&#21152;&#20837;&#21407;&#22987;&#25968;&#25454;&#38598;&#20013;</span>
ggplot(Auto, aes(x = horsepower, y = mpg)) + geom_line(aes(y = pred)) + geom_point() + geom_smooth()
</pre>
</div>

<p>
dt &lt;- mtcars[1:5, 1:6]
</p>
</div>
</div>
<div id="orgae10d74" class="outline-4">
<h4 id="orgae10d74"><span class="section-number-4">9.1.8</span> 密度图</h4>
</div>
</div>
<div id="orgbd70e9f" class="outline-3">
<h3 id="orgbd70e9f"><span class="section-number-3">9.2</span> patchwork</h3>
<div class="outline-text-3" id="text-9-2">
<p>
利用 patchwork 包可以实现图像的排列组合展示。
</p>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #008b8b;">library</span>(patchwork)
<span style="color: #008b8b;">library</span>(ggplot2)
<span style="color: #008b8b;">library</span>(dplyr)
p = diamonds <span style="color: #008b8b;">%&gt;%</span> 
    ggplot(aes(carat, price,color=clarity))+geom_point()
p2 = diamonds <span style="color: #008b8b;">%&gt;%</span> 
    ggplot(aes(clarity, price, fill=cut))+geom_boxplot(position=<span style="color: #8b2252;">"dodge"</span>)
p|p2     
</pre>
</div>
</div>
</div>
</div>

<div id="orgc7b1f8c" class="outline-2">
<h2 id="orgc7b1f8c"><span class="section-number-2">10</span> 表格、results 输出</h2>
<div class="outline-text-2" id="text-10">
<p>
在 R 中关于表格输出的包有很多，huxtable 是其中之一。
</p>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #008b8b;">library</span>(<span style="color: #8b2252;">"huxtable"</span>)
car_ht <span style="color: #008b8b;">&lt;-</span> as_hux(mtcars)
car_ht <span style="color: #008b8b;">&lt;-</span> huxtable::add_rownames(car_ht, colname = <span style="color: #8b2252;">"Car"</span>)
car_ht <span style="color: #008b8b;">&lt;-</span> car_ht                                          <span style="color: #008b8b;">%&gt;%</span>
    slice(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">10</span>)                                         <span style="color: #008b8b;">%&gt;%</span> 
    select(Car, mpg, cyl, hp)                           <span style="color: #008b8b;">%&gt;%</span> 
    arrange(hp)                                         <span style="color: #008b8b;">%&gt;%</span> 
    filter(cyl &gt; <span style="color: #008b8b;">4</span>)                                     <span style="color: #008b8b;">%&gt;%</span> 
    rename(MPG = mpg, Cylinders = cyl, Horsepower = hp) <span style="color: #008b8b;">%&gt;%</span> 
    mutate(kml = MPG/<span style="color: #008b8b;">2.82</span>)                              <span style="color: #008b8b;">%&gt;%</span> 
    huxtable::add_colnames()                            
theme_plain(car_ht)
<span style="color: #b22222;"># </span><span style="color: #b22222;">kableExtra</span>
<span style="color: #008b8b;">library</span>(knitr)
<span style="color: #008b8b;">library</span>(kableExtra)
kable(dt)
dt <span style="color: #008b8b;">%&gt;%</span>
    kable() <span style="color: #008b8b;">%&gt;%</span>
    kable_styling()

xtable::xtable(mtcars[<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">4</span>, <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">4</span>], caption = <span style="color: #8b2252;">"Hello xtable"</span>) <span style="color: #008b8b;">%&gt;%</span>
    xtable2kable() <span style="color: #008b8b;">%&gt;%</span>
    column_spec(<span style="color: #008b8b;">1</span>, color = <span style="color: #8b2252;">"red"</span>)
</pre>
</div>
</div>
<div id="org0b6a5d9" class="outline-3">
<h3 id="org0b6a5d9"><span class="section-number-3">10.1</span> reprex</h3>
<div class="outline-text-3" id="text-10-1">
<p>
这个包对粘贴 R 程序的结果有好处。
</p>
<div class="org-src-container">
<pre class="src src-R">reprex({
    y <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">4</span>; mean(y)}, style = <span style="color: #228b22;">TRUE</span>
    )
</pre>
</div>

<p>
上述代码的结果就是
</p>

<div class="org-src-container">
<pre class="src src-R">y <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">4</span>
mean(y)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 2.5  </span>
</pre>
</div>
</div>
</div>
</div>

<div id="org2f1929c" class="outline-2">
<h2 id="org2f1929c"><span class="section-number-2">11</span> parallel 并行运算</h2>
<div class="outline-text-2" id="text-11">
<div class="org-src-container">
<pre class="src src-R">  <span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
  <span style="color: #008b8b;">library</span>(doParallel)
  cl <span style="color: #008b8b;">&lt;-</span> makeCluster(<span style="color: #008b8b;">2</span>)
  registerDoParallel(cl)
  foreach(i = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>) <span style="color: #008b8b;">%dopar%</span> sqrt(i)
x <span style="color: #008b8b;">&lt;-</span> iris[which(iris[,<span style="color: #008b8b;">5</span>] != <span style="color: #8b2252;">"setosa"</span>),c(<span style="color: #008b8b;">1</span>,<span style="color: #008b8b;">5</span>)]
  trials <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">10000</span>
  stime <span style="color: #008b8b;">&lt;-</span> system.time({
      r <span style="color: #008b8b;">&lt;-</span> foreach(icount(trials),.combine = cbind) <span style="color: #008b8b;">%do%</span> {
          ind <span style="color: #008b8b;">&lt;-</span> sample(<span style="color: #008b8b;">100</span>,<span style="color: #008b8b;">100</span>,replace = <span style="color: #228b22;">TRUE</span>)
          result1 <span style="color: #008b8b;">&lt;-</span> glm(x[ind,<span style="color: #008b8b;">2</span>]~x[ind,<span style="color: #008b8b;">1</span>],family = binomial(logit))
          coefficients(result1)
      }
  }
  )[<span style="color: #008b8b;">3</span>]
</pre>
</div>
</div>

<div id="orgf0a2a60" class="outline-4">
<h4 id="orgf0a2a60"><span class="section-number-4">11.0.1</span> 如何加速 R 的运行速度？</h4>
<div class="outline-text-4" id="text-11-0-1">
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
<span style="color: #008b8b;">library</span>(parallel)
<span style="color: #0000ff;">doit</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>(x) x^<span style="color: #008b8b;">2</span> + <span style="color: #008b8b;">2</span> * x
system.time(res = lapply(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">5000000</span>, doit))
<span style="color: #008b8b;">rm</span>(res)
gc()
cl <span style="color: #008b8b;">&lt;-</span> makeCluster(getOption(<span style="color: #8b2252;">"cl.cores"</span>, <span style="color: #008b8b;">3</span>))
system.time(res = parLapply(cl, <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">5000000</span>, doit))
stopCluster(cl)
</pre>
</div>
</div>
</div>
</div>

<div id="orgf64e952" class="outline-2">
<h2 id="orgf64e952"><span class="section-number-2">12</span> Packages</h2>
<div class="outline-text-2" id="text-12">
</div>
<div id="org07cca67" class="outline-3">
<h3 id="org07cca67"><span class="section-number-3">12.1</span> Base</h3>
<div class="outline-text-3" id="text-12-1">
</div>
<div id="org3810a91" class="outline-4">
<h4 id="org3810a91"><span class="section-number-4">12.1.1</span> c</h4>
<div class="outline-text-4" id="text-12-1-1">
<p>
Combine Values into a Vector or List.
</p>
<div class="org-src-container">
<pre class="src src-R">c(<span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">7</span>:<span style="color: #008b8b;">9</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 1 7 8 9</span>
c(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">5</span>, <span style="color: #008b8b;">10.5</span>, <span style="color: #8b2252;">"next"</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "1"    "2"    "3"    "4"    "5"    "10.5" "next"</span>
ll <span style="color: #008b8b;">&lt;-</span> list(A = <span style="color: #008b8b;">1</span>, c = <span style="color: #8b2252;">"C"</span>)
<span style="color: #b22222;">## </span><span style="color: #b22222;">do *not* use</span>
c(ll, d = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; $A</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 1</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; $c</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "C"</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; $d1</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 1</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; $d2</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 2</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; $d3</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 3</span>
c(list(A = c(B = <span style="color: #008b8b;">1</span>)), recursive = <span style="color: #228b22;">TRUE</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; A.B </span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   1</span>
c(list(A = c(B = <span style="color: #008b8b;">1</span>, C = <span style="color: #008b8b;">2</span>), B = c(E = <span style="color: #008b8b;">7</span>)), recursive = <span style="color: #228b22;">TRUE</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; A.B A.C B.E </span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   1   2   7</span>
</pre>
</div>

<p>
x[ [1] ] 可以将 atomic vector 转化为 numeric。
</p>
<div class="org-src-container">
<pre class="src src-R">x[
<span style="color: #b22222;"># </span><span style="color: #b22222;">[1] 1 2</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">Levels: 1 2</span>


x <span style="color: #008b8b;">&lt;-</span> c(a=<span style="color: #008b8b;">1</span>, b=<span style="color: #008b8b;">2</span>)
x[<span style="color: #008b8b;">1</span>] <span style="color: #008b8b;">%&gt;%</span> str()
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  Named num 1</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  - attr(*, "names")= chr "a"</span>
x[[<span style="color: #008b8b;">1</span>]]
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 1</span>
x[[<span style="color: #8b2252;">'a'</span>]]
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 1</span>
</pre>
</div>
</div>
</div>
<div id="org30e06b1" class="outline-4">
<h4 id="org30e06b1"><span class="section-number-4">12.1.2</span> matrix</h4>
<div class="outline-text-4" id="text-12-1-2">
<div class="org-src-container">
<pre class="src src-R">  <span style="color: #008b8b;">library</span>(magrittr)
a <span style="color: #008b8b;">&lt;-</span> matrix(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">4</span>, nrow = <span style="color: #008b8b;">2</span>)
a
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;      [,1] [,2]</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1,]    1    3</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [2,]    2    4</span>
a[<span style="color: #008b8b;">1</span>,,drop=<span style="color: #228b22;">FALSE</span>] <span style="color: #008b8b;">%&gt;%</span> class()
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "matrix"</span>
a[<span style="color: #008b8b;">1</span>,] <span style="color: #008b8b;">%&gt;%</span> class()
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "integer"</span>
is.vector(a[<span style="color: #008b8b;">1</span>,])
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] TRUE</span>
is.vector(a[<span style="color: #008b8b;">1</span>,,drop=F])
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] FALSE</span>
</pre>
</div>
</div>
</div>
<div id="org7ee43a8" class="outline-4">
<h4 id="org7ee43a8"><span class="section-number-4">12.1.3</span> data.frame</h4>
<div class="outline-text-4" id="text-12-1-3">
<div class="org-src-container">
<pre class="src src-R">df <span style="color: #008b8b;">&lt;-</span> data.frame(a=<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">2</span>, b=<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">2</span>)
df
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   a b</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1 1 1</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2 2 2</span>
str(df[<span style="color: #008b8b;">2</span>])
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 'data.frame':    2 obs. of  1 variable:</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  $ b: int  1 2</span>
str(df[,<span style="color: #008b8b;">2</span>])
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  int [1:2] 1 2</span>
str(df[[<span style="color: #008b8b;">1</span>]])
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  int [1:2] 1 2</span>
str(df[,<span style="color: #8b2252;">"a"</span>,drop=F])
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 'data.frame':    2 obs. of  1 variable:</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  $ a: int  1 2</span>
str(df[,<span style="color: #8b2252;">"a"</span>])
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  int [1:2] 1 2</span>
</pre>
</div>
</div>
</div>
<div id="org1dc30d7" class="outline-4">
<h4 id="org1dc30d7"><span class="section-number-4">12.1.4</span> factor</h4>
<div class="outline-text-4" id="text-12-1-4">
<p>
需要注意 drop 参数。
</p>
<div class="org-src-container">
<pre class="src src-R">x[<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">2</span>, drop = T]
<span style="color: #b22222;"># </span><span style="color: #b22222;">[1] 1 2</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">Levels: 1 2</span>
</pre>
</div>
</div>
</div>
<div id="org472e426" class="outline-4">
<h4 id="org472e426"><span class="section-number-4">12.1.5</span> list</h4>
<div class="outline-text-4" id="text-12-1-5">
<p>
$诡异之处。
</p>

<div class="org-src-container">
<pre class="src src-R">x = list(abc=<span style="color: #008b8b;">1</span>)
x
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; $abc</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 1</span>
x$a
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 1</span>
x[[<span style="color: #8b2252;">"a"</span>]]
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; NULL</span>
<span style="color: #008b8b;">options</span>(warnPartialMatchDollar = T)
</pre>
</div>
</div>
</div>
<div id="org8767116" class="outline-4">
<h4 id="org8767116"><span class="section-number-4">12.1.6</span> missing/out of bound indices</h4>
<div class="outline-text-4" id="text-12-1-6">
<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">4</span>
x[<span style="color: #008b8b;">5</span>]
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] NA</span>
x[[<span style="color: #008b8b;">5</span>]]
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Error in x[[5]]: &#19979;&#26631;&#20986;&#30028;</span>
x[<span style="color: #228b22;">NULL</span>]
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; integer(0)</span>
x[<span style="color: #228b22;">NA_real_</span>]
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] NA</span>
x[[<span style="color: #228b22;">NA_real_</span>]]
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Error in x[[NA_real_]]: &#19979;&#26631;&#20986;&#30028;</span>
x[[<span style="color: #228b22;">NULL</span>]]
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Error in x[[NULL]]: attempt to select less than one element in get1index</span>

x <span style="color: #008b8b;">&lt;-</span> list(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">4</span>)
x[<span style="color: #008b8b;">5</span>]
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[1]]</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; NULL</span>
x[<span style="color: #228b22;">NA_real_</span>]
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[1]]</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; NULL</span>
x[<span style="color: #228b22;">NULL</span>]
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; list()</span>
x[[<span style="color: #008b8b;">5</span>]]
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Error in x[[5]]: &#19979;&#26631;&#20986;&#30028;</span>
x[[<span style="color: #228b22;">NA_real_</span>]]
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; NULL</span>
x[[<span style="color: #228b22;">NULL</span>]]
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Error in x[[NULL]]: attempt to select less than one element in get1index</span>
</pre>
</div>
</div>
</div>
<div id="orgc654b28" class="outline-4">
<h4 id="orgc654b28"><span class="section-number-4">12.1.7</span> head/tail</h4>
<div class="outline-text-4" id="text-12-1-7">
<div class="org-src-container">
<pre class="src src-R">head(tail(mtcars, n = <span style="color: #008b8b;">10</span>), n = <span style="color: #008b8b;">3</span>) 
</pre>
</div>
</div>
</div>
<div id="org9fe8f80" class="outline-4">
<h4 id="org9fe8f80"><span class="section-number-4">12.1.8</span> date</h4>
<div class="outline-text-4" id="text-12-1-8">
<div class="org-src-container">
<pre class="src src-R">(today <span style="color: #008b8b;">&lt;-</span> Sys.Date())
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "2020-03-04"</span>
format(today, <span style="color: #8b2252;">"%d %b %Y"</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">with month as a word</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "04 3&#26376; 2020"</span>
(tenweeks <span style="color: #008b8b;">&lt;-</span> seq(today, length.out = <span style="color: #008b8b;">10</span>, by = <span style="color: #8b2252;">"1 week"</span>))
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [1] "2020-03-04" "2020-03-11" "2020-03-18" "2020-03-25" "2020-04-01"</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [6] "2020-04-08" "2020-04-15" "2020-04-22" "2020-04-29" "2020-05-06"  </span>
</pre>
</div>
</div>
</div>
<div id="org00b450b" class="outline-4">
<h4 id="org00b450b"><span class="section-number-4">12.1.9</span> cat</h4>
<div class="outline-text-4" id="text-12-1-9">
<p>
Concatenate and Print.Outputs the objects, concatenating the representations. cat performs much less conversion than print.主要用于打印结果。
</p>

<div class="org-src-container">
<pre class="src src-R">iter <span style="color: #008b8b;">&lt;-</span> stats::rpois(<span style="color: #008b8b;">1</span>, lambda = <span style="color: #008b8b;">10</span>)
<span style="color: #b22222;">## </span><span style="color: #b22222;">print an informative message</span>
cat(<span style="color: #8b2252;">"iteration = "</span>, iter <span style="color: #008b8b;">&lt;-</span> iter + <span style="color: #008b8b;">1</span>, <span style="color: #8b2252;">"\n"</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; iteration =  9</span>
</pre>
</div>
</div>
</div>
<div id="org92834a5" class="outline-4">
<h4 id="org92834a5"><span class="section-number-4">12.1.10</span> which</h4>
<div class="outline-text-4" id="text-12-1-10">
<p>
以前一直喜欢用 which, 今天终于知道了如何用｛｝来 pipeline 了。
</p>
<div class="org-src-container">
<pre class="src src-R">Abbr$Abbr <span style="color: #008b8b;">%&gt;%</span> {which((.) == <span style="color: #8b2252;">"S"</span>)}  
</pre>
</div>
</div>
</div>

<div id="orgb970142" class="outline-4">
<h4 id="orgb970142"><span class="section-number-4">12.1.11</span> warning</h4>
<div class="outline-text-4" id="text-12-1-11">
<p>
Generates a warning message that corresponds to its argument(s) and (optionally) the expression or function from which it was called.
</p>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #a020f0;">if</span>(length(list.files(sprintf(<span style="color: #8b2252;">"%s/"</span>,modelpath),pattern = <span style="color: #8b2252;">"onehot_encode.RData"</span>))&gt;<span style="color: #008b8b;">0</span>)
    <span style="color: #008b8b;">warning</span>(<span style="color: #8b2252;">"The model path has onehot_encode.RData file,Please check, don't converge it!!"</span>) <span style="color: #a020f0;">else</span>{
                                                                                                 cat(<span style="color: #8b2252;">"The model path has not onehot_encode.RData file :)"</span>)
                                                                                             }        
</pre>
</div>
</div>
</div>
<div id="orgbc1165b" class="outline-4">
<h4 id="orgbc1165b"><span class="section-number-4">12.1.12</span> stop</h4>
<div class="outline-text-4" id="text-12-1-12">
<p>
stop stops execution of the current expression and executes an error action.
</p>
<div class="org-src-container">
<pre class="src src-R">iter <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">12</span>
try(<span style="color: #a020f0;">if</span> (iter &gt; <span style="color: #008b8b;">10</span>) <span style="color: #a020f0;">stop</span>(<span style="color: #8b2252;">"too many iterations"</span>))
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Error in try(if (iter &gt; 10) stop("too many iterations")) : </span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   too many iterations </span>
</pre>
</div>
</div>
</div>
<div id="orgac5b54d" class="outline-4">
<h4 id="orgac5b54d"><span class="section-number-4">12.1.13</span> message</h4>
<div class="outline-text-4" id="text-12-1-13">
<div class="org-src-container">
<pre class="src src-R"><span style="color: #0000ff;">testit</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>() {
    <span style="color: #008b8b;">message</span>(<span style="color: #8b2252;">"testing package startup messages"</span>)
    packageStartupMessage(<span style="color: #8b2252;">"initializing ..."</span>, appendLF = <span style="color: #228b22;">FALSE</span>)
    Sys.sleep(<span style="color: #008b8b;">1</span>)
    packageStartupMessage(<span style="color: #8b2252;">" done"</span>)
}
testit()
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; testing package startup messages</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; initializing ... done      </span>
</pre>
</div>
</div>
</div>
<div id="org7cf54c8" class="outline-4">
<h4 id="org7cf54c8"><span class="section-number-4">12.1.14</span> toString</h4>
<div class="outline-text-4" id="text-12-1-14">
<p>
A character vector of length 1 is returned.
其实，这个函数相当于 str<sub>c</sub>(x, collapse = ", ").
</p>
<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #8b2252;">"a"</span>, <span style="color: #8b2252;">"b"</span>, <span style="color: #8b2252;">"aaaaaaaaaaa"</span>)
toString(x)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "a, b, aaaaaaaaaaa"</span>
str_c(x, collapse = <span style="color: #8b2252;">", "</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Error in str_c(x, collapse = ", "): &#27809;&#26377;"str_c"&#36825;&#20010;&#20989;&#25968;</span>
toString(x, width = <span style="color: #008b8b;">8</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "a, b...."</span>
</pre>
</div>
</div>
</div>
<div id="org33ae4f1" class="outline-4">
<h4 id="org33ae4f1"><span class="section-number-4">12.1.15</span> tryCatch</h4>
<div class="outline-text-4" id="text-12-1-15">
<div class="org-src-container">
<pre class="src src-R"><span style="color: #a020f0;">tryCatch</span>(<span style="color: #008b8b;">1</span>, finally = print(<span style="color: #8b2252;">"Hello"</span>))
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "Hello"</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 1</span>
e <span style="color: #008b8b;">&lt;-</span> simpleError(<span style="color: #8b2252;">"test error"</span>)
<span style="color: #a020f0;">stop</span>(e)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Error: test error</span>
<span style="color: #a020f0;">tryCatch</span>(<span style="color: #a020f0;">stop</span>(e), finally = print(<span style="color: #8b2252;">"Hello"</span>))
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Error: test error</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "Hello"      </span>
</pre>
</div>
</div>
</div>

<div id="org04b3a66" class="outline-4">
<h4 id="org04b3a66"><span class="section-number-4">12.1.16</span> rbind</h4>
<div class="outline-text-4" id="text-12-1-16">
<div class="org-src-container">
<pre class="src src-R">dd <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">10</span>
rbind(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">4</span>, c = <span style="color: #008b8b;">2</span>, <span style="color: #8b2252;">"a++"</span> = <span style="color: #008b8b;">10</span>, dd, deparse.level = <span style="color: #008b8b;">0</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">middle 2 rownames</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;     [,1] [,2] [,3] [,4]</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;        1    2    3    4 </span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; c      2    2    2    2</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; a++   10   10   10   10</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;       10   10   10   10</span>
rbind(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">4</span>, c = <span style="color: #008b8b;">2</span>, <span style="color: #8b2252;">"a++"</span> = <span style="color: #008b8b;">10</span>, dd, deparse.level = <span style="color: #008b8b;">1</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">3 rownames (default)</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;     [,1] [,2] [,3] [,4]</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;        1    2    3    4</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; c      2    2    2    2</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; a++   10   10   10   10</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; dd    10   10   10   10</span>
rbind(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">4</span>, c = <span style="color: #008b8b;">2</span>, <span style="color: #8b2252;">"a++"</span> = <span style="color: #008b8b;">10</span>, dd, deparse.level = <span style="color: #008b8b;">2</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">4 rownames</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;     [,1] [,2] [,3] [,4]</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1:4    1    2    3    4</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; c      2    2    2    2</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; a++   10   10   10   10</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; dd    10   10   10   10      </span>
</pre>
</div>
</div>
</div>
<div id="org0914e54" class="outline-4">
<h4 id="org0914e54"><span class="section-number-4">12.1.17</span> rawconversion</h4>
<div class="outline-text-4" id="text-12-1-17">
<p>
Convert to or from Raw Vectors.Conversion and manipulation of objects of type "raw".
</p>
<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> <span style="color: #8b2252;">"A test string"</span>
(y <span style="color: #008b8b;">&lt;-</span> charToRaw(x))
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [1] 41 20 74 65 73 74 20 73 74 72 69 6e 67</span>
y <span style="color: #008b8b;">%&gt;%</span> str()
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Error in y %&gt;% str(): &#27809;&#26377;"%&gt;%"&#36825;&#20010;&#20989;&#25968;</span>
rawToChar(y)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "A test string"</span>
rawToBits(y)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   [1] 01 00 00 00 00 00 01 00 00 00 00 00 00 01 00 00 00 00 01 00 01 01 01</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [24] 00 01 00 01 00 00 01 01 00 01 01 00 00 01 01 01 00 00 00 01 00 01 01</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [47] 01 00 00 00 00 00 00 01 00 00 01 01 00 00 01 01 01 00 00 00 01 00 01</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [70] 01 01 00 00 01 00 00 01 01 01 00 01 00 00 01 00 01 01 00 00 01 01 01</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [93] 00 01 01 00 01 01 01 00 00 01 01 00  </span>
</pre>
</div>
</div>
</div>
<div id="org16d9f4d" class="outline-4">
<h4 id="org16d9f4d"><span class="section-number-4">12.1.18</span> all.names</h4>
<div class="outline-text-4" id="text-12-1-18">
<p>
Find All Names in an Expression.这个函数十分重要!!!
</p>
<div class="org-src-container">
<pre class="src src-R">all.names(expression(sin(x + y)))
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "sin" "+"   "x"   "y"</span>
all.names(quote(sin(x + y))) <span style="color: #b22222;"># </span><span style="color: #b22222;">or a call</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "sin" "+"   "x"   "y"</span>
all.vars(expression(sin(x + y)))
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "x" "y"  </span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-R">str_remove(all.names(quote(<span style="color: #008b8b;">23</span>*x+<span style="color: #008b8b;">12</span>*ty)),<span style="color: #8b2252;">"[*|+]"</span>) <span style="color: #008b8b;">%&gt;%</span> 
    str_detect(<span style="color: #8b2252;">""</span>)      
</pre>
</div>
</div>
</div>

<div id="org7ccca91" class="outline-4">
<h4 id="org7ccca91"><span class="section-number-4">12.1.19</span> apply</h4>
<div class="outline-text-4" id="text-12-1-19">
<p>
apply(X, MARGIN, FUN)
Here:
-x: 一个数组或者矩阵
-MARGIN: 两种数值 1 或者 2 决定对哪一个维度进行函数计算
-MARGIN=1`: 操作基于行
-MARGIN=2`: 操作基于列
-MARGIN=c(1,2)`: 对行和列都进行操作
-FUN: 使用哪种操作，内置的函数有 mean（平均值）、medium（中位数）、sum（求和）、min（最小值）、max（最大值），当然还包括广大的用户自定义函数.
</p>

<div class="org-src-container">
<pre class="src src-R">&gt; m1 <span style="color: #008b8b;">&lt;-</span> matrix(C<span style="color: #008b8b;">&lt;-</span>(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">10</span>),nrow=<span style="color: #008b8b;">5</span>, ncol=<span style="color: #008b8b;">6</span>)
&gt; m1
[,<span style="color: #008b8b;">1</span>] [,<span style="color: #008b8b;">2</span>] [,<span style="color: #008b8b;">3</span>] [,<span style="color: #008b8b;">4</span>] [,<span style="color: #008b8b;">5</span>] [,<span style="color: #008b8b;">6</span>]
[<span style="color: #008b8b;">1</span>,]    <span style="color: #008b8b;">1</span>    <span style="color: #008b8b;">6</span>    <span style="color: #008b8b;">1</span>    <span style="color: #008b8b;">6</span>    <span style="color: #008b8b;">1</span>    <span style="color: #008b8b;">6</span>
[<span style="color: #008b8b;">2</span>,]    <span style="color: #008b8b;">2</span>    <span style="color: #008b8b;">7</span>    <span style="color: #008b8b;">2</span>    <span style="color: #008b8b;">7</span>    <span style="color: #008b8b;">2</span>    <span style="color: #008b8b;">7</span>
[<span style="color: #008b8b;">3</span>,]    <span style="color: #008b8b;">3</span>    <span style="color: #008b8b;">8</span>    <span style="color: #008b8b;">3</span>    <span style="color: #008b8b;">8</span>    <span style="color: #008b8b;">3</span>    <span style="color: #008b8b;">8</span>
[<span style="color: #008b8b;">4</span>,]    <span style="color: #008b8b;">4</span>    <span style="color: #008b8b;">9</span>    <span style="color: #008b8b;">4</span>    <span style="color: #008b8b;">9</span>    <span style="color: #008b8b;">4</span>    <span style="color: #008b8b;">9</span>
[<span style="color: #008b8b;">5</span>,]    <span style="color: #008b8b;">5</span>   <span style="color: #008b8b;">10</span>    <span style="color: #008b8b;">5</span>   <span style="color: #008b8b;">10</span>    <span style="color: #008b8b;">5</span>   <span style="color: #008b8b;">10</span>
&gt; a_m1 <span style="color: #008b8b;">&lt;-</span> apply(m1, <span style="color: #008b8b;">2</span>, sum)
&gt; a_m1
[<span style="color: #008b8b;">1</span>] <span style="color: #008b8b;">15</span> <span style="color: #008b8b;">40</span> <span style="color: #008b8b;">15</span> <span style="color: #008b8b;">40</span> <span style="color: #008b8b;">15</span> <span style="color: #008b8b;">40</span>  
</pre>
</div>
</div>
</div>

<div id="org01d6475" class="outline-4">
<h4 id="org01d6475"><span class="section-number-4">12.1.20</span> aggregate</h4>
<div class="outline-text-4" id="text-12-1-20">
<p>
以前不知道这个函数，真是好用啊。
Compute Summary Statistics of Data Subsets. Splits the data into subsets, computes summary statistics for each, and returns the result in a convenient form.
</p>

<div class="org-src-container">
<pre class="src src-R">aggregate(Sepal.Length ~ Species, data = iris, mean)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;      Species Sepal.Length</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1     setosa        5.006</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2 versicolor        5.936</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3  virginica        6.588</span>
iris <span style="color: #008b8b;">%&gt;%</span> 
    group_by(Species) <span style="color: #008b8b;">%&gt;%</span> 
    summarise(mean(Sepal.Length))
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; `summarise()` ungrouping output (override with `.groups` argument)</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; # A tibble: 3 x 2</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   Species    `mean(Sepal.Length)`</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   &lt;fct&gt;                     &lt;dbl&gt;</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1 setosa                     5.01</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2 versicolor                 5.94</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3 virginica                  6.59  </span>
</pre>
</div>
<p>
pipeline 版本的 code 如下：
</p>
<div class="org-src-container">
<pre class="src src-R">iris <span style="color: #008b8b;">%&gt;%</span> 
    aggregate(Sepal.Length ~ Species,.,mean)  
</pre>
</div>

<div class="org-src-container">
<pre class="src src-R">testDF <span style="color: #008b8b;">&lt;-</span> data.frame(v1 = c(<span style="color: #008b8b;">1</span>,<span style="color: #008b8b;">3</span>,<span style="color: #008b8b;">5</span>,<span style="color: #008b8b;">7</span>,<span style="color: #008b8b;">8</span>,<span style="color: #008b8b;">3</span>,<span style="color: #008b8b;">5</span>,<span style="color: #228b22;">NA</span>,<span style="color: #008b8b;">4</span>,<span style="color: #008b8b;">5</span>,<span style="color: #008b8b;">7</span>,<span style="color: #008b8b;">9</span>),
                     v2 = c(<span style="color: #008b8b;">11</span>,<span style="color: #008b8b;">33</span>,<span style="color: #008b8b;">55</span>,<span style="color: #008b8b;">77</span>,<span style="color: #008b8b;">88</span>,<span style="color: #008b8b;">33</span>,<span style="color: #008b8b;">55</span>,<span style="color: #228b22;">NA</span>,<span style="color: #008b8b;">44</span>,<span style="color: #008b8b;">55</span>,<span style="color: #008b8b;">77</span>,<span style="color: #008b8b;">99</span>) )

by1 <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #8b2252;">"red"</span>, <span style="color: #8b2252;">"blue"</span>, <span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">2</span>, <span style="color: #228b22;">NA</span>, <span style="color: #8b2252;">"big"</span>, <span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">2</span>, <span style="color: #8b2252;">"red"</span>, <span style="color: #008b8b;">1</span>, <span style="color: #228b22;">NA</span>, <span style="color: #008b8b;">12</span>)
by2 <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #8b2252;">"wet"</span>, <span style="color: #8b2252;">"dry"</span>, <span style="color: #008b8b;">99</span>, <span style="color: #008b8b;">95</span>, <span style="color: #228b22;">NA</span>, <span style="color: #8b2252;">"damp"</span>, <span style="color: #008b8b;">95</span>, <span style="color: #008b8b;">99</span>, <span style="color: #8b2252;">"red"</span>, <span style="color: #008b8b;">99</span>, <span style="color: #228b22;">NA</span>, <span style="color: #228b22;">NA</span>)
aggregate(x = testDF, by = list(by1, by2), FUN = <span style="color: #8b2252;">"mean"</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   Group.1 Group.2 v1 v2</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1       1      95  5 55</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2       2      95  7 77</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3       1      99  5 55</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 4       2      99 NA NA</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 5     big    damp  3 33</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 6    blue     dry  3 33</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 7     red     red  4 44</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 8     red     wet  1 11  </span>
</pre>
</div>
</div>
</div>

<div id="orgf966943" class="outline-4">
<h4 id="orgf966943"><span class="section-number-4">12.1.21</span> ave</h4>
<div class="outline-text-4" id="text-12-1-21">
<p>
这个函数可以分组计算均值。
</p>

<div class="org-src-container">
<pre class="src src-R">ave(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 2 2 2</span>
<span style="color: #008b8b;">library</span>(datasets)
<span style="color: #008b8b;">attach</span>(warpbreaks)
ave(breaks, wool)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [1] 31.04 31.04 31.04 31.04 31.04 31.04 31.04 31.04 31.04 31.04 31.04</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [12] 31.04 31.04 31.04 31.04 31.04 31.04 31.04 31.04 31.04 31.04 31.04</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [23] 31.04 31.04 31.04 31.04 31.04 25.26 25.26 25.26 25.26 25.26 25.26</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [34] 25.26 25.26 25.26 25.26 25.26 25.26 25.26 25.26 25.26 25.26 25.26</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [45] 25.26 25.26 25.26 25.26 25.26 25.26 25.26 25.26 25.26 25.26</span>
breaks
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [1] 26 30 54 25 70 52 51 26 67 18 21 29 17 12 18 35 30 36 36 21 24 18 10</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [24] 43 28 15 26 27 14 29 19 29 31 41 20 44 42 26 19 16 39 28 21 39 29 20</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [47] 21 24 17 13 15 15 16 28</span>
wool
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [1] A A A A A A A A A A A A A A A A A A A A A A A A A A A B B B B B B B B</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [36] B B B B B B B B B B B B B B B B B B B</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Levels: A B  </span>
</pre>
</div>
</div>
</div>

<div id="orgf2ff9f8" class="outline-4">
<h4 id="orgf2ff9f8"><span class="section-number-4">12.1.22</span> aperm</h4>
<div class="outline-text-4" id="text-12-1-22">
<p>
对数列的维度进行重塑。
</p>
<div class="org-src-container">
<pre class="src src-R">(x <span style="color: #008b8b;">&lt;-</span> array(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">24</span>, <span style="color: #008b8b;">2</span>:<span style="color: #008b8b;">4</span>))
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; , , 1</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;      [,1] [,2] [,3]</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1,]    1    3    5</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [2,]    2    4    6</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; , , 2</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;      [,1] [,2] [,3]</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1,]    7    9   11</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [2,]    8   10   12</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; , , 3</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;      [,1] [,2] [,3]</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1,]   13   15   17</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [2,]   14   16   18</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; , , 4</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;      [,1] [,2] [,3]</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1,]   19   21   23</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [2,]   20   22   24</span>
(xt <span style="color: #008b8b;">&lt;-</span> aperm(x, c(<span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">3</span>)))
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; , , 1</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;      [,1] [,2]</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1,]    1    2</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [2,]    3    4</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [3,]    5    6</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; , , 2</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;      [,1] [,2]</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1,]    7    8</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [2,]    9   10</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [3,]   11   12</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; , , 3</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;      [,1] [,2]</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1,]   13   14</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [2,]   15   16</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [3,]   17   18</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; , , 4</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;      [,1] [,2]</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1,]   19   20</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [2,]   21   22</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [3,]   23   24      </span>
</pre>
</div>
</div>
</div>

<div id="orgfc59915" class="outline-4">
<h4 id="orgfc59915"><span class="section-number-4">12.1.23</span> any</h4>
<div class="outline-text-4" id="text-12-1-23">
<p>
Are Some Values True?Given a set of logical vectors, is at least one of the values true?
</p>
<div class="org-src-container">
<pre class="src src-R">range(x <span style="color: #008b8b;">&lt;-</span> sort(round(stats::rnorm(<span style="color: #008b8b;">10</span>) - <span style="color: #008b8b;">1.2</span>, <span style="color: #008b8b;">1</span>)))
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] -2.8 -0.3</span>
<span style="color: #a020f0;">if</span> (any(x &lt; <span style="color: #008b8b;">0</span>)) cat(<span style="color: #8b2252;">"x contains negative values\n"</span>)
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; x contains negative values</span>
</pre>
</div>
</div>
</div>
<div id="org654aca1" class="outline-4">
<h4 id="org654aca1"><span class="section-number-4">12.1.24</span> all</h4>
<div class="outline-text-4" id="text-12-1-24">
<p>
Given a set of logical vectors, are all of the values true?
</p>
<div class="org-src-container">
<pre class="src src-R">range(x <span style="color: #008b8b;">&lt;-</span> sort(round(stats::rnorm(<span style="color: #008b8b;">10</span>) - <span style="color: #008b8b;">1.2</span>, <span style="color: #008b8b;">1</span>)))
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] -2.9  1.5</span>
<span style="color: #a020f0;">if</span> (all(x &lt; <span style="color: #008b8b;">0</span>)) {
    cat(<span style="color: #8b2252;">"all x values are negative\n"</span>)
} <span style="color: #a020f0;">else</span> {
    cat(<span style="color: #8b2252;">"all x values are poisitive\n"</span>)
}
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; all x values are poisitive      </span>
</pre>
</div>
</div>
</div>
<div id="orgf56137d" class="outline-4">
<h4 id="orgf56137d"><span class="section-number-4">12.1.25</span> anyNA</h4>
<div class="outline-text-4" id="text-12-1-25">
<div class="org-src-container">
<pre class="src src-R">is.na(c(<span style="color: #008b8b;">1</span>, <span style="color: #228b22;">NA</span>)) <span style="color: #b22222;"># </span><span style="color: #b22222;">&gt; FALSE  TRUE</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] FALSE  TRUE</span>
is.na(paste(c(<span style="color: #008b8b;">1</span>, <span style="color: #228b22;">NA</span>))) <span style="color: #b22222;"># </span><span style="color: #b22222;">&gt; FALSE FALSE</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] FALSE FALSE</span>
c(<span style="color: #228b22;">TRUE</span>, <span style="color: #228b22;">FALSE</span>) &amp; <span style="color: #228b22;">NA</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1]    NA FALSE</span>
c(<span style="color: #228b22;">TRUE</span>, <span style="color: #228b22;">FALSE</span>) | <span style="color: #228b22;">NA</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] TRUE   NA</span>
(xx <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #008b8b;">0</span>:<span style="color: #008b8b;">4</span>))
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 0 1 2 3 4</span>
is.na(xx) <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">4</span>)
xx <span style="color: #b22222;"># </span><span style="color: #b22222;">&gt; 0 NA  2 NA  4</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1]  0 NA  2 NA  4</span>
anyNA(xx) <span style="color: #b22222;"># </span><span style="color: #b22222;">TRUE</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] TRUE </span>
</pre>
</div>
</div>
</div>

<div id="orgb073998" class="outline-4">
<h4 id="orgb073998"><span class="section-number-4">12.1.26</span> expression</h4>
<div class="outline-text-4" id="text-12-1-26">
<div class="org-src-container">
<pre class="src src-R">length(ex1 <span style="color: #008b8b;">&lt;-</span> expression(<span style="color: #008b8b;">1</span> + <span style="color: #008b8b;">0</span>:<span style="color: #008b8b;">9</span>)) <span style="color: #b22222;"># </span><span style="color: #b22222;">1</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 1</span>
ex1
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; expression(1 + 0:9)</span>
eval(ex1)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [1]  1  2  3  4  5  6  7  8  9 10  </span>
</pre>
</div>
</div>
</div>
<div id="org582f57f" class="outline-4">
<h4 id="org582f57f"><span class="section-number-4">12.1.27</span> call</h4>
<div class="outline-text-4" id="text-12-1-27">
<p>
Function Calls.Create or test for objects of mode "call" (or "(", see Details).
call(name, &#x2026;)
is.call(x)
as.call(x)
Arguments
name a non-empty character string naming the function to be called.
arguments to be part of the call.
x	
an arbitrary R object.
</p>

<div class="org-src-container">
<pre class="src src-R">cl <span style="color: #008b8b;">&lt;-</span> call(<span style="color: #8b2252;">"round"</span>, <span style="color: #008b8b;">10.5</span>)
is.call(cl) <span style="color: #b22222;"># </span><span style="color: #b22222;">TRUE</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] TRUE</span>
cl <span style="color: #008b8b;">%&gt;%</span> eval()
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Error in cl %&gt;% eval(): &#27809;&#26377;"%&gt;%"&#36825;&#20010;&#20989;&#25968;</span>
class(cl) <span style="color: #b22222;"># </span><span style="color: #b22222;">"call"</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "call"</span>
typeof(cl) <span style="color: #b22222;"># </span><span style="color: #b22222;">"language"</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "language"</span>
is.call(cl) &amp;&amp; is.language(cl) <span style="color: #b22222;"># </span><span style="color: #b22222;">always TRUE for "call"s</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] TRUE  </span>
</pre>
</div>
</div>
</div>

<div id="org4bfd287" class="outline-4">
<h4 id="org4bfd287"><span class="section-number-4">12.1.28</span> 科学计算符号</h4>
<div class="outline-text-4" id="text-12-1-28">
<p>
+:Addition
–：Subtraction
*:Multiplication
/:Division
^:Exponent
%%:Modulus (Remainder from division)
%/%:Integer Division
</p>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #008b8b;">16</span> <span style="color: #008b8b;">%/%</span> <span style="color: #008b8b;">5</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">3</span>
</pre>
</div>

<p>
常用函数：
</p>
<ul class="org-ul">
<li>cat：连接&#x2026;中的对象，并将其输出到屏幕上或文件中（如果声明了一个的话）。</li>
</ul>
<p>
cat()函数的优势在于可以用来捕捉函数功能的错误，除了 cat()函数外，warning()可以生成一条错误提示信息，用 message()生成一条诊断信息，或用 stop()停止当前表达式的执行并提示错误。
</p>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
firstname <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #8b2252;">"Jane"</span>)
cat(<span style="color: #8b2252;">"Hello"</span>, firstname, <span style="color: #8b2252;">"\n"</span>)
</pre>
</div>
</div>
</div>
<div id="orgf586997" class="outline-4">
<h4 id="orgf586997"><span class="section-number-4">12.1.29</span> reduce</h4>
<div class="outline-text-4" id="text-12-1-29">
<p>
以前对这个函数很不熟悉。只要重复调用这个函数三次以上就可以使用这个函数！
reduce() takes a vector of length n and produces a vector of length 1 by calling a function with a pair of values at a time: reduce(1:4, f) is equivalent to f(f(f(1, 2), 3), 4).
如果寻找多个向量的共同值，就可以用 reduce.
</p>
<div class="org-src-container">
<pre class="src src-R">l <span style="color: #008b8b;">&lt;-</span> map(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">4</span>,~sample(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">10</span>,<span style="color: #008b8b;">15</span>,replace = T))
str(l)
reduce(l,intersect)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #0000ff;">paste2</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>(x, y, sep = <span style="color: #8b2252;">"."</span>) paste(x, y, sep = sep)
letters[<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">4</span>] <span style="color: #008b8b;">%&gt;%</span> reduce(paste2)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "a.b.c.d" </span>
</pre>
</div>
</div>
</div>
<div id="org4025fb8" class="outline-4">
<h4 id="org4025fb8"><span class="section-number-4">12.1.30</span> reduce2</h4>
<div class="outline-text-4" id="text-12-1-30">
<p>
可以支持多个输入。
For reduce2() and accumulate2(), a 3-argument function. The function will be passed the accumulated value as the first argument, the next value of .x as the second argument, and the next value of .y as the third argument.
</p>
<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> list(c(<span style="color: #008b8b;">0</span>, <span style="color: #008b8b;">1</span>), c(<span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">3</span>), c(<span style="color: #008b8b;">4</span>, <span style="color: #008b8b;">5</span>))
y <span style="color: #008b8b;">&lt;-</span> list(c(<span style="color: #008b8b;">6</span>, <span style="color: #008b8b;">7</span>), c(<span style="color: #008b8b;">8</span>, <span style="color: #008b8b;">9</span>))
reduce2(x, y, paste)      
</pre>
</div>

<div class="org-src-container">
<pre class="src src-R">letters[<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">4</span>] <span style="color: #008b8b;">%&gt;%</span> reduce2(c(<span style="color: #8b2252;">"-"</span>, <span style="color: #8b2252;">"."</span>, <span style="color: #8b2252;">"-"</span>), paste2)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "a-b.c-d"      </span>
</pre>
</div>
</div>
</div>
<div id="org5678aeb" class="outline-4">
<h4 id="org5678aeb"><span class="section-number-4">12.1.31</span> get</h4>
<div class="outline-text-4" id="text-12-1-31">
<p>
Return the Value of a Named Object
</p>
<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">5</span>
get(<span style="color: #8b2252;">"x"</span>)  
</pre>
</div>
</div>
</div>
<div id="org13c7f26" class="outline-4">
<h4 id="org13c7f26"><span class="section-number-4">12.1.32</span> assign</h4>
<div class="outline-text-4" id="text-12-1-32">
<p>
Assign a Value to a Name.Assign a value to a name in an environment.
</p>
<div class="org-src-container">
<pre class="src src-R">a <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">4</span>
assign(<span style="color: #8b2252;">"a[1]"</span>, <span style="color: #008b8b;">2</span>)
a
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 1 2 3 4</span>
get(<span style="color: #8b2252;">"a[1]"</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 2</span>
a[<span style="color: #008b8b;">1</span>] == <span style="color: #008b8b;">2</span> <span style="color: #b22222;"># </span><span style="color: #b22222;">FALSE</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] FALSE</span>
get(<span style="color: #8b2252;">"a[1]"</span>) == <span style="color: #008b8b;">2</span> <span style="color: #b22222;"># </span><span style="color: #b22222;">TRUE</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] TRUE      </span>
</pre>
</div>
</div>
</div>

<div id="orgebb9ea2" class="outline-4">
<h4 id="orgebb9ea2"><span class="section-number-4">12.1.33</span> attr</h4>
<div class="outline-text-4" id="text-12-1-33">
<p>
Object Attributes.
</p>
<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">10</span>
attr(x, <span style="color: #8b2252;">"dim"</span>) <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">5</span>)
x
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;      [,1] [,2] [,3] [,4] [,5]</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1,]    1    3    5    7    9</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [2,]    2    4    6    8   10</span>
</pre>
</div>
</div>
</div>
<div id="org4217ebd" class="outline-4">
<h4 id="org4217ebd"><span class="section-number-4">12.1.34</span> body</h4>
<div class="outline-text-4" id="text-12-1-34">
<div class="org-src-container">
<pre class="src src-R"><span style="color: #0000ff;">f</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>(x) x^<span style="color: #008b8b;">5</span>
body(f) <span style="color: #008b8b;">&lt;-</span> quote(<span style="color: #008b8b;">5</span>^x)
<span style="color: #b22222;">## </span><span style="color: #b22222;">or equivalently  body(f) &lt;- expression(5^x)</span>
f(<span style="color: #008b8b;">3</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">= 125</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 125</span>
body(f)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 5^x  </span>
</pre>
</div>
</div>
</div>

<div id="org57b7ce3" class="outline-4">
<h4 id="org57b7ce3"><span class="section-number-4">12.1.35</span> strrep</h4>
<div class="outline-text-4" id="text-12-1-35">
<p>
Repeat the character strings in a character vector a given number of times (i.e., concatenate the respective numbers of copies of the strings).
</p>
<div class="org-src-container">
<pre class="src src-R">strrep(<span style="color: #8b2252;">"ABC"</span>, <span style="color: #008b8b;">2</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "ABCABC"</span>
strrep(c(<span style="color: #8b2252;">"A"</span>, <span style="color: #8b2252;">"B"</span>, <span style="color: #8b2252;">"C"</span>), <span style="color: #008b8b;">1</span> : <span style="color: #008b8b;">3</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "A"   "BB"  "CCC"      </span>
</pre>
</div>
</div>
</div>
<div id="orgdeb0316" class="outline-4">
<h4 id="orgdeb0316"><span class="section-number-4">12.1.36</span> utils</h4>
<div class="outline-text-4" id="text-12-1-36">
</div>
<div id="org25eacef" class="outline-5">
<h5 id="org25eacef"><span class="section-number-5">12.1.36.1</span> adist</h5>
<div class="outline-text-5" id="text-12-1-36-1">
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">## </span><span style="color: #b22222;">Cf. https://en.wikipedia.org/wiki/Levenshtein_distance</span>
(adist(<span style="color: #8b2252;">"kitten"</span>, <span style="color: #8b2252;">"sitting"</span>))
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;      [,1]</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1,]    3</span>
(adist(<span style="color: #8b2252;">"lasy"</span>, <span style="color: #8b2252;">"1 lazy 2"</span>))
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;      [,1]</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1,]    5       </span>
</pre>
</div>
</div>
</div>
<div id="orgcfc19b9" class="outline-5">
<h5 id="orgcfc19b9"><span class="section-number-5">12.1.36.2</span> apropos</h5>
<div class="outline-text-5" id="text-12-1-36-2">
<p>
apropos() returns a character vector giving the names of objects in the search
list matching (as a regular expression) what.find() returns where objects of a
given name can be found.
</p>

<p>
apropos 函数能够匹配在内存中的对象。
</p>
<div class="org-src-container">
<pre class="src src-R">      <span style="color: #b22222;">## </span><span style="color: #b22222;">Not run: apropos("lm")</span>
apropos(<span style="color: #8b2252;">"GLM"</span>)                      <span style="color: #b22222;"># </span><span style="color: #b22222;">several</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "glm"           "glm.control"   "glm.fit"       "predict.glm"  </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [5] "residuals.glm" "summary.glm"</span>
apropos(<span style="color: #8b2252;">"GLM"</span>, ignore.case = <span style="color: #228b22;">FALSE</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">not one</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; character(0)</span>
apropos(<span style="color: #8b2252;">"lq"</span>)
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "evalq"       "evalqOnLoad"</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">need a DOUBLE backslash '\\' (in case you don't see it anymore)</span>
apropos(<span style="color: #8b2252;">"\\["</span>)
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [1] "["                    "[.AsIs"               "[.data.frame"        </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [4] "[.Date"               "[.difftime"           "[.Dlist"             </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [7] "[.DLLInfoList"        "[.factor"             "[.hexmode"           </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [10] "[.listof"             "[.noquote"            "[.numeric_version"   </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [13] "[.octmode"            "[.POSIXct"            "[.POSIXlt"           </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [16] "[.simple.list"        "[.table"              "[.warnings"          </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [19] "[["                   "[[.data.frame"        "[[.Date"             </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [22] "[[.factor"            "[[.numeric_version"   "[[.POSIXct"          </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [25] "[[.POSIXlt"           "[[&lt;-"                 "[[&lt;-.data.frame"     </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [28] "[[&lt;-.factor"          "[[&lt;-.numeric_version" "[[&lt;-.POSIXlt"        </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [31] "[&lt;-"                  "[&lt;-.data.frame"       "[&lt;-.Date"            </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [34] "[&lt;-.factor"           "[&lt;-.numeric_version"  "[&lt;-.POSIXct"         </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [37] "[&lt;-.POSIXlt"</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">everything % not diff-able</span>
length(apropos(<span style="color: #8b2252;">"."</span>))
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 3647</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">the 1-letter things</span>
apropos(<span style="color: #8b2252;">"^.$"</span>)
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [1] "-" ":" "!" "?" "(" "[" "{" "@" "*" "/" "&amp;" "^" "+" "&lt;" "=" "&gt;" "|"</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [18] "~" "$" "c" "C" "D" "F" "I" "n" "q" "t" "T"</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">the 1-2-letter things</span>
apropos(<span style="color: #8b2252;">"^..?$"</span>)
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [1] "-"  ":"  "::" "!"  "!=" "?"  ".C" "("  "["  "[[" "{"  "@"  "*"  "/" </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [15] "&amp;"  "&amp;&amp;" "%%" "^"  "+"  "&lt;"  "&lt;-" "&lt;=" "="  "==" "&gt;"  "&gt;=" "|"  "||"</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [29] "~"  "$"  "ar" "as" "by" "c"  "C"  "cm" "D"  "de" "df" "do" "dt" "el"</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [43] "F"  "gc" "gl" "I"  "id" "if" "Im" "is" "lm" "ls" "n"  "pf" "pi" "pt"</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [57] "q"  "qf" "qr" "qt" "Re" "rf" "rm" "rt" "sd" "t"  "T"  "ts" "vi" </span>
</pre>
</div>
</div>
</div>
<div id="org81a9c0f" class="outline-5">
<h5 id="org81a9c0f"><span class="section-number-5">12.1.36.3</span> person</h5>
<div class="outline-text-5" id="text-12-1-36-3">
<p>
这个函数可以生成一个人名信息。
</p>
<div class="org-src-container">
<pre class="src src-R">(p1 <span style="color: #008b8b;">&lt;-</span> person(<span style="color: #8b2252;">"Karl"</span>, <span style="color: #8b2252;">"Pearson"</span>, email = <span style="color: #8b2252;">"pearson@stats.heaven"</span>))
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "Karl Pearson <a href="mailto:pearson%40stats.heaven">&lt;pearson@stats.heaven&gt;</a>"       </span>
</pre>
</div>
</div>
</div>
<div id="org03d3eb4" class="outline-5">
<h5 id="org03d3eb4"><span class="section-number-5">12.1.36.4</span> roman</h5>
<div class="outline-text-5" id="text-12-1-36-4">
<p>
Simple manipulation of (a small set of) integer numbers as roman numerals.
</p>
<div class="org-src-container">
<pre class="src src-R">(y <span style="color: #008b8b;">&lt;-</span> as.roman(<span style="color: #008b8b;">1</span> : <span style="color: #008b8b;">5</span>))
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] I   II  III IV  V</span>
(y <span style="color: #008b8b;">&lt;-</span> as.roman(format(Sys.Date(), <span style="color: #8b2252;">"%Y"</span>)))
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] MMXX</span>
</pre>
</div>
</div>
</div>
<div id="orgd386b9e" class="outline-5">
<h5 id="orgd386b9e"><span class="section-number-5">12.1.36.5</span> askYesNo</h5>
<div class="outline-text-5" id="text-12-1-36-5">
<p>
askYesNo provides a standard way to ask the user a yes/no question. It provides a way for front-ends to substitute their own dialogs.
</p>
<div class="org-src-container">
<pre class="src src-R">askYesNo(<span style="color: #8b2252;">"Do you want to use askYesNo?"</span>)  
</pre>
</div>
</div>
</div>
<div id="orgeaeb8ae" class="outline-5">
<h5 id="orgeaeb8ae"><span class="section-number-5">12.1.36.6</span> bibentry</h5>
<div class="outline-text-5" id="text-12-1-36-6">
<p>
这个函数主要用来生成 bib 文献。
</p>
<div class="org-src-container">
<pre class="src src-R">rref <span style="color: #008b8b;">&lt;-</span> bibentry(
    bibtype = <span style="color: #8b2252;">"Manual"</span>,
    title = <span style="color: #8b2252;">"R: A Language and Environment for Statistical Computing"</span>,
    author = person(<span style="color: #8b2252;">"R Core Team"</span>),
    organization = <span style="color: #8b2252;">"R Foundation for Statistical Computing"</span>,
    address = <span style="color: #8b2252;">"Vienna, Austria"</span>,
    year = <span style="color: #008b8b;">2014</span>,
    url = <span style="color: #8b2252;">"https://www.R-project.org/"</span>)
<span style="color: #b22222;">## </span><span style="color: #b22222;">Different printing styles</span>
print(rref)
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; R Core Team (2014). _R: A Language and Environment for Statistical</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Computing_. R Foundation for Statistical Computing, Vienna,</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Austria. &lt;URL: https://www.R-project.org/&gt;.       </span>
</pre>
</div>
</div>
</div>
<div id="org66014ee" class="outline-5">
<h5 id="org66014ee"><span class="section-number-5">12.1.36.7</span> browseEnv</h5>
<div class="outline-text-5" id="text-12-1-36-7">
<p>
浏览环境中的对象。
</p>
<div class="org-src-container">
<pre class="src src-R">browseEnv()       
</pre>
</div>
</div>
</div>
<div id="org9ad6174" class="outline-5">
<h5 id="org9ad6174"><span class="section-number-5">12.1.36.8</span> browseURL</h5>
<div class="outline-text-5" id="text-12-1-36-8">
<p>
Load URL into an HTML Browser.
</p>
<div class="org-src-container">
<pre class="src src-R">browseURL(<span style="color: #8b2252;">"https://www.r-project.org"</span>)         
</pre>
</div>
</div>
</div>
<div id="org7d0e6f2" class="outline-5">
<h5 id="org7d0e6f2"><span class="section-number-5">12.1.36.9</span> browseVignettes</h5>
<div class="outline-text-5" id="text-12-1-36-9">
<p>
List Vignettes in an HTML Browser.学习起来很方便的。
</p>
<div class="org-src-container">
<pre class="src src-R">browseVignettes(all = <span style="color: #228b22;">FALSE</span>)       
</pre>
</div>
</div>
</div>
<div id="orge13848c" class="outline-5">
<h5 id="orge13848c"><span class="section-number-5">12.1.36.10</span> bug.report</h5>
<div class="outline-text-5" id="text-12-1-36-10">
<p>
Send a Bug Report.Invokes an editor or email program to write a bug report or opens a web page for bug submission. Some standard information on the current version and configuration of R are included automatically.
</p>
<div class="org-src-container">
<pre class="src src-R">bug.report(subject = <span style="color: #8b2252;">""</span>,  address,
           file = <span style="color: #8b2252;">"R.bug.report"</span>, package = <span style="color: #228b22;">NULL</span>, lib.loc = <span style="color: #228b22;">NULL</span>,
           ...)
</pre>
</div>
</div>
</div>
<div id="orgb0d5020" class="outline-5">
<h5 id="orgb0d5020"><span class="section-number-5">12.1.36.11</span> capture.output</h5>
<div class="outline-text-5" id="text-12-1-36-11">
<p>
Send Output to a Character String or File.Evaluates its arguments with the output being returned as a character string or sent to a file. Related to sink in the same way that with is related to attach.
</p>
<div class="org-src-container">
<pre class="src src-R">glmout <span style="color: #008b8b;">&lt;-</span> capture.output(summary(glm(case ~ spontaneous+induced,
                                     data = infert, family = binomial())))
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Error in is.data.frame(data): object 'infert' not found</span>
glmout[<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">5</span>]
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Error in eval(expr, envir, enclos): object 'glmout' not found</span>
capture.output(<span style="color: #008b8b;">1</span>+<span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">2</span>+<span style="color: #008b8b;">2</span>)
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "[1] 2" "[1] 4"</span>
capture.output({<span style="color: #008b8b;">1</span>+<span style="color: #008b8b;">1</span>; <span style="color: #008b8b;">2</span>+<span style="color: #008b8b;">2</span>})
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "[1] 4"       </span>
</pre>
</div>
</div>
</div>
<div id="orgf0a63cf" class="outline-5">
<h5 id="orgf0a63cf"><span class="section-number-5">12.1.36.12</span> changedFiles</h5>
<div class="outline-text-5" id="text-12-1-36-12">
<p>
fileSnapshot takes a snapshot of a selection of files, recording summary information about each.
</p>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;"># </span><span style="color: #b22222;">Create some files in a temporary directory</span>
dir <span style="color: #008b8b;">&lt;-</span> tempfile()
dir.create(dir)
writeBin(<span style="color: #008b8b;">1L</span>, file.path(dir, <span style="color: #8b2252;">"file1"</span>))
writeBin(<span style="color: #008b8b;">2L</span>, file.path(dir, <span style="color: #8b2252;">"file2"</span>))
dir.create(file.path(dir, <span style="color: #8b2252;">"dir"</span>))

                                 <span style="color: #b22222;"># </span><span style="color: #b22222;">Take a snapshot</span>
snapshot <span style="color: #008b8b;">&lt;-</span> fileSnapshot(dir, timestamp = tempfile(<span style="color: #8b2252;">"timestamp"</span>), md5sum=<span style="color: #228b22;">TRUE</span>)

                                 <span style="color: #b22222;"># </span><span style="color: #b22222;">Change one of the files.</span>
writeBin(<span style="color: #008b8b;">3L</span>:<span style="color: #008b8b;">4L</span>, file.path(dir, <span style="color: #8b2252;">"file2"</span>))

                                 <span style="color: #b22222;"># </span><span style="color: #b22222;">Display the detected changes.  We may or may not see mtime change...</span>
changedFiles(snapshot)
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; File changes:</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;       size mtime Newer md5sum</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; file2 TRUE  TRUE  TRUE   TRUE</span>
changedFiles(snapshot)$changes
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;        size isdir  mode mtime Newer md5sum</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; dir   FALSE FALSE FALSE FALSE FALSE     NA</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; file1 FALSE FALSE FALSE FALSE FALSE  FALSE</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; file2  TRUE FALSE FALSE  TRUE  TRUE   TRUE       </span>
</pre>
</div>
</div>
</div>
<div id="orgc19483f" class="outline-5">
<h5 id="orgc19483f"><span class="section-number-5">12.1.36.13</span> citation</h5>
<div class="outline-text-5" id="text-12-1-36-13">
<p>
如何在文献中引用 R 包？
</p>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">## </span><span style="color: #b22222;">the basic R reference</span>
citation()
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; To cite R in publications use:</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   R Core Team (2019). R: A language and environment for</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   statistical computing. R Foundation for Statistical Computing,</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   Vienna, Austria. URL https://www.R-project.org/.</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; A BibTeX entry for LaTeX users is</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   @Manual{,</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;     title = {R: A Language and Environment for Statistical Computing},</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;     author = {{R Core Team}},</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;     organization = {R Foundation for Statistical Computing},</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;     address = {Vienna, Austria},</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;     year = {2019},</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;     url = {https://www.R-project.org/},</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   }</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; We have invested a lot of time and effort in creating R, please</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; cite it when using it for data analysis. See also</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 'citation("pkgname")' for citing R packages.</span>

<span style="color: #b22222;">## </span><span style="color: #b22222;">references for a package -- might not have these installed</span>
<span style="color: #a020f0;">if</span>(nchar(system.file(package = <span style="color: #8b2252;">"lattice"</span>))) citation(<span style="color: #8b2252;">"lattice"</span>)
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; To cite the lattice package in publications use:</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   Sarkar, Deepayan (2008) Lattice: Multivariate Data Visualization</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   with R. Springer, New York. ISBN 978-0-387-75968-5</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; A BibTeX entry for LaTeX users is</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   @Book{,</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;     title = {Lattice: Multivariate Data Visualization with R},</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;     author = {Deepayan Sarkar},</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;     publisher = {Springer},</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;     address = {New York},</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;     year = {2008},</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;     note = {ISBN 978-0-387-75968-5},</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;     url = {http://lmdvr.r-forge.r-project.org},</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   }</span>
<span style="color: #a020f0;">if</span>(nchar(system.file(package = <span style="color: #8b2252;">"foreign"</span>))) citation(<span style="color: #8b2252;">"foreign"</span>)
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; To cite package 'foreign' in publications use:</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   R Core Team (2018). foreign: Read Data Stored by 'Minitab', 'S',</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   'SAS', 'SPSS', 'Stata', 'Systat', 'Weka', 'dBase', .... R</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   package version 0.8-71.</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   https://CRAN.R-project.org/package=foreign</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; A BibTeX entry for LaTeX users is</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   @Manual{,</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;     title = {foreign: Read Data Stored by 'Minitab', 'S', 'SAS', 'SPSS', 'Stata',</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 'Systat', 'Weka', 'dBase', ...},</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;     author = {{R Core Team}},</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;     year = {2018},</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;     note = {R package version 0.8-71},</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;     url = {https://CRAN.R-project.org/package=foreign},</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   }</span>

<span style="color: #b22222;">## </span><span style="color: #b22222;">extract the bibtex entry from the return value</span>
x <span style="color: #008b8b;">&lt;-</span> citation()
toBibtex(x)
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; @Manual{,</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   title = {R: A Language and Environment for Statistical Computing},</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   author = {{R Core Team}},</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   organization = {R Foundation for Statistical Computing},</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   address = {Vienna, Austria},</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   year = {2019},</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   url = {https://www.R-project.org/},</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; }</span>


<span style="color: #b22222;">## </span><span style="color: #b22222;">A citation with more than one bibentry:</span>
cm <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">tryCatch</span>(citation(<span style="color: #8b2252;">"mgcv"</span>),
               error = <span style="color: #a020f0;">function</span>(e) {
                 <span style="color: #008b8b;">warning</span>(<span style="color: #8b2252;">"Recommended package 'mgcv' is not installed properly"</span>)
                 <span style="color: #a020f0;">stop</span>(e$message) })
cm <span style="color: #b22222;"># </span><span style="color: #b22222;">short entries (2-3 lines each)       </span>
</pre>
</div>
</div>
</div>
<div id="orge186de8" class="outline-5">
<h5 id="orge186de8"><span class="section-number-5">12.1.36.14</span> cite</h5>
<div class="outline-text-5" id="text-12-1-36-14">
<p>
Cite a Bibliography Entry.Cite a bibentry object in text. The cite() function uses the cite() function from the default bibstyle if present, or citeNatbib() if not. citeNatbib() uses a style similar to that used by the LaTeX package natbib.
</p>
<div class="org-src-container">
<pre class="src src-R">  <span style="color: #b22222;">## </span><span style="color: #b22222;">R reference</span>
rref <span style="color: #008b8b;">&lt;-</span> bibentry(
   bibtype = <span style="color: #8b2252;">"Manual"</span>,
   title = <span style="color: #8b2252;">"R: A Language and Environment for Statistical Computing"</span>,
   author = person(<span style="color: #8b2252;">"R Core Team"</span>),
   organization = <span style="color: #8b2252;">"R Foundation for Statistical Computing"</span>,
   address = <span style="color: #8b2252;">"Vienna, Austria"</span>,
   year = <span style="color: #008b8b;">2013</span>,
   url = <span style="color: #8b2252;">"https://www.R-project.org/"</span>,
   key = <span style="color: #8b2252;">"R"</span>)

<span style="color: #b22222;">## </span><span style="color: #b22222;">References for boot package and associated book</span>
bref <span style="color: #008b8b;">&lt;-</span> c(
   bibentry(
     bibtype = <span style="color: #8b2252;">"Manual"</span>,
     title = <span style="color: #8b2252;">"boot: Bootstrap R (S-PLUS) Functions"</span>,
     author = c(
       person(<span style="color: #8b2252;">"Angelo"</span>, <span style="color: #8b2252;">"Canty"</span>, role = <span style="color: #8b2252;">"aut"</span>,
         comment = <span style="color: #8b2252;">"S original"</span>),
       person(c(<span style="color: #8b2252;">"Brian"</span>, <span style="color: #8b2252;">"D."</span>), <span style="color: #8b2252;">"Ripley"</span>, role = c(<span style="color: #8b2252;">"aut"</span>, <span style="color: #8b2252;">"trl"</span>, <span style="color: #8b2252;">"cre"</span>),
         comment = <span style="color: #8b2252;">"R port, author of parallel support"</span>,
         email = <span style="color: #8b2252;">"ripley@stats.ox.ac.uk"</span>)
     ),
     year = <span style="color: #8b2252;">"2012"</span>,
     note = <span style="color: #8b2252;">"R package version 1.3-4"</span>,
     url = <span style="color: #8b2252;">"https://CRAN.R-project.org/package=boot"</span>,
     key = <span style="color: #8b2252;">"boot-package"</span>
   ),

   bibentry(
     bibtype = <span style="color: #8b2252;">"Book"</span>,
     title = <span style="color: #8b2252;">"Bootstrap Methods and Their Applications"</span>,
     author = as.person(<span style="color: #8b2252;">"Anthony C. Davison [aut], David V. Hinkley [aut]"</span>),
     year = <span style="color: #8b2252;">"1997"</span>,
     publisher = <span style="color: #8b2252;">"Cambridge University Press"</span>,
     address = <span style="color: #8b2252;">"Cambridge"</span>,
     isbn = <span style="color: #8b2252;">"0-521-57391-2"</span>,
     url = <span style="color: #8b2252;">"http://statwww.epfl.ch/davison/BMA/"</span>,
     key = <span style="color: #8b2252;">"boot-book"</span>
   )
)

<span style="color: #b22222;">## </span><span style="color: #b22222;">Combine and cite</span>
refs <span style="color: #008b8b;">&lt;-</span> c(rref, bref)
cite(<span style="color: #8b2252;">"R, boot-package"</span>, refs)
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "(R Core Team 2013; Canty and Ripley 2012)"     </span>
</pre>
</div>
</div>
</div>
<div id="orga666477" class="outline-5">
<h5 id="orga666477"><span class="section-number-5">12.1.36.15</span> clipboard</h5>
<div class="outline-text-5" id="text-12-1-36-15">
<p>
Transfer text between a character vector and the Windows clipboard in MS Windows (only).
</p>
<div class="org-src-container">
<pre class="src src-R">getClipboardFormats(numeric = <span style="color: #228b22;">FALSE</span>)
readClipboard(format = <span style="color: #008b8b;">1</span>, raw = <span style="color: #228b22;">FALSE</span>)
writeClipboard(str, format = <span style="color: #008b8b;">1</span>)       
</pre>
</div>
</div>
</div>
<div id="orgc47314e" class="outline-5">
<h5 id="orgc47314e"><span class="section-number-5">12.1.36.16</span> txtProgressBar</h5>
<div class="outline-text-5" id="text-12-1-36-16">
<p>
Text progress bar in the R console.
</p>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #0000ff;">testit</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>(x = sort(runif(<span style="color: #008b8b;">20</span>)), ...)
{
    pb <span style="color: #008b8b;">&lt;-</span> txtProgressBar(...)
    <span style="color: #a020f0;">for</span>(i <span style="color: #a020f0;">in</span> c(<span style="color: #008b8b;">0</span>, x, <span style="color: #008b8b;">1</span>)) {Sys.sleep(<span style="color: #008b8b;">0.5</span>); setTxtProgressBar(pb, i)}
    Sys.sleep(<span style="color: #008b8b;">1</span>)
    close(pb)
}
testit(style = <span style="color: #008b8b;">3</span>)
<span style="color: #b22222;">## </span><span style="color: #b22222;">|=================================================| 100%</span>
</pre>
</div>
</div>
</div>
<div id="org4cc1d38" class="outline-5">
<h5 id="org4cc1d38"><span class="section-number-5">12.1.36.17</span> combn</h5>
<div class="outline-text-5" id="text-12-1-36-17">
<p>
Generate all combinations of the elements of x taken m at a time. 
If x is a positive integer, returns all combinations of the elements of seq(x) taken m at a time. If argument FUN is not NULL, applies a function given by the argument to each point. If simplify is FALSE, returns a list; otherwise returns an array, typically a matrix. &#x2026; are passed unchanged to the FUN function, if specified.
</p>
<div class="org-src-container">
<pre class="src src-R">combn(letters[<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">4</span>], <span style="color: #008b8b;">2</span>)
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;      [,1] [,2] [,3] [,4] [,5] [,6]</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1,] "a"  "a"  "a"  "b"  "b"  "c" </span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [2,] "b"  "c"  "d"  "c"  "d"  "d"  </span>
</pre>
</div>
</div>
</div>
<div id="org37bfd56" class="outline-5">
<h5 id="org37bfd56"><span class="section-number-5">12.1.36.18</span> compareVersion</h5>
<div class="outline-text-5" id="text-12-1-36-18">
<p>
Compare two package version numbers to see which is later.
</p>
<div class="org-src-container">
<pre class="src src-R">compareVersion(<span style="color: #8b2252;">"1.0"</span>, <span style="color: #8b2252;">"1.0-1"</span>)
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] -1</span>
compareVersion(<span style="color: #8b2252;">"7.2-0"</span>,<span style="color: #8b2252;">"7.1-12"</span>)
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 1       </span>
</pre>
</div>
</div>
</div>
<div id="org149cbb9" class="outline-5">
<h5 id="org149cbb9"><span class="section-number-5">12.1.36.19</span> compile</h5>
<div class="outline-text-5" id="text-12-1-36-19">
<p>
Compile Files for Use with R on Unix-alikes.Compile given source files so that they can subsequently be collected into a shared object using R CMD SHLIB or an executable program using R CMD LINK. Not available on Windows.
</p>

<div class="org-src-container">
<pre class="src src-R">R CMD COMPILE [options] srcfiles       
</pre>
</div>
</div>
</div>
<div id="orgd1d8340" class="outline-5">
<h5 id="orgd1d8340"><span class="section-number-5">12.1.36.20</span> data</h5>
<div class="outline-text-5" id="text-12-1-36-20">
<p>
Loads specified data sets, or list the available data sets.
</p>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #008b8b;">require</span>(utils)
data()                         <span style="color: #b22222;"># </span><span style="color: #b22222;">list all available data sets</span>
try(data(package = <span style="color: #8b2252;">"rpart"</span>) )  <span style="color: #b22222;"># </span><span style="color: #b22222;">list the data sets in the rpart package</span>
data(USArrests, <span style="color: #8b2252;">"VADeaths"</span>)    <span style="color: #b22222;"># </span><span style="color: #b22222;">load the data sets 'USArrests' and 'VADeaths'</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">Not run: ## Alternatively</span>
ds <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #8b2252;">"USArrests"</span>, <span style="color: #8b2252;">"VADeaths"</span>); data(list = ds)
<span style="color: #b22222;">## </span><span style="color: #b22222;">End(Not run)</span>
help(USArrests)                <span style="color: #b22222;"># </span><span style="color: #b22222;">give information on data set 'USArrests'</span>
</pre>
</div>
</div>
</div>
<div id="org4570f42" class="outline-5">
<h5 id="org4570f42"><span class="section-number-5">12.1.36.21</span> demo</h5>
<div class="outline-text-5" id="text-12-1-36-21">
<p>
demo is a user-friendly interface to running some demonstration R scripts. demo() gives the list of available topics.
</p>
<div class="org-src-container">
<pre class="src src-R">demo() <span style="color: #b22222;"># </span><span style="color: #b22222;">for attached packages</span>

<span style="color: #b22222;">## </span><span style="color: #b22222;">All available demos:</span>
demo(package = .packages(all.available = <span style="color: #228b22;">TRUE</span>))


<span style="color: #b22222;">## </span><span style="color: #b22222;">Display a demo, pausing between pages</span>
demo(lm.glm, package = <span style="color: #8b2252;">"stats"</span>, ask = <span style="color: #228b22;">TRUE</span>)

<span style="color: #b22222;">## </span><span style="color: #b22222;">Display it without pausing</span>
demo(lm.glm, package = <span style="color: #8b2252;">"stats"</span>, ask = <span style="color: #228b22;">FALSE</span>)


<span style="color: #b22222;">## </span><span style="color: #b22222;">Not run: </span>
ch <span style="color: #008b8b;">&lt;-</span> <span style="color: #8b2252;">"scoping"</span>
demo(ch, character = <span style="color: #228b22;">TRUE</span>)

<span style="color: #b22222;">## </span><span style="color: #b22222;">End(Not run)</span>

<span style="color: #b22222;">## </span><span style="color: #b22222;">Find the location of a demo</span>
system.file(<span style="color: #8b2252;">"demo"</span>, <span style="color: #8b2252;">"lm.glm.R"</span>, package = <span style="color: #8b2252;">"stats"</span>)
</pre>
</div>
</div>
</div>
<div id="org016191e" class="outline-5">
<h5 id="org016191e"><span class="section-number-5">12.1.36.22</span> file.edit</h5>
<div class="outline-text-5" id="text-12-1-36-22">
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">## </span><span style="color: #b22222;">Not run: </span>
                                 <span style="color: #b22222;"># </span><span style="color: #b22222;">open two R scripts for editing</span>
file.edit(<span style="color: #8b2252;">"script1.R"</span>, <span style="color: #8b2252;">"script2.R"</span>)       
</pre>
</div>
</div>
</div>
<div id="orga42a6d2" class="outline-5">
<h5 id="orga42a6d2"><span class="section-number-5">12.1.36.23</span> select.list</h5>
<div class="outline-text-5" id="text-12-1-36-23">
<p>
Select item(s) from a character vector.
</p>
<div class="org-src-container">
<pre class="src src-R">select.list(sort(.packages(all.available = <span style="color: #228b22;">TRUE</span>)))
</pre>
</div>
</div>
</div>
<div id="orgca9beac" class="outline-5">
<h5 id="orgca9beac"><span class="section-number-5">12.1.36.24</span> stack/unstack</h5>
<div class="outline-text-5" id="text-12-1-36-24">
<p>
stack(打包函数) 和 tidyr 包中的 gather 函数类似，而 unstack 函数和 separate 函数类似。
</p>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #008b8b;">require</span>(stats)
<span style="color: #008b8b;">require</span>(datasets)
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Loading required package: datasets</span>
formula(PlantGrowth)         <span style="color: #b22222;"># </span><span style="color: #b22222;">check the default formula</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; weight ~ group</span>
pg <span style="color: #008b8b;">&lt;-</span> unstack(PlantGrowth)   <span style="color: #b22222;"># </span><span style="color: #b22222;">unstack according to this formula</span>
pg <span style="color: #008b8b;">%&gt;%</span> head()
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   ctrl trt1 trt2</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1 4.17 4.81 6.31</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2 5.58 4.17 5.12</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3 5.18 4.41 5.54</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 4 6.11 3.59 5.50</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 5 4.50 5.87 5.37</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 6 4.61 3.83 5.29</span>
stack(pg) <span style="color: #008b8b;">%&gt;%</span> head()
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   values  ind</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1   4.17 ctrl</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2   5.58 ctrl</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3   5.18 ctrl</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 4   6.11 ctrl</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 5   4.50 ctrl</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 6   4.61 ctrl  </span>
</pre>
</div>
</div>
</div>
<div id="org8288ccc" class="outline-5">
<h5 id="org8288ccc"><span class="section-number-5">12.1.36.25</span> fix</h5>
<div class="outline-text-5" id="text-12-1-36-25">
<p>
Fix an Object.fix invokes edit on x and then assigns the new (edited) version of x in the user's workspace.
</p>
<div class="org-src-container">
<pre class="src src-R">fix(my.fun)
my.fun <span style="color: #008b8b;">%&gt;%</span>
    fix
</pre>
</div>
</div>
</div>
</div>
<div id="orgb322325" class="outline-4">
<h4 id="orgb322325"><span class="section-number-4">12.1.37</span> data.matrix</h4>
<div class="outline-text-4" id="text-12-1-37">
<p>
可以将 data.frame 转化为 matrix,注意 matrix 中字符串也要转化为数字型。
</p>
<div class="org-src-container">
<pre class="src src-R">DF <span style="color: #008b8b;">&lt;-</span> data.frame(
    a = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>, b = letters[<span style="color: #008b8b;">10</span>:<span style="color: #008b8b;">12</span>],
    c = seq(as.Date(<span style="color: #8b2252;">"2004-01-01"</span>), by = <span style="color: #8b2252;">"week"</span>, len = <span style="color: #008b8b;">3</span>),
    stringsAsFactors = <span style="color: #228b22;">TRUE</span>
)
DF
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   a b          c</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1 1 j 2004-01-01</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2 2 k 2004-01-08</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3 3 l 2004-01-15</span>
data.matrix(DF[<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">2</span>])
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;      a b</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1,] 1 1</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [2,] 2 2</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [3,] 3 3</span>
data.matrix(DF)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;      a b     c</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1,] 1 1 12418</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [2,] 2 2 12425</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [3,] 3 3 12432      </span>
</pre>
</div>
</div>
</div>

<div id="org9320f6d" class="outline-4">
<h4 id="org9320f6d"><span class="section-number-4">12.1.38</span> get</h4>
<div class="outline-text-4" id="text-12-1-38">
<p>
Search by name for an object (get) or zero or more objects (mget).
</p>

<p>
get(x, pos = -1, envir = as.environment(pos), mode = "any",
    inherits = TRUE)
</p>

<p>
mget(x, envir = as.environment(-1), mode = "any", ifnotfound,
     inherits = FALSE)
</p>

<p>
dynGet(x, ifnotfound = , minframe = 1L, inherits = FALSE)
Arguments
x	
For get, an object name (given as a character string).
For mget, a character vector of object names.
</p>

<p>
pos, envir	
where to look for the object (see ‘Details’); if omitted search as if the name of the object appeared unquoted in an expression.
</p>

<p>
mode	
the mode or type of object sought: see the ‘Details’ section.
</p>

<p>
inherits	
should the enclosing frames of the environment be searched?
</p>

<p>
ifnotfound	
For mget, a list of values to be used if the item is not found: it will be coerced to a list if necessary.
For dynGet any R object, e.g., a call to stop().
</p>

<p>
minframe	integer specifying the minimal frame number to look into.
</p>

<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">1</span>
typeof(ls())
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "character"</span>
typeof(get(<span style="color: #8b2252;">"x"</span>))
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "double"</span>
</pre>
</div>

<p>
get 函数取数确实好用
</p>
<div class="org-src-container">
<pre class="src src-R">data(mtcars)
get(<span style="color: #8b2252;">"mtcars"</span>)[[<span style="color: #8b2252;">"mpg"</span>]]
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [1] 21.0 21.0 22.8 21.4 18.7 18.1 14.3 24.4 22.8 19.2 17.8 16.4 17.3 15.2</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [15] 10.4 10.4 14.7 32.4 30.4 33.9 21.5 15.5 15.2 13.3 19.2 27.3 26.0 30.4</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [29] 15.8 19.7 15.0 21.4      </span>
</pre>
</div>
</div>
</div>
<div id="orgfe5c1eb" class="outline-4">
<h4 id="orgfe5c1eb"><span class="section-number-4">12.1.39</span> cut</h4>
<div class="outline-text-4" id="text-12-1-39">
<p>
Convert Numeric to Factor.cut divides the range of x into intervals and codes the values in x according to which interval they fall. The leftmost interval corresponds to level one, the next leftmost to level two and so on.
</p>

<div class="org-src-container">
<pre class="src src-R">Z <span style="color: #008b8b;">&lt;-</span> stats::rnorm(<span style="color: #008b8b;">10000</span>)
table(cut(Z, breaks = -<span style="color: #008b8b;">6</span>:<span style="color: #008b8b;">6</span>))
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; (-6,-5] (-5,-4] (-4,-3] (-3,-2] (-2,-1]  (-1,0]   (0,1]   (1,2]   (2,3] </span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;       0       0       9     198    1357    3495    3421    1284     224 </span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   (3,4]   (4,5]   (5,6] </span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;      12       0       0</span>
</pre>
</div>
</div>
</div>

<div id="orgf21e381" class="outline-4">
<h4 id="orgf21e381"><span class="section-number-4">12.1.40</span> stop</h4>
<div class="outline-text-4" id="text-12-1-40">
<div class="org-src-container">
<pre class="src src-R"><span style="color: #0000ff;">my_sqrt</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>(x){
    <span style="color: #a020f0;">if</span> (x&lt;<span style="color: #008b8b;">0</span>) {
        <span style="color: #a020f0;">stop</span>(<span style="color: #8b2252;">"x must be positive!"</span>)
    }<span style="color: #a020f0;">else</span>{
        sqrt(x)
    }
}

my_sqrt(-<span style="color: #008b8b;">1</span>)

<span style="color: #0000ff;">my_sqrt</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>(x){
    <span style="color: #a020f0;">if</span> (x&lt;<span style="color: #008b8b;">0</span>) {
        rlang::abort(message = <span style="color: #8b2252;">"x must be positive!"</span>,
                     .subclass = <span style="color: #8b2252;">"my_sqrt_error"</span>,
                     x=x)
    }<span style="color: #a020f0;">else</span>{
        sqrt(x)
    }
}
my_sqrt(-<span style="color: #008b8b;">1</span>)      
</pre>
</div>
</div>
</div>

<div id="org2fb5032" class="outline-4">
<h4 id="org2fb5032"><span class="section-number-4">12.1.41</span> data.class</h4>
<div class="outline-text-4" id="text-12-1-41">
<p>
Determine the class of an arbitrary R object.
</p>
<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> LETTERS
x
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [1] "A" "B" "C" "D" "E" "F" "G" "H" "I" "J" "K" "L" "M" "N" "O" "P" "Q"</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [18] "R" "S" "T" "U" "V" "W" "X" "Y" "Z"</span>
data.class(factor(x))
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "factor"</span>
data.class(matrix(x, ncol = <span style="color: #008b8b;">13</span>))
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "matrix"      </span>
</pre>
</div>
</div>
</div>

<div id="orge6d23e2" class="outline-4">
<h4 id="orge6d23e2"><span class="section-number-4">12.1.42</span> substitute</h4>
<div class="outline-text-4" id="text-12-1-42">
<p>
substitute returns the parse tree for the (unevaluated) expression expr, substituting any variables bound in env.
这个 substitute 其实就是 rlang 包里的 expr,顾名思义其实就是 expression,其 typeof 是 language.
这个操作经常和 eval 放在一起使用。下面的例子说明%&gt;% 不是万能的！！
</p>
<div class="org-src-container">
<pre class="src src-R">substitute(b <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">1</span>) <span style="color: #008b8b;">%&gt;%</span> eval()
b
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Error in eval(expr, envir, enclos): &#25214;&#19981;&#21040;&#23545;&#35937;'b'</span>
eval(substitute(b <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">1</span>))
b
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 1</span>

expr(e <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">1</span>) <span style="color: #008b8b;">%&gt;%</span> eval_tidy()
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 1</span>
e
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Error in eval(expr, envir, enclos): &#25214;&#19981;&#21040;&#23545;&#35937;'e'</span>
eval(expr(e <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">1</span>))
e
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 1</span>
</pre>
</div>
</div>
</div>
<div id="orgaca2e9c" class="outline-4">
<h4 id="orgaca2e9c"><span class="section-number-4">12.1.43</span> deparse</h4>
<div class="outline-text-4" id="text-12-1-43">
<p>
Turn unevaluated expressions into character strings.
</p>
<div class="org-src-container">
<pre class="src src-R">args(lm) <span style="color: #008b8b;">%&gt;%</span> typeof()
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "closure"</span>
deparse(args(lm))
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "function (formula, data, subset, weights, na.action, method = \"qr\", " </span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [2] "    model = TRUE, x = FALSE, y = FALSE, qr = TRUE, singular.ok = TRUE, "</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [3] "    contrasts = NULL, offset, ...) "                                    </span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [4] "NULL"      </span>
</pre>
</div>
</div>
</div>
</div>

<div id="orgae2e4da" class="outline-3">
<h3 id="orgae2e4da"><span class="section-number-3">12.2</span> dplyr</h3>
<div class="outline-text-3" id="text-12-2">
<p>
这个包主要包括 5 个核心函数，分别是:
</p>
</div>
<div id="orgefac555" class="outline-4">
<h4 id="orgefac555"><span class="section-number-4">12.2.1</span> filter</h4>
<div class="outline-text-4" id="text-12-2-1">
<p>
filter:按值筛选观测（相当于 sql 中的 select），filter 选择行，而 select 选择列，也就是特征。参数中 .preserve=T 表示保持当前的分组结果，所以这个参数一般和 group<sub>trim</sub> 和 group<sub>keys</sub>() 配合使用，一般默认的是 false,具体例子可以考虑下面的例子。
filter(data,var=所限定的条件)
</p>
<div class="org-src-container">
<pre class="src src-R">  <span style="color: #008b8b;">library</span>(nycflights13)
  <span style="color: #008b8b;">library</span>(tidyverse)
  filter(flights, month == <span style="color: #008b8b;">1</span>, day == <span style="color: #008b8b;">1</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#23558;&#19968;&#26376;&#19968;&#21495;&#30340;&#33322;&#29677;&#25361;&#20986;&#26469;</span>
  filter(flights, month == <span style="color: #008b8b;">1</span> &amp; day == <span style="color: #008b8b;">1</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">&amp;&#26159;&#8220;&#19982;&#8221;</span>
  filter(flights, month == <span style="color: #008b8b;">11</span> | month == <span style="color: #008b8b;">12</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">|&#26159;&#8220;&#25110;&#8221;</span>
  filter(flights, month == <span style="color: #008b8b;">11</span> | <span style="color: #008b8b;">12</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#36825;&#37324;&#31243;&#24207;&#20250;&#20808;&#21028;&#26029; 11|12 &#30340;&#20540;&#20026; TRUE&#65292;&#20063;&#23601;&#26159; 1&#65292;&#25152;&#20197;&#31243;&#24207;&#20854;&#23454;&#20026; filter(flights, month == 1)</span>
  filter(flights, month <span style="color: #008b8b;">%in%</span> c(<span style="color: #008b8b;">11</span>, <span style="color: #008b8b;">12</span>)) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#36825;&#20010;&#32467;&#26524;&#31561;&#20215;&#20110; filter(flights, month == 11 | month == 12)</span>
<span style="color: #b22222;">##</span><span style="color: #b22222;">&#21152;&#19978;.preserve &#30340;&#22909;&#22788;&#22312;&#20110;&#21487;&#20197;&#20445;&#30041;group_keys.</span>
iris <span style="color: #008b8b;">%&gt;%</span>
      group_by(Species) <span style="color: #008b8b;">%&gt;%</span>
    filter(Species == <span style="color: #8b2252;">"setosa"</span>, .preserve = <span style="color: #228b22;">TRUE</span>) <span style="color: #008b8b;">%&gt;%</span>
    group_keys()

  <span style="color: #b22222;">## </span><span style="color: #b22222;">Species   </span>
<span style="color: #b22222;">##   </span><span style="color: #b22222;">&lt;fct&gt;     </span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">1 setosa    </span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">2 versicolor</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">3 virginica </span>

  iris <span style="color: #008b8b;">%&gt;%</span>
      group_by(Species) <span style="color: #008b8b;">%&gt;%</span>
      filter(Species == <span style="color: #8b2252;">"setosa"</span>) <span style="color: #008b8b;">%&gt;%</span>
      group_keys()
  <span style="color: #b22222;">## </span><span style="color: #b22222;">Species</span>
  <span style="color: #b22222;">## </span><span style="color: #b22222;">&lt;fct&gt;  </span>
  <span style="color: #b22222;">##      </span><span style="color: #b22222;">1 setosa </span>
</pre>
</div>
</div>

<div id="orgc88a28d" class="outline-5">
<h5 id="orgc88a28d"><span class="section-number-5">12.2.1.1</span> filter<sub>all</sub></h5>
<div class="outline-text-5" id="text-12-2-1-1">
<p>
配合 all<sub>vars</sub> 和 any<sub>vars</sub> 一起用。
</p>
<div class="org-src-container">
<pre class="src src-R">filter_all(mtcars, all_vars(. &gt; <span style="color: #008b8b;">1</span>))
filter_all(mtcars, any_vars(. &gt; <span style="color: #008b8b;">1</span>))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-R">enframe(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">10</span>) <span style="color: #008b8b;">%&gt;%</span>
    add_row(name = -<span style="color: #008b8b;">4</span>, value = <span style="color: #008b8b;">6</span>) <span style="color: #008b8b;">%&gt;%</span>
    filter_all(all_vars(. &gt; <span style="color: #008b8b;">5</span>))
                                     <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; # A tibble: 5 x 2</span>
                                     <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;    name value</span>
                                     <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   &lt;dbl&gt; &lt;dbl&gt;</span>
                                     <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1     6     6</span>
                                     <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2     7     7</span>
                                     <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3     8     8</span>
                                     <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 4     9     9</span>
                                     <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 5    10    10</span>

enframe(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">10</span>) <span style="color: #008b8b;">%&gt;%</span>
    add_row(name = -<span style="color: #008b8b;">4</span>, value = <span style="color: #008b8b;">6</span>) <span style="color: #008b8b;">%&gt;%</span>
    filter_all(any_vars(. &gt; <span style="color: #008b8b;">5</span>))
                                     <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; # A tibble: 6 x 2</span>
                                     <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;    name value</span>
                                     <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   &lt;dbl&gt; &lt;dbl&gt;</span>
                                     <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1     6     6</span>
                                     <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2     7     7</span>
                                     <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3     8     8</span>
                                     <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 4     9     9</span>
                                     <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 5    10    10</span>
                                     <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 6    -4     6   </span>
</pre>
</div>

<p>
这么看起来，any<sub>vars</sub> 要求更高！
</p>
</div>
</div>

<div id="orgf5c4a0b" class="outline-5">
<h5 id="orgf5c4a0b"><span class="section-number-5">12.2.1.2</span> filter<sub>at</sub></h5>
<div class="outline-text-5" id="text-12-2-1-2">
<p>
对确定的变量进行筛选。
</p>

<div class="org-src-container">
<pre class="src src-R">filter_at(mtcars, vars(starts_with(<span style="color: #8b2252;">"d"</span>)), any_vars((. %% <span style="color: #008b8b;">2</span>) == <span style="color: #008b8b;">0</span>))
</pre>
</div>
</div>
</div>

<div id="org4939145" class="outline-5">
<h5 id="org4939145"><span class="section-number-5">12.2.1.3</span> filter<sub>if</sub></h5>
<div class="outline-text-5" id="text-12-2-1-3">
<div class="org-src-container">
<pre class="src src-R">filter_if(mtcars, ~ all(floor(.) == .), all_vars(. != <span style="color: #008b8b;">0</span>))
</pre>
</div>
</div>
</div>
</div>

<div id="orgbdc8bb9" class="outline-4">
<h4 id="orgbdc8bb9"><span class="section-number-4">12.2.2</span> first/last/nth</h4>
<div class="outline-text-4" id="text-12-2-2">
<p>
可以对 vector 
Usage
nth(x, n, order<sub>by</sub> = NULL, default = default<sub>missing</sub>(x))
</p>

<p>
first(x, order<sub>by</sub> = NULL, default = default<sub>missing</sub>(x))
</p>

<p>
last(x, order<sub>by</sub> = NULL, default = default<sub>missing</sub>(x))
Arguments
x A vector.
</p>

<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">10</span>
y <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">10</span>:<span style="color: #008b8b;">1</span>
x <span style="color: #008b8b;">%&gt;%</span> first()
x <span style="color: #008b8b;">%&gt;%</span> nth(<span style="color: #008b8b;">5</span>)
y <span style="color: #008b8b;">%&gt;%</span> last()
nth(x, <span style="color: #008b8b;">5</span>)
</pre>
</div>
</div>
</div>

<div id="orge47a3ff" class="outline-4">
<h4 id="orge47a3ff"><span class="section-number-4">12.2.3</span> across</h4>
<div class="outline-text-4" id="text-12-2-3">
<p>
across() makes it easy to apply the same transformation to multiple columns, allowing you to use select() semantics inside in summarise() and mutate(). across() supersedes the family of "scoped variants" like summarise<sub>at</sub>(), summarise<sub>if</sub>(), and summarise<sub>all</sub>(). See vignette("colwise") for more details.
</p>

<div class="org-src-container">
<pre class="src src-R">iris <span style="color: #008b8b;">%&gt;%</span>
    group_by(Species) <span style="color: #008b8b;">%&gt;%</span>
    summarise(across(starts_with(<span style="color: #8b2252;">"Sepal"</span>), mean))
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; `summarise()` ungrouping output (override with `.groups` argument)</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; # A tibble: 3 x 3</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   Species    Sepal.Length Sepal.Width</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   &lt;fct&gt;             &lt;dbl&gt;       &lt;dbl&gt;</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1 setosa             5.01        3.43</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2 versicolor         5.94        2.77</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3 virginica          6.59        2.97</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;"># </span><span style="color: #b22222;">A purrr-style formula</span>
iris <span style="color: #008b8b;">%&gt;%</span>
    group_by(Species) <span style="color: #008b8b;">%&gt;%</span>
    summarise(across(starts_with(<span style="color: #8b2252;">"Sepal"</span>), ~mean(.x, na.rm = <span style="color: #228b22;">TRUE</span>)))
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; `summarise()` ungrouping output (override with `.groups` argument)</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; # A tibble: 3 x 3</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   Species    Sepal.Length Sepal.Width</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   &lt;fct&gt;             &lt;dbl&gt;       &lt;dbl&gt;</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1 setosa             5.01        3.43</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2 versicolor         5.94        2.77</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3 virginica          6.59        2.97  </span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-R">iris <span style="color: #008b8b;">%&gt;%</span>
    group_by(Species) <span style="color: #008b8b;">%&gt;%</span>
    summarise(across(starts_with(<span style="color: #8b2252;">"Sepal"</span>), list(mean = mean, sd = sd)))
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; `summarise()` ungrouping output (override with `.groups` argument)</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; # A tibble: 3 x 5</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   Species  Sepal.Length_me&#8230; Sepal.Length_sd Sepal.Width_mean Sepal.Width_sd</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   &lt;fct&gt;               &lt;dbl&gt;           &lt;dbl&gt;            &lt;dbl&gt;          &lt;dbl&gt;</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1 setosa               5.01           0.352             3.43          0.379</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2 versico&#8230;             5.94           0.516             2.77          0.314</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3 virgini&#8230;             6.59           0.636             2.97          0.322  </span>
</pre>
</div>
</div>
</div>

<div id="org7782330" class="outline-4">
<h4 id="org7782330"><span class="section-number-4">12.2.4</span> c<sub>cross</sub></h4>
<div class="outline-text-4" id="text-12-2-4">
<p>
c<sub>across</sub>() is designed to work with rowwise() to make it easy to perform row-wise aggregations. It has two differences from c().
</p>
<div class="org-src-container">
<pre class="src src-R">df <span style="color: #008b8b;">&lt;-</span> tibble(id = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">4</span>, w = runif(<span style="color: #008b8b;">4</span>), x = runif(<span style="color: #008b8b;">4</span>), y = runif(<span style="color: #008b8b;">4</span>), z = runif(<span style="color: #008b8b;">4</span>))
df
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; # A tibble: 4 x 5</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;      id      w     x     y     z</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   &lt;int&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1     1 0.0846 0.369 0.151 0.636</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2     2 0.928  0.916 0.317 0.856</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3     3 0.926  0.960 0.389 0.264</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 4     4 0.413  0.241 0.978 0.557</span>
df <span style="color: #008b8b;">%&gt;%</span>
    rowwise() <span style="color: #008b8b;">%&gt;%</span>
    mutate(
        sum = sum(c_across(w:z)),
        sd = sd(c_across(w:z))
    )
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; # A tibble: 4 x 7</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; # Rowwise: </span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;      id      w     x     y     z   sum    sd</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   &lt;int&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1     1 0.0846 0.369 0.151 0.636  1.24 0.249</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2     2 0.928  0.916 0.317 0.856  3.02 0.294</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3     3 0.926  0.960 0.389 0.264  2.54 0.360</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 4     4 0.413  0.241 0.978 0.557  2.19 0.315  </span>
</pre>
</div>
</div>
</div>

<div id="org79ad1d6" class="outline-4">
<h4 id="org79ad1d6"><span class="section-number-4">12.2.5</span> arrange</h4>
<div class="outline-text-4" id="text-12-2-5">
<p>
arrange(data, var1, var2, ……) #优先按照 var1 升序排列，其次是 var2,接着&#x2026;.
</p>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #008b8b;">library</span>(tidyverse)
<span style="color: #008b8b;">library</span>(nycflights13)
arrange(flights, year, month, day) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25353;&#29031; year,month,day &#21319;&#24207;&#25490;&#21015;</span>
arrange(flights, desc(arr_delay)) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#23558; arr_delay &#23383;&#27573;&#25353;&#29031;&#38477;&#24207;&#25490;&#21015;</span>
flights <span style="color: #008b8b;">%&gt;%</span> group_by(month) <span style="color: #008b8b;">%&gt;%</span> summarise(arrtime = mean(dep_delay, na.rm = <span style="color: #228b22;">TRUE</span>)) <span style="color: #008b8b;">%&gt;%</span> arrange(desc(arrtime))
</pre>
</div>

<p>
知识点盲区：之前一直以为 group<sub>by</sub>() 和 arrange 一起使用是指这样，
</p>
<div class="org-src-container">
<pre class="src src-R">mtcars <span style="color: #008b8b;">%&gt;%</span>
    head() <span style="color: #008b8b;">%&gt;%</span>
    group_by(cyl) <span style="color: #008b8b;">%&gt;%</span>
    arrange(mpg)
</pre>
</div>
<p>
长成这样的，没想到其实是这样的。
</p>
<div class="org-src-container">
<pre class="src src-R">mtcars <span style="color: #008b8b;">%&gt;%</span>
    head() <span style="color: #008b8b;">%&gt;%</span>
    group_by(cyl) <span style="color: #008b8b;">%&gt;%</span>
    arrange(cyl, mpg)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; # A tibble: 6 x 11</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; # Groups:   cyl [3]</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;     mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1  22.8     4   108    93  3.85  2.32  18.6     1     1     4     1</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2  18.1     6   225   105  2.76  3.46  20.2     1     0     3     1</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3  21       6   160   110  3.9   2.62  16.5     0     1     4     4</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 4  21       6   160   110  3.9   2.88  17.0     0     1     4     4</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 5  21.4     6   258   110  3.08  3.22  19.4     1     0     3     1</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 6  18.7     8   360   175  3.15  3.44  17.0     0     0     3     2  </span>
</pre>
</div>

<p>
需要注意！
</p>

<p>
它来了，它来了，arrange<sub>if</sub>, arrange<sub>at</sub>, arrange<sub>all</sub>.
</p>

<div class="org-src-container">
<pre class="src src-R">df <span style="color: #008b8b;">&lt;-</span> as_tibble(mtcars)
arrange(df, across())
arrange(df, across(everything(), desc))  
</pre>
</div>
</div>
</div>

<div id="orgcef2716" class="outline-4">
<h4 id="orgcef2716"><span class="section-number-4">12.2.6</span> select</h4>
<div class="outline-text-4" id="text-12-2-6">
<p>
其实在 base R 的处理中，可以通过 %&gt;% .$ 的方式来选择数据。
</p>

<div class="org-src-container">
<pre class="src src-R">iris <span style="color: #008b8b;">%&gt;%</span> .$Species <span style="color: #008b8b;">%&gt;%</span> head()
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] setosa setosa setosa setosa setosa setosa</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Levels: setosa versicolor virginica  </span>
</pre>
</div>

<p>
&gt; select(data,var1,var2,&#x2026;) #从 data 中选择 var1 和 var2 等变量
</p>

<p>
select 还有一种变型，select(c("character")) 能够处理 character strings.select 命令结合其他子命令可以对数据进行多种选择，包括：
</p>

<ul class="org-ul">
<li>starts<sub>with</sub>(): Starts with a prefix.</li>
<li>ends<sub>with</sub>(): Ends with a suffix.</li>
<li>contains(): Contains a literal string.</li>
<li>matches(): Matches a regular expression.</li>
<li>num<sub>range</sub>(): Matches a numerical range like x01, x02, x03.这里有个有趣的地方就是，参数 width =2 or width=1,结果不同。</li>
<li>one<sub>of</sub>(): Matches variable names in a character vector. one<sub>of</sub> 函数特点是可以匹配到名称为准确的变量，而 select 不行。</li>
<li>everything(): Matches all variables. 调换变量名称非常有用处。</li>
<li>last<sub>col</sub>(): Select last variable, possibly with an offset.</li>
</ul>

<div class="org-src-container">
<pre class="src src-R">select(flights, time_hour, air_time, everything()) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#23558; time_hour,air_time &#20004;&#20010;&#21464;&#37327;&#25552;&#21069;</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">###</span><span style="color: #b22222;">some example--------------------------------------------</span>
iris <span style="color: #008b8b;">%&gt;%</span> select(starts_with(<span style="color: #8b2252;">"Petal"</span>))
iris <span style="color: #008b8b;">%&gt;%</span> select(ends_with(<span style="color: #8b2252;">"Width"</span>))
iris <span style="color: #008b8b;">%&gt;%</span> select(contains(<span style="color: #8b2252;">"etal"</span>)) <span style="color: #008b8b;">%&gt;%</span> head(<span style="color: #008b8b;">2</span>)
iris <span style="color: #008b8b;">%&gt;%</span> select(matches(<span style="color: #8b2252;">".t."</span>)) <span style="color: #008b8b;">%&gt;%</span> head(<span style="color: #008b8b;">2</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21547;&#26377; t</span>
flights <span style="color: #008b8b;">%&gt;%</span>
    select(matches(<span style="color: #8b2252;">"^(dep|arr)_"</span>))
iris <span style="color: #008b8b;">%&gt;%</span> select(everything()) <span style="color: #008b8b;">%&gt;%</span> head(<span style="color: #008b8b;">2</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36873;&#25321;&#25152;&#26377;&#21464;&#37327;</span>
iris <span style="color: #008b8b;">%&gt;%</span> select(last_col()) <span style="color: #008b8b;">%&gt;%</span> head(<span style="color: #008b8b;">2</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36873;&#25321;&#25152;&#26377;&#21464;&#37327;</span>
iris <span style="color: #008b8b;">%&gt;%</span> select(last_col(offset = <span style="color: #008b8b;">1</span>)) <span style="color: #008b8b;">%&gt;%</span> head(<span style="color: #008b8b;">2</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36873;&#25321;&#20498;&#25968;&#31532; 2 &#21015;&#21464;&#37327;</span>
iris <span style="color: #008b8b;">%&gt;%</span> select(one_of(c(<span style="color: #8b2252;">"Petal.Length"</span>, <span style="color: #8b2252;">"Petal.Width"</span>))) <span style="color: #008b8b;">%&gt;%</span> head(<span style="color: #008b8b;">2</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">Matches variable names in a character vector.</span>
iris <span style="color: #008b8b;">%&gt;%</span> mutate(X01=<span style="color: #008b8b;">1</span>,X02=<span style="color: #008b8b;">2</span>) <span style="color: #008b8b;">%&gt;%</span> select(num_range(<span style="color: #8b2252;">"X0"</span>,<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">2</span>))

data3 <span style="color: #008b8b;">&lt;-</span> flights
colnames(data3) <span style="color: #008b8b;">&lt;-</span> sprintf(<span style="color: #8b2252;">"x%02d"</span>, <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">19</span>)
select(data3, num_range(<span style="color: #8b2252;">"x"</span>, <span style="color: #008b8b;">8</span>:<span style="color: #008b8b;">11</span>, width = <span style="color: #008b8b;">2</span>)) 
<span style="color: #b22222;"># </span><span style="color: #b22222;">A tibble: 336,776 x 4</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">x08   x09 x10     x11</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">&lt;int&gt; &lt;dbl&gt; &lt;chr&gt; &lt;int&gt;</span>
<span style="color: #b22222;">##                        </span><span style="color: #b22222;">1   819    11 UA     1545</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">2   830    20 UA     1714</span>
select(data3, num_range(<span style="color: #8b2252;">"x"</span>, <span style="color: #008b8b;">8</span>:<span style="color: #008b8b;">11</span>, width = <span style="color: #008b8b;">1</span>))
                       <span style="color: #b22222;">##                  </span><span style="color: #b22222;">A tibble: 336,776 x 2</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">x10     x11</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">&lt;chr&gt; &lt;int&gt;</span>
<span style="color: #b22222;">##            </span><span style="color: #b22222;">1 UA     1545</span>
</pre>
</div>
</div>

<div id="orge06b93f" class="outline-5">
<h5 id="orge06b93f"><span class="section-number-5">12.2.6.1</span> select<sub>all</sub>(),select<sub>at</sub>(),select<sub>if</sub>()</h5>
<div class="outline-text-5" id="text-12-2-6-1">
<p>
select<sub>all</sub>(.tbl, .funs = list(), &#x2026;)
select<sub>at</sub>(.tbl, .vars, .funs = list(), &#x2026;)
</p>

<p>
select<sub>at</sub>(mtcars,vars(-contains("ar"),starts<sub>with</sub>("c")),toupper) 这句有些意思，首先删除变量名中有 "ar" 的变量，然后保留有 "c" 的变量名称,如果一个变量名叫“car”，那么这个变量会被保留下来。这点需要注意。
</p>

<p>
综合 select<sub>all,select</sub><sub>if,select</sub><sub>all</sub> 三个变量函数来看，都是中.vars 名称上作文章。
</p>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;"># </span><span style="color: #b22222;">Supply a renaming function:</span>
select_all(mtcars, <span style="color: #8b2252;">"toupper"</span>)
select_all(mtcars)
mtcars <span style="color: #008b8b;">%&gt;%</span> select_all(toupper) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23545;&#25152;&#26377;&#21464;&#37327;&#23383;&#27597;&#21629;&#21517;&#20840;&#37096;&#25913;&#20026;&#22823;&#20889;</span>
select_at(mtcars, vars(-everything())) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21024;&#38500;&#25152;&#26377;&#21464;&#37327;</span>
select_at(mtcars, vars(-contains(<span style="color: #8b2252;">"ar"</span>), starts_with(<span style="color: #8b2252;">"c"</span>)), toupper) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36873;&#25321;&#21024;&#38500;&#30340;&#21464;&#37327;&#65292;&#28982;&#21518;&#20316;&#30456;&#24212;&#30340;&#22788;&#29702;</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">Selection drops unselected variables:</span>
<span style="color: #0000ff;">is_whole</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>(x) all(floor(x) == x)
select_if(mtcars, is_whole, toupper) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21487;&#20197;&#25361;&#36873;&#28385;&#36275;&#26465;&#20214;&#30340;&#29305;&#24449;</span>
select_if(mtcars, is_whole) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21482;&#20445;&#30041;&#28385;&#36275;&#26465;&#20214;&#30340;&#21464;&#37327;</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #008b8b;">library</span>(tidyverse)
<span style="color: #008b8b;">library</span>(nycflights13)
select(flights, year, month, day) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20174; flights &#25968;&#25454;&#38598;&#20013;&#36873;&#25321;&#20986; year,month,day &#19977;&#20010;&#21464;&#37327;</span>
select(flights, year:day) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#36873;&#25321;&#20986;&#8220;year&#8221;&#21644;&#8220;day&#8221;&#20043;&#38388;&#30340;&#25152;&#26377;&#21015;</span>
select(flights, -(year:day)) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#36873;&#25321;&#20986;&#19981;&#22312;&#8220;year&#8221;&#21644;"day"&#20043;&#38388;&#30340;&#25152;&#26377;&#21015;</span>

flights <span style="color: #008b8b;">%&gt;%</span>
  select(ends_with(<span style="color: #8b2252;">"delay"</span>))
flights <span style="color: #008b8b;">%&gt;%</span>
  select(contains(<span style="color: #8b2252;">"dep"</span>))
flights <span style="color: #008b8b;">%&gt;%</span>
  select(matches(<span style="color: #8b2252;">"dep"</span>))
flights <span style="color: #008b8b;">%&gt;%</span>
  select(matches(<span style="color: #8b2252;">"^(dep|arr)_"</span>))

data2 <span style="color: #008b8b;">&lt;-</span> flights
colnames(data2) <span style="color: #008b8b;">&lt;-</span> sprintf(<span style="color: #8b2252;">"x%d"</span>, <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">19</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#23383;&#31526;</span>
select(data2, num_range(<span style="color: #8b2252;">"x"</span>, <span style="color: #008b8b;">8</span>:<span style="color: #008b8b;">11</span>))
select(data2, num_range(<span style="color: #8b2252;">"x"</span>, c(<span style="color: #008b8b;">9</span>, <span style="color: #008b8b;">11</span>)))

data3 <span style="color: #008b8b;">&lt;-</span> flights
colnames(data3) <span style="color: #008b8b;">&lt;-</span> sprintf(<span style="color: #8b2252;">"x%02d"</span>, <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">19</span>)
select(data3, num_range(<span style="color: #8b2252;">"x"</span>, <span style="color: #008b8b;">8</span>:<span style="color: #008b8b;">11</span>, width = <span style="color: #008b8b;">2</span>))

vars <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #8b2252;">"year"</span>, <span style="color: #8b2252;">"month"</span>, <span style="color: #8b2252;">"day"</span>)
select(flights, !!vars)
group_by_at(flights, vars(year:day)) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#22312; dplyr &#20013;&#65292;&#21464;&#20307;&#21518;&#32512;_at()&#22312;&#20182;&#20204;&#30340;&#31532;&#20108;&#20010;&#21442;&#25968;&#20013;&#25903;&#25345; select &#35821;&#20041;&#12290;&#20320;&#21482;&#38656;&#35201;&#29992; vars&#65288;&#65289;&#21253;&#35065;&#36825;&#20010;&#36873;&#25321;.</span>
</pre>
</div>
</div>
</div>
</div>

<div id="orgae38ace" class="outline-4">
<h4 id="orgae38ace"><span class="section-number-4">12.2.7</span> pull</h4>
<div class="outline-text-4" id="text-12-2-7">
<div class="org-src-container">
<pre class="src src-R">mtcars <span style="color: #008b8b;">%&gt;%</span> pull(-<span style="color: #008b8b;">1</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21487;&#20197;&#21462;&#26368;&#21518;&#19968;&#21015;&#30340;&#25968;&#20540;</span>
mtcars <span style="color: #008b8b;">%&gt;%</span> pull(<span style="color: #008b8b;">1</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21487;&#20197;&#21462;&#31532;&#19968;&#21015;&#30340;&#25968;&#20540;</span>
mtcars <span style="color: #008b8b;">%&gt;%</span> pull(cyl) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21487;&#20197;&#21462;cyl &#21464;&#37327;&#30340;&#25968;&#20540;</span>
</pre>
</div>
</div>
</div>
<div id="orgc4cccbe" class="outline-4">
<h4 id="orgc4cccbe"><span class="section-number-4">12.2.8</span> group<sub>by</sub></h4>
<div class="outline-text-4" id="text-12-2-8">
<p>
这里有个参数比较重要，.drop=FALSE，就是将 group 内没有的观测显示出来，而默认的是不显示。可以用 group<sub>by</sub><sub>drop</sub><sub>default</sub>() 显示是否将没有的观测扔掉。You can group
by expressions: this is just short-hand for a mutate/rename followed by a simple
group<sub>by</sub> mtcars %&gt;% group<sub>by</sub>(vsam = vs + am). Use add = TRUE to instead append.
</p>

<p>
by<sub>cyl</sub> %&gt;%
       group<sub>by</sub>(vs, am, add = TRUE) %&gt;%
       group<sub>vars</sub>()
</p>

<p>
下面这个例子可以更好地说明这个问题。
</p>

<div class="org-src-container">
<pre class="src src-R">mtcars <span style="color: #008b8b;">%&gt;%</span> 
  group_by(cyl) <span style="color: #008b8b;">%&gt;%</span> 
  group_by(hp) <span style="color: #008b8b;">%&gt;%</span> 
  head()
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; # A tibble: 6 x 11</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; # Groups:   hp [4]</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;     mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1  21       6   160   110  3.9   2.62  16.5     0     1     4     4</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2  21       6   160   110  3.9   2.88  17.0     0     1     4     4</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3  22.8     4   108    93  3.85  2.32  18.6     1     1     4     1</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 4  21.4     6   258   110  3.08  3.22  19.4     1     0     3     1</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 5  18.7     8   360   175  3.15  3.44  17.0     0     0     3     2</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 6  18.1     6   225   105  2.76  3.46  20.2     1     0     3     1</span>

  mtcars <span style="color: #008b8b;">%&gt;%</span> 
  group_by(cyl) <span style="color: #008b8b;">%&gt;%</span> 
  group_by(hp,add = T) <span style="color: #008b8b;">%&gt;%</span> 
  head()
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; # A tibble: 6 x 11</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; # Groups:   cyl, hp [4]</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;     mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1  21       6   160   110  3.9   2.62  16.5     0     1     4     4</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2  21       6   160   110  3.9   2.88  17.0     0     1     4     4</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3  22.8     4   108    93  3.85  2.32  18.6     1     1     4     1</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 4  21.4     6   258   110  3.08  3.22  19.4     1     0     3     1</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 5  18.7     8   360   175  3.15  3.44  17.0     0     0     3     2</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 6  18.1     6   225   105  2.76  3.46  20.2     1     0     3     1  </span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-R">  <span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
  daily <span style="color: #008b8b;">&lt;-</span> flights <span style="color: #008b8b;">%&gt;%</span> group_by(year, month, day)
head()
  data= data.frame(date=c(<span style="color: #8b2252;">"20190102"</span>,<span style="color: #8b2252;">"20190102"</span>,<span style="color: #8b2252;">"20190102"</span>,<span style="color: #8b2252;">"20190103"</span>,<span style="color: #8b2252;">"20190104"</span>,<span style="color: #8b2252;">"20190105"</span>),value=c(<span style="color: #008b8b;">1</span>,<span style="color: #008b8b;">2</span>,<span style="color: #008b8b;">1</span>,<span style="color: #008b8b;">2</span>,<span style="color: #008b8b;">3</span>,<span style="color: #008b8b;">4</span>))
  data=data <span style="color: #008b8b;">%&gt;%</span> mutate(date=as.character(date))
  data <span style="color: #008b8b;">%&gt;%</span> group_by(date) <span style="color: #008b8b;">%&gt;%</span> arrange(desc(value)) <span style="color: #008b8b;">%&gt;%</span> filter(row_number() == <span style="color: #008b8b;">1</span>)
  typeof(data$date)
  mtcars <span style="color: #008b8b;">%&gt;%</span>
      group_by(vsam = vs+am) <span style="color: #008b8b;">%&gt;%</span>
      tally
  by_cyl <span style="color: #008b8b;">&lt;-</span> mtcars <span style="color: #008b8b;">%&gt;%</span>
      group_by(cyl)
  by_cyl <span style="color: #008b8b;">%&gt;%</span>
      group_by(vs,am) <span style="color: #008b8b;">%&gt;%</span>
      group_vars()
</pre>
</div>

<p>
group<sub>by</sub> 函数里面有一个参数 .drop, 如果是 .drop=FALSE 那么意味着可以显示没有的观测水平的变量，否则就不显示了，具体例子如下。
</p>
<div class="org-src-container">
<pre class="src src-R">iris$Species = factor(iris$Species, levels=c(levels(iris$Species), <span style="color: #8b2252;">"empty_level"</span>))
                                      <span style="color: #b22222;"># </span><span style="color: #b22222;">Species is a factor and empty groups are included in the output</span>
iris <span style="color: #008b8b;">%&gt;%</span> group_by(Species, .drop=<span style="color: #228b22;">FALSE</span>) <span style="color: #008b8b;">%&gt;%</span> tally
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   Species         n</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1 setosa         50</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2 versicolor     50</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3 virginica      50</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 4 empty_level     0</span>

                                      <span style="color: #b22222;"># </span><span style="color: #b22222;">Add character column</span>
iris$group2 = c(rep(c(<span style="color: #8b2252;">"A"</span>,<span style="color: #8b2252;">"B"</span>), <span style="color: #008b8b;">50</span>), rep(c(<span style="color: #8b2252;">"B"</span>,<span style="color: #8b2252;">"C"</span>), each=<span style="color: #008b8b;">25</span>))
                                      <span style="color: #b22222;"># </span><span style="color: #b22222;">Empty groups involving combinations of Species and group2 are not included in output</span>
iris <span style="color: #008b8b;">%&gt;%</span> group_by(Species, group2, .drop=<span style="color: #228b22;">FALSE</span>) <span style="color: #008b8b;">%&gt;%</span> tally <span style="color: #008b8b;">%&gt;%</span> group_by_drop_default()
</pre>
</div>
</div>

<div id="org76baf5f" class="outline-5">
<h5 id="org76baf5f"><span class="section-number-5">12.2.8.1</span> group<sub>by</sub><sub>all,group</sub><sub>by</sub><sub>at,group</sub><sub>by</sub><sub>if</sub></h5>
<div class="outline-text-5" id="text-12-2-8-1">
<p>
group<sub>by</sub><sub>all,group</sub><sub>by</sub><sub>if,group</sub><sub>by</sub><sub>at</sub> 这 3 个函数等价于 group()+mutate(),比如 iris %&gt;% group<sub>by</sub><sub>all</sub>(is.factor) = iris %&gt;% group<sub>by</sub>(everything) %&gt;% mutate(everything()=is.factor()).
group<sub>by</sub><sub>if</sub>(is.factor,as.character) 等价于 iris %&gt;% group<sub>by</sub>() %&gt;% mutate(as.char(is.factor)) 
</p>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;"># </span><span style="color: #b22222;">Group a data frame by all variables:</span>
group_by_all(mtcars)
<span style="color: #b22222;"># </span><span style="color: #b22222;">Group by variables selected with a predicate:</span>
group_by_if(iris, is.factor) <span style="color: #b22222;">#</span><span style="color: #b22222;">factor</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">Group by variables selected by name:</span>
group_by_at(mtcars, vars(vs, am))
<span style="color: #b22222;"># </span><span style="color: #b22222;">Like group_by(), the scoped variants have optional mutate</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">semantics. This provide a shortcut for group_by() + mutate():</span>
d <span style="color: #008b8b;">&lt;-</span> tibble(x=c(<span style="color: #008b8b;">1</span>,<span style="color: #008b8b;">1</span>,<span style="color: #008b8b;">2</span>,<span style="color: #008b8b;">2</span>), y=c(<span style="color: #008b8b;">1</span>,<span style="color: #008b8b;">2</span>,<span style="color: #008b8b;">1</span>,<span style="color: #008b8b;">2</span>))
group_by_all(d, as.factor)
group_by_if(iris, is.factor, as.character)
data <span style="color: #008b8b;">&lt;-</span> data.frame(id=c(<span style="color: #008b8b;">1</span>,<span style="color: #008b8b;">1</span>,<span style="color: #008b8b;">3</span>,<span style="color: #008b8b;">2</span>,<span style="color: #008b8b;">3</span>),abx=c(<span style="color: #008b8b;">1</span>,<span style="color: #008b8b;">2</span>,<span style="color: #008b8b;">1</span>,<span style="color: #008b8b;">2</span>,<span style="color: #008b8b;">3</span>))
data <span style="color: #008b8b;">%&gt;%</span> 
    group_by_at(vars(-contains(<span style="color: #8b2252;">"b"</span>))) <span style="color: #008b8b;">%&gt;%</span> 
    tally()
</pre>
</div>

<p>
dplyr will have a specialized group<sub>by</sub> function group<sub>by</sub><sub>at</sub> to deal with multiple grouping variables. It would be much easier to use the new member of the _at family:
group<sub>by</sub><sub>at</sub> 命令可以接受 character 型变量。
</p>

<div class="org-src-container">
<pre class="src src-R">cols <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #8b2252;">"am"</span>, <span style="color: #8b2252;">"gear"</span>)
mtcars <span style="color: #008b8b;">%&gt;%</span>
    group_by_at(.vars = cols) <span style="color: #008b8b;">%&gt;%</span>
    summarise(mean_cyl = mean(cyl))
                                    <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; # A tibble: 4 x 3</span>
                                    <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; # Groups:   am [2]</span>
                                    <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;      am  gear mean_cyl</span>
                                    <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;</span>
                                    <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1     0     3     7.47</span>
                                    <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2     0     4     5   </span>
                                    <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3     1     4     4.5 </span>
                                    <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 4     1     5     6    </span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-R">group_by_at(mtcars, vars(vs, am))
                                    <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; # A tibble: 32 x 11</span>
                                    <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; # Groups:   vs, am [4]</span>
                                    <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;      mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb</span>
                                    <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  * &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span>
                                    <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  1  21       6  160    110  3.9   2.62  16.5     0     1     4     4</span>
                                    <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  2  21       6  160    110  3.9   2.88  17.0     0     1     4     4</span>
                                    <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  3  22.8     4  108     93  3.85  2.32  18.6     1     1     4     1</span>
                                    <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  4  21.4     6  258    110  3.08  3.22  19.4     1     0     3     1</span>
                                    <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  5  18.7     8  360    175  3.15  3.44  17.0     0     0     3     2</span>
                                    <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  6  18.1     6  225    105  2.76  3.46  20.2     1     0     3     1</span>
                                    <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  7  14.3     8  360    245  3.21  3.57  15.8     0     0     3     4</span>
                                    <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  8  24.4     4  147.    62  3.69  3.19  20       1     0     4     2</span>
                                    <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  9  22.8     4  141.    95  3.92  3.15  22.9     1     0     4     2</span>
                                    <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 10  19.2     6  168.   123  3.92  3.44  18.3     1     0     4     4 </span>
</pre>
</div>
</div>
</div>

<div id="org224bd33" class="outline-5">
<h5 id="org224bd33"><span class="section-number-5">12.2.8.2</span> group<sub>cols,group</sub><sub>rows</sub></h5>
<div class="outline-text-5" id="text-12-2-8-2">
<p>
该函数可以显示成组的变量名字 
</p>

<div class="org-src-container">
<pre class="src src-R">    <span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
    gdf <span style="color: #008b8b;">&lt;-</span> iris <span style="color: #008b8b;">%&gt;%</span> group_by(Species) <span style="color: #008b8b;">%&gt;%</span> select(group_cols())
gdf
</pre>
</div>

<p>
group<sub>rows</sub>() just returns the list of indices.
</p>

<p>
这个 group<sub>rows</sub> 很像 group<sub>data,不同的是</sub> group<sub>data</sub> 可以生成一个带有 group 变量的 tibble.
</p>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
xiaomi_id <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #8b2252;">"1"</span>,<span style="color: #8b2252;">"2"</span>,<span style="color: #8b2252;">"3"</span>,<span style="color: #8b2252;">"1"</span>)
credit_time <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #8b2252;">"20190101"</span>,<span style="color: #8b2252;">"20190201"</span>,<span style="color: #8b2252;">"20190401"</span>,<span style="color: #8b2252;">"20190101"</span>)
x1 <span style="color: #008b8b;">&lt;-</span> seq(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">4</span>)
df1 <span style="color: #008b8b;">&lt;-</span> tibble(xiaomi_id,credit_time,x1)
                                    <span style="color: #b22222;">#</span><span style="color: #b22222;">df1 %&gt;% mutate(dplyr::row_number(xiaomi_id</span>
df1 <span style="color: #008b8b;">%&gt;%</span> 
    group_by(xiaomi_id) <span style="color: #008b8b;">%&gt;%</span> 
    group_rows()
                                    <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[1]]</span>
                                    <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 1 4</span>
                                    <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                    <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[2]]</span>
                                    <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 2</span>
                                    <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                    <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[3]]</span>
                                    <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 3</span>
</pre>
</div>
</div>
</div>

<div id="org50c713a" class="outline-5">
<h5 id="org50c713a"><span class="section-number-5">12.2.8.3</span> group<sub>data</sub>()</h5>
<div class="outline-text-5" id="text-12-2-8-3">
<p>
group<sub>data</sub>() return a tibble with one row per group. 
</p>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
df <span style="color: #008b8b;">&lt;-</span> tibble(x = c(<span style="color: #008b8b;">1</span>,<span style="color: #008b8b;">1</span>,<span style="color: #008b8b;">2</span>,<span style="color: #008b8b;">2</span>))
                                      <span style="color: #b22222;"># </span><span style="color: #b22222;">one row</span>
group_data(df)
</pre>
</div>
</div>
</div>

<div id="org92a135d" class="outline-5">
<h5 id="org92a135d"><span class="section-number-5">12.2.8.4</span> group<sub>split</sub></h5>
<div class="outline-text-5" id="text-12-2-8-4">
<p>
group<sub>split</sub>() works like base::split() but it uses the grouping structure from
group<sub>by</sub>() and therefore is subject to the data mask.
</p>

<p>
这个函数和 split() 类似，和 split 一致的是，同样生成的是 list 型，但是不同的是
group<sub>split</sub> 生成的是纯粹的 list 型数据。
</p>

<div class="org-src-container">
<pre class="src src-R">  <span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
ir <span style="color: #008b8b;">&lt;-</span> iris <span style="color: #008b8b;">%&gt;%</span>
  group_by(Species)
group_split(ir)

  iris <span style="color: #008b8b;">%&gt;%</span> split(.$Species) <span style="color: #008b8b;">%&gt;%</span>
     head 
</pre>
</div>

<p>
You can specify the grouping in group<sub>split</sub>() instead, and if you want to drop the grouping variables, set keep = FALSE.
</p>

<div class="org-src-container">
<pre class="src src-R">  releases_70s <span style="color: #008b8b;">&lt;-</span> tribble(
  ~band, ~album, ~us_chart_peak,
  <span style="color: #8b2252;">"Talking Heads"</span>, <span style="color: #8b2252;">"Talking Heads: 77"</span>, <span style="color: #008b8b;">97</span>,
  <span style="color: #8b2252;">"Talking Heads"</span>, <span style="color: #8b2252;">"Fear of Music"</span>, <span style="color: #008b8b;">21</span>,
  <span style="color: #8b2252;">"Talking Heads"</span>, <span style="color: #8b2252;">"More Songs About Buildings and Food"</span>, <span style="color: #008b8b;">29</span>,
  <span style="color: #8b2252;">"Devo"</span>, <span style="color: #8b2252;">"Q: Are We Not Men? A: We Are Devo!"</span>, <span style="color: #008b8b;">78</span>,
  <span style="color: #8b2252;">"Devo"</span>, <span style="color: #8b2252;">"Duty Now for the Future"</span>, <span style="color: #008b8b;">73</span>
)
releases_70s <span style="color: #008b8b;">%&gt;%</span>
  group_split(band, keep = <span style="color: #228b22;">FALSE</span>)
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[1]]</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; # A tibble: 2 x 2</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   album                              us_chart_peak</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   &lt;chr&gt;                                      &lt;dbl&gt;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1 Q: Are We Not Men? A: We Are Devo!            78</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2 Duty Now for the Future                       73</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[2]]</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; # A tibble: 3 x 2</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   album                               us_chart_peak</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   &lt;chr&gt;                                       &lt;dbl&gt;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1 Talking Heads: 77                              97</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2 Fear of Music                                  21</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3 More Songs About Buildings and Food            29</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; attr(,"ptype")</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; # A tibble: 0 x 2</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; # &#8230; with 2 variables: album &lt;chr&gt;, us_chart_peak &lt;dbl&gt;  </span>
</pre>
</div>
</div>
</div>

<div id="org11a8c4d" class="outline-5">
<h5 id="org11a8c4d"><span class="section-number-5">12.2.8.5</span> group<sub>keys</sub></h5>
<div class="outline-text-5" id="text-12-2-8-5">
<p>
group<sub>keys</sub>() returns a tibble with one row per group, and one column per grouping variable.
</p>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
    ir <span style="color: #008b8b;">&lt;-</span> iris <span style="color: #008b8b;">%&gt;%</span>
        group_by(Species)
    group_keys(ir)
</pre>
</div>
</div>
</div>

<div id="org5881c0b" class="outline-5">
<h5 id="org5881c0b"><span class="section-number-5">12.2.8.6</span> group<sub>trim</sub></h5>
<div class="outline-text-5" id="text-12-2-8-6">
<p>
去除固定水平的数据，往往和 filter 相结合使用，这个函数就像一个剪刀一样。
Drop unused levels of all factors that are used as grouping variables, then recalculates the grouping structure.
</p>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
is <span style="color: #008b8b;">&lt;-</span> iris <span style="color: #008b8b;">%&gt;%</span>
      group_by(Species) <span style="color: #008b8b;">%&gt;%</span>
      filter(Species == <span style="color: #8b2252;">"setosa"</span>, .preserve = <span style="color: #228b22;">TRUE</span>) <span style="color: #008b8b;">%&gt;%</span>
      group_trim()
is <span style="color: #008b8b;">%&gt;%</span> group_keys()
</pre>
</div>
</div>
</div>

<div id="orgcea5910" class="outline-5">
<h5 id="orgcea5910"><span class="section-number-5">12.2.8.7</span> group<sub>map</sub>()</h5>
<div class="outline-text-5" id="text-12-2-8-7">
<p>
group<sub>map</sub>() returns a list of results from calling .f on each group.
运行之后就会觉得 group<sub>map</sub> 很像 lapply.
这个函数对于处理分组数据的操作很方便！
</p>
<div class="org-src-container">
<pre class="src src-R">mtcars <span style="color: #008b8b;">%&gt;%</span>
    group_by(cyl) <span style="color: #008b8b;">%&gt;%</span>
    group_map(~ head(.x, <span style="color: #008b8b;">2L</span>))
iris <span style="color: #008b8b;">%&gt;%</span>
    group_by(Species) <span style="color: #008b8b;">%&gt;%</span>
    group_map(~ quantile(.x$Petal.Length, probs = c(<span style="color: #008b8b;">0.25</span>, <span style="color: #008b8b;">0.5</span>, <span style="color: #008b8b;">0.75</span>)))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-R">enframe(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>) <span style="color: #008b8b;">%&gt;%</span> 
    add_column(group=c(<span style="color: #8b2252;">"1"</span>,<span style="color: #8b2252;">"2"</span>,<span style="color: #8b2252;">"3"</span>)) <span style="color: #008b8b;">%&gt;%</span> 
    add_row(name=<span style="color: #008b8b;">1</span>,value=<span style="color: #008b8b;">3</span>,group=<span style="color: #8b2252;">"2"</span>) <span style="color: #008b8b;">%&gt;%</span> 
    group_by(name) <span style="color: #008b8b;">%&gt;%</span> 
    dplyr::arrange(name,value) <span style="color: #008b8b;">%&gt;%</span> 
    group_map(~sort(.$group,decreasing = T))    
</pre>
</div>
</div>
</div>

<div id="orgd4c33f4" class="outline-5">
<h5 id="orgd4c33f4"><span class="section-number-5">12.2.8.8</span> group<sub>modify</sub>()</h5>
<div class="outline-text-5" id="text-12-2-8-8">
<p>
group<sub>modify</sub> 和 group<sub>map</sub> 函数非常相似，所不同的是，group<sub>modify</sub> 生成的是一个 tibble 类型的数据，而 group<sub>map</sub> 生成的是 list 型数据。group<sub>modify</sub>() returns a grouped tibble. In that case .f must return a data frame.
</p>

<div class="org-src-container">
<pre class="src src-R">mtcars <span style="color: #008b8b;">%&gt;%</span>
    group_by(cyl) <span style="color: #008b8b;">%&gt;%</span>
    group_modify(~ head(.x, <span style="color: #008b8b;">2L</span>))
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21487;&#20197;&#23545;&#27604;&#19979;</span>
mtcars <span style="color: #008b8b;">%&gt;%</span>
    group_by(cyl) <span style="color: #008b8b;">%&gt;%</span>
    head(<span style="color: #008b8b;">2</span>)
</pre>
</div>
</div>
</div>

<div id="org22d4f5e" class="outline-5">
<h5 id="org22d4f5e"><span class="section-number-5">12.2.8.9</span> group<sub>nest</sub></h5>
<div class="outline-text-5" id="text-12-2-8-9">
<p>
将数据进行压缩。
</p>
<div class="org-src-container">
<pre class="src src-R">iris <span style="color: #008b8b;">%&gt;%</span>
    group_by(Species) <span style="color: #008b8b;">%&gt;%</span>
    group_nest()
<span style="color: #b22222;">##                                     </span><span style="color: #b22222;"># A tibble: 3 x 2</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">Species    data             </span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">&lt;fct&gt;      &lt;list&gt;           </span>
<span style="color: #b22222;">##                 </span><span style="color: #b22222;">1 setosa     &lt;tibble [50 x 4]&gt;</span>
<span style="color: #b22222;">##                       </span><span style="color: #b22222;">2 versicolor &lt;tibble [50 x 4]&gt;</span>
<span style="color: #b22222;">##                             </span><span style="color: #b22222;">3 virginica  &lt;tibble [50 x 4]&gt;</span>
</pre>
</div>
</div>
</div>

<div id="orgfb1e73b" class="outline-5">
<h5 id="orgfb1e73b"><span class="section-number-5">12.2.8.10</span> group<sub>size</sub>/n<sub>groups</sub></h5>
<div class="outline-text-5" id="text-12-2-8-10">
<p>
n<sub>group</sub> returns 组数，group<sub>size</sub> 返回的是每组有多少样本量。
</p>
<div class="org-src-container">
<pre class="src src-R">data <span style="color: #008b8b;">&lt;-</span> data.frame(id=c(<span style="color: #008b8b;">1</span>,<span style="color: #008b8b;">2</span>,<span style="color: #008b8b;">3</span>,<span style="color: #008b8b;">1</span>),x=c(<span style="color: #008b8b;">2</span>,<span style="color: #008b8b;">3</span>,<span style="color: #008b8b;">4</span>,<span style="color: #008b8b;">5</span>))
data <span style="color: #008b8b;">%&gt;%</span> 
    group_by(id) <span style="color: #008b8b;">%&gt;%</span> 
    n_groups()

data <span style="color: #008b8b;">%&gt;%</span> 
    group_by(id) <span style="color: #008b8b;">%&gt;%</span> 
    group_size()  
</pre>
</div>
</div>
</div>
<div id="org184aa7e" class="outline-5">
<h5 id="org184aa7e"><span class="section-number-5">12.2.8.11</span> ungroup</h5>
<div class="outline-text-5" id="text-12-2-8-11">
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
dim(daily)
dim(daily <span style="color: #008b8b;">%&gt;%</span>
    ungroup())

daily <span style="color: #008b8b;">%&gt;%</span>
    ungroup() <span style="color: #008b8b;">%&gt;%</span> <span style="color: #b22222;"># </span><span style="color: #b22222;">&#19981;&#20877;&#25353;&#26085;&#26399;&#20998;&#32452;</span>
    summarize(flights = n()) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25152;&#26377;&#33322;&#29677;</span>
</pre>
</div>
</div>
</div>
<div id="orgf149d74" class="outline-5">
<h5 id="orgf149d74"><span class="section-number-5">12.2.8.12</span> group<sub>indices</sub></h5>
<div class="outline-text-5" id="text-12-2-8-12">
<p>
返回记录所在组 id
</p>
<div class="org-src-container">
<pre class="src src-R">mtcars <span style="color: #008b8b;">%&gt;%</span> 
    group_indices(cyl)
mtcars <span style="color: #008b8b;">%&gt;%</span> head()       
</pre>
</div>
</div>
</div>
<div id="org414c257" class="outline-5">
<h5 id="org414c257"><span class="section-number-5">12.2.8.13</span> groups/group<sub>vars</sub></h5>
<div class="outline-text-5" id="text-12-2-8-13">
<p>
返回的是分组变量的名称。
</p>
<div class="org-src-container">
<pre class="src src-R">  df <span style="color: #008b8b;">&lt;-</span> tibble(x = <span style="color: #008b8b;">1</span>, y = <span style="color: #008b8b;">2</span>) <span style="color: #008b8b;">%&gt;%</span> group_by(x,y)
  df
    groups(df) <span style="color: #b22222;">#</span><span style="color: #b22222;">list&#22411;</span>
  <span style="color: #b22222;">## </span><span style="color: #b22222;">[[1]]</span>
  <span style="color: #b22222;">## </span><span style="color: #b22222;">x</span>

  <span style="color: #b22222;">## </span><span style="color: #b22222;">[[2]]</span>
  <span style="color: #b22222;">## </span><span style="color: #b22222;">y</span>
group_vars(df)
  <span style="color: #b22222;">## </span><span style="color: #b22222;">[1] "x" "y"  </span>
</pre>
</div>
</div>
</div>
</div>
<div id="org0cd6ee3" class="outline-4">
<h4 id="org0cd6ee3"><span class="section-number-4">12.2.9</span> context</h4>
<div class="outline-text-4" id="text-12-2-9">
<p>
These functions return information about the "current" group or "current" variable, so only work inside specific contexts like summarise() and mutate().
</p>

<div class="org-src-container">
<pre class="src src-R">df <span style="color: #008b8b;">&lt;-</span> tibble(
    g = sample(rep(letters[<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>], <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>)),
    x = runif(<span style="color: #008b8b;">6</span>),
    y = runif(<span style="color: #008b8b;">6</span>)
)
gf <span style="color: #008b8b;">&lt;-</span> df <span style="color: #008b8b;">%&gt;%</span> group_by(g)
gf <span style="color: #008b8b;">%&gt;%</span> summarise(n = n())
gf <span style="color: #008b8b;">%&gt;%</span> 
    mutate(id = cur_group_id())
gf <span style="color: #008b8b;">%&gt;%</span> 
    summarise(row = cur_group_rows())

gf <span style="color: #008b8b;">%&gt;%</span> 
    summarise(data = list(cur_group())) <span style="color: #008b8b;">%&gt;%</span> 
    unnest()

gf <span style="color: #008b8b;">%&gt;%</span> 
    summarise(data = list(cur_data())) <span style="color: #008b8b;">%&gt;%</span> 
    unnest()

gf <span style="color: #008b8b;">%&gt;%</span> mutate(across(everything(), ~ paste(cur_column(), round(.x, <span style="color: #008b8b;">2</span>))))  
</pre>
</div>
</div>
</div>

<div id="org42b79a3" class="outline-4">
<h4 id="org42b79a3"><span class="section-number-4">12.2.10</span> rename</h4>
<div class="outline-text-4" id="text-12-2-10">
<p>
对变量重新命名
</p>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
rename(flights, tail_num = tailnum) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#23558;&#21464;&#37327; tailnum &#21629;&#21517;&#20026; tail_num</span>
vars <span style="color: #008b8b;">&lt;-</span> c(var1 = <span style="color: #8b2252;">"cyl"</span>, var2 =<span style="color: #8b2252;">"am"</span>)
select(mtcars, !!vars)
rename(mtcars, !!vars) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36824;&#21487;&#20197;&#36825;&#20040;&#29609;&#65374;</span>
</pre>
</div>

<p>
当然少不了三件套：rename<sub>if</sub>/rename<sub>at</sub>/rename<sub>all</sub>.
</p>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;"># </span><span style="color: #b22222;">But renaming retains them:</span>
<span style="color: #0000ff;">is_whole</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>(x) all(floor(x) == x)
rename_if(mtcars, is_whole, toupper)
rename_at(mtcars, vars(-(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>)), toupper)
rename_all(mtcars, toupper)
</pre>
</div>

<p>
需要注意的是 rename<sub>at</sub> 和 select<sub>at</sub> 都能对变量进行作 toupper,但是 select<sub>at</sub> 能够对变量进行筛选。类似的函数还有 recode 等。
</p>
</div>
</div>
<div id="org4e8046d" class="outline-4">
<h4 id="org4e8046d"><span class="section-number-4">12.2.11</span> mutate</h4>
<div class="outline-text-4" id="text-12-2-11">
<p>
mutate:使用现有变量的函数创建新变量,新变量总是放在最后
</p>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
flights_sml <span style="color: #008b8b;">&lt;-</span> select(
    flights,
    year:day,
    ends_with(<span style="color: #8b2252;">"delay"</span>),
    distance,
    air_time
)
mutate(flights_sml,
       gain = arr_delay - dep_delay,
       speed = distance / air_time * <span style="color: #008b8b;">60</span>
       )
</pre>
</div>
</div>
<div id="org6b5e013" class="outline-5">
<h5 id="org6b5e013"><span class="section-number-5">12.2.11.1</span> mutate<sub>all</sub></h5>
<div class="outline-text-5" id="text-12-2-11-1">
<p>
利用 mutate<sub>all</sub> 可以实现对所有变量进行科学计算。
</p>
<div class="org-src-container">
<pre class="src src-R">mtcars <span style="color: #008b8b;">%&gt;%</span> 
    group_by(cyl) <span style="color: #008b8b;">%&gt;%</span> 
    mutate_all(<span style="color: #000000; background-color: #ffffff;">`*`</span>,<span style="color: #008b8b;">100</span>) <span style="color: #008b8b;">%&gt;%</span> 
    head()       
</pre>
</div>
</div>
</div>
<div id="orgd570e22" class="outline-5">
<h5 id="orgd570e22"><span class="section-number-5">12.2.11.2</span> mutate<sub>if</sub></h5>
<div class="outline-text-5" id="text-12-2-11-2">
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
                                      <span style="color: #b22222;"># </span><span style="color: #b22222;">mutate_if() is particularly useful for transforming variables from</span>
                                      <span style="color: #b22222;"># </span><span style="color: #b22222;">one type to another</span>
iris_new=iris <span style="color: #008b8b;">%&gt;%</span> mutate_if(is.factor, as.character)
str(iris)
str(iris_new) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21487;&#20197;&#21457;&#29616;&#21407;&#26469; Species &#21464;&#37327;&#20026;&#22240;&#23376;&#22411;&#65292;&#32463;&#36807; mutate_if &#21518;&#21464;&#25104;&#20102; char &#22411;</span>
                                      <span style="color: #b22222;"># </span><span style="color: #b22222;">If you want to apply multiple transformations, pass a list of</span>
                                      <span style="color: #b22222;"># </span><span style="color: #b22222;">functions. When there are multiple functions, they create new</span>
                                      <span style="color: #b22222;"># </span><span style="color: #b22222;">variables instead of modifying the variables in place:</span>
iris <span style="color: #008b8b;">%&gt;%</span> mutate_if(is.numeric, list(~log(.))) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23545;&#25152;&#26377; numeric &#22411;&#30340;&#21464;&#37327;&#21462;&#23545;&#25968;</span>
</pre>
</div>
</div>
</div>

<div id="org63fc78d" class="outline-5">
<h5 id="org63fc78d"><span class="section-number-5">12.2.11.3</span> mutate<sub>at</sub>()</h5>
<div class="outline-text-5" id="text-12-2-11-3">
<p>
mutate<sub>at</sub> 真是谁用谁知道哈～ mutate<sub>at</sub> 针对固定的列作变换真是谁用谁知道。一个细节就是对列作函数变换时需要~str<sub>split</sub>(.,"<sub>X</sub>"),是点不需要加上其他操作。
</p>

<p>
对特定的列作特定的函数映射。
</p>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #0000ff;">scale2</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>(x, na.rm = <span style="color: #228b22;">FALSE</span>) (x - mean(x, na.rm = na.rm)) / sd(x, na.rm)
starwars <span style="color: #008b8b;">%&gt;%</span> mutate_at(c(<span style="color: #8b2252;">"height"</span>, <span style="color: #8b2252;">"mass"</span>), scale2)
starwars$
</pre>
</div>

<div class="org-src-container">
<pre class="src src-R">df1 <span style="color: #008b8b;">%&gt;%</span> 
    mutate_at(<span style="color: #008b8b;">1</span>,~str_sub(.,<span style="color: #008b8b;">1</span>,str_length(.)-<span style="color: #008b8b;">4</span>)) <span style="color: #008b8b;">%&gt;%</span> 
    add_column(var_bin=df1$var) <span style="color: #008b8b;">%&gt;%</span> 
    mutate(num=var_bin) <span style="color: #008b8b;">%&gt;%</span> 
    mutate_at(<span style="color: #8b2252;">"num"</span>,~str_split(.,<span style="color: #8b2252;">"_X"</span>) <span style="color: #008b8b;">%&gt;%</span> map_chr(<span style="color: #008b8b;">2</span>)) <span style="color: #008b8b;">%&gt;%</span> 
    dplyr::group_by(var) <span style="color: #008b8b;">%&gt;%</span> 
    arrange(var,desc(value)) <span style="color: #008b8b;">%&gt;%</span> 
    mutate(num2=num) <span style="color: #008b8b;">%&gt;%</span>
    mutate_at(<span style="color: #8b2252;">"num2"</span>,~sort(.,decreasing = T)) <span style="color: #008b8b;">%&gt;%</span> 
    mutate(num3=num) <span style="color: #008b8b;">%&gt;%</span> 
    mutate_at(<span style="color: #8b2252;">"num3"</span>,~sort(.,decreasing = F)) <span style="color: #008b8b;">%&gt;%</span> head()

df1 <span style="color: #008b8b;">%&gt;%</span> 
    mutate_at(<span style="color: #008b8b;">1</span>,~str_sub(.,<span style="color: #008b8b;">1</span>,str_length(.)-<span style="color: #008b8b;">4</span>)) <span style="color: #008b8b;">%&gt;%</span> 
    add_column(var_bin=df1$var) <span style="color: #008b8b;">%&gt;%</span> 
    mutate(num=var_bin) <span style="color: #008b8b;">%&gt;%</span> 
    mutate_at(<span style="color: #8b2252;">"num"</span>,~str_split(.,<span style="color: #8b2252;">"_X"</span>) <span style="color: #008b8b;">%&gt;%</span> map_chr(<span style="color: #008b8b;">2</span>)) <span style="color: #008b8b;">%&gt;%</span> 
    dplyr::group_by(var) <span style="color: #008b8b;">%&gt;%</span> 
    arrange(var,desc(value)) <span style="color: #008b8b;">%&gt;%</span> 
    mutate(num2=num) <span style="color: #008b8b;">%&gt;%</span>
    mutate_at(<span style="color: #8b2252;">"num2"</span>,~sort(.,decreasing = T)) <span style="color: #008b8b;">%&gt;%</span> 
    mutate(num3=num) <span style="color: #008b8b;">%&gt;%</span> 
    mutate_at(<span style="color: #8b2252;">"num3"</span>,~sort(.,decreasing = F)) <span style="color: #008b8b;">%&gt;%</span> 
    dplyr::summarise(equal_ratio=(mean(num==num2|num==num3)))
<span style="color: #b22222;"># </span><span style="color: #b22222;">A tibble: 6 x 6</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">Groups:   var [2]</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">var                                value var_bin                            num   num2  num3 </span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">&lt;chr&gt;                              &lt;dbl&gt; &lt;chr&gt;                              &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">1 als_d15_cell_nbank_cf_allnum    0.0477   als_d15_cell_nbank_cf_allnum_X03   03    05    01   </span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">2 als_d15_cell_nbank_cf_allnum   -0.000132 als_d15_cell_nbank_cf_allnum_X01   01    04    02   </span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">3 als_d15_cell_nbank_cf_allnum   -0.00798  als_d15_cell_nbank_cf_allnum_X02   02    03    03   </span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">4 als_d15_cell_nbank_cf_allnum   -0.0270   als_d15_cell_nbank_cf_allnum_X04   04    02    04   </span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">5 als_d15_cell_nbank_cf_allnum   -0.128    als_d15_cell_nbank_cf_allnum_X05   05    01    05   </span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">6 als_d15_cell_nbank_else_allnum  0.296    als_d15_cell_nbank_else_allnum_X05 05    05    03   </span>
</pre>
</div>
</div>
</div>
</div>
<div id="org9b88660" class="outline-4">
<h4 id="org9b88660"><span class="section-number-4">12.2.12</span> transmute</h4>
<div class="outline-text-4" id="text-12-2-12">
<p>
如果只想保留新变量，可以使用 transmute() 函数：
</p>

<div class="org-src-container">
<pre class="src src-R">transmute(flights,
          gain = arr_delay - dep_delay,
          hours = air_time / <span style="color: #008b8b;">60</span>,
          gain_per_hour = gain / hours
          )
</pre>
</div>

<p>
transmute<sub>all</sub>(.tbl, .funs, &#x2026;)
</p>

<p>
transmute<sub>if</sub>(.tbl, .predicate, .funs, &#x2026;)
</p>

<p>
transmute<sub>at</sub>(.tbl, .vars, .funs, &#x2026;, .cols = NULL)
</p>

<p>
同样三件套。
</p>
</div>
</div>

<div id="org9c30e38" class="outline-4">
<h4 id="org9c30e38"><span class="section-number-4">12.2.13</span> add<sub>column</sub>()/add<sub>row</sub>()</h4>
<div class="outline-text-4" id="text-12-2-13">
<p>
这个函数和 mutate 一样，可以实现迅速添加列的目的
</p>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;"># </span><span style="color: #b22222;">add_column ---------------------------------</span>
df <span style="color: #008b8b;">&lt;-</span> tibble(x = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>, y = <span style="color: #008b8b;">3</span>:<span style="color: #008b8b;">1</span>)
add_column(df, z = -<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">1</span>, w = <span style="color: #008b8b;">0</span>)
add_row(df, x = <span style="color: #008b8b;">4</span>, y = <span style="color: #008b8b;">0</span>)
                                      <span style="color: #b22222;"># </span><span style="color: #b22222;">You can specify where to add the new rows</span>
add_row(df, x = <span style="color: #008b8b;">4</span>, y = <span style="color: #008b8b;">0</span>, .before = <span style="color: #008b8b;">2</span>)
                                      <span style="color: #b22222;"># </span><span style="color: #b22222;">You can supply vectors, to add multiple rows (this isn't</span>
                                      <span style="color: #b22222;"># </span><span style="color: #b22222;">recommended because it's a bit hard to read)</span>
add_row(df, x = <span style="color: #008b8b;">4</span>:<span style="color: #008b8b;">5</span>, y = <span style="color: #008b8b;">0</span>:-<span style="color: #008b8b;">1</span>)
                                      <span style="color: #b22222;"># </span><span style="color: #b22222;">Absent variables get missing values</span>
add_row(df, x = <span style="color: #008b8b;">4</span>)
</pre>
</div>
</div>
</div>

<div id="org2de9f92" class="outline-4">
<h4 id="org2de9f92"><span class="section-number-4">12.2.14</span> bind<sub>rows\bind</sub><sub>cols</sub></h4>
<div class="outline-text-4" id="text-12-2-14">
<p>
这个函数有些奇怪，在处理 list 型数据时，需要注意。
</p>

<div class="org-src-container">
<pre class="src src-R">  ll <span style="color: #008b8b;">&lt;-</span> list(
      a = c(A = <span style="color: #008b8b;">1</span>, B = <span style="color: #008b8b;">2</span>),
      b = c(A = <span style="color: #008b8b;">3</span>, B = <span style="color: #008b8b;">4</span>)
  )
  ll
  bind_rows(ll)
  bind_rows(!!!ll)
                                        <span style="color: #b22222;">## </span><span style="color: #b22222;"># A tibble: 2 x 2  </span>
<span style="color: #b22222;">##       </span><span style="color: #b22222;">A     B</span>
<span style="color: #b22222;">##   </span><span style="color: #b22222;">&lt;dbl&gt; &lt;dbl&gt;</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">1     1     2</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">2     3     4</span>
  df1 <span style="color: #008b8b;">&lt;-</span> data.frame(id=c(<span style="color: #008b8b;">1</span>,<span style="color: #008b8b;">2</span>,<span style="color: #008b8b;">3</span>),x=c(<span style="color: #008b8b;">3</span>,<span style="color: #008b8b;">4</span>,<span style="color: #008b8b;">5</span>))
  df2 <span style="color: #008b8b;">&lt;-</span> data.frame(id=c(<span style="color: #008b8b;">1</span>,<span style="color: #008b8b;">2</span>),x=c(<span style="color: #008b8b;">6</span>,<span style="color: #008b8b;">7</span>))
  bind_rows(df1,df2)
  bind_rows(df1,df2, .id = <span style="color: #8b2252;">"id"</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#20250;&#20135;&#29983;&#19968;&#20010;&#26032;&#30340;&#21464;&#37327;&#21517;&#21483; id  </span>
                                        <span style="color: #b22222;"># </span><span style="color: #b22222;">You can circumvent that behaviour with explicit splicing:</span>
</pre>
</div>

<p>
要想获得和原数据一致的格式，还是要用 bind<sub>rows</sub>(!!!ll) 命令。
</p>

<p>
同理的函数 bind<sub>cols</sub>()
</p>
</div>
</div>

<div id="org8ef186a" class="outline-4">
<h4 id="org8ef186a"><span class="section-number-4">12.2.15</span> summarise</h4>
<div class="outline-text-4" id="text-12-2-15">
<p>
summarise:将多个值总结为一个摘要统计量。需要注意这个函数在 plyr 里面也有，如果不注意会得到错误的值。这个函数的缺陷在于只能使用返回单一值的摘要函数，这意味者我们不能使用像 quantile() 这样的函数，因为它会返回任意长度的向量。不过可以将结果包装在一个列表中！
</p>

<p>
n():目前每个分组观测值得数量
</p>

<p>
n<sub>distinct</sub>(x):x 中不重复值的数量，与 length(unique())作用相同。
</p>

<p>
first(x),last(x),nth(x):作用与 x[1],x[length(x)],x[n]相似。
</p>

<p>
经常和 group<sub>by</sub>()一起使用，
</p>

<div class="org-src-container">
<pre class="src src-R"> flights <span style="color: #008b8b;">%&gt;%</span>
  group_by(month) <span style="color: #008b8b;">%&gt;%</span>
  summarise(
    first(dep_time),
    last(arr_delay),
    nth(arr_time, <span style="color: #008b8b;">5</span>, order_by = year),
    n(),
    n_distinct(year)
  )
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; # A tibble: 12 x 6</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;    month `first(dep_time~ `last(arr_delay~ `nth(arr_time, ~ `n()`</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;    &lt;int&gt;            &lt;int&gt;            &lt;dbl&gt;            &lt;int&gt; &lt;int&gt;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  1     1              517               NA              812 27004</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  2     2              456               NA              859 24951</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  3     3                4               NA              746 28834</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  4     4              454               NA              914 28330</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  5     5                9               NA              831 28796</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  6     6                2               NA              925 28243</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  7     7                1               NA              300 29425</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  8     8               12               NA              420 29327</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  9     9                9               NA              906 27574</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 10    10              447               NA              917 28889</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 11    11                5               NA              831 27268</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 12    12               13               NA              845 28135 </span>
</pre>
</div>
</div>


<div id="orgae7738c" class="outline-5">
<h5 id="orgae7738c"><span class="section-number-5">12.2.15.1</span> summarise<sub>each</sub>()</h5>
<div class="outline-text-5" id="text-12-2-15-1">
<div class="org-src-container">
<pre class="src src-R">summarize(flights, delay = mean(dep_delay, na.rm = <span style="color: #228b22;">TRUE</span>)) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#23558; delay &#21464;&#37327;&#23450;&#20041;&#20026; dep_delay &#22343;&#20540;</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-R">da <span style="color: #008b8b;">&lt;-</span> data.frame(id=c(<span style="color: #8b2252;">"1"</span>,<span style="color: #8b2252;">"1"</span>,<span style="color: #8b2252;">"2"</span>),label=c(<span style="color: #008b8b;">1</span>,<span style="color: #008b8b;">0</span>,<span style="color: #008b8b;">1</span>))
da <span style="color: #008b8b;">%&gt;%</span> group_by(id) <span style="color: #008b8b;">%&gt;%</span> mutate(label=max(label))
da <span style="color: #008b8b;">%&gt;%</span> group_by(id) <span style="color: #008b8b;">%&gt;%</span> summarize(label = max(label))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-R">by_day <span style="color: #008b8b;">&lt;-</span> group_by(flights, year, month, day)
summarize(by_day, delay = mean(dep_delay, na.rm = <span style="color: #228b22;">TRUE</span>))
    flights <span style="color: #008b8b;">%&gt;%</span>
      group_by(dest) <span style="color: #008b8b;">%&gt;%</span>
      summarise(
          planes = n_distinct(tailnum),
          flights = n(),
          f = sum(flights),
          fistv = first(tailnum),
          lastv = last(tailnum),
          iqr = IQR(dep_time, na.rm = <span style="color: #228b22;">TRUE</span>),
          nthv = nth(tailnum, <span style="color: #008b8b;">12</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">tailnum[12]</span>
      )
  summarise_each(y, mean) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#27714;&#35299;&#25968;&#25454;&#27599;&#19968;&#21015;&#30340;&#22343;&#20540;</span>
  mtcars <span style="color: #008b8b;">%&gt;%</span> tally() <span style="color: #b22222;"># </span><span style="color: #b22222;">tally()&#30456;&#24403;&#20110; summaries&#65292;count</span>
  mtcars <span style="color: #008b8b;">%&gt;%</span>
      group_by(cyl) <span style="color: #008b8b;">%&gt;%</span>
      tally()
  mtcars <span style="color: #008b8b;">%&gt;%</span> add_tally()
</pre>
</div>

<p>
summarise 可以结合！！很方便。
</p>

<div class="org-src-container">
<pre class="src src-R">mass <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">100</span> 
  starwars <span style="color: #008b8b;">%&gt;%</span> summarise(avg = mean(mass/!!mass,na.rm = T))
</pre>
</div>

<p>
还可以结合 any()/all() 来做一些操作：再补充！
</p>

<p>
Given a set of logical vectors, is at least one of the values true?
</p>
<div class="org-src-container">
<pre class="src src-R">range(x <span style="color: #008b8b;">&lt;-</span> sort(round(stats::rnorm(<span style="color: #008b8b;">10</span>) - <span style="color: #008b8b;">1.2</span>, <span style="color: #008b8b;">1</span>)))
<span style="color: #a020f0;">if</span>(any(x &lt; <span style="color: #008b8b;">0</span>)) cat(<span style="color: #8b2252;">"x contains negative values\n"</span>)
</pre>
</div>
</div>
</div>

<div id="org6956596" class="outline-5">
<h5 id="org6956596"><span class="section-number-5">12.2.15.2</span> summarise<sub>at</sub></h5>
<div class="outline-text-5" id="text-12-2-15-2">
<div class="org-src-container">
<pre class="src src-R">df1=data.frame(id=c(<span style="color: #008b8b;">1</span>,<span style="color: #008b8b;">2</span>,<span style="color: #008b8b;">2</span>,<span style="color: #008b8b;">3</span>,<span style="color: #008b8b;">3</span>),x=c(<span style="color: #008b8b;">2</span>,<span style="color: #008b8b;">6</span>,<span style="color: #008b8b;">5</span>,<span style="color: #008b8b;">6</span>,<span style="color: #008b8b;">9</span>))
df1 <span style="color: #008b8b;">%&gt;%</span> 
    summarise_at(vars(x),list(n=~n(),mean=mean,median=median))
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&#31561;&#20215;&#20110;</span>
df1 <span style="color: #008b8b;">%&gt;%</span> 
    summarise_at(vars(x),list(~n(),~mean(.),~median(.)))

d.cancer <span style="color: #008b8b;">%&gt;%</span>
    summarise_at(
        c(<span style="color: #8b2252;">"v0"</span>, <span style="color: #8b2252;">"v1"</span>),
        list(avg = ~mean(.), std = ~sd(.)), 
        na.rm=<span style="color: #228b22;">TRUE</span>)
</pre>
</div>
</div>
</div>

<div id="org0509053" class="outline-5">
<h5 id="org0509053"><span class="section-number-5">12.2.15.3</span> summarise<sub>all</sub></h5>
<div class="outline-text-5" id="text-12-2-15-3">
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;"># </span><span style="color: #b22222;">&#24179;&#22343;&#20540;&#65292;&#23383;&#31526;&#24179;&#22343;&#20540;&#36820;&#22238; NA</span>
summarise_all(flights, mean) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#25152;&#26377;&#21464;&#37327;&#30340;,&#20854;&#23454;&#36825;&#20063;&#26159;&#21457;&#29616;&#26377;&#32570;&#22833;&#20540;&#30340;&#22909;&#26041;&#27861;</span>
summarise_all(flights, sd,na.rm = <span style="color: #228b22;">TRUE</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36820;&#22238;&#25152;&#26377;&#21464;&#37327;&#30340;</span>
</pre>
</div>

<ul class="org-ul">
<li>其他窗口函数</li>
</ul>

<p>
cumall，cumany,cummean
</p>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;"># </span><span style="color: #b22222;">`cummean()` returns a numeric/integer vector of the same length</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">as the input vector.</span>
x <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">3</span>, <span style="color: #008b8b;">5</span>, <span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">2</span>)
cummean(x)
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 1.00 2.00 3.00 2.75 2.60</span>
cumsum(x) / seq_along(x)
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 1.00 2.00 3.00 2.75 2.60</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">`cumall()` and `cumany()` return logicals</span>
cumall(x &lt; <span style="color: #008b8b;">5</span>)
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1]  TRUE  TRUE FALSE FALSE FALSE</span>
cumany(x == <span style="color: #008b8b;">3</span>)
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] FALSE  TRUE  TRUE  TRUE  TRUE</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">`cumall()` vs. `cumany()`</span>
df <span style="color: #008b8b;">&lt;-</span> data.frame(
  date = as.Date(<span style="color: #8b2252;">"2020-01-01"</span>) + <span style="color: #008b8b;">0</span>:<span style="color: #008b8b;">6</span>,
  balance = c(<span style="color: #008b8b;">100</span>, <span style="color: #008b8b;">50</span>, <span style="color: #008b8b;">25</span>, -<span style="color: #008b8b;">25</span>, -<span style="color: #008b8b;">50</span>, <span style="color: #008b8b;">30</span>, <span style="color: #008b8b;">120</span>)
)
<span style="color: #b22222;"># </span><span style="color: #b22222;">all rows after first overdraft</span>
df <span style="color: #008b8b;">%&gt;%</span> filter(cumany(balance &lt; <span style="color: #008b8b;">0</span>))
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;         date balance</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1 2020-01-04     -25</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2 2020-01-05     -50</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3 2020-01-06      30</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 4 2020-01-07     120</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">all rows until first overdraft</span>
df <span style="color: #008b8b;">%&gt;%</span> filter(cumall(!(balance &lt; <span style="color: #008b8b;">0</span>)))
</pre>
</div>
</div>
</div>
</div>

<div id="org33f6891" class="outline-4">
<h4 id="org33f6891"><span class="section-number-4">12.2.16</span> sample<sub>n</sub></h4>
<div class="outline-text-4" id="text-12-2-16">
<p>
使用 sample()和 sample<sub>frac</sub>()获得一定数量的随机样本，使用 sample<sub>n</sub>()可以选择固定的行数，sample<sub>frac</sub>()可选择占总行数固定比例的行数。使用 replace=TRUE 时为有放回的取样（即有可能重复取样）。如果需要，可以用 weight 参数来对取样的数据进行权重设置。
</p>

<div class="org-src-container">
<pre class="src src-R">sample_n(flights, <span style="color: #008b8b;">10</span>)
flights <span style="color: #008b8b;">%&gt;%</span> sample_n(<span style="color: #008b8b;">10</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#38543;&#26426;&#25277;&#26679;</span>
sample_frac(flights, <span style="color: #008b8b;">0.01</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25353;&#29031;&#19968;&#23450;&#30340;&#25277;&#26679;&#27604;&#20363;&#26469;&#25277;</span>
slice(flights, <span style="color: #008b8b;">10</span>:<span style="color: #008b8b;">15</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#31579;&#36873;&#20986;&#22266;&#23450;&#34892;&#20301;&#32622;</span>
top_n(flights, <span style="color: #008b8b;">5</span>, wt = dep_time) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25353;&#29031; dep_time &#21319;&#24207;&#25490;&#24207;</span>
flights <span style="color: #008b8b;">%&gt;%</span> top_n(-<span style="color: #008b8b;">2</span>)
flights <span style="color: #008b8b;">%&gt;%</span> top_frac(.5)
</pre>
</div>

<p>
ToDo:
是不是 filter(row<sub>number</sub>()==1) 等价于 top<sub>n</sub>(1)?
</p>

<div class="org-src-container">
<pre class="src src-R">df1 <span style="color: #008b8b;">%&gt;%</span> 
  group_by(id) <span style="color: #008b8b;">%&gt;%</span> 
  arrange(desc(x)) <span style="color: #008b8b;">%&gt;%</span> 
  filter(row_number()==<span style="color: #008b8b;">1</span>)

df1 <span style="color: #008b8b;">%&gt;%</span> 
  group_by(id) <span style="color: #008b8b;">%&gt;%</span> 
  arrange(desc(x)) <span style="color: #008b8b;">%&gt;%</span>
  top_n(<span style="color: #008b8b;">1</span>)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-R">mtcars <span style="color: #008b8b;">%&gt;%</span>
    group_by(cyl) <span style="color: #008b8b;">%&gt;%</span>
    arrange(desc(carb)) <span style="color: #008b8b;">%&gt;%</span>
    select(cyl, carb) <span style="color: #008b8b;">%&gt;%</span>
    filter(row_number() == <span style="color: #008b8b;">1</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; # A tibble: 3 x 2</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; # Groups:   cyl [3]</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;     cyl  carb</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   &lt;dbl&gt; &lt;dbl&gt;</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1     8     8</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2     6     6</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3     4     2</span>

mtcars <span style="color: #008b8b;">%&gt;%</span>
    group_by(cyl) <span style="color: #008b8b;">%&gt;%</span>
    arrange(desc(carb)) <span style="color: #008b8b;">%&gt;%</span>
    select(cyl, carb) <span style="color: #008b8b;">%&gt;%</span>
    top_n(<span style="color: #008b8b;">1</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Selecting by carb</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; # A tibble: 8 x 2</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; # Groups:   cyl [3]</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;     cyl  carb</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   &lt;dbl&gt; &lt;dbl&gt;</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1     8     8</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2     6     6</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3     4     2</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 4     4     2</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 5     4     2</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 6     4     2</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 7     4     2</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 8     4     2  </span>
</pre>
</div>

<p>
从上述这个例子可以看出，top<sub>n</sub>(2) 会输出所有值为 rank=2 的数值，但是 filter(row<sub>number</sub>() == 1) 只会输出一条记录。
</p>
</div>
</div>

<div id="org4710573" class="outline-4">
<h4 id="org4710573"><span class="section-number-4">12.2.17</span> tally</h4>
<div class="outline-text-4" id="text-12-2-17">
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;"># </span><span style="color: #b22222;">tally() is short-hand for summarise(n())</span>
mtcars <span style="color: #008b8b;">%&gt;%</span> tally()
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;    n</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1 32</span>
</pre>
</div>
</div>
</div>

<div id="org7d37902" class="outline-4">
<h4 id="org7d37902"><span class="section-number-4">12.2.18</span> add<sub>tally</sub></h4>
<div class="outline-text-4" id="text-12-2-18">
<p>
从下面的例子可以看出，新生成了一列数据 n.
</p>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;"># </span><span style="color: #b22222;">add_tally() is short-hand for mutate(n())</span>
mtcars <span style="color: #008b8b;">%&gt;%</span>
    add_tally() <span style="color: #008b8b;">%&gt;%</span>
    head() <span style="color: #008b8b;">%&gt;%</span>
    select(mpg, cyl, n)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; # A tibble: 6 x 3</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;     mpg   cyl     n</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1  21       6    32</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2  21       6    32</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3  22.8     4    32</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 4  21.4     6    32</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 5  18.7     8    32</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 6  18.1     6    32</span>
</pre>
</div>
</div>
</div>

<div id="org1e57e7b" class="outline-4">
<h4 id="org1e57e7b"><span class="section-number-4">12.2.19</span> count</h4>
<div class="outline-text-4" id="text-12-2-19">
<p>
如果一个表有主键，比如说，xiaomi<sub>id,credit</sub><sub>time,最好验证下</sub>，看看是否真正唯一标识每个观测。
</p>
<div class="org-src-container">
<pre class="src src-R">xiaomi_id <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #8b2252;">"1"</span>,<span style="color: #8b2252;">"2"</span>,<span style="color: #8b2252;">"3"</span>,<span style="color: #8b2252;">"1"</span>)
credit_time <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #8b2252;">"20190101"</span>,<span style="color: #8b2252;">"20190201"</span>,<span style="color: #8b2252;">"20190401"</span>,<span style="color: #8b2252;">"20190101"</span>)
x1 <span style="color: #008b8b;">&lt;-</span> seq(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">4</span>)
df1 <span style="color: #008b8b;">&lt;-</span> tibble(xiaomi_id,credit_time,x1)
df1 <span style="color: #008b8b;">%&gt;%</span> count(xiaomi_id,credit_time) <span style="color: #008b8b;">%&gt;%</span> 
    filter(n&gt;<span style="color: #008b8b;">1</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; # A tibble: 1 x 3</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   xiaomi_id credit_time     n</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   &lt;chr&gt;     &lt;chr&gt;       &lt;int&gt;</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1 1         20190101        2  </span>
</pre>
</div>

<p>
count() is a short-hand for group<sub>by</sub>() + tally().
count(sort=T/F,name="",wt=),注意 count 函数可以结合 weight 权重函数进行计算。
</p>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;"># </span><span style="color: #b22222;">count() is a short-hand for group_by() + tally()</span>
mtcars <span style="color: #008b8b;">%&gt;%</span> count(cyl,sort = <span style="color: #228b22;">TRUE</span>,name = <span style="color: #8b2252;">"n_cyl"</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#29978;&#33267;&#20320;&#21487;&#20197;&#37325;&#26032;&#21629;&#21517;</span>
</pre>
</div>
</div>
</div>
<div id="orge630039" class="outline-4">
<h4 id="orge630039"><span class="section-number-4">12.2.20</span> distinct</h4>
<div class="outline-text-4" id="text-12-2-20">
<p>
找出数据表中不同的数据项
</p>
<div class="org-src-container">
<pre class="src src-R">df <span style="color: #008b8b;">&lt;-</span> tibble(x = rep(<span style="color: #008b8b;">2</span>:<span style="color: #008b8b;">5</span>, each = <span style="color: #008b8b;">2</span>) / <span style="color: #008b8b;">2</span>, y = rep(<span style="color: #008b8b;">2</span>:<span style="color: #008b8b;">3</span>, each = <span style="color: #008b8b;">4</span>) / <span style="color: #008b8b;">2</span>)
df <span style="color: #008b8b;">%&gt;%</span> distinct() 
distinct_all(df)
df <span style="color: #008b8b;">%&gt;%</span> distinct(x)
distinct_at(df, vars(x))
distinct_if(df, is.numeric) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#38024;&#23545;numeric &#22411;&#25968;&#25454;&#21435;&#37325;</span>
</pre>
</div>
</div>

<div id="org51537e0" class="outline-5">
<h5 id="org51537e0"><span class="section-number-5">12.2.20.1</span> distinct<sub>at</sub></h5>
<div class="outline-text-5" id="text-12-2-20-1">
<div class="org-src-container">
<pre class="src src-R">df <span style="color: #008b8b;">&lt;-</span> tibble(x = rep(<span style="color: #008b8b;">2</span>:<span style="color: #008b8b;">5</span>, each = <span style="color: #008b8b;">2</span>) / <span style="color: #008b8b;">2</span>, y = rep(<span style="color: #008b8b;">2</span>:<span style="color: #008b8b;">3</span>, each = <span style="color: #008b8b;">4</span>) / <span style="color: #008b8b;">2</span>)
df
distinct_at(df,vars(x))  
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; # A tibble: 4 x 1</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;       x</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   &lt;dbl&gt;</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1   1  </span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2   1.5</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3   2  </span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 4   2.5</span>
</pre>
</div>
</div>
</div>

<div id="org738bfaa" class="outline-5">
<h5 id="org738bfaa"><span class="section-number-5">12.2.20.2</span> distinct<sub>if</sub></h5>
<div class="outline-text-5" id="text-12-2-20-2">
<div class="org-src-container">
<pre class="src src-R">df <span style="color: #008b8b;">&lt;-</span> tibble(x = rep(<span style="color: #008b8b;">2</span>:<span style="color: #008b8b;">5</span>, each = <span style="color: #008b8b;">2</span>) / <span style="color: #008b8b;">2</span>, y = rep(<span style="color: #008b8b;">2</span>:<span style="color: #008b8b;">3</span>, each = <span style="color: #008b8b;">4</span>) / <span style="color: #008b8b;">2</span>)
df
distinct_if(df, is.numeric)
</pre>
</div>
</div>
</div>

<div id="org1d8f91e" class="outline-5">
<h5 id="org1d8f91e"><span class="section-number-5">12.2.20.3</span> distinct<sub>all</sub></h5>
<div class="outline-text-5" id="text-12-2-20-3">
<div class="org-src-container">
<pre class="src src-R">df <span style="color: #008b8b;">&lt;-</span> tibble(x = rep(<span style="color: #008b8b;">2</span>:<span style="color: #008b8b;">5</span>, each = <span style="color: #008b8b;">2</span>) / <span style="color: #008b8b;">2</span>, y = rep(<span style="color: #008b8b;">2</span>:<span style="color: #008b8b;">3</span>, each = <span style="color: #008b8b;">4</span>) / <span style="color: #008b8b;">2</span>)
df
distinct_all(df)       
</pre>
</div>
</div>
</div>
</div>

<div id="org1cc99cb" class="outline-4">
<h4 id="org1cc99cb"><span class="section-number-4">12.2.21</span> do()</h4>
<div class="outline-text-4" id="text-12-2-21">
<p>
You can use do() to perform arbitrary computation, returning either a data frame or arbitrary objects which will be stored in a list. This is particularly useful when working with models: you can fit models per group with do() and then flexibly extract components with either another do() or summarise().
这个函数可以灵活利用各种函数，棒！目标对象应该是 data.frame 型。
</p>
<div class="org-src-container">
<pre class="src src-R">by_cyl <span style="color: #008b8b;">&lt;-</span> group_by(mtcars, cyl)
do(by_cyl, head(., <span style="color: #008b8b;">2</span>))

models <span style="color: #008b8b;">&lt;-</span> by_cyl <span style="color: #008b8b;">%&gt;%</span> do(mod = lm(mpg ~ disp, data = .))
summarise(models, rsq = summary(mod)$r.squared)
models <span style="color: #008b8b;">%&gt;%</span> do(data.frame(coef = coef(.$mod)))

models <span style="color: #008b8b;">%&gt;%</span> do(data.frame(
  var = names(coef(.$mod)),
  coef(summary(.$mod)))
  )
</pre>
</div>

<div class="org-src-container">
<pre class="src src-R">by_cyl <span style="color: #008b8b;">&lt;-</span> mtcars <span style="color: #008b8b;">%&gt;%</span>
    group_by(cyl)
do(by_cyl, head(., <span style="color: #008b8b;">2</span>)) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#24847;&#24605;&#23601;&#26159; head(by_cyl,2)</span>

models <span style="color: #008b8b;">&lt;-</span> by_cyl <span style="color: #008b8b;">%&gt;%</span> do(mod = lm(mpg ~ disp, data = .))
models <span style="color: #008b8b;">%&gt;%</span> do(data.frame(coef = coef(.$mod)))

iris <span style="color: #008b8b;">%&gt;%</span>
    group_by(Species) <span style="color: #008b8b;">%&gt;%</span>
    do({
        mod <span style="color: #008b8b;">&lt;-</span> lm(Sepal.Length ~ Sepal.Width, data = .)
        pred <span style="color: #008b8b;">&lt;-</span> predict(mod, newdata = .[<span style="color: #8b2252;">"Sepal.Width"</span>])
        data.frame(., pred)
    })
</pre>
</div>
</div>
</div>
<div id="org5e0556d" class="outline-4">
<h4 id="org5e0556d"><span class="section-number-4">12.2.22</span> n<sub>distinct</sub>()</h4>
<div class="outline-text-4" id="text-12-2-22">
<p>
这个函数仍然不熟悉。
</p>

<div class="org-src-container">
<pre class="src src-R">df <span style="color: #008b8b;">&lt;-</span> tibble(
    g1 = c(<span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">2</span>),
    g2 = c(<span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">1</span>),
    a = sample(<span style="color: #008b8b;">5</span>),
    b = sample(<span style="color: #008b8b;">5</span>)
)
<span style="color: #b22222;">###</span><span style="color: #b22222;">.--------------------------</span>
ins
df <span style="color: #008b8b;">%&gt;%</span> n_distinct()
</pre>
</div>

<div class="org-src-container">
<pre class="src src-R">df <span style="color: #008b8b;">&lt;-</span> tibble(
    g1 = c(<span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">2</span>),
    g2 = c(<span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">1</span>),
    a = sample(<span style="color: #008b8b;">5</span>),
    b = sample(<span style="color: #008b8b;">5</span>)
)

df <span style="color: #008b8b;">%&gt;%</span> summarise(n(),n_distinct(a))
</pre>
</div>
</div>
</div>

<div id="org1f4cfee" class="outline-4">
<h4 id="org1f4cfee"><span class="section-number-4">12.2.23</span> slice()</h4>
<div class="outline-text-4" id="text-12-2-23">
<p>
slice 可于选择数据的行，相对于 select 选择列数据。
</p>
<div class="org-src-container">
<pre class="src src-R">mtcars <span style="color: #008b8b;">%&gt;%</span> slice(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">10</span>)<span style="color: #b22222;">#</span><span style="color: #b22222;">&#36873;&#25321;&#21069; 10 &#34892;</span>
mtcars <span style="color: #008b8b;">%&gt;%</span> slice(-<span style="color: #008b8b;">1</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21024;&#38500;&#31532;&#19968;&#34892;</span>
mtcars <span style="color: #008b8b;">%&gt;%</span> slice(-c(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">5</span>)) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21024;&#38500;&#21069; 5 &#34892;</span>
<span style="color: #b22222;">###</span><span style="color: #b22222;">&#19979;&#38754;&#26041;&#27861;&#31561;&#20215;</span>
slice(mtcars, n())
mtcars <span style="color: #008b8b;">%&gt;%</span> tail(<span style="color: #008b8b;">1</span>)
</pre>
</div>

<p>
衍生函数如下：
slice<sub>head</sub>(): dplyr (data.frame).
slice<sub>tail</sub>(): dplyr (data.frame).
slice<sub>min</sub>(): dplyr (data.frame).
slice<sub>max</sub>(): dplyr (data.frame).
slice<sub>sample</sub>(): dplyr (data.frame).
</p>

<div class="org-src-container">
<pre class="src src-R">
</pre>
</div>
</div>
</div>


<div id="org613b59a" class="outline-4">
<h4 id="org613b59a"><span class="section-number-4">12.2.24</span> between()</h4>
<div class="outline-text-4" id="text-12-2-24">
<p>
This is a shortcut for x &gt;= left &amp; x &lt;= right, implemented efficiently in C++ for local values, and translated to the appropriate SQL for remote tables.
</p>

<div class="org-src-container">
<pre class="src src-R">data <span style="color: #008b8b;">&lt;-</span> data.frame(id=c(<span style="color: #008b8b;">1</span>,<span style="color: #008b8b;">2</span>,<span style="color: #008b8b;">3</span>),x=c(<span style="color: #008b8b;">3</span>,<span style="color: #008b8b;">4</span>,<span style="color: #008b8b;">5</span>))
data <span style="color: #008b8b;">%&gt;%</span> 
    mutate(tag=ifelse(x <span style="color: #008b8b;">%&gt;%</span> between(<span style="color: #008b8b;">1</span>,<span style="color: #008b8b;">4</span>),<span style="color: #008b8b;">1</span>,-<span style="color: #008b8b;">1</span>))
</pre>
</div>
</div>
</div>

<div id="orgdf018e2" class="outline-4">
<h4 id="orgdf018e2"><span class="section-number-4">12.2.25</span> case<sub>when</sub>()</h4>
<div class="outline-text-4" id="text-12-2-25">
<div class="org-src-container">
<pre class="src src-R">case_when(mtcars$carb &lt;= <span style="color: #008b8b;">2</span> ~ <span style="color: #8b2252;">"low"</span>,
            mtcars$carb &gt; <span style="color: #008b8b;">2</span> ~ <span style="color: #8b2252;">"high"</span>) <span style="color: #008b8b;">%&gt;%</span> table
</pre>
</div>
</div>
</div>

<div id="org025cf66" class="outline-4">
<h4 id="org025cf66"><span class="section-number-4">12.2.26</span> if<sub>else</sub>()</h4>
<div class="outline-text-4" id="text-12-2-26">
<p>
Compared to the base ifelse(), this function is more strict. It checks that true and false are the same type. This strictness makes the output type more predictable, and makes it somewhat faster.说白了，if<sub>else</sub>() 可以保持原数据同样的数据类型。
</p>
<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> c(-<span style="color: #008b8b;">5</span>:<span style="color: #008b8b;">5</span>, <span style="color: #228b22;">NA</span>)
if_else(x &lt; <span style="color: #008b8b;">0</span>, <span style="color: #228b22;">NA_integer_</span>, x)
if_else(x &lt; <span style="color: #008b8b;">0</span>, <span style="color: #8b2252;">"negative"</span>, <span style="color: #8b2252;">"positive"</span>, <span style="color: #8b2252;">"missing"</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21644; ifelse &#30456;&#27604;&#65292;if_else &#21487;&#20197;&#33258;&#21160;&#23545;&#32570;&#22833;&#20540;&#36827;&#34892;&#22635;&#20805;</span>
ifelse(x &lt; <span style="color: #008b8b;">0</span>, <span style="color: #8b2252;">"negative"</span>, <span style="color: #8b2252;">"positive"</span>)
                                      <span style="color: #b22222;"># </span><span style="color: #b22222;">Unlike ifelse, if_else preserves types</span>
x <span style="color: #008b8b;">&lt;-</span> factor(sample(letters[<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">5</span>], <span style="color: #008b8b;">10</span>, replace = <span style="color: #228b22;">TRUE</span>))
ifelse(x <span style="color: #008b8b;">%in%</span> c(<span style="color: #8b2252;">"a"</span>, <span style="color: #8b2252;">"b"</span>, <span style="color: #8b2252;">"c"</span>), x, factor(<span style="color: #228b22;">NA</span>))
if_else(x <span style="color: #008b8b;">%in%</span> c(<span style="color: #8b2252;">"a"</span>, <span style="color: #8b2252;">"b"</span>, <span style="color: #8b2252;">"c"</span>), x, factor(<span style="color: #228b22;">NA</span>))
</pre>
</div>
</div>
</div>

<div id="org899bccb" class="outline-4">
<h4 id="org899bccb"><span class="section-number-4">12.2.27</span> na<sub>if</sub>()</h4>
<div class="outline-text-4" id="text-12-2-27">
<p>
还是不太熟悉。。。。
</p>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">###</span><span style="color: #b22222;">na_if()&#23558;&#21464;&#37327;&#20013;&#30340;&#26410;&#30693;&#31867;&#22411;&#26367;&#25442;&#25104; NA--------------------------------------------</span>
na_if(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">5</span>, <span style="color: #008b8b;">5</span>:<span style="color: #008b8b;">1</span>)
x <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #008b8b;">1</span>, -<span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">0</span>, <span style="color: #008b8b;">10</span>)
na_if(x, <span style="color: #008b8b;">0</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25226; x &#20013;&#30340; 0 &#20540;&#26367;&#25442;&#25104; NA</span>
<span style="color: #008b8b;">100</span>/x
<span style="color: #008b8b;">100</span> / na_if(x, <span style="color: #008b8b;">0</span>)
y <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #8b2252;">"abc"</span>, <span style="color: #8b2252;">"def"</span>, <span style="color: #8b2252;">""</span>, <span style="color: #8b2252;">"ghi"</span>)
na_if(y, <span style="color: #8b2252;">""</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#25226;"&#8220;&#26367;&#25442;&#25104; NA</span>

test=starwars <span style="color: #008b8b;">%&gt;%</span>
    select(name, eye_color) <span style="color: #008b8b;">%&gt;%</span>
    mutate(eye_color = na_if(eye_color, <span style="color: #8b2252;">"unknown"</span>)) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#35828;&#30333;&#20102;&#23601;&#26159;&#25226; eye_color &#20013;"unknown"&#30340;&#37027;&#20123;&#20154;&#26631;&#35760;&#20026; NA</span>
test <span style="color: #008b8b;">%&gt;%</span> summarise(sum(is.na(eye_color))) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26377; 3 &#20010; NA</span>

starwars <span style="color: #008b8b;">%&gt;%</span>
    mutate_if(is.character, list(~na_if(., <span style="color: #8b2252;">"unknown"</span>)))<span style="color: #b22222;">#</span><span style="color: #b22222;">&#23558;&#25152;&#26377; char &#22411;&#21464;&#37327;&#20013;&#25152;&#26377; unknown &#30340;&#23383;&#27573;&#37117;&#26367;&#25442;&#20026; NA</span>
</pre>
</div>
</div>
</div>

<div id="orgc438fb9" class="outline-4">
<h4 id="orgc438fb9"><span class="section-number-4">12.2.28</span> recode()</h4>
<div class="outline-text-4" id="text-12-2-28">
<p>
This is a vectorised version of switch(): you can replace numeric values based on their position or their name, and character or factor values only by their name. This is an S3 generic: dplyr provides methods for numeric, character, and factors. For logical vectors, use if<sub>else</sub>(). For more complicated criteria, use case<sub>when</sub>().这个函数的命令是指将符合条件的字符进行替换，不符合条件的字符不变,主要针对的是数值型、字符型、因子型变量。
</p>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;"># </span><span style="color: #b22222;">For character values, recode values with named arguments only. Unmatched</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">values are unchanged.</span>
char_vec <span style="color: #008b8b;">&lt;-</span> sample(c(<span style="color: #8b2252;">"a"</span>, <span style="color: #8b2252;">"b"</span>, <span style="color: #8b2252;">"c"</span>), <span style="color: #008b8b;">10</span>, replace = <span style="color: #228b22;">TRUE</span>)
dplyr::recode(char_vec, a = <span style="color: #8b2252;">"Apple"</span>)
dplyr::recode(char_vec, a = <span style="color: #8b2252;">"Apple"</span>, b = <span style="color: #8b2252;">"Banana"</span>)
dplyr::recode(char_vec, a = <span style="color: #8b2252;">"Apple"</span>, b = <span style="color: #8b2252;">"Banana"</span>, .default = <span style="color: #228b22;">NA_character_</span>)
<span style="color: #b22222;"># </span><span style="color: #b22222;">Use a named character vector for unquote splicing with !!!</span>
level_key <span style="color: #008b8b;">&lt;-</span> c(a = <span style="color: #8b2252;">"apple"</span>, b = <span style="color: #8b2252;">"banana"</span>, c = <span style="color: #8b2252;">"carrot"</span>)
dplyr::recode(char_vec, !!!level_key)
<span style="color: #b22222;"># </span><span style="color: #b22222;">For numeric values, named arguments can also be used</span>
num_vec <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">4</span>, <span style="color: #228b22;">NA</span>)
dplyr::recode(num_vec, <span style="color: #000000; background-color: #ffffff;">`2`</span> = <span style="color: #008b8b;">20L</span>, <span style="color: #000000; background-color: #ffffff;">`4`</span> = <span style="color: #008b8b;">40L</span>)
<span style="color: #b22222;"># </span><span style="color: #b22222;">Or if you don't name the arguments, recode() matches by position.</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">(Only works for numeric vector)</span>
dplyr::recode(num_vec, <span style="color: #8b2252;">"a"</span>, <span style="color: #8b2252;">"b"</span>, <span style="color: #8b2252;">"c"</span>, <span style="color: #8b2252;">"d"</span>)
dplyr::recode(c(<span style="color: #008b8b;">1</span>,<span style="color: #008b8b;">5</span>,<span style="color: #008b8b;">3</span>), <span style="color: #8b2252;">"a"</span>, <span style="color: #8b2252;">"b"</span>, <span style="color: #8b2252;">"c"</span>, <span style="color: #8b2252;">"d"</span>, .default = <span style="color: #8b2252;">"nothing"</span>)
<span style="color: #b22222;"># </span><span style="color: #b22222;">Note that if the replacements are not compatible with .x,</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">unmatched values are replaced by NA and a warning is issued.</span>
dplyr::recode(num_vec, <span style="color: #000000; background-color: #ffffff;">`2`</span> = <span style="color: #8b2252;">"b"</span>, <span style="color: #000000; background-color: #ffffff;">`4`</span> = <span style="color: #8b2252;">"d"</span>)
<span style="color: #b22222;"># </span><span style="color: #b22222;">use .missing to replace missing values in .x</span>
dplyr::recode(num_vec, <span style="color: #8b2252;">"a"</span>, <span style="color: #8b2252;">"b"</span>, <span style="color: #8b2252;">"c"</span>, .default = <span style="color: #8b2252;">"other"</span>, .missing = <span style="color: #8b2252;">"missing"</span>)
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "a"       "b"       "c"       "other"   "missing"</span>
</pre>
</div>
</div>
</div>

<div id="orgdf8fde0" class="outline-4">
<h4 id="orgdf8fde0"><span class="section-number-4">12.2.29</span> recode<sub>factor</sub>()</h4>
<div class="outline-text-4" id="text-12-2-29">
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;"># </span><span style="color: #b22222;">Use recode_factor() to create factors with levels ordered as they</span>
                                      <span style="color: #b22222;"># </span><span style="color: #b22222;">appear in the recode call. The levels in .default and .missing</span>
                                      <span style="color: #b22222;"># </span><span style="color: #b22222;">come last.</span>
recode_factor(num_vec, <span style="color: #000000; background-color: #ffffff;">`1`</span> = <span style="color: #8b2252;">"z"</span>, <span style="color: #000000; background-color: #ffffff;">`2`</span> = <span style="color: #8b2252;">"y"</span>, <span style="color: #000000; background-color: #ffffff;">`3`</span> = <span style="color: #8b2252;">"x"</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Warning: Unreplaced values treated as NA as .x is not compatible. Please specify replacements exhaustively or supply .default</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] z    y    x    &lt;NA&gt; &lt;NA&gt;</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Levels: z y x</span>
recode_factor(num_vec, <span style="color: #000000; background-color: #ffffff;">`1`</span> = <span style="color: #8b2252;">"z"</span>, <span style="color: #000000; background-color: #ffffff;">`2`</span> = <span style="color: #8b2252;">"y"</span>, <span style="color: #000000; background-color: #ffffff;">`3`</span> = <span style="color: #8b2252;">"x"</span>,
              .default = <span style="color: #8b2252;">"D"</span>)
char_vec <span style="color: #008b8b;">&lt;-</span> sample(c(<span style="color: #8b2252;">"a"</span>, <span style="color: #8b2252;">"b"</span>, <span style="color: #8b2252;">"c"</span>), <span style="color: #008b8b;">10</span>, replace = <span style="color: #228b22;">TRUE</span>)
char_vec
level_key <span style="color: #008b8b;">&lt;-</span> c(a = <span style="color: #8b2252;">"apple"</span>, b = <span style="color: #8b2252;">"banana"</span>, c = <span style="color: #8b2252;">"carrot"</span>)
recode_factor(char_vec, !!!level_key)
</pre>
</div>
</div>
</div>

<div id="org3ee0105" class="outline-4">
<h4 id="org3ee0105"><span class="section-number-4">12.2.30</span> near()</h4>
<div class="outline-text-4" id="text-12-2-30">
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">Compare two numeric vectors</span>
sqrt(<span style="color: #008b8b;">2</span>) ^ <span style="color: #008b8b;">2</span> == <span style="color: #008b8b;">2</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] FALSE</span>
near(sqrt(<span style="color: #008b8b;">2</span>) ^ <span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">2</span>,tol = .Machine$double.eps^<span style="color: #008b8b;">0.5</span>)
</pre>
</div>
</div>
</div>

<div id="org5d9ebba" class="outline-4">
<h4 id="org5d9ebba"><span class="section-number-4">12.2.31</span> rowwise()</h4>
<div class="outline-text-4" id="text-12-2-31">
<p>
这个函数可以方便对每行数据进行相同的操作，说白了就是对行进行分组计算。
rowwise() is used for the results of do() when you create list-variables. It is also useful to support arbitrary complex operations that need to be applied to each row.
</p>
<div class="org-src-container">
<pre class="src src-R">df <span style="color: #008b8b;">&lt;-</span> expand.grid(x = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>, y = <span style="color: #008b8b;">3</span>:<span style="color: #008b8b;">1</span>)
df <span style="color: #008b8b;">%&gt;%</span> dim()
df_done <span style="color: #008b8b;">&lt;-</span> df <span style="color: #008b8b;">%&gt;%</span> rowwise() <span style="color: #008b8b;">%&gt;%</span> do(i = seq(.$x, .$y))
df_done$i
</pre>
</div>

<div class="org-src-container">
<pre class="src src-R">iris <span style="color: #008b8b;">%&gt;%</span>
    select(Sepal.Length, Petal.Length) <span style="color: #008b8b;">%&gt;%</span>
    rowwise() <span style="color: #008b8b;">%&gt;%</span>
    mutate(Max.Len = max(Sepal.Length, Petal.Length)) <span style="color: #008b8b;">%&gt;%</span>
    head()
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Source: local data frame [6 x 3]</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Groups: &lt;by row&gt;</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; # A tibble: 6 x 3</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   Sepal.Length Petal.Length Max.Len</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;          &lt;dbl&gt;        &lt;dbl&gt;   &lt;dbl&gt;</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1          5.1          1.4     5.1</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2          4.9          1.4     4.9</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3          4.7          1.3     4.7</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 4          4.6          1.5     4.6</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 5          5            1.4     5  </span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 6          5.4          1.7     5.4</span>

iris <span style="color: #008b8b;">%&gt;%</span>
    select(Sepal.Length, Petal.Length) <span style="color: #008b8b;">%&gt;%</span>
    mutate(Max.Len = max(Sepal.Length, Petal.Length)) <span style="color: #008b8b;">%&gt;%</span>
    head()
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   Sepal.Length Petal.Length Max.Len</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1          5.1          1.4     7.9</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2          4.9          1.4     7.9</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3          4.7          1.3     7.9</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 4          4.6          1.5     7.9</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 5          5.0          1.4     7.9</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 6          5.4          1.7     7.9 </span>
</pre>
</div>
<p>
从上面的例子可以看出，没有对所有行分组的话，只是返回一个全局值，如果加入 rowwise 则会按照每行进行计算。
</p>
</div>
</div>
<div id="org67f4b0a" class="outline-4">
<h4 id="org67f4b0a"><span class="section-number-4">12.2.32</span> all<sub>equal</sub>()</h4>
<div class="outline-text-4" id="text-12-2-32">
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#21487;&#20197;&#27604;&#23545;&#20004;&#20010;&#39034;&#24207;&#23436;&#20840;&#19981;&#19968;&#33268;&#30340;&#25968;&#25454;&#26694;&#65292;&#25968;&#25454;&#26694;&#30340;&#31867;&#22411;&#36824;&#21487;&#20197;&#19981;&#19968;&#33268;</span>
  <span style="color: #0000ff;">scramble</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>(x) x[sample(nrow(x)), sample(ncol(x))]
                                        <span style="color: #b22222;"># </span><span style="color: #b22222;">By default, ordering of rows and columns ignored</span>
  all_equal(mtcars, scramble(mtcars))
  all_equal(mtcars, scramble(mtcars), ignore_col_order = <span style="color: #228b22;">FALSE</span>)
  all_equal(mtcars, scramble(mtcars), ignore_row_order = <span style="color: #228b22;">FALSE</span>)
                                        <span style="color: #b22222;"># </span><span style="color: #b22222;">By default all_equal is sensitive to variable differences</span>
  df1 <span style="color: #008b8b;">&lt;-</span> data.frame(x = <span style="color: #8b2252;">"a"</span>)
  df2 <span style="color: #008b8b;">&lt;-</span> data.frame(x = factor(<span style="color: #8b2252;">"a"</span>))
  all_equal(df1, df2)
                                        <span style="color: #b22222;"># </span><span style="color: #b22222;">But you can request dplyr convert similar types</span>
  all_equal(df1, df2, convert = <span style="color: #228b22;">TRUE</span>)
</pre>
</div>
</div>
</div>

<div id="org130f32e" class="outline-4">
<h4 id="org130f32e"><span class="section-number-4">12.2.33</span> rownames<sub>to</sub><sub>column</sub>/column<sub>to</sub><sub>rownames</sub></h4>
<div class="outline-text-4" id="text-12-2-33">
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#23558;&#34892;&#21517;&#36716;&#31227;&#21040; column</span>
a=rownames_to_column(iris, var = <span style="color: #8b2252;">"C"</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26032;&#24314;&#19968;&#20010;&#21015;&#21517; C&#65292;&#29992; id &#22635;&#20805;</span>
column_to_rownames(a, var = <span style="color: #8b2252;">"C"</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#29992;&#21464;&#37327; C &#22635;&#20805;&#34892;&#21517;</span>
</pre>
</div>
</div>
</div>
<div id="orge660a56" class="outline-4">
<h4 id="orge660a56"><span class="section-number-4">12.2.34</span> do</h4>
<div class="outline-text-4" id="text-12-2-34">
<p>
You can use do() to perform arbitrary computation, returning either a data frame or arbitrary objects which will be stored in a list.
</p>

<div class="org-src-container">
<pre class="src src-R">by_cyl <span style="color: #008b8b;">&lt;-</span> group_by(mtcars, cyl)
do(by_cyl, head(., <span style="color: #008b8b;">2</span>))
models <span style="color: #008b8b;">&lt;-</span> by_cyl <span style="color: #008b8b;">%&gt;%</span> do(mod = lm(mpg ~ disp, data = .))
models
</pre>
</div>
</div>
</div>
<div id="orge2e2ab1" class="outline-4">
<h4 id="orge2e2ab1"><span class="section-number-4">12.2.35</span> tbl<sub>df</sub>()</h4>
<div class="outline-text-4" id="text-12-2-35">
<div class="org-src-container">
<pre class="src src-R">set.seed(<span style="color: #008b8b;">100</span>)
ds <span style="color: #008b8b;">&lt;-</span> data.frame(group=c(rep(<span style="color: #8b2252;">"a"</span>,<span style="color: #008b8b;">100</span>), rep(<span style="color: #8b2252;">"b"</span>,<span style="color: #008b8b;">100</span>), rep(<span style="color: #8b2252;">"c"</span>,<span style="color: #008b8b;">100</span>)), 
                 x=rnorm(n = <span style="color: #008b8b;">300</span>, mean = <span style="color: #008b8b;">3</span>, sd = <span style="color: #008b8b;">2</span>), y=rnorm(n = <span style="color: #008b8b;">300</span>, mean = <span style="color: #008b8b;">2</span>, sd = <span style="color: #008b8b;">2</span>))
ds <span style="color: #008b8b;">%&gt;%</span> tbl_df()

ds <span style="color: #008b8b;">%&gt;%</span> group_by(group) <span style="color: #008b8b;">%&gt;%</span> do(.$x&gt;<span style="color: #008b8b;">3</span>)

ds <span style="color: #008b8b;">%&gt;%</span>
    tbl_df <span style="color: #008b8b;">%&gt;%</span>
    group_by(group) <span style="color: #008b8b;">%&gt;%</span>
    do(.$x&gt;<span style="color: #008b8b;">3</span>)
</pre>
</div>
</div>
</div>

<div id="org2a8e97e" class="outline-4">
<h4 id="org2a8e97e"><span class="section-number-4">12.2.36</span> src<sub>dbi</sub>()</h4>
<div class="outline-text-4" id="text-12-2-36">
<div class="org-src-container">
<pre class="src src-R">con <span style="color: #008b8b;">&lt;-</span> DBI::dbConnect(RSQLite::SQLite(), <span style="color: #8b2252;">":memory:"</span>)
copy_to(con, mtcars)
DBI::dbListTables(con)
                                      <span style="color: #b22222;"># </span><span style="color: #b22222;">To retrieve a single table from a source, use `tbl()`</span>
con <span style="color: #008b8b;">%&gt;%</span> tbl(<span style="color: #8b2252;">"mtcars"</span>)
con <span style="color: #008b8b;">%&gt;%</span> tbl(sql(<span style="color: #8b2252;">"SELECT * FROM mtcars WHERE cyl == 8"</span>))
</pre>
</div>
</div>
</div>
<div id="orgb188c18" class="outline-4">
<h4 id="orgb188c18"><span class="section-number-4">12.2.37</span> coalesce()</h4>
<div class="outline-text-4" id="text-12-2-37">
<p>
不熟悉了～这个函数可以用来填补缺失值，也可以用现成的向量作互补填值。
</p>
<div class="org-src-container">
<pre class="src src-R">  x <span style="color: #008b8b;">&lt;-</span> sample(c(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">5</span>, <span style="color: #228b22;">NA</span>, <span style="color: #228b22;">NA</span>, <span style="color: #228b22;">NA</span>))
  x
  <span style="color: #b22222;">#</span><span style="color: #b22222;">[1] NA NA  2  3  1 NA  5  4</span>
  coalesce(x, <span style="color: #008b8b;">0L</span>)  <span style="color: #b22222;">#</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">[1] 0 0 2 3 1 0 5 4</span>
  y <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">2</span>, <span style="color: #228b22;">NA</span>, <span style="color: #228b22;">NA</span>, <span style="color: #008b8b;">5</span>)
  z <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #228b22;">NA</span>, <span style="color: #228b22;">NA</span>, <span style="color: #008b8b;">3</span>, <span style="color: #008b8b;">4</span>, <span style="color: #008b8b;">5</span>)
  coalesce(y, z)

                                        <span style="color: #b22222;"># </span><span style="color: #b22222;">Supply lists by splicing them into dots:</span>
  vecs <span style="color: #008b8b;">&lt;-</span> list(
      c(<span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">2</span>, <span style="color: #228b22;">NA</span>, <span style="color: #228b22;">NA</span>, <span style="color: #008b8b;">5</span>),
      c(<span style="color: #228b22;">NA</span>, <span style="color: #228b22;">NA</span>, <span style="color: #008b8b;">3</span>, <span style="color: #008b8b;">4</span>, <span style="color: #008b8b;">5</span>)
  )
  coalesce(!!!vecs) <span style="color: #b22222;">##</span><span style="color: #b22222;">&#23545;list&#22411;&#25968;&#25454;&#38656;&#35201;&#27880;&#24847;&#21152;&#65281;&#65281;&#65281;</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-R">df <span style="color: #008b8b;">&lt;-</span> tribble(
    ~date, ~item, ~sales, ~store,
    <span style="color: #8b2252;">"2020-03-01"</span>, <span style="color: #8b2252;">"apples"</span>, <span style="color: #008b8b;">1</span>, <span style="color: #228b22;">NA_character_</span>,
    <span style="color: #8b2252;">"2020-03-01"</span>, <span style="color: #8b2252;">"bananas"</span>, <span style="color: #228b22;">NA_real_</span>, <span style="color: #8b2252;">"Loblaws"</span>
)

df
<span style="color: #b22222;">## </span><span style="color: #b22222;"># A tibble: 2 x 4</span>
<span style="color: #b22222;">##   </span><span style="color: #b22222;">date       item    sales store  </span>
<span style="color: #b22222;">##   </span><span style="color: #b22222;">&lt;chr&gt;      &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt;  </span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">1 2020-03-01 apples      1 &lt;NA&gt;   </span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">2 2020-03-01 bananas    NA Loblaws</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;"># </span><span style="color: #b22222;">Use coalesce() to quickly replace them</span>
df <span style="color: #008b8b;">%&gt;%</span>
    mutate(
        sales = coalesce(sales, <span style="color: #008b8b;">0</span>),
        store = coalesce(store, <span style="color: #8b2252;">"Unknown"</span>)
    )
<span style="color: #b22222;">## </span><span style="color: #b22222;"># A tibble: 2 x 4</span>
<span style="color: #b22222;">##   </span><span style="color: #b22222;">date       item    sales store  </span>
<span style="color: #b22222;">##   </span><span style="color: #b22222;">&lt;chr&gt;      &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt;  </span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">1 2020-03-01 apples      1 Unknown</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">2 2020-03-01 bananas     0 Loblaws</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-R">tribble(
    ~id, ~x_best_method, ~x_decent_method, ~x_last_ditch_effort,
    <span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">1.05</span>, <span style="color: #008b8b;">1.1</span>,
    <span style="color: #008b8b;">2</span>, <span style="color: #228b22;">NA_real_</span>, <span style="color: #008b8b;">2.05</span>, <span style="color: #008b8b;">2.2</span>,
    <span style="color: #008b8b;">3</span>, <span style="color: #228b22;">NA_real_</span>, <span style="color: #228b22;">NA_real_</span>, <span style="color: #008b8b;">3.3</span>,
    <span style="color: #008b8b;">4</span>, <span style="color: #228b22;">NA_real_</span>, <span style="color: #228b22;">NA_real_</span>, <span style="color: #228b22;">NA_real_</span>
) <span style="color: #008b8b;">%&gt;%</span>
    mutate(x_estimate = coalesce(x_best_method, x_decent_method, x_last_ditch_effort, <span style="color: #008b8b;">0</span>))
<span style="color: #b22222;">## </span><span style="color: #b22222;"># A tibble: 4 x 5</span>
<span style="color: #b22222;">##      </span><span style="color: #b22222;">id x_best_method x_decent_method x_last_ditch_effort x_estimate</span>
<span style="color: #b22222;">##   </span><span style="color: #b22222;">&lt;dbl&gt;         &lt;dbl&gt;           &lt;dbl&gt;               &lt;dbl&gt;      &lt;dbl&gt;</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">1     1             1            1.05                 1.1       1   </span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">2     2            NA            2.05                 2.2       2.05</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">3     3            NA           NA                    3.3       3.3 </span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">4     4            NA           NA                   NA         0</span>
</pre>
</div>
</div>
</div>
<div id="orgc143f0a" class="outline-4">
<h4 id="orgc143f0a"><span class="section-number-4">12.2.38</span> separate<sub>rows</sub></h4>
<div class="outline-text-4" id="text-12-2-38">
<p>
Separate a collapsed column into multiple rows.
</p>
<div class="org-src-container">
<pre class="src src-R">df <span style="color: #008b8b;">&lt;-</span> tribble(
    ~date, ~items,
    <span style="color: #8b2252;">"2020-03-01"</span>, <span style="color: #8b2252;">"apples, bananas, tofu"</span>,
    <span style="color: #8b2252;">"2020-03-02"</span>, <span style="color: #8b2252;">"oats, cherries, bread"</span>
)

                                  <span style="color: #b22222;"># </span><span style="color: #b22222;">Use separate_rows to separate the column into multiple rows</span>
df <span style="color: #008b8b;">%&gt;%</span>
    separate_rows(items)
<span style="color: #b22222;">## </span><span style="color: #b22222;"># A tibble: 6 x 2</span>
<span style="color: #b22222;">##   </span><span style="color: #b22222;">date       items   </span>
<span style="color: #b22222;">##   </span><span style="color: #b22222;">&lt;chr&gt;      &lt;chr&gt;   </span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">1 2020-03-01 apples  </span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">2 2020-03-01 bananas </span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">3 2020-03-01 tofu    </span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">4 2020-03-02 oats    </span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">5 2020-03-02 cherries</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">6 2020-03-02 bread</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;"># </span><span style="color: #b22222;">Detects the separator automatically, but sometimes that's not great!</span>
tribble(
    ~date, ~items,
    <span style="color: #8b2252;">"2020-03-01; 2020-03-02"</span>, <span style="color: #8b2252;">"apples, bananas, tofu; oats, cherries, bread"</span>
) <span style="color: #008b8b;">%&gt;%</span>
    separate_rows(date, items)
<span style="color: #b22222;">## </span><span style="color: #b22222;"># A tibble: 6 x 2</span>
<span style="color: #b22222;">##   </span><span style="color: #b22222;">date  items   </span>
<span style="color: #b22222;">##   </span><span style="color: #b22222;">&lt;chr&gt; &lt;chr&gt;   </span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">1 2020  apples  </span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">2 03    bananas </span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">3 01    tofu    </span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">4 2020  oats    </span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">5 03    cherries</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">6 02    bread</span>

                                  <span style="color: #b22222;"># </span><span style="color: #b22222;">Set it yourself:</span>
tribble(
    ~date, ~items,
    <span style="color: #8b2252;">"2020-03-01; 2020-03-02"</span>, <span style="color: #8b2252;">"apples, bananas, tofu; oats, cherries, bread"</span>
) <span style="color: #008b8b;">%&gt;%</span>
    separate_rows(date, items, sep = <span style="color: #8b2252;">"; "</span>)
</pre>
</div>
</div>
</div>
<div id="orgb7252fe" class="outline-4">
<h4 id="orgb7252fe"><span class="section-number-4">12.2.39</span> separate</h4>
<div class="outline-text-4" id="text-12-2-39">
<div class="org-src-container">
<pre class="src src-R">iris <span style="color: #008b8b;">%&gt;%</span>
    dplyr::transmute(Sepal.Length = as.character(Sepal.Length)) <span style="color: #008b8b;">%&gt;%</span>
    tidyr::separate(
               col = Sepal.Length,
               into = c(<span style="color: #8b2252;">"Sep1"</span>, <span style="color: #8b2252;">"Sep2"</span>),
               sep = <span style="color: #8b2252;">"\\."</span>,
               remove = <span style="color: #228b22;">FALSE</span>
           ) <span style="color: #008b8b;">%&gt;%</span> head(<span style="color: #008b8b;">4</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Warning: Expected 2 pieces. Missing pieces filled with `NA` in 17 rows [5,</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 8, 26, 27, 36, 41, 44, 50, 51, 61, 63, 79, 84, 86, 94, 120, 139].</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   Sepal.Length Sep1 Sep2</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1          5.1    5    1</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2          4.9    4    9</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3          4.7    4    7</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 4          4.6    4    6      </span>
</pre>
</div>
</div>
</div>

<div id="org3b06a32" class="outline-4">
<h4 id="org3b06a32"><span class="section-number-4">12.2.40</span> combine()</h4>
<div class="outline-text-4" id="text-12-2-40">
<p>
combine() acts like c() or unlist() but uses consistent dplyr coercion rules.对因子型数据的 combine 特别有用。
</p>
<div class="org-src-container">
<pre class="src src-R">f1 <span style="color: #008b8b;">&lt;-</span> factor(<span style="color: #8b2252;">"a"</span>)
f2 <span style="color: #008b8b;">&lt;-</span> factor(<span style="color: #8b2252;">"b"</span>)
c(f1, f2) <span style="color: #008b8b;">%&gt;%</span> class()
unlist(list(f1, f2)) <span style="color: #008b8b;">%&gt;%</span> class()
combine(f1, f2) <span style="color: #008b8b;">%&gt;%</span> class() <span style="color: #b22222;"># </span><span style="color: #b22222;">char &#22411;</span>
combine(list(f1, f2)) <span style="color: #008b8b;">%&gt;%</span> class() <span style="color: #b22222;"># </span><span style="color: #b22222;">char &#22411;</span>
</pre>
</div>
</div>
</div>
<div id="org38631d7" class="outline-4">
<h4 id="org38631d7"><span class="section-number-4">12.2.41</span> ranking()</h4>
<div class="outline-text-4" id="text-12-2-41">
<ul class="org-ul">
<li>row<sub>number</sub>(): equivalent to rank(ties.method = "first")</li>

<li>min<sub>rank</sub>(): equivalent to rank(ties.method = "min")</li>

<li>dense<sub>rank</sub>(): like min<sub>rank</sub>(), but with no gaps between ranks</li>

<li>percent<sub>rank</sub>(): a number between 0 and 1 computed by rescaling min<sub>rank</sub> to [0, 1]</li>

<li>cume<sub>dist</sub>(): a cumulative distribution function. Proportion of all values less than or equal to the current rank.</li>

<li>ntile(): a rough rank, which breaks the input vector into n buckets.</li>
</ul>

<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #008b8b;">5</span>, <span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">3</span>, <span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">2</span>, <span style="color: #228b22;">NA</span>)
row_number(x)
min_rank(x)
dense_rank(x)
percent_rank(x)
cume_dist(x)
ntile(x, <span style="color: #008b8b;">2</span>)  
</pre>
</div>

<p>
row<sub>number</sub> 一般可以用来对数据进行排序，所以可以用来产生唯一的标识。
</p>
<div class="org-src-container">
<pre class="src src-R">xiaomi_id <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #8b2252;">"1"</span>,<span style="color: #8b2252;">"2"</span>,<span style="color: #8b2252;">"3"</span>,<span style="color: #8b2252;">"1"</span>)
credit_time <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #8b2252;">"20190101"</span>,<span style="color: #8b2252;">"20190201"</span>,<span style="color: #8b2252;">"20190401"</span>,<span style="color: #8b2252;">"20190101"</span>)
x1 <span style="color: #008b8b;">&lt;-</span> seq(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">4</span>)
df1 <span style="color: #008b8b;">&lt;-</span> tibble(xiaomi_id,credit_time,x1)
df1 <span style="color: #008b8b;">%&gt;%</span> mutate(dplyr::row_number(xiaomi_id))
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; # A tibble: 4 x 4</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   xiaomi_id credit_time    x1 `dplyr::row_number(xiaomi_id)`</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   &lt;chr&gt;     &lt;chr&gt;       &lt;int&gt;                          &lt;int&gt;</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1 1         20190101        1                              1</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2 2         20190201        2                              3</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3 3         20190401        3                              4</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 4 1         20190101        4                              2  </span>
</pre>
</div>
</div>
</div>

<div id="orge279077" class="outline-4">
<h4 id="orge279077"><span class="section-number-4">12.2.42</span> order<sub>by</sub>()</h4>
<div class="outline-text-4" id="text-12-2-42">
<p>
This function makes it possible to control the ordering of window functions in R that don't have a specific ordering parameter.
</p>
<div class="org-src-container">
<pre class="src src-R">order_by(<span style="color: #008b8b;">10</span>:<span style="color: #008b8b;">1</span>, cumsum(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">10</span>))
x <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">10</span>:<span style="color: #008b8b;">1</span>
y <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">10</span>
order_by(x, cumsum(y))

df <span style="color: #008b8b;">&lt;-</span> data.frame(year = <span style="color: #008b8b;">2000</span>:<span style="color: #008b8b;">2005</span>, value = (<span style="color: #008b8b;">0</span>:<span style="color: #008b8b;">5</span>) ^ <span style="color: #008b8b;">2</span>)
scrambled <span style="color: #008b8b;">&lt;-</span> df[sample(nrow(df)), ]

wrong <span style="color: #008b8b;">&lt;-</span> mutate(scrambled, running = cumsum(value))
arrange(wrong, year)

right <span style="color: #008b8b;">&lt;-</span> mutate(scrambled, running = order_by(year, cumsum(value)))
arrange(right, year)
</pre>
</div>
</div>
</div>
<div id="orgf224ca8" class="outline-4">
<h4 id="orgf224ca8"><span class="section-number-4">12.2.43</span> join</h4>
<div class="outline-text-4" id="text-12-2-43">
<ul class="org-ul">
<li>inner<sub>join</sub></li>
</ul>
<p>
连接方式包括内连接、外连接。内连接就是 inner<sub>join,这种连接就是等值连接,内连接最重要的性质是</sub>，没有匹配的行不会包含在结果中。这意味着内连接一般不适合在 分析中使用，因为太容易丢失观测了。。
</p>

<div class="org-src-container">
<pre class="src src-R"> <span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
inner_join(a, b, by = <span style="color: #8b2252;">"x1"</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">Join data. Retain only rows in both sets.</span>
 band_members <span style="color: #008b8b;">%&gt;%</span> inner_join(band_instruments)

</pre>
</div>

<ul class="org-ul">
<li>外连接</li>
</ul>

<p>
内连接保留同时存在于两个表中的观测，外连接则保留至少存在于一个表中的观测。外连 接有 3 种类型。
</p>

<ul class="org-ul">
<li>左连接 ：保留 x 中的所有观测。</li>
</ul>
<p>
left<sub>join</sub>()
</p>

<div class="org-src-container">
<pre class="src src-R">band_members <span style="color: #008b8b;">%&gt;%</span> left_join(band_instruments)
</pre>
</div>

<ul class="org-ul">
<li>右连接 ：保留 y 中的所有观测</li>
</ul>

<p>
right<sub>join</sub>()
</p>

<div class="org-src-container">
<pre class="src src-R">band_members <span style="color: #008b8b;">%&gt;%</span> right_join(band_instruments)
</pre>
</div>

<ul class="org-ul">
<li>全连接 ：保留 x 和 y 中的所有观测。</li>
</ul>
<p>
full<sub>join</sub>()
</p>

<div class="org-src-container">
<pre class="src src-R">band_members <span style="color: #008b8b;">%&gt;%</span> full_join(band_instruments)
</pre>
</div>

<ul class="org-ul">
<li>筛选连接</li>

<li>semi<sub>join</sub>(x, y) ： 保留 x 表中与 y 表中的观测相匹配的所有观测。q:和内连接有何不同？</li>
</ul>
<p>
与 inner<sub>join</sub> 不同的是， semi<sub>join</sub> 只会保留 x 中的特征，而不会新加 y 中的特征。
</p>
<div class="org-src-container">
<pre class="src src-R">band_members <span style="color: #008b8b;">%&gt;%</span> semi_join(band_instruments)
</pre>
</div>

<ul class="org-ul">
<li>anti<sub>join</sub>(x, y) ： <b>丢弃 x 表中与 y 表中的观测相匹配的所有观测，或者说只保留与
y 中不同的观测。</b> 和 semi<sub>join</sub> 一样，只保留 x 中的特征。</li>
</ul>

<div class="org-src-container">
<pre class="src src-R">band_members <span style="color: #008b8b;">%&gt;%</span> anti_join(band_instrument)
</pre>
</div>

<ul class="org-ul">
<li>nest<sub>join</sub>()</li>
</ul>

<div class="org-src-container">
<pre class="src src-R">band_members <span style="color: #008b8b;">%&gt;%</span> nest_join(band_instruments)
</pre>
</div>
</div>
</div>

<div id="org5aa02d2" class="outline-4">
<h4 id="org5aa02d2"><span class="section-number-4">12.2.44</span> lead-lag</h4>
<div class="outline-text-4" id="text-12-2-44">
<p>
产生一个滞后向量和向前的向量。
</p>

<div class="org-src-container">
<pre class="src src-R">lead(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">10</span>, <span style="color: #008b8b;">1</span>)
lead(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">10</span>, <span style="color: #008b8b;">2</span>)
</pre>
</div>
<p>
这个函数的 order<sub>by</sub> 参数还是挺有用的。
</p>
<div class="org-src-container">
<pre class="src src-R">df <span style="color: #008b8b;">&lt;-</span> data.frame(year = <span style="color: #008b8b;">2000</span>:<span style="color: #008b8b;">2005</span>, value = (<span style="color: #008b8b;">0</span>:<span style="color: #008b8b;">5</span>) ^ <span style="color: #008b8b;">2</span>)
scrambled <span style="color: #008b8b;">&lt;-</span> df[sample(nrow(df)), ]
scrambled <span style="color: #008b8b;">%&gt;%</span> mutate(prev = lag(value, order_by = year)) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21487;&#20197;&#37197;&#21512;order_by &#20351;&#29992;</span>
</pre>
</div>
</div>
</div>

<div id="orgbc9f57e" class="outline-4">
<h4 id="orgbc9f57e"><span class="section-number-4">12.2.45</span> set manipulation</h4>
<div class="outline-text-4" id="text-12-2-45">
<p>
intersect(x, y) 返回既在 x 表，又在 y 表中的观测。
union(x, y) 返回 x 表或 y 表中的唯一观测,其实就是并集的概念。还有一个是 <b>union<sub>all</sub>(),类似于 bind<sub>rows</sub>()</b>,dplyr 的 union<sub>all</sub> 会对不存在的字段补空值，所以除非碰到相同字段左右类型不一样且无法隐式转换，否则 union<sub>all</sub> 任何情况下都不会报错。
setdiff(x, y) 返回在 x 表，但不在 y 表中的观测。
setequal(x,y):可以比较两个向量是否一致，顺序不一致也可以。
intersect(y, z) 
Rows that appear in both y and z.
</p>

<p>
union(y, z) 
Rows that appear in either or both y an
</p>

<p>
setdiff(y, z) 
Rows that appear in y but not z. 保留在 y 中的，但不在 z 中的。
</p>

<div class="org-src-container">
<pre class="src src-R">  <span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
  y <span style="color: #008b8b;">&lt;-</span> tibble(x1 = c(<span style="color: #8b2252;">"A"</span>, <span style="color: #8b2252;">"B"</span>, <span style="color: #8b2252;">"C"</span>), x2 = c(<span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">3</span>))
  z <span style="color: #008b8b;">&lt;-</span> tibble(x1 = c(<span style="color: #8b2252;">"B"</span>, <span style="color: #8b2252;">"C"</span>, <span style="color: #8b2252;">"D"</span>), x2 = c(<span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">3</span>, <span style="color: #008b8b;">4</span>))
  union(y, z) 
union_all(y,z)
intersect(y,z)
setdiff(y,z) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20445;&#30041;&#19979;y&#20013;&#29420;&#26377;&#30340;&#20540;,&#21435;&#38500;&#37325;&#22797;&#30340;&#21435;&#38500;&#37325;&#22797;&#30340;</span>
  a <span style="color: #008b8b;">&lt;-</span> rep(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>, <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>)
  b <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>
  setequal(a, b)  <span style="color: #b22222;"># </span><span style="color: #b22222;">TRUE</span>
  identical(a, b)  <span style="color: #b22222;"># </span><span style="color: #b22222;">FALSE</span>
  setequal(mtcars, mtcars[<span style="color: #008b8b;">32</span>:<span style="color: #008b8b;">1</span>, ])
</pre>
</div>
</div>
</div>
</div>

<div id="orgbb8d4d3" class="outline-3">
<h3 id="orgbb8d4d3"><span class="section-number-3">12.3</span> dbplyr</h3>
<div class="outline-text-3" id="text-12-3">
<p>
此包简直就是学习 sql 神器！
</p>
</div>
<div id="org8492fa3" class="outline-4">
<h4 id="org8492fa3"><span class="section-number-4">12.3.1</span> sql<sub>render</sub></h4>
<div class="outline-text-4" id="text-12-3-1">
<p>
这个命令可以将 dplyr 包命令转换为 sql 语句。
</p>
<div class="org-src-container">
<pre class="src src-R">con <span style="color: #008b8b;">&lt;-</span> DBI::dbConnect(RSQLite::SQLite(), path = <span style="color: #8b2252;">":dbname:"</span>)
copy_to(con, nycflights13::flights, <span style="color: #8b2252;">"flights"</span>,
        temporary = <span style="color: #228b22;">FALSE</span>, 
        indexes = list(
            c(<span style="color: #8b2252;">"year"</span>, <span style="color: #8b2252;">"month"</span>, <span style="color: #8b2252;">"day"</span>), 
            <span style="color: #8b2252;">"carrier"</span>, 
            <span style="color: #8b2252;">"tailnum"</span>,
            <span style="color: #8b2252;">"dest"</span>
        )
        )
flights_db <span style="color: #008b8b;">&lt;-</span> tbl(con, <span style="color: #8b2252;">"flights"</span>)
flights_db <span style="color: #008b8b;">%&gt;%</span> select(year:day, dep_delay, arr_delay) <span style="color: #008b8b;">%&gt;%</span> 
    show_query()
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; &lt;SQL&gt;</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; SELECT `year`, `month`, `day`, `dep_delay`, `arr_delay`</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; FROM `flights`  </span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #008b8b;">library</span>(DBI)
<span style="color: #008b8b;">library</span>(dbplyr)
test <span style="color: #008b8b;">&lt;-</span> mtcars <span style="color: #008b8b;">%&gt;%</span>
    summarise_all(mean) <span style="color: #008b8b;">%&gt;%</span>
    show_query() <span style="color: #b22222;"># </span><span style="color: #b22222;">&#27880;&#24847;&#22312; spark &#29615;&#22659;&#19979;&#21487;&#20197;&#29992; show_query()&#26174;&#31034; sql &#35821;&#21477;</span>
mtcars <span style="color: #008b8b;">%&gt;%</span> summarise(mean) <span style="color: #b22222;"># </span><span style="color: #b22222;">return na</span>
sql_render(test) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21487;&#20197;&#27604;&#36739; dplyr &#35821;&#27861;&#19982;&#23427;&#20135;&#29983;&#30340; SQL&#65306;</span>
</pre>
</div>
</div>
</div>

<div id="orga0ff1ed" class="outline-4">
<h4 id="orga0ff1ed"><span class="section-number-4">12.3.2</span> translate<sub>sql</sub>()</h4>
<div class="outline-text-4" id="text-12-3-2">
<div class="org-src-container">
<pre class="src src-R">translate_sql(x == <span style="color: #008b8b;">1</span> &amp;&amp; (y &lt; <span style="color: #008b8b;">2</span> || z &gt; <span style="color: #008b8b;">3</span>))
</pre>
</div>
</div>
</div>
</div>
<div id="orgc9abb97" class="outline-3">
<h3 id="orgc9abb97"><span class="section-number-3">12.4</span> purrr</h3>
<div class="outline-text-3" id="text-12-4">
<p>
这个函数主要应用于 list 型。
</p>
</div>
<div id="org8360b65" class="outline-4">
<h4 id="org8360b65"><span class="section-number-4">12.4.1</span> accumulate</h4>
<div class="outline-text-4" id="text-12-4-1">
<p>
accumulate 其实是 reduce 的一种改良版本。可以把 reduce 所得结果的整个过程输出。
accumulate() sequentially applies a 2-argument function to elements of a vector. 
类似于 cum 等累计函数，还可以选择方向进行计算。accumulate2():For accumulate2() .y is the second argument of the pair. It needs to be 1 element shorter than the vector to be accumulated (.x). If .init is set, .y needs to be one element shorted than the concatenation of the initial value and .x.
accumulate(.x, .f, &#x2026;, .init, .dir = c("forward", "backward"))
accumulate2(.x, .y, .f, &#x2026;, .init)
</p>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">5</span> <span style="color: #008b8b;">%&gt;%</span> accumulate(<span style="color: #000000; background-color: #ffffff;">`+`</span>)
<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">5</span> <span style="color: #008b8b;">%&gt;%</span> accumulate(<span style="color: #000000; background-color: #ffffff;">`+`</span>, .dir = <span style="color: #8b2252;">"backward"</span>)
</pre>
</div>

<p>
accumulate 不光能够处理数字，还能处理字符。请注意下面函数的 argument.
</p>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
accumulate(letters[<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">5</span>], paste, sep = <span style="color: #8b2252;">"."</span>)
accumulate(letters[<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">5</span>], paste, sep = <span style="color: #8b2252;">"."</span>, .dir = <span style="color: #8b2252;">"backward"</span>)
letters[<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">4</span>] <span style="color: #008b8b;">%&gt;%</span> accumulate2(c(<span style="color: #8b2252;">"-"</span>, <span style="color: #8b2252;">"."</span>, <span style="color: #8b2252;">"-"</span>), paste2)
</pre>
</div>
</div>
</div>

<div id="org5dce560" class="outline-4">
<h4 id="org5dce560"><span class="section-number-4">12.4.2</span> accumulate2</h4>
<div class="outline-text-4" id="text-12-4-2">
<div class="org-src-container">
<pre class="src src-R"><span style="color: #0000ff;">paste2</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>(x, y, sep = <span style="color: #8b2252;">"."</span>) paste(x, y, sep = sep)
letters[<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">4</span>] <span style="color: #008b8b;">%&gt;%</span> 
    accumulate2(c(<span style="color: #8b2252;">"-"</span>, <span style="color: #8b2252;">"."</span>, <span style="color: #8b2252;">"-"</span>), paste2)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[1]]</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "a"</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[2]]</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "a-b"</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[3]]</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "a-b.c"</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[4]]</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "a-b.c-d"      </span>
</pre>
</div>
</div>
</div>

<div id="orga0192a9" class="outline-4">
<h4 id="orga0192a9"><span class="section-number-4">12.4.3</span> simplify</h4>
<div class="outline-text-4" id="text-12-4-3">
<p>
Coerce a list to a vector.
</p>
<div class="org-src-container">
<pre class="src src-R">list(x = <span style="color: #008b8b;">1</span>, y = <span style="color: #008b8b;">1</span>) <span style="color: #008b8b;">%&gt;%</span> 
    simplify()
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; x y </span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1 1</span>
list(x=<span style="color: #008b8b;">1</span>,y=<span style="color: #008b8b;">1</span>) <span style="color: #008b8b;">%&gt;%</span> as_vector()  
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; x y </span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1 1</span>
as.list(letters) <span style="color: #008b8b;">%&gt;%</span> as_vector(<span style="color: #8b2252;">"character"</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [1] "a" "b" "c" "d" "e" "f" "g" "h" "i" "j" "k" "l" "m" "n" "o" "p" "q"</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [18] "r" "s" "t" "u" "v" "w" "x" "y" "z"</span>
</pre>
</div>
</div>
</div>
<div id="orgcc41438" class="outline-4">
<h4 id="orgcc41438"><span class="section-number-4">12.4.4</span> working with list</h4>
<div class="outline-text-4" id="text-12-4-4">
</div>
<div id="org66e24f4" class="outline-5">
<h5 id="org66e24f4"><span class="section-number-5">12.4.4.1</span> array<sub>branch</sub></h5>
<div class="outline-text-5" id="text-12-4-4-1">
<p>
Coerce array to list,这个函数可以将 array 型数据转化为 list 型。array<sub>branch</sub>()
and array<sub>tree</sub>() enable arrays to be used with purrr's functionals by turning them into lists.
</p>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
x <span style="color: #008b8b;">&lt;-</span> array(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">2</span>)
x
array_branch(x) <span style="color: #008b8b;">%&gt;%</span> str()
<span style="color: #b22222;">## </span><span style="color: #b22222;">[[1]]</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] 1</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">[[2]]</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] 2</span>
</pre>
</div>

<p>
这个命令类似于 as.list,而非 list 命令。
</p>

<div class="org-src-container">
<pre class="src src-R">
reprex({
    <span style="color: #008b8b;">library</span>(purrr)
    x <span style="color: #008b8b;">&lt;-</span> array(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">2</span>)
    x
    array_branch(x)
    as.list(x)
    list(x)
})
<span style="color: #008b8b;">library</span>(purrr)
x <span style="color: #008b8b;">&lt;-</span> array(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">2</span>)
x
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 1 2</span>
array_branch(x)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[1]]</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 1</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[2]]</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 2</span>
as.list(x)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[1]]</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 1</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[2]]</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 2</span>
list(x)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[1]]</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 1 2</span>

</pre>
</div>
</div>
</div>


<div id="org93768e4" class="outline-5">
<h5 id="org93768e4"><span class="section-number-5">12.4.4.2</span> array<sub>tree</sub></h5>
<div class="outline-text-5" id="text-12-4-4-2">
<p>
array<sub>tree</sub>() creates an hierarchical list (a tree) that has as many levels as dimensions specified in margin.
</p>
<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> array(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">12</span>, c(<span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">3</span>))
x
array_tree(x) <span style="color: #008b8b;">%&gt;%</span> str()
</pre>
</div>
</div>
</div>

<div id="org03cd13f" class="outline-5">
<h5 id="org03cd13f"><span class="section-number-5">12.4.4.3</span> cross</h5>
<div class="outline-text-5" id="text-12-4-4-3">
<p>
cross 是对一个数据组的数据进行扩展，即可产生所有可能的数据记录。
Produce all combinations of list elements
</p>
<div class="org-src-container">
<pre class="src src-R">data <span style="color: #008b8b;">&lt;-</span> list(
    id = c(<span style="color: #8b2252;">"John"</span>, <span style="color: #8b2252;">"Jane"</span>),
    greeting = c(<span style="color: #8b2252;">"Hello."</span>, <span style="color: #8b2252;">"Bonjour."</span>),
    sep = c(<span style="color: #8b2252;">"! "</span>, <span style="color: #8b2252;">"... "</span>)
)
data <span style="color: #008b8b;">%&gt;%</span>
    cross() <span style="color: #008b8b;">%&gt;%</span>
    map(lift(paste))
</pre>
</div>
</div>
</div>

<div id="orgd7a99c6" class="outline-5">
<h5 id="orgd7a99c6"><span class="section-number-5">12.4.4.4</span> cross2</h5>
<div class="outline-text-5" id="text-12-4-4-4">
<p>
cross2() returns the product set of the elements of .x and .y. 可以对 2 个数据集产生所有的可能的数据记录。
</p>
<div class="org-src-container">
<pre class="src src-R">seq_len(<span style="color: #008b8b;">3</span>) <span style="color: #008b8b;">%&gt;%</span>
    cross2(., ., .filter = <span style="color: #000000; background-color: #ffffff;">`==`</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[1]]</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[1]][[1]]</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 2</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[1]][[2]]</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 1</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[2]]</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[2]][[1]]</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 3</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[2]][[2]]</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 1</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[3]]</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[3]][[1]]</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 1</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[3]][[2]]</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 2</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[4]]</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[4]][[1]]</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 3</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[4]][[2]]</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 2</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[5]]</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[5]][[1]]</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 1</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[5]][[2]]</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 3</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[6]]</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[6]][[1]]</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 2</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[6]][[2]]</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 3 </span>
</pre>
</div>
</div>
</div>

<div id="orgd9fa8e5" class="outline-5">
<h5 id="orgd9fa8e5"><span class="section-number-5">12.4.4.5</span> cross<sub>df</sub></h5>
<div class="outline-text-5" id="text-12-4-4-5">
<div class="org-src-container">
<pre class="src src-R">list(stores = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">2</span>, weeks = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>) <span style="color: #008b8b;">%&gt;%</span> cross_df()
<span style="color: #b22222;"># </span><span style="color: #b22222;">A tibble: 6 x 2</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">stores weeks</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">&lt;int&gt; &lt;int&gt;</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">1      1     1</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">2      2     1</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">3      1     2</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">4      2     2</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">5      1     3</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">6      2     3</span>
</pre>
</div>
</div>
</div>
<div id="org390627c" class="outline-5">
<h5 id="org390627c"><span class="section-number-5">12.4.4.6</span> set<sub>names</sub></h5>
<div class="outline-text-5" id="text-12-4-4-6">
<div class="org-src-container">
<pre class="src src-R">set_names(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">4</span>, c(<span style="color: #8b2252;">"a"</span>, <span style="color: #8b2252;">"b"</span>, <span style="color: #8b2252;">"c"</span>, <span style="color: #8b2252;">"d"</span>))
</pre>
</div>

<p>
还能跟 function 结合！
</p>

<div class="org-src-container">
<pre class="src src-R">list(a = <span style="color: #008b8b;">1</span>, b = <span style="color: #008b8b;">2</span>) <span style="color: #008b8b;">%&gt;%</span>
    set_names(paste0, <span style="color: #8b2252;">"_element"</span>)
<span style="color: #b22222;">## </span><span style="color: #b22222;">$a_element</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] 1</span>
<span style="color: #b22222;">## </span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">$b_element</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] 2</span>
</pre>
</div>
</div>
</div>
</div>

<div id="org1c8253f" class="outline-4">
<h4 id="org1c8253f"><span class="section-number-4">12.4.5</span> assign<sub>in</sub></h4>
<div class="outline-text-4" id="text-12-4-5">
<p>
assign<sub>in</sub>() takes a data structure and a pluck location, assigns a value there, and returns the modified data structure。对于固定位置变量取值进行替换。
</p>

<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> list(list(bar = <span style="color: #008b8b;">1</span>, foo = c(<span style="color: #008b8b;">1</span>,<span style="color: #008b8b;">2</span>)))
x
x <span style="color: #008b8b;">%&gt;%</span>
    assign_in(list(<span style="color: #008b8b;">1</span>,<span style="color: #8b2252;">"foo"</span>),<span style="color: #008b8b;">100</span>)
</pre>
</div>
</div>
</div>

<div id="orgb27e79c" class="outline-4">
<h4 id="orgb27e79c"><span class="section-number-4">12.4.6</span> modify<sub>in</sub></h4>
<div class="outline-text-4" id="text-12-4-6">
<p>
该函数功能和 assign<sub>in</sub> 类似，但是允许取值和变量存在函数映射关系。 
</p>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
  x <span style="color: #008b8b;">&lt;-</span> list(list(bar = <span style="color: #008b8b;">1</span>, foo = <span style="color: #008b8b;">2</span>))
  x <span style="color: #008b8b;">%&gt;%</span> 
  modify_in(list(<span style="color: #008b8b;">1</span>, <span style="color: #8b2252;">"foo"</span>), ~ .x * <span style="color: #008b8b;">200</span>)
  modify_in(x, list(<span style="color: #008b8b;">1</span>,<span style="color: #8b2252;">"foo"</span>),<span style="color: #000000; background-color: #ffffff;">`+`</span>,<span style="color: #008b8b;">100</span>)
</pre>
</div>
</div>
</div>
<div id="org434be7a" class="outline-4">
<h4 id="org434be7a"><span class="section-number-4">12.4.7</span> pluck</h4>
<div class="outline-text-4" id="text-12-4-7">
<p>
从这个函数名字可以知道，叫摘下。
select an element by name or index,pluck(x,"b").这个函数类似于 select。pluck 还是挺方便的，对于不存在的元素还可以赋值 na。还有一个函数为 chuck,跟 pluck 相比，它能返回错误信息，所以使用起来更为方便。
pluck(x, 1) 的作用就像是 x[ [1] ]. pluck 也支持函数。
</p>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;"># </span><span style="color: #b22222;">list of data structures:</span>
obj1 <span style="color: #008b8b;">&lt;-</span> list(<span style="color: #8b2252;">"a"</span>, list(<span style="color: #008b8b;">1</span>, elt = <span style="color: #8b2252;">"foobar"</span>))
obj2 <span style="color: #008b8b;">&lt;-</span> list(<span style="color: #8b2252;">"b"</span>, list(<span style="color: #008b8b;">2</span>, elt = <span style="color: #8b2252;">"foobaz"</span>))
x <span style="color: #008b8b;">&lt;-</span> list(obj1, obj2)
<span style="color: #0000ff;">my_element</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>(x) x[[<span style="color: #008b8b;">2</span>]]$elt
pluck(x, <span style="color: #008b8b;">1</span>, my_element)
pluck(x, <span style="color: #008b8b;">2</span>, my_element)
pluck(x, <span style="color: #008b8b;">2</span>)
x[[<span style="color: #008b8b;">1</span>]][[<span style="color: #008b8b;">2</span>]]$elt
<span style="color: #b22222;">###</span><span style="color: #b22222;">pluck &#22909;&#29992;&#65281;</span>
test <span style="color: #008b8b;">&lt;-</span> list(x=c(<span style="color: #008b8b;">1</span>,<span style="color: #008b8b;">2</span>),y=c(<span style="color: #008b8b;">2</span>,<span style="color: #008b8b;">3</span>))
pluck(test,<span style="color: #008b8b;">1</span>)
pluck(test,<span style="color: #8b2252;">"x"</span>)[<span style="color: #008b8b;">2</span>]
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36824;&#21487;&#20197;&#21462;&#22810;&#32500;&#25968;&#25454;</span>
?pluck
pluck(x, <span style="color: #008b8b;">10</span>, .default = <span style="color: #228b22;">NA</span>) <span style="color: #b22222;">## </span><span style="color: #b22222;">By default, pluck() consistently returns `NULL` when an element</span>
                                      <span style="color: #b22222;"># </span><span style="color: #b22222;">does not exist:</span>
<span style="color: #0000ff;">my_element</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>(x) x[[<span style="color: #008b8b;">2</span>]]$elt
idx <span style="color: #008b8b;">&lt;-</span> list(<span style="color: #008b8b;">1</span>, my_element)
pluck(x, !!!idx)
</pre>
</div>
</div>
</div>

<div id="org0a2bcf8" class="outline-4">
<h4 id="org0a2bcf8"><span class="section-number-4">12.4.8</span> map</h4>
<div class="outline-text-4" id="text-12-4-8">
<p>
The map() functions use pluck() by default to retrieve multiple values from a list:
map 也可以和 pluck 一样，摘取 list 中的元素。但是和 pluck 不同的是，map 
</p>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">10</span> <span style="color: #008b8b;">%&gt;%</span>
    map(<span style="color: #a020f0;">function</span>(x) rnorm(<span style="color: #008b8b;">2</span>, x))

obj1 <span style="color: #008b8b;">&lt;-</span> list(<span style="color: #8b2252;">"a"</span>, list(<span style="color: #008b8b;">1</span>, elt = <span style="color: #8b2252;">"foo"</span>))
obj2 <span style="color: #008b8b;">&lt;-</span> list(<span style="color: #8b2252;">"b"</span>, list(<span style="color: #008b8b;">2</span>, elt = <span style="color: #8b2252;">"bar"</span>))
x <span style="color: #008b8b;">&lt;-</span> list(obj1, obj2)
x
map(x, <span style="color: #008b8b;">2</span>)
map(x, list(<span style="color: #008b8b;">2</span>, <span style="color: #8b2252;">"elt"</span>))
                                      <span style="color: #b22222;"># </span><span style="color: #b22222;">You can also supply a default:</span>
map(x, list(<span style="color: #008b8b;">2</span>, <span style="color: #8b2252;">"elt"</span>, <span style="color: #008b8b;">10</span>), .default = <span style="color: #8b2252;">"superb default"</span>)

</pre>
</div>
</div>
</div>

<div id="org6fc61a9" class="outline-4">
<h4 id="org6fc61a9"><span class="section-number-4">12.4.9</span> exec</h4>
<div class="outline-text-4" id="text-12-4-9">
<p>
Usage
exec(.fn, &#x2026;, .env = caller<sub>env</sub>())
Arguments
.fn 
A function, or function name as a string.
</p>

<p>
&#x2026; 
Arguments to function.
</p>

<p>
These dots support tidy-dots features.
</p>

<p>
.env  
Environment in which to evaluate the call. This will be most useful if f is a
string, or the function has side-effects.
</p>

<p>
注意 exec 的 function 是 string 型。
</p>
<div class="org-src-container">
<pre class="src src-R">args <span style="color: #008b8b;">&lt;-</span> list(x = c(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">10</span>, <span style="color: #008b8b;">100</span>, <span style="color: #228b22;">NA</span>), na.rm = <span style="color: #228b22;">TRUE</span>)
exec(<span style="color: #8b2252;">"mean"</span>, !!!args)
exec(<span style="color: #8b2252;">"mean"</span>, !!!args, trim = <span style="color: #008b8b;">0.2</span>)      
                                  <span style="color: #b22222;"># </span><span style="color: #b22222;">exec() is not designed to generate pretty function calls. This is</span>
                                  <span style="color: #b22222;"># </span><span style="color: #b22222;">most easily seen if you call a function that captures the call:</span>
f <span style="color: #008b8b;">&lt;-</span> disp ~ cyl
exec(<span style="color: #8b2252;">"lm"</span>, f, data = mtcars)


</pre>
</div>
</div>
</div>
<div id="orgee8013a" class="outline-4">
<h4 id="orgee8013a"><span class="section-number-4">12.4.10</span> every</h4>
<div class="outline-text-4" id="text-12-4-10">
<p>
Do every or some elements of a list satisfy a predicate?
</p>
<div class="org-src-container">
<pre class="src src-R">y <span style="color: #008b8b;">&lt;-</span> list(<span style="color: #008b8b;">0</span>:<span style="color: #008b8b;">10</span>, <span style="color: #008b8b;">5.5</span>)
y <span style="color: #008b8b;">%&gt;%</span> every(is.numeric)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] TRUE</span>
y <span style="color: #008b8b;">%&gt;%</span> every(is.integer)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] FALSE</span>
</pre>
</div>
</div>
</div>
<div id="org5923c49" class="outline-4">
<h4 id="org5923c49"><span class="section-number-4">12.4.11</span> some</h4>
<div class="outline-text-4" id="text-12-4-11">
<p>
类似于 is.character
</p>

<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> list(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">5</span>,letters,list(<span style="color: #008b8b;">10</span>))
x <span style="color: #008b8b;">%&gt;%</span>
    some(is_character)
</pre>
</div>
</div>
</div>
<div id="orgbe0f21d" class="outline-4">
<h4 id="orgbe0f21d"><span class="section-number-4">12.4.12</span> keep</h4>
<div class="outline-text-4" id="text-12-4-12">
<p>
keep 的作用和 filter 类似。keep() 和 discard() 函数可以分别保留输入中预测值为 TRUE 和 false 的元素。
keep() is similar to Filter(), but the argument order is more convenient. 
</p>

<div class="org-src-container">
<pre class="src src-R">?keep
rep(<span style="color: #008b8b;">10</span>, <span style="color: #008b8b;">10</span>) <span style="color: #008b8b;">%&gt;%</span>
    map(sample, <span style="color: #008b8b;">5</span>) <span style="color: #008b8b;">%&gt;%</span> <span style="color: #b22222;">#</span><span style="color: #b22222;">map like apply</span>
    keep(<span style="color: #a020f0;">function</span>(x) mean(x) &gt; <span style="color: #008b8b;">6</span>)

x <span style="color: #008b8b;">&lt;-</span> rerun(<span style="color: #008b8b;">5</span>, a = rbernoulli(<span style="color: #008b8b;">1</span>), b = sample(<span style="color: #008b8b;">10</span>))
x
x <span style="color: #008b8b;">%&gt;%</span> keep(<span style="color: #8b2252;">"a"</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">filter(a==TRUE)</span>
x <span style="color: #008b8b;">%&gt;%</span> discard(<span style="color: #8b2252;">"a"</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">filter(a==Flase)</span>
</pre>
</div>
</div>
</div>
<div id="org77728ba" class="outline-4">
<h4 id="org77728ba"><span class="section-number-4">12.4.13</span> reshape lists</h4>
<div class="outline-text-4" id="text-12-4-13">
</div>
<div id="org8294220" class="outline-5">
<h5 id="org8294220"><span class="section-number-5">12.4.13.1</span> flatten</h5>
<div class="outline-text-5" id="text-12-4-13-1">
<p>
这个函数可以方便处理 list 型数据，可以将 list 型数据转换为一个简单的向量。These functions remove a level hierarchy from a list. They are similar to unlist(), but they only ever remove a single layer of hierarchy and they are type-stable, so you always know what the type of the output is.
</p>

<p>
在 list 型数据里，利用 purrr 包可以利用 flatten 函数或者 simplify/as<sub>vector</sub> 函数去解决。
</p>
<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> rerun(<span style="color: #008b8b;">2</span>,sample(<span style="color: #008b8b;">4</span>))
x
x <span style="color: #008b8b;">%&gt;%</span> flatten()
x <span style="color: #008b8b;">%&gt;%</span> flatten_int()
x <span style="color: #008b8b;">%&gt;%</span> map(<span style="color: #008b8b;">1L</span>) <span style="color: #008b8b;">%&gt;%</span> flatten_int()
x <span style="color: #008b8b;">%&gt;%</span> map_int(<span style="color: #008b8b;">1L</span>)      
</pre>
</div>
</div>
</div>
<div id="org5a1219c" class="outline-5">
<h5 id="org5a1219c"><span class="section-number-5">12.4.13.2</span> flatten<sub>chr</sub>/flatten<sub>dfr</sub>/flatten<sub>int</sub>/flatten<sub>lgl</sub></h5>
<div class="outline-text-5" id="text-12-4-13-2">
<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> rerun(<span style="color: #008b8b;">2</span>, sample(<span style="color: #008b8b;">4</span>))
x
x <span style="color: #008b8b;">%&gt;%</span> flatten()
x <span style="color: #008b8b;">%&gt;%</span> flatten_int()
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] 1 3 2 4 4 3 1 2</span>
x <span style="color: #008b8b;">%&gt;%</span> flatten_chr()
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] "1" "3" "2" "4" "4" "3" "1" "2"</span>
x <span style="color: #008b8b;">%&gt;%</span> flatten_dfc()
                                 <span style="color: #b22222;"># </span><span style="color: #b22222;">A tibble: 1 x 8</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">V1    V2    V3    V4    V5    V6    V7    V8</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">&lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;</span>
                                               <span style="color: #b22222;">## </span><span style="color: #b22222;">1     1     3     2     4     4     3     1     2</span>
x <span style="color: #008b8b;">%&gt;%</span> flatten_lgl()       
</pre>
</div>
</div>
</div>
<div id="orgc890b89" class="outline-5">
<h5 id="orgc890b89"><span class="section-number-5">12.4.13.3</span> transpose</h5>
<div class="outline-text-5" id="text-12-4-13-3">
<p>
Transpose turns a list-of-lists "inside-out"; it turns a pair of lists into a
list of pairs, or a list of pairs into pair of lists. 
对于 list 型数据进行转置。 
</p>
<div class="org-src-container">
<pre class="src src-R">list(x = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">2</span>, y = <span style="color: #008b8b;">3</span>:<span style="color: #008b8b;">4</span>)
<span style="color: #b22222;">## </span><span style="color: #b22222;">$x</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] 1 2</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">$y</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] 3 4</span>
x <span style="color: #008b8b;">&lt;-</span> transpose(list(x = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">2</span>, y = <span style="color: #008b8b;">3</span>:<span style="color: #008b8b;">4</span>))
x
<span style="color: #b22222;">## </span><span style="color: #b22222;">[[1]]</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] 1 3</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">[[2]]</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] 2 4</span>
</pre>
</div>
</div>
</div>
</div>
<div id="orgb5b9f7c" class="outline-4">
<h4 id="orgb5b9f7c"><span class="section-number-4">12.4.14</span> append</h4>
<div class="outline-text-4" id="text-12-4-14">
<div class="org-src-container">
<pre class="src src-R">      x <span style="color: #008b8b;">&lt;-</span> as.list(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>)

      x <span style="color: #008b8b;">%&gt;%</span> append(<span style="color: #8b2252;">"a"</span>)
                                        <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[1]]</span>
         <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 1</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                        <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[2]]</span>
                                        <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 2</span>
                                        <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                        <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[3]]</span>
                                        <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 3</span>
                                        <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                        <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[4]]</span>
                                        <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "a"      </span>
</pre>
</div>
</div>
</div>

<div id="org80bafdb" class="outline-4">
<h4 id="org80bafdb"><span class="section-number-4">12.4.15</span> prepend</h4>
<div class="outline-text-4" id="text-12-4-15">
<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> as.list(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>)
x <span style="color: #008b8b;">%&gt;%</span> prepend(<span style="color: #8b2252;">"a"</span>)

                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[1]]</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "a"</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[2]]</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 1</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[3]]</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 2</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[4]]</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 3      </span>
</pre>
</div>
</div>
</div>

<div id="org9f0edd4" class="outline-4">
<h4 id="org9f0edd4"><span class="section-number-4">12.4.16</span> has<sub>element</sub></h4>
<div class="outline-text-4" id="text-12-4-16">
<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> list(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">10</span>, <span style="color: #008b8b;">5</span>, <span style="color: #008b8b;">9.9</span>)
x <span style="color: #008b8b;">%&gt;%</span> has_element(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">10</span>)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] TRUE</span>
</pre>
</div>
</div>
</div>
<div id="org3117002" class="outline-4">
<h4 id="org3117002"><span class="section-number-4">12.4.17</span> compact</h4>
<div class="outline-text-4" id="text-12-4-17">
<p>
compact 可以忽视 NULL 值。compact
</p>
<div class="org-src-container">
<pre class="src src-R">x=list(a = <span style="color: #8b2252;">"a"</span>, b = <span style="color: #228b22;">NULL</span>, c = integer(<span style="color: #008b8b;">0</span>), d = <span style="color: #228b22;">NA</span>, e = list()) <span style="color: #008b8b;">%&gt;%</span>
    compact()
x

x=c(<span style="color: #008b8b;">1</span>,<span style="color: #228b22;">NA</span>)
x=matrix(c(<span style="color: #008b8b;">1</span>,<span style="color: #008b8b;">2</span>,<span style="color: #228b22;">NA</span>,<span style="color: #008b8b;">3</span>),<span style="color: #008b8b;">2</span>,<span style="color: #008b8b;">2</span>)
x&gt;<span style="color: #008b8b;">3</span>
class(x)
x==<span style="color: #228b22;">NA</span>
x[!is.na(x)]
</pre>
</div>
</div>
</div>

<div id="org9577728" class="outline-4">
<h4 id="org9577728"><span class="section-number-4">12.4.18</span> split</h4>
<div class="outline-text-4" id="text-12-4-18">
<div class="org-src-container">
<pre class="src src-R">mtcars <span style="color: #008b8b;">%&gt;%</span>
    split(.$cyl) <span style="color: #008b8b;">%&gt;%</span>
    map(~lm(mpg~wt,data=.)) <span style="color: #008b8b;">%&gt;%</span>
    map(summary) <span style="color: #008b8b;">%&gt;%</span>
    map_dbl(<span style="color: #8b2252;">"r.squared"</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">return double vectors</span>
</pre>
</div>
</div>
</div>

<div id="org6519ef2" class="outline-4">
<h4 id="org6519ef2"><span class="section-number-4">12.4.19</span> modify function behavior</h4>
<div class="outline-text-4" id="text-12-4-19">
</div>
<div id="org6c65c31" class="outline-5">
<h5 id="org6c65c31"><span class="section-number-5">12.4.19.1</span> compose</h5>
<div class="outline-text-5" id="text-12-4-19-1">
<p>
Compose multiple functions.
之间一直不理解这个函数（还是要多看 stackoverflow）哈～说白了就是一个嵌套函数模型。
</p>

<p>
sin(cos(x)) #就等价于 compose(sin,cos)
</p>

<div class="org-src-container">
<pre class="src src-R">f1 <span style="color: #008b8b;">&lt;-</span> list(sin, cos, cos, sqrt)
x <span style="color: #008b8b;">&lt;-</span> seq(<span style="color: #008b8b;">0</span>, <span style="color: #008b8b;">1</span>, length.out = <span style="color: #008b8b;">10</span>) <span style="color: #008b8b;">%&gt;%</span> round(<span style="color: #008b8b;">3</span>)
x <span style="color: #008b8b;">%&gt;%</span> head()
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 0.000 0.111 0.222 0.333 0.444 0.556</span>
lift(compose)(f1)(x) <span style="color: #008b8b;">%&gt;%</span> round(<span style="color: #008b8b;">3</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [1] 0.514 0.553 0.588 0.620 0.649 0.676 0.699 0.721 0.740 0.756  </span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-R">not_null <span style="color: #008b8b;">&lt;-</span> compose(<span style="color: #000000; background-color: #ffffff;">`!`</span>, is.null)
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#31561;&#20215;&#20110; !is.null(null)</span>
not_null(<span style="color: #228b22;">NULL</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">!is.null</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] FALSE</span>
not_null(<span style="color: #008b8b;">4</span>)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] TRUE</span>
</pre>
</div>
</div>
</div>
<div id="org984ae56" class="outline-5">
<h5 id="org984ae56"><span class="section-number-5">12.4.19.2</span> lift</h5>
<div class="outline-text-5" id="text-12-4-19-2">
<p>
change the type of input a function takes.这个函数可以将各种函数适配数据类型（完美～）。在这个函数族里面，最重要的函数应该就是 lift<sub>ld</sub>(fun) transforms a function taking a list to a function taking dots.
可以将最常见的 list 型数据转换为 double 型。
</p>

<p>
我理解这个函数可以将 list 型数据导入到 function 中。这个函数可以满足函数适配 vector 型和 list 型数据。
</p>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#21487;&#20197;&#22788;&#29702;&#19968;&#20010;list &#22411;&#30340;argument</span>
x <span style="color: #008b8b;">&lt;-</span> list(x = c(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">100</span>,<span style="color: #228b22;">NA</span>,<span style="color: #008b8b;">1000</span>),na.rm = T,trim = <span style="color: #008b8b;">0.9</span>)
lift_dl(mean)(x)
                                        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#31561;&#20215;&#20110;</span>
mean <span style="color: #008b8b;">%&gt;%</span>
    lift_dl() <span style="color: #008b8b;">%&gt;%</span>
    invoke(x)

fun2 <span style="color: #008b8b;">&lt;-</span> fun <span style="color: #008b8b;">%&gt;%</span>
    lift_ld()
fun2(<span style="color: #008b8b;">2</span>,<span style="color: #228b22;">NA</span>,<span style="color: #008b8b;">4</span>,na.rm = T)
</pre>
</div>
</div>
<div id="orgd1f04af" class="outline-6">
<h6 id="orgd1f04af"><span class="section-number-6">12.4.19.2.1</span> lift<sub>dl</sub></h6>
<div class="outline-text-6" id="text-12-4-19-2-1">
<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> list(x = c(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">100</span>, <span style="color: #228b22;">NA</span>, <span style="color: #008b8b;">1000</span>), na.rm = <span style="color: #228b22;">TRUE</span>, trim = <span style="color: #008b8b;">0.9</span>)
lift(mean)(x)
                                <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 51</span>
x <span style="color: #008b8b;">%&gt;%</span> 
    lift(mean)()
                                <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 51</span>
list(c(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">100</span>, <span style="color: #228b22;">NA</span>, <span style="color: #008b8b;">1000</span>)) <span style="color: #008b8b;">%&gt;%</span> 
    lift_dl(mean, na.rm = <span style="color: #228b22;">TRUE</span>)()
                                <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 59.9</span>

</pre>
</div>
</div>
</div>

<div id="orgbe6ff18" class="outline-6">
<h6 id="orgbe6ff18"><span class="section-number-6">12.4.19.2.2</span> lift<sub>vl</sub></h6>
<div class="outline-text-6" id="text-12-4-19-2-2">
<div class="org-src-container">
<pre class="src src-R">x=list(<span style="color: #008b8b;">1</span>,<span style="color: #008b8b;">3</span>)
lift_vl(mean)(x)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] 2</span>
</pre>
</div>
</div>
</div>
</div>
<div id="org8584a3e" class="outline-5">
<h5 id="org8584a3e"><span class="section-number-5">12.4.19.3</span> rerun</h5>
<div class="outline-text-5" id="text-12-4-19-3">
<p>
This is a convenient way of generating sample data. It works similarly to replicate(&#x2026;, simplify = FALSE).
Usage
rerun(.n, &#x2026;)
Arguments
.n  
Number of times to run expressions
&#x2026; 
Expressions to re-run.
</p>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #008b8b;">2</span> <span style="color: #008b8b;">%&gt;%</span> rerun(rnorm(<span style="color: #008b8b;">5</span>))
<span style="color: #b22222;">## </span><span style="color: #b22222;">[[1]]</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] -0.1916 -1.5257  0.7233  0.2105  1.6455</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">[[2]]</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1]  0.37978 -0.48375  0.03287  0.67469  1.19097</span>
</pre>
</div>
</div>
</div>
<div id="orgf82b8fd" class="outline-5">
<h5 id="orgf82b8fd"><span class="section-number-5">12.4.19.4</span> negate</h5>
<div class="outline-text-5" id="text-12-4-19-4">
<p>
Negate a predicate function.
</p>
<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> rerun(<span style="color: #008b8b;">3</span>,a = rbernoulli(<span style="color: #008b8b;">1</span>), b = sample(<span style="color: #008b8b;">10</span>))
x
x <span style="color: #008b8b;">%&gt;%</span> purrr::keep(<span style="color: #8b2252;">"a"</span>) <span style="color: #008b8b;">%&gt;%</span> length()
x <span style="color: #008b8b;">%&gt;%</span> keep(negate(<span style="color: #8b2252;">"a"</span>)) <span style="color: #008b8b;">%&gt;%</span> length()
                                 <span style="color: #b22222;"># </span><span style="color: #b22222;">Same as</span>
x <span style="color: #008b8b;">%&gt;%</span> discard(<span style="color: #8b2252;">"y"</span>) <span style="color: #008b8b;">%&gt;%</span> length()
</pre>
</div>
</div>
</div>
<div id="orged8c415" class="outline-5">
<h5 id="orged8c415"><span class="section-number-5">12.4.19.5</span> safely</h5>
<div class="outline-text-5" id="text-12-4-19-5">
<p>
safely 函数可以对显示函数输出结果进行判断。
safely() 函数一般输出两个变量 $result 和 $error.所以能够用来检查函数错误。
</p>

<div class="org-src-container">
<pre class="src src-R">safe_log <span style="color: #008b8b;">&lt;-</span> safely(log)
safe_log(<span style="color: #008b8b;">10</span>)
safe_log(<span style="color: #8b2252;">"a"</span>)
<span style="color: #b22222;">## </span><span style="color: #b22222;">$result</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">NULL</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">$error</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">&lt;simpleError in .Primitive("log")(x, base): non-numeric argument to mathematical function&gt;</span>
</pre>
</div>
</div>
</div>

<div id="org4ed13e4" class="outline-5">
<h5 id="org4ed13e4"><span class="section-number-5">12.4.19.6</span> partial</h5>
<div class="outline-text-5" id="text-12-4-19-6">
<p>
可以研究研究！！这个函数可以有效地链接多个函数！！
</p>

<p>
Partial apply a function, filling in some arguments.Partial function application allows you to modify a function by pre-filling some of the arguments. It is particularly useful in conjunction with functionals and other function operators.
</p>

<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">3</span>
func <span style="color: #008b8b;">&lt;-</span> purrr::partial(rnorm, n = x, ... = , sd = <span style="color: #008b8b;">1</span>)
func(<span style="color: #008b8b;">5</span>)      
</pre>
</div>

<p>
上面这个例子看出，rnorm 函数的其他参数均是默认，sd 必须是 1.
</p>

<div class="org-src-container">
<pre class="src src-R">p <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #008b8b;">0.2</span>, <span style="color: #008b8b;">0.5</span>, <span style="color: #008b8b;">0.8</span>)
p_names <span style="color: #008b8b;">&lt;-</span> map_chr(p, ~paste0(.x*<span style="color: #008b8b;">100</span>, <span style="color: #8b2252;">"%"</span>))
p_funs <span style="color: #008b8b;">&lt;-</span> map(p, ~partial(quantile, probs = .x, na.rm = <span style="color: #228b22;">TRUE</span>)) <span style="color: #008b8b;">%&gt;%</span> 
    set_names(nm = p_names)

mtcars <span style="color: #008b8b;">%&gt;%</span> 
    group_by(cyl) <span style="color: #008b8b;">%&gt;%</span> 
    summarize_at(vars(mpg), funs(!!!p_funs))      
</pre>
</div>
</div>
</div>

<div id="org044ad87" class="outline-5">
<h5 id="org044ad87"><span class="section-number-5">12.4.19.7</span> quietly</h5>
<div class="outline-text-5" id="text-12-4-19-7">
<p>
Modify function to return list of results, output, messages, warnings.
</p>
<div class="org-src-container">
<pre class="src src-R">quietly_log <span style="color: #008b8b;">&lt;-</span> quietly(log)
quietly_log(<span style="color: #008b8b;">10</span>)
quietly_log(<span style="color: #8b2252;">"a"</span>)       
</pre>
</div>
</div>
</div>
<div id="org839fa1b" class="outline-5">
<h5 id="org839fa1b"><span class="section-number-5">12.4.19.8</span> possibly</h5>
<div class="outline-text-5" id="text-12-4-19-8">
<p>
possibly() Modify function to return default value whenever an error occurs (instead of error).
</p>
<div class="org-src-container">
<pre class="src src-R">quietly_log <span style="color: #008b8b;">&lt;-</span> possibly(log)
quietly_log(<span style="color: #008b8b;">10</span>)
quietly_log(<span style="color: #8b2252;">"a"</span>)       
</pre>
</div>
</div>
</div>
</div>
<div id="org0f60f96" class="outline-4">
<h4 id="org0f60f96"><span class="section-number-4">12.4.20</span> invoke</h4>
<div class="outline-text-4" id="text-12-4-20">
<p>
invoke 正如其名，调用函数，作用和 do.call 类似，所不同的是 do.call 的输入必须是
list 型，而 invoke 没有这种限制。call lists of functions with lists of parameters.
</p>
<div class="org-src-container">
<pre class="src src-R">invoke(mean,list(na.rm = T),x = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">10</span>)
<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">10</span> <span style="color: #008b8b;">%&gt;%</span> mean(na.rm = T)
</pre>
</div>
<p>
需要注意的是 invoke 第一个参数不能设为 list 型，而 invoke<sub>map</sub> 可以。
</p>

<div class="org-src-container">
<pre class="src src-R">invoke(paste, letters)  
</pre>
</div>
</div>
</div>

<div id="org00ddfec" class="outline-4">
<h4 id="org00ddfec"><span class="section-number-4">12.4.21</span> invoke<sub>map</sub></h4>
<div class="outline-text-4" id="text-12-4-21">
<p>
相比于 map,pmap,还有一种更复杂的情况，不但传给函数的参数不同，甚至函数本身也是不同的，就需要用 invoke<sub>map</sub>。这个函数目前已经被 exec 函数所取代。
</p>
<div class="org-src-container">
<pre class="src src-R">list(mean,median) <span style="color: #008b8b;">%&gt;%</span>
    invoke_map(list(n = <span style="color: #008b8b;">10</span>))
f <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #8b2252;">"runif"</span>, <span style="color: #8b2252;">"rnorm"</span>, <span style="color: #8b2252;">"rpois"</span>) 
param <span style="color: #008b8b;">&lt;-</span> list( list(min = -<span style="color: #008b8b;">1</span>, max = <span style="color: #008b8b;">1</span>), list(sd = <span style="color: #008b8b;">5</span>), list(lambda = <span style="color: #008b8b;">10</span>) )
invoke_map(f, param, n = <span style="color: #008b8b;">5</span>)
</pre>
</div>
</div>
</div>

<div id="orgafaa77c" class="outline-4">
<h4 id="orgafaa77c"><span class="section-number-4">12.4.22</span> exec</h4>
<div class="outline-text-4" id="text-12-4-22">
<p>
purrr 包已经将 invoke 函数下线了，以后用 exec 函数代替它。
</p>

<p>
这个函数可以用在函数命令和数据的交接。为啥不能直接用命令，因为数据的类型是其他类型。
</p>

<div class="org-src-container">
<pre class="src src-R">exec(runif, !!!list(n = <span style="color: #008b8b;">10</span>))
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [1] 0.63228 0.16132 0.38375 0.36571 0.37132 0.03628 0.97515 0.65578</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [9] 0.53078 0.61435</span>
invoke(mean, list(na.rm = <span style="color: #228b22;">TRUE</span>), x = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">10</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 5.5  </span>
</pre>
</div>
</div>
</div>

<div id="orgd7e2c6c" class="outline-4">
<h4 id="orgd7e2c6c"><span class="section-number-4">12.4.23</span> map</h4>
<div class="outline-text-4" id="text-12-4-23">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">&#xa0;</td>
<td class="org-left">list</td>
<td class="org-left">atomic</td>
<td class="org-left">same type</td>
<td class="org-left">nothing</td>
</tr>

<tr>
<td class="org-left">one argument</td>
<td class="org-left">map()</td>
<td class="org-left">map<sub>lgl</sub>(),&#x2026;</td>
<td class="org-left">modify()</td>
<td class="org-left">walk()</td>
</tr>

<tr>
<td class="org-left">two arnuments</td>
<td class="org-left">map2()</td>
<td class="org-left">map2<sub>lgl</sub>(),&#x2026;</td>
<td class="org-left">modify2()</td>
<td class="org-left">walk2()</td>
</tr>

<tr>
<td class="org-left">one arguments+index</td>
<td class="org-left">imap()</td>
<td class="org-left">imap<sub>lgl</sub>(),&#x2026;</td>
<td class="org-left">imodify()</td>
<td class="org-left">iwalk()</td>
</tr>

<tr>
<td class="org-left">N arguments</td>
<td class="org-left">pmap()</td>
<td class="org-left">pmap<sub>lgl</sub>(),&#x2026;</td>
<td class="org-left">-</td>
<td class="org-left">pwalk()</td>
</tr>
</tbody>
</table>

<p>
先来个甜点。
</p>
<div class="org-src-container">
<pre class="src src-R">mtcars <span style="color: #008b8b;">%&gt;%</span> 
    split(.$cyl) <span style="color: #008b8b;">%&gt;%</span> 
    map(~ lm(mpg~wt,data = .x)) <span style="color: #008b8b;">%&gt;%</span> 
    map(coef) <span style="color: #008b8b;">%&gt;%</span> 
    map_dbl(<span style="color: #008b8b;">2</span>)      
</pre>
</div>

<p>
apply a function to each element of a vector. 这个函数对应于 base 包中的 apply,是一个 Map family，衍生的函数包括 map<sub>lgl</sub>(),map<sub>int</sub>(),map<sub>dbl</sub>(),map<sub>chr</sub>()等，作用于不同的数据类型。map<sub>dfr</sub>()和 map<sub>dfc</sub>()返回的是 data.frame.
</p>

<p>
The map(.x, .f) functions transforms each element of the vector .x with the function .f, returning a vector defined by the suffix (<sub>lgl</sub>, _chr() etc).
从这个例子可以看出，～符号对应着 function. 
</p>
<div class="org-src-container">
<pre class="src src-R">  <span style="color: #0000ff;">triple</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>(x) x*<span style="color: #008b8b;">3</span>
  map(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>,triple)

 <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">10</span> <span style="color: #008b8b;">%&gt;%</span>
  map(rnorm,n=<span style="color: #008b8b;">10</span>) <span style="color: #008b8b;">%&gt;%</span>
  map_dbl(mean)
<span style="color: #b22222;"># </span><span style="color: #b22222;">or use an anonymous function</span>
<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">10</span> <span style="color: #008b8b;">%&gt;%</span>
  map(<span style="color: #a020f0;">function</span>(x) rnorm(<span style="color: #008b8b;">10</span>,x))
                                        <span style="color: #b22222;"># </span><span style="color: #b22222;">or a formula</span>
<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">10</span> <span style="color: #008b8b;">%&gt;%</span>
  map(~ rnorm(<span style="color: #008b8b;">10</span>,.x))
                                        <span style="color: #b22222;"># </span><span style="color: #b22222;">Extract by name or position</span>
                                        <span style="color: #b22222;"># </span><span style="color: #b22222;">.default specifies value for elements that are missing or NULL</span>
l1 <span style="color: #008b8b;">&lt;-</span> list(list(a = <span style="color: #008b8b;">1L</span>), list(a = <span style="color: #228b22;">NULL</span>, b = <span style="color: #008b8b;">2L</span>), list(b = <span style="color: #008b8b;">3L</span>))
l1
set_names(c(<span style="color: #8b2252;">"foo"</span>, <span style="color: #8b2252;">"bar"</span>)) <span style="color: #008b8b;">%&gt;%</span> map_chr(paste0, <span style="color: #8b2252;">":suffix"</span>)

                                        <span style="color: #b22222;"># </span><span style="color: #b22222;">Extract by name or position</span>
                                        <span style="color: #b22222;"># </span><span style="color: #b22222;">.default specifies value for elements that are missing or NULL</span>
l1 <span style="color: #008b8b;">&lt;-</span> list(list(a = <span style="color: #008b8b;">1L</span>), list(a = <span style="color: #228b22;">NULL</span>, b = <span style="color: #008b8b;">2L</span>), list(b = <span style="color: #008b8b;">3L</span>))
l1
l1 <span style="color: #008b8b;">%&gt;%</span> map(<span style="color: #8b2252;">"a"</span>, .default = <span style="color: #8b2252;">"???"</span>) <span style="color: #b22222;">##</span><span style="color: #b22222;">&#23558;&#32570;&#22833;&#20540;&#25110;&#32773; NULL &#22635;&#20805;&#20026;???</span>
l1 <span style="color: #008b8b;">%&gt;%</span> map_int(<span style="color: #8b2252;">"b"</span>,.default=<span style="color: #228b22;">NA</span>)
                                        <span style="color: #b22222;"># </span><span style="color: #b22222;">Supply multiple values to index deeply into a list</span>
l2 <span style="color: #008b8b;">&lt;-</span> list(
  list(num = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>,     letters[<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>]),
  list(num = <span style="color: #008b8b;">101</span>:<span style="color: #008b8b;">103</span>, letters[<span style="color: #008b8b;">4</span>:<span style="color: #008b8b;">6</span>]),
  list()
)
l2 <span style="color: #008b8b;">%&gt;%</span> head
l2 <span style="color: #008b8b;">%&gt;%</span> map(c(<span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">2</span>)) <span style="color: #b22222;">##</span><span style="color: #b22222;">&#21487;&#20197;&#36873;&#25321; c(2,2)&#20803;&#32032;</span>
                                        <span style="color: #b22222;"># </span><span style="color: #b22222;">Use a list to build an extractor that mixes numeric indices and names,</span>
                                        <span style="color: #b22222;"># </span><span style="color: #b22222;">and .default to provide a default value if the element does not exist</span>
l2 <span style="color: #008b8b;">%&gt;%</span> map(list(<span style="color: #8b2252;">"num"</span>, <span style="color: #008b8b;">3</span>)) <span style="color: #b22222;">##</span><span style="color: #b22222;">&#21487;&#20197;&#36873;&#25321;&#30830;&#23450;&#20803;&#32032;</span>

l2 <span style="color: #008b8b;">%&gt;%</span> map_dbl(list(<span style="color: #8b2252;">"num"</span>, <span style="color: #008b8b;">3</span>), .default = <span style="color: #228b22;">NA</span>)
</pre>
</div>

<p>
map 函数还可以充当 pluck 函数功能。
</p>

<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> list(
    list(-<span style="color: #008b8b;">1</span>, x = <span style="color: #008b8b;">1</span>, y = c(<span style="color: #008b8b;">2</span>), z = <span style="color: #8b2252;">"a"</span>),
    list(-<span style="color: #008b8b;">2</span>, x = <span style="color: #008b8b;">4</span>, y = c(<span style="color: #008b8b;">5</span>, <span style="color: #008b8b;">6</span>), z = <span style="color: #8b2252;">"b"</span>),
    list(-<span style="color: #008b8b;">3</span>, x = <span style="color: #008b8b;">8</span>, y = c(<span style="color: #008b8b;">9</span>, <span style="color: #008b8b;">10</span>, <span style="color: #008b8b;">11</span>))
)

                                      <span style="color: #b22222;"># </span><span style="color: #b22222;">Select by name</span>
map_dbl(x, <span style="color: #8b2252;">"x"</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 1 4 8</span>

                                      <span style="color: #b22222;"># </span><span style="color: #b22222;">Or by position</span>
map_dbl(x, <span style="color: #008b8b;">1</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] -1 -2 -3</span>

                                      <span style="color: #b22222;"># </span><span style="color: #b22222;">Or by both</span>
map_dbl(x, list(<span style="color: #8b2252;">"y"</span>, <span style="color: #008b8b;">1</span>))
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 2 5 9</span>

                                      <span style="color: #b22222;"># </span><span style="color: #b22222;">You'll get an error if a component doesn't exist:</span>
map_chr(x, <span style="color: #8b2252;">"z"</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Error: Result 3 must be a single string, not NULL of length 0</span>

                                      <span style="color: #b22222;"># </span><span style="color: #b22222;">Unless you supply a .default value</span>
map_chr(x, <span style="color: #8b2252;">"z"</span>, .default = <span style="color: #228b22;">NA</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "a" "b" NA fs  </span>
</pre>
</div>
</div>


<div id="orgcca8d78" class="outline-5">
<h5 id="orgcca8d78"><span class="section-number-5">12.4.23.1</span> map<sub>lgl</sub></h5>
<div class="outline-text-5" id="text-12-4-23-1">
<p>
map<sub>lgl</sub>() always returns a logical vector
</p>
<div class="org-src-container">
<pre class="src src-R">map_lgl(mtcars, is.double)      
</pre>
</div>
</div>
</div>

<div id="orgb08dd6d" class="outline-5">
<h5 id="orgb08dd6d"><span class="section-number-5">12.4.23.2</span> map<sub>chr</sub></h5>
<div class="outline-text-5" id="text-12-4-23-2">
<p>
map<sub>chr</sub>() always returns a character vector
</p>
<div class="org-src-container">
<pre class="src src-R">mtcars <span style="color: #008b8b;">%&gt;%</span> 
    map_chr(typeof)       
</pre>
</div>
</div>
</div>

<div id="org95d195a" class="outline-5">
<h5 id="org95d195a"><span class="section-number-5">12.4.23.3</span> map<sub>int</sub></h5>
<div class="outline-text-5" id="text-12-4-23-3">
<p>
map<sub>int</sub>() always returns a integer vector
</p>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #0000ff;">n_unique</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>(x) length(unique(x))
mtcars <span style="color: #008b8b;">%&gt;%</span> 
    map_int(n_unique)       
</pre>
</div>
</div>
</div>

<div id="orgbb4c2e2" class="outline-5">
<h5 id="orgbb4c2e2"><span class="section-number-5">12.4.23.4</span> map<sub>dbl</sub></h5>
<div class="outline-text-5" id="text-12-4-23-4">
<p>
map<sub>dbl</sub>() always returns a double vector.
需要注意的是，map<sub>dbl</sub> 只能接受一个输入。
</p>

<div class="org-src-container">
<pre class="src src-R">mtcars <span style="color: #008b8b;">%&gt;%</span> 
    map_dbl(mean)

<span style="color: #0000ff;">pair</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>(x) c(x, x)
map_dbl(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">2</span>, pair)
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Error: Result 1 must be a single double, not an integer vector of length 2</span>
map(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">2</span>, pair)
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[1]]</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 1 1</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[2]]</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 2 2</span>
</pre>
</div>
</div>
</div>

<div id="orga4f6da6" class="outline-5">
<h5 id="orga4f6da6"><span class="section-number-5">12.4.23.5</span> map<sub>at</sub></h5>
<div class="outline-text-5" id="text-12-4-23-5">
<p>
可以针对特定的变量进行函数操作。
</p>
<div class="org-src-container">
<pre class="src src-R">survey08 <span style="color: #008b8b;">&lt;-</span> data.frame(year = c(<span style="color: #008b8b;">2008</span>, <span style="color: #008b8b;">2008</span>, <span style="color: #008b8b;">2007</span>, <span style="color: #008b8b;">2006</span>, <span style="color: #008b8b;">2008</span>), employed = c(<span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">2</span>))
survey09 <span style="color: #008b8b;">&lt;-</span> data.frame(year = <span style="color: #008b8b;">2009</span>, employed = c(<span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">1</span>))
survey10 <span style="color: #008b8b;">&lt;-</span> data.frame(year = <span style="color: #008b8b;">2010</span>, employed = c(<span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">1</span>))
<span style="color: #b22222;"># </span><span style="color: #b22222;">put dataframes into a list</span>
df_list <span style="color: #008b8b;">&lt;-</span> list(survey08, survey09, survey10)
names(df_list) <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #8b2252;">"survey08"</span>, <span style="color: #8b2252;">"survey09"</span>, <span style="color: #8b2252;">"survey10"</span>)
df_list <span style="color: #008b8b;">%&gt;%</span>
  map(~ filter(.x, year <span style="color: #008b8b;">%in%</span> <span style="color: #008b8b;">2008</span>:<span style="color: #008b8b;">2009</span>))
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; $survey08</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   year employed</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1 2008        1</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2 2008        2</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3 2008        2</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; $survey09</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   year employed</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1 2009        1</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2 2009        1</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3 2009        1</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 4 2009        2</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 5 2009        1</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; $survey10</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] year     employed</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; &lt;0 &#34892;&gt; (&#25110;0-&#38271;&#24230;&#30340;row.names)</span>

df_list <span style="color: #008b8b;">%&gt;%</span>
  map_at(
    c(<span style="color: #8b2252;">"survey08"</span>, <span style="color: #8b2252;">"survey09"</span>),
    ~ filter(.x, year <span style="color: #008b8b;">%in%</span> <span style="color: #008b8b;">2008</span>:<span style="color: #008b8b;">2009</span>)
  )
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; $survey08</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   year employed</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1 2008        1</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2 2008        2</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3 2008        2</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; $survey09</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   year employed</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1 2009        1</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2 2009        1</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3 2009        1</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 4 2009        2</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 5 2009        1</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; $survey10</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   year employed</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1 2010        2</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2 2010        1</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3 2010        1</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 4 2010        1</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 5 2010        1       </span>
</pre>
</div>
</div>
</div>
</div>

<div id="org97349c1" class="outline-4">
<h4 id="org97349c1"><span class="section-number-4">12.4.24</span> map<sub>if</sub></h4>
<div class="outline-text-4" id="text-12-4-24">
<div class="org-src-container">
<pre class="src src-R">df <span style="color: #008b8b;">&lt;-</span> data.frame(
    stringsAsFactors = <span style="color: #228b22;">FALSE</span>,
    id = c(<span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">3</span>),
    age = c(<span style="color: #008b8b;">18</span>, <span style="color: #008b8b;">21</span>, <span style="color: #008b8b;">16</span>),
    name = c(<span style="color: #8b2252;">"jim"</span>, <span style="color: #8b2252;">"bob"</span>, <span style="color: #8b2252;">"alice"</span>),
    income = c(<span style="color: #008b8b;">100</span>, <span style="color: #008b8b;">200</span>, <span style="color: #008b8b;">300</span>)
)
df <span style="color: #008b8b;">&lt;-</span> map_df(df, as.character)
df <span style="color: #008b8b;">%&gt;%</span>
    map_at(c(<span style="color: #8b2252;">"id"</span>), as.numeric) <span style="color: #008b8b;">%&gt;%</span>
    glimpse()
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Error in glimpse(.): &#27809;&#26377;"glimpse"&#36825;&#20010;&#20989;&#25968;</span>

df <span style="color: #008b8b;">%&gt;%</span>
    map_if(names(.) <span style="color: #008b8b;">%in%</span> c(<span style="color: #8b2252;">"id"</span>), as.numeric)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; $id</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 1 2 3</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; $age</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "18" "21" "16"</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; $name</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "jim"   "bob"   "alice"</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; $income</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "100" "200" "300"      </span>
</pre>
</div>
</div>
</div>

<div id="org129f915" class="outline-4">
<h4 id="org129f915"><span class="section-number-4">12.4.25</span> as<sub>mapper</sub></h4>
<div class="outline-text-4" id="text-12-4-25">
<p>
You can see what’s happening behind the scenes by calling as<sub>mapper</sub>(). 可以通过
as<sub>mapper</sub> 函数查看当前 function 形式。
</p>
<div class="org-src-container">
<pre class="src src-R">as_mapper(~length(unique(.x)))      
</pre>
</div>
</div>
</div>
<div id="org1fa794b" class="outline-4">
<h4 id="org1fa794b"><span class="section-number-4">12.4.26</span> map2</h4>
<div class="outline-text-4" id="text-12-4-26">
<p>
Map over multiple inputs simultaneously.We need a new tool: a map2(), which is vectorised over two arguments. This means both .x and .y are varied in each call to .f.
</p>

<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> list(<span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">10</span>, <span style="color: #008b8b;">100</span>)
y <span style="color: #008b8b;">&lt;-</span> list(<span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">3</span>)
z <span style="color: #008b8b;">&lt;-</span> list(<span style="color: #008b8b;">5</span>, <span style="color: #008b8b;">50</span>, <span style="color: #008b8b;">500</span>)
map2(x, y, ~ .x + .y) <span style="color: #b22222;">#</span><span style="color: #b22222;">list &#20803;&#32032;&#20043;&#38388;&#30340;&#30456;&#21152;</span>
                                    <span style="color: #b22222;">#</span><span style="color: #b22222;">or</span>
map2(x,y,<span style="color: #000000; background-color: #ffffff;">`+`</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36825;&#37324;&#30340;&#21152;&#21495;&#38656;&#35201;&#27880;&#24847;</span>
<span style="color: #b22222;">##</span><span style="color: #b22222;">model,predict</span>
                                    <span style="color: #b22222;"># </span><span style="color: #b22222;">Split into pieces, fit model to each piece, then predict</span>
by_cyl <span style="color: #008b8b;">&lt;-</span> mtcars <span style="color: #008b8b;">%&gt;%</span> split(.$cyl)
mods <span style="color: #008b8b;">&lt;-</span> by_cyl <span style="color: #008b8b;">%&gt;%</span> map(~ lm(mpg ~ wt, data = .))
map2(mods, by_cyl, predict)

x <span style="color: #008b8b;">&lt;-</span> c(foo = <span style="color: #008b8b;">1L</span>, bar = <span style="color: #008b8b;">2L</span>)
y <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #228b22;">TRUE</span>, <span style="color: #228b22;">FALSE</span>)
modify2(x, y, ~ <span style="color: #a020f0;">if</span> (.y) .x <span style="color: #a020f0;">else</span> <span style="color: #008b8b;">0L</span>) <span style="color: #008b8b;">%&gt;%</span> str()
                                    <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  Named int [1:2] 1 0</span>
                                    <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  - attr(*, "names")= chr [1:2] "foo" "bar"</span>
map2(x, y, ~ <span style="color: #a020f0;">if</span> (.y) .x <span style="color: #a020f0;">else</span> <span style="color: #008b8b;">0</span>) <span style="color: #008b8b;">%&gt;%</span> str()
                                    <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; List of 2</span>
                                    <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  $ foo: int 1</span>
                                    <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  $ bar: num 0</span>
</pre>
</div>

<p>
在 base 包中，有类似的函数就是 Map.
</p>

<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> list(<span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">10</span>, <span style="color: #008b8b;">100</span>)
y <span style="color: #008b8b;">&lt;-</span> list(<span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">3</span>)
Map(<span style="color: #000000; background-color: #ffffff;">`+`</span>,x,y) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36825;&#37324;&#30340;&#21152;&#21495;&#38656;&#35201;&#27880;&#24847;</span>
</pre>
</div>

<p>
而且 Map 函数相当于 map2 以及 mapply.
</p>
<div class="org-src-container">
<pre class="src src-R">mapply(rep, <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">4</span>, <span style="color: #008b8b;">4</span>:<span style="color: #008b8b;">1</span>)
mapply(rep, times = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">4</span>, MoreArgs = list(x = <span style="color: #008b8b;">42</span>))
map2(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">4</span>,<span style="color: #008b8b;">4</span>:<span style="color: #008b8b;">1</span>,rep)
map2(times = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">4</span>, MoreArgs = list(x = <span style="color: #008b8b;">42</span>),rep)
Map(rep,times = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">4</span>, MoreArgs = list(x = <span style="color: #008b8b;">42</span>))

mapply(<span style="color: #a020f0;">function</span>(x, y) seq_len(x) + y,
       c(a =  <span style="color: #008b8b;">1</span>, b = <span style="color: #008b8b;">2</span>, c = <span style="color: #008b8b;">3</span>),  <span style="color: #b22222;"># </span><span style="color: #b22222;">names from first</span>
       c(A = <span style="color: #008b8b;">10</span>, B = <span style="color: #008b8b;">0</span>, C = -<span style="color: #008b8b;">10</span>))
Map(<span style="color: #a020f0;">function</span>(x, y) seq_len(x) + y,
    c(a =  <span style="color: #008b8b;">1</span>, b = <span style="color: #008b8b;">2</span>, c = <span style="color: #008b8b;">3</span>),  <span style="color: #b22222;"># </span><span style="color: #b22222;">names from first</span>
    c(A = <span style="color: #008b8b;">10</span>, B = <span style="color: #008b8b;">0</span>, C = -<span style="color: #008b8b;">10</span>))

map2(c(a =  <span style="color: #008b8b;">1</span>, b = <span style="color: #008b8b;">2</span>, c = <span style="color: #008b8b;">3</span>),  <span style="color: #b22222;"># </span><span style="color: #b22222;">names from first</span>
     c(A = <span style="color: #008b8b;">10</span>, B = <span style="color: #008b8b;">0</span>, C = -<span style="color: #008b8b;">10</span>),<span style="color: #a020f0;">function</span>(x, y) seq_len(x) + y)   
</pre>
</div>
</div>
</div>
<div id="org160a263" class="outline-4">
<h4 id="org160a263"><span class="section-number-4">12.4.27</span> pmap</h4>
<div class="outline-text-4" id="text-12-4-27">
<p>
map 是对一列数据进行分析,map2 是对两列数据进行分析，那么 pmap 是对三列数据进行分析。 pmap 也可以被当作是 rowwise 版本 map. pmap 可以实现逐行相加。  
</p>
<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> list(<span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">10</span>, <span style="color: #008b8b;">100</span>)
  y <span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">3</span>)
  z <span style="color: #008b8b;">&lt;-</span> list(<span style="color: #008b8b;">5</span>, <span style="color: #008b8b;">50</span>, <span style="color: #008b8b;">500</span>)
  pmap(list(x, y, z), sum) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22810;&#20010;&#20803;&#32032;&#30456;&#21152;&#65292;&#38656;&#35201; pmap &#25805;&#20316;</span>
  <span style="color: #b22222;"># </span><span style="color: #b22222;">Matching arguments by position</span>
  pmap(list(x, y, z), <span style="color: #a020f0;">function</span>(a, b, c) a / (b + c))
                                          <span style="color: #b22222;"># </span><span style="color: #b22222;">Matching arguments by name</span>
  l <span style="color: #008b8b;">&lt;-</span> list(a = x, b = y, c = z)
  pmap(l, <span style="color: #a020f0;">function</span>(c, b, a) a / (b + c))
                                          <span style="color: #b22222;"># </span><span style="color: #b22222;">Vectorizing a function over multiple arguments</span>
  df <span style="color: #008b8b;">&lt;-</span> data.frame(
    x = c(<span style="color: #8b2252;">"apple"</span>, <span style="color: #8b2252;">"banana"</span>, <span style="color: #8b2252;">"cherry"</span>),
    pattern = c(<span style="color: #8b2252;">"p"</span>, <span style="color: #8b2252;">"n"</span>, <span style="color: #8b2252;">"h"</span>),
    replacement = c(<span style="color: #8b2252;">"x"</span>, <span style="color: #8b2252;">"f"</span>, <span style="color: #8b2252;">"q"</span>),
    stringsAsFactors = <span style="color: #228b22;">FALSE</span>
  )
  pmap(df, gsub)
  pmap_chr(df, gsub)

                                          <span style="color: #b22222;"># </span><span style="color: #b22222;">Use `...` to absorb unused components of input list .l</span>
  df <span style="color: #008b8b;">&lt;-</span> data.frame(
    x = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span> + <span style="color: #008b8b;">0.1</span>,
    y = <span style="color: #008b8b;">3</span>:<span style="color: #008b8b;">1</span> - <span style="color: #008b8b;">0.1</span>,
    z = letters[<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>]
  )
  <span style="color: #0000ff;">plus</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>(x, y) x + y
  <span style="color: #a020f0;">if</span> (<span style="color: #228b22;">FALSE</span>) {                                        <span style="color: #b22222;"># </span><span style="color: #b22222;">this won't work</span>
    pmap(df, plus)
  }
                                          <span style="color: #b22222;"># </span><span style="color: #b22222;">but this will</span>
  <span style="color: #0000ff;">plus2</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>(x, y, ...) x + y
  pmap_dbl(df, plus2)
  df
  <span style="color: #b22222;"># </span><span style="color: #b22222;">If you want to bind the results of your function rowwise, use map2_dfr() or pmap_dfr()</span>
  <span style="color: #0000ff;">ex_fun</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>(arg1, arg2){
    col <span style="color: #008b8b;">&lt;-</span> arg1 + arg2
    x <span style="color: #008b8b;">&lt;-</span> as.data.frame(col)
  }
  arg1 <span style="color: #008b8b;">&lt;-</span> seq(<span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">10</span>, by = <span style="color: #008b8b;">3</span>)
  arg2 <span style="color: #008b8b;">&lt;-</span> seq(<span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">11</span>, by = <span style="color: #008b8b;">3</span>)
  arg1+arg2
  df <span style="color: #008b8b;">&lt;-</span> map2_dfr(arg1, arg2, ex_fun)
  df
                                          <span style="color: #b22222;"># </span><span style="color: #b22222;">If instead you want to bind by columns, use map2_dfc() or pmap_dfc()</span>
  df2 <span style="color: #008b8b;">&lt;-</span> map2_dfc(arg1, arg2, ex_fun)
  df2
</pre>
</div>

<p>
rowwise 版本
</p>

<div class="org-src-container">
<pre class="src src-R">df <span style="color: #008b8b;">&lt;-</span> data.frame(a = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">10</span>, b = <span style="color: #008b8b;">11</span>:<span style="color: #008b8b;">20</span>, c = <span style="color: #008b8b;">21</span>:<span style="color: #008b8b;">30</span>)
pmap(df, <span style="color: #a020f0;">function</span>(a, b, c) {
    data.frame(var1 = a + b,
               var2 = c/<span style="color: #008b8b;">2</span>) 
}  )
<span style="color: #b22222;">## </span><span style="color: #b22222;">[[1]]</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">var1 var2</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">1   12 10.5</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">[[2]]</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">var1 var2</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">1   14   11</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">[[3]]</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">var1 var2</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">1   16 11.5</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">[[4]]</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">var1 var2</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">1   18   12</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">[[5]]</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">var1 var2</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">1   20 12.5</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">[[6]]</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">var1 var2</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">1   22   13</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">[[7]]</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">var1 var2</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">1   24 13.5</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">[[8]]</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">var1 var2</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">1   26   14</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">[[9]]</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">var1 var2</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">1   28 14.5</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">[[10]]</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">var1 var2</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">1   30   15 </span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-R">df <span style="color: #008b8b;">&lt;-</span> tibble(x1 = c(<span style="color: #008b8b;">1</span>,<span style="color: #008b8b;">2</span>,<span style="color: #008b8b;">3</span>),
             x2 = c(<span style="color: #008b8b;">4</span>,<span style="color: #008b8b;">5</span>,<span style="color: #008b8b;">6</span>))

pmap(df,<span style="color: #a020f0;">function</span>(x1, x2) x1+x2)
pmap(df, sum)  
</pre>
</div>
</div>
</div>

<div id="orgbd41ded" class="outline-4">
<h4 id="orgbd41ded"><span class="section-number-4">12.4.28</span> pwalk</h4>
<div class="outline-text-4" id="text-12-4-28">
<p>
如果调用函数的目的是利用其副作用，而不是返回值时，那么就应该使用游走函数，而不是映射函数。通常来说，使用这个函数的目的是在屏幕上提供输出或者将文件保存到磁盘——重要的是操作过程，而不是返回值。
</p>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #008b8b;">library</span>(dplyr)
<span style="color: #008b8b;">library</span>(purrr)
<span style="color: #008b8b;">library</span>(tibble)
<span style="color: #008b8b;">library</span>(datasets)
set.seed(<span style="color: #008b8b;">57</span>)
ds_mt <span style="color: #008b8b;">&lt;-</span> 
    mtcars <span style="color: #008b8b;">%&gt;%</span> 
    rownames_to_column(<span style="color: #8b2252;">"model"</span>) <span style="color: #008b8b;">%&gt;%</span> 
    mutate(
        am = factor(am, labels = c(<span style="color: #8b2252;">"auto"</span>, <span style="color: #8b2252;">"manual"</span>)), 
        vs = factor(vs, labels = c(<span style="color: #8b2252;">"V"</span>, <span style="color: #8b2252;">"S"</span>))
    ) <span style="color: #008b8b;">%&gt;%</span> 
    select(model, mpg, wt, cyl, am, vs) <span style="color: #008b8b;">%&gt;%</span> 
    sample_n(<span style="color: #008b8b;">3</span>)

<span style="color: #0000ff;">foo</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>(model, am, mpg){
    print(
        paste(<span style="color: #8b2252;">"The"</span>, model, <span style="color: #8b2252;">"has a"</span>, am, <span style="color: #8b2252;">"transmission and gets"</span>, mpg, <span style="color: #8b2252;">"mpgs."</span>)
    )
}

ds_mt <span style="color: #008b8b;">%&gt;%</span> 
    select(model, am, mpg) <span style="color: #008b8b;">%&gt;%</span> 
    pwalk(
        .l = .,
        .f = foo
    )      
</pre>
</div>
</div>
</div>

<div id="orgde3f9bf" class="outline-4">
<h4 id="orgde3f9bf"><span class="section-number-4">12.4.29</span> list<sub>modify</sub></h4>
<div class="outline-text-4" id="text-12-4-29">
<p>
可以对已有的 list 型数据进行修改，list<sub>merge</sub> 可以。
list<sub>modify</sub>() and list<sub>merge</sub>() recursively combine two lists, matching elements either by name or position. If a sub-element is present in both lists list<sub>modify</sub>() takes the value from y, and list<sub>merge</sub>() concatenates the values together.
</p>

<p>
list<sub>merge</sub> 更像是 list 型数据的 rbind.
</p>
<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> list(x = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">10</span>, y = <span style="color: #008b8b;">4</span>, z = list(a = <span style="color: #008b8b;">1</span>, b = <span style="color: #008b8b;">2</span>))
list_modify(x,z = <span style="color: #008b8b;">5</span>)
x <span style="color: #008b8b;">&lt;-</span> list(x = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">10</span>, y = <span style="color: #008b8b;">4</span>, z = list(a = <span style="color: #008b8b;">1</span>, b = <span style="color: #008b8b;">2</span>))
str(x)

                                  <span style="color: #b22222;"># </span><span style="color: #b22222;">Update values</span>
str(list_modify(x, a = <span style="color: #008b8b;">1</span>))
                                  <span style="color: #b22222;"># </span><span style="color: #b22222;">Replace values</span>
str(list_modify(x, z = <span style="color: #008b8b;">5</span>))
str(list_modify(x, z = list(a = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">5</span>)))

                                  <span style="color: #b22222;"># </span><span style="color: #b22222;">Remove values</span>
str(list_modify(x, z = zap()))

                                  <span style="color: #b22222;"># </span><span style="color: #b22222;">Combine values</span>
str(list_merge(x, x = <span style="color: #008b8b;">11</span>, z = list(a = <span style="color: #008b8b;">2</span>:<span style="color: #008b8b;">5</span>, c = <span style="color: #008b8b;">3</span>)))


                                  <span style="color: #b22222;"># </span><span style="color: #b22222;">All these functions support tidy dots features. Use !!! to splice</span>
                                  <span style="color: #b22222;"># </span><span style="color: #b22222;">a list of arguments:</span>
l <span style="color: #008b8b;">&lt;-</span> list(new = <span style="color: #008b8b;">1</span>, y = zap(), z = <span style="color: #008b8b;">5</span>)
str(list_modify(x, !!!l))
</pre>
</div>
</div>
</div>

<div id="orge1ce197" class="outline-4">
<h4 id="orge1ce197"><span class="section-number-4">12.4.30</span> imap_</h4>
<div class="outline-text-4" id="text-12-4-30">
<p>
imap<sub>xxx</sub>(x, &#x2026;), an indexed map, is short hand for map2(x, names(x), &#x2026;) if x has names, or map2(x, seq<sub>along</sub>(x), &#x2026;) if it does not. This is useful if you need to compute on both the value and the position of an element.
这个函数是简化版本的 map2,等价于 map2(x,names(x),&#x2026;) 或者是 seq<sub>along</sub>(x).
</p>

<div class="org-src-container">
<pre class="src src-R">z=sample(<span style="color: #008b8b;">10</span>)
z
imap_chr(z, ~ paste0(.y, <span style="color: #8b2252;">": "</span>, .x))
iwalk(mtcars, ~ cat(.y, <span style="color: #8b2252;">": "</span>, median(.x), <span style="color: #8b2252;">"\n"</span>, sep = <span style="color: #8b2252;">""</span>))
</pre>
</div>
</div>
</div>
<div id="org768a334" class="outline-4">
<h4 id="org768a334"><span class="section-number-4">12.4.31</span> lmap</h4>
<div class="outline-text-4" id="text-12-4-31">
<p>
lmap(), lmap<sub>at</sub>() and lmap<sub>if</sub>() are similar to map(), map<sub>at</sub>() and map<sub>if</sub>(), with the difference that they operate exclusively on functions that take and return a list (or data frame).
</p>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;"># </span><span style="color: #b22222;">Let's write a function that returns a larger list or an empty list</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">depending on some condition. This function also uses the names</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">metadata available in the attributes of the list-element</span>
   <span style="color: #0000ff;">maybe_rep</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>(x) {
       n <span style="color: #008b8b;">&lt;-</span> rpois(<span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">2</span>)
       out <span style="color: #008b8b;">&lt;-</span> rep_len(x, n)
       <span style="color: #a020f0;">if</span> (length(out) &gt; <span style="color: #008b8b;">0</span>) {
           names(out) <span style="color: #008b8b;">&lt;-</span> paste0(names(x), seq_len(n))
       }
       out
   }
   <span style="color: #b22222;"># </span><span style="color: #b22222;">The output size varies each time we map f()</span>
   x <span style="color: #008b8b;">&lt;-</span> list(a = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">4</span>, b = letters[<span style="color: #008b8b;">5</span>:<span style="color: #008b8b;">7</span>], c = <span style="color: #008b8b;">8</span>:<span style="color: #008b8b;">9</span>, d = letters[<span style="color: #008b8b;">10</span>])
   x <span style="color: #008b8b;">%&gt;%</span> lmap(maybe_rep)
   <span style="color: #b22222;"># </span><span style="color: #b22222;">We can apply f() on a selected subset of x</span>
   x <span style="color: #008b8b;">%&gt;%</span> lmap_at(c(<span style="color: #8b2252;">"a"</span>, <span style="color: #8b2252;">"d"</span>), maybe_rep)
   <span style="color: #b22222;"># </span><span style="color: #b22222;">Or only where a condition is satisfied</span>
   x <span style="color: #008b8b;">%&gt;%</span> lmap_if(is.character, maybe_rep)
</pre>
</div>
</div>
</div>
<div id="orgdfa4ca4" class="outline-4">
<h4 id="orgdfa4ca4"><span class="section-number-4">12.4.32</span> modify</h4>
<div class="outline-text-4" id="text-12-4-32">
<p>
Same type of output as input: modify().modify 函数好处是输出和输入类型一样的类型。Unlike map() and its variants which always return a fixed object type (list for map(), integer vector for map<sub>int</sub>(), etc), the modify() family always returns the same type as the input object.
</p>
<div class="org-src-container">
<pre class="src src-R"> <span style="color: #b22222;"># </span><span style="color: #b22222;">Convert factors to characters</span>
iris <span style="color: #008b8b;">%&gt;%</span>
  modify_if(is.factor, as.character) <span style="color: #008b8b;">%&gt;%</span>
  str()

                                        <span style="color: #b22222;"># </span><span style="color: #b22222;">Specify which columns to map with a numeric vector of positions:</span>
mtcars <span style="color: #008b8b;">%&gt;%</span> modify_at(c(<span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">4</span>, <span style="color: #008b8b;">5</span>), as.character) <span style="color: #008b8b;">%&gt;%</span> str()

list(x = rbernoulli(<span style="color: #008b8b;">100</span>), y = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">100</span>) <span style="color: #008b8b;">%&gt;%</span>
  transpose() <span style="color: #008b8b;">%&gt;%</span>
  modify_if(<span style="color: #8b2252;">"x"</span>, ~ update_list(., y = ~ y * <span style="color: #008b8b;">100</span>)) <span style="color: #008b8b;">%&gt;%</span>
  transpose() <span style="color: #008b8b;">%&gt;%</span>
  simplify_all()

                                        <span style="color: #b22222;"># </span><span style="color: #b22222;">Use modify2() to map over two vectors and preserve the type of</span>
                                        <span style="color: #b22222;"># </span><span style="color: #b22222;">the first one:</span>
x <span style="color: #008b8b;">&lt;-</span> c(foo = <span style="color: #008b8b;">1L</span>, bar = <span style="color: #008b8b;">2L</span>)
y <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #228b22;">TRUE</span>, <span style="color: #228b22;">FALSE</span>)
modify2(x, y, ~ <span style="color: #a020f0;">if</span> (.y) .x <span style="color: #a020f0;">else</span> <span style="color: #008b8b;">0L</span>)
                                        <span style="color: #b22222;"># </span><span style="color: #b22222;">Modify at specified depth ---------------------------</span>
l1 <span style="color: #008b8b;">&lt;-</span> list(
  obj1 = list(
    prop1 = list(param1 = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">2</span>, param2 = <span style="color: #008b8b;">3</span>:<span style="color: #008b8b;">4</span>),
    prop2 = list(param1 = <span style="color: #008b8b;">5</span>:<span style="color: #008b8b;">6</span>, param2 = <span style="color: #008b8b;">7</span>:<span style="color: #008b8b;">8</span>)
  ),
  obj2 = list(
    prop1 = list(param1 = <span style="color: #008b8b;">9</span>:<span style="color: #008b8b;">10</span>, param2 = <span style="color: #008b8b;">11</span>:<span style="color: #008b8b;">12</span>),
    prop2 = list(param1 = <span style="color: #008b8b;">12</span>:<span style="color: #008b8b;">14</span>, param2 = <span style="color: #008b8b;">15</span>:<span style="color: #008b8b;">17</span>)
  )
)
                                        <span style="color: #b22222;"># </span><span style="color: #b22222;">In the above list, "obj" is level 1, "prop" is level 2 and "param"</span>
                                        <span style="color: #b22222;"># </span><span style="color: #b22222;">is level 3. To apply sum() on all params, we map it at depth 3:</span>
l1 <span style="color: #008b8b;">%&gt;%</span> modify_depth(<span style="color: #008b8b;">3</span>, sum)
l1 <span style="color: #008b8b;">%&gt;%</span> modify_depth(<span style="color: #008b8b;">3</span>, <span style="color: #000000; background-color: #ffffff;">`+`</span>, <span style="color: #008b8b;">100L</span>)
                                        <span style="color: #b22222;"># </span><span style="color: #b22222;">modify() lets us pluck the elements prop1/param2 in obj1 and obj2:</span>
l1 <span style="color: #008b8b;">%&gt;%</span> modify(c(<span style="color: #8b2252;">"prop1"</span>, <span style="color: #8b2252;">"param2"</span>)) <span style="color: #008b8b;">%&gt;%</span> str()
l1 <span style="color: #008b8b;">%&gt;%</span> modify_depth(<span style="color: #008b8b;">2</span>, ~ pmap(., paste, sep = <span style="color: #8b2252;">" / "</span>)) <span style="color: #008b8b;">%&gt;%</span> str()
</pre>
</div>

<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> c(foo = <span style="color: #008b8b;">1L</span>, bar = <span style="color: #008b8b;">2L</span>)
y <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #228b22;">TRUE</span>, <span style="color: #228b22;">FALSE</span>)
modify2(x, y, ~ <span style="color: #a020f0;">if</span> (.y) .x <span style="color: #a020f0;">else</span> <span style="color: #008b8b;">0L</span>)      
</pre>
</div>
</div>
</div>

<div id="orgbe0244a" class="outline-4">
<h4 id="orgbe0244a"><span class="section-number-4">12.4.33</span> vec<sub>depth</sub></h4>
<div class="outline-text-4" id="text-12-4-33">
<p>
Compute the depth of a vector.The depth of a vector is basically how many levels that you can index into it.
</p>
<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> list(
    list(),
    list(list()),
    list(list(list(<span style="color: #008b8b;">1</span>)))
)
vec_depth(x)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] 5</span>
x <span style="color: #008b8b;">%&gt;%</span> map_int(vec_depth)      
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] 1 2 4</span>
</pre>
</div>
</div>
</div>
<div id="orgedec014" class="outline-4">
<h4 id="orgedec014"><span class="section-number-4">12.4.34</span> reduce</h4>
<div class="outline-text-4" id="text-12-4-34">
<p>
Reduce a list to a single value by iteratively applying a binary function.
mapreduce?
</p>

<p>
Arguments
.x  
A list or atomic vector.
</p>

<p>
.f  
For reduce(), and accumulate(), a 2-argument function. The function will be passed the accumulated value as the first argument and the "next" value as the second argument.
</p>

<p>
For reduce2() and accumulate2(), a 3-argument function. The function will be passed the accumulated value as the first argument, the next value of .x as the second argument, and the next value of .y as the third argument.
</p>

<p>
The reduction terminates early if .f returns a value wrapped in a done().
</p>

<p>
&#x2026; 
Additional arguments passed on to the mapped function.
</p>

<p>
.init 
If supplied, will be used as the first value to start the accumulation, rather than using .x. This is useful if you want to ensure that reduce returns a correct value when .x is empty. If missing, and .x is empty, will throw an error.
</p>

<p>
.dir  
The direction of reduction as a string, one of "forward" (the default) or "backward". See the section about direction below.
</p>

<p>
.y  
For reduce2() and accumulate2(), an additional argument that is passed to .f. If init is not set, .y should be 1 element shorter than .x.
</p>

<div class="org-src-container">
<pre class="src src-R">  x <span style="color: #008b8b;">&lt;-</span> list(c(<span style="color: #008b8b;">0</span>,<span style="color: #008b8b;">1</span>))
  x <span style="color: #008b8b;">%&gt;%</span> reduce(c) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36825;&#20010;&#20989;&#25968;&#21487;&#20197;&#24456;&#26041;&#20415;&#22320;&#23558;list &#22411; &#36716;&#21464;&#25104; vector.</span>
  x <span style="color: #008b8b;">%&gt;%</span> reduce_right(c)
  x <span style="color: #008b8b;">%&gt;%</span> reduce(<span style="color: #8b2252;">"+"</span>) 
lst <span style="color: #008b8b;">&lt;-</span> list(<span style="color: #008b8b;">0</span>)
  <span style="color: #a020f0;">for</span>(i <span style="color: #a020f0;">in</span> (<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">5</span>))
  {
   lst[i] = list(matrix(rep(i,<span style="color: #008b8b;">8</span>),nrow = <span style="color: #008b8b;">2</span>))
  }
Reduce(<span style="color: #8b2252;">"+"</span>,lst) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#23558;list &#20013;&#30340;&#20803;&#32032;&#36827;&#34892;&#30456;&#21152;</span>

a <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #008b8b;">12</span>,<span style="color: #008b8b;">23</span>,<span style="color: #008b8b;">3</span>,<span style="color: #008b8b;">8</span>)
  Reduce(<span style="color: #8b2252;">"+"</span>,a)
                                        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#31561;&#20215;&#20110;&#8220;"+"("+"("+"(12,25),3),8)&#8221;</span>
  Reduce(<span style="color: #8b2252;">"-"</span>,a)
                                        <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21516;&#26679;&#31561;&#20215;&#20110;&#19979;&#38754;&#31639;&#24335;"-"("-"("-"(12,25),3),8)</span>

  Reduce(<span style="color: #8b2252;">"+"</span>,a,accumulate=T) <span style="color: #b22222;">##</span><span style="color: #b22222;">&#21487;&#20197;&#30693;&#36947;&#32047;&#35745;&#30340;&#32467;&#26524;</span>

??mapreduce
</pre>
</div>

<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> list(c(<span style="color: #008b8b;">0</span>, <span style="color: #008b8b;">1</span>), c(<span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">3</span>), c(<span style="color: #008b8b;">4</span>, <span style="color: #008b8b;">5</span>))
y <span style="color: #008b8b;">&lt;-</span> list(c(<span style="color: #008b8b;">6</span>, <span style="color: #008b8b;">7</span>), c(<span style="color: #008b8b;">8</span>, <span style="color: #008b8b;">9</span>))
reduce2(x, y, paste)
                                    <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "0 2 6 4 8" "1 3 7 5 9"</span>
<span style="color: #0000ff;">paste2</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>(x, y, sep = <span style="color: #8b2252;">"."</span>) paste(x, y, sep = sep)
letters[<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">4</span>] <span style="color: #008b8b;">%&gt;%</span> reduce2(c(<span style="color: #8b2252;">"-"</span>, <span style="color: #8b2252;">"."</span>, <span style="color: #8b2252;">"-"</span>), paste2)
                                    <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "a-b.c-d"    </span>
</pre>
</div>
</div>
</div>

<div id="org2c88a7c" class="outline-4">
<h4 id="org2c88a7c"><span class="section-number-4">12.4.35</span> detect</h4>
<div class="outline-text-4" id="text-12-4-35">
<p>
detect() 函数可以找出预测值为真的第一个元素， detect<sub>index</sub>() 函数则可以返回这个元素的位置：这个函数可以通过
</p>
<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> sample(<span style="color: #008b8b;">10</span>)
x
x <span style="color: #008b8b;">%&gt;%</span> detect(~ . &gt;<span style="color: #008b8b;">5</span>)
x <span style="color: #008b8b;">%&gt;%</span>
    detect_index(~ . &gt;<span style="color: #008b8b;">5</span>)

detect(x, <span style="color: #8b2252;">"foo"</span>)
</pre>
</div>
</div>
</div>
<div id="orgcc59a9f" class="outline-4">
<h4 id="orgcc59a9f"><span class="section-number-4">12.4.36</span> detect<sub>index</sub></h4>
<div class="outline-text-4" id="text-12-4-36">
<p>
detect<sub>index</sub>() 函数则可以返回这个元素的位置，应该是满足第一条件的元素位置：
</p>
<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> sample(<span style="color: #008b8b;">10</span>)
x
x <span style="color: #008b8b;">%&gt;%</span>
    detect_index(~ . &gt;<span style="color: #008b8b;">5</span>)
</pre>
</div>
</div>
</div>
<div id="org041b751" class="outline-4">
<h4 id="org041b751"><span class="section-number-4">12.4.37</span> head<sub>while</sub>/tail<sub>while</sub></h4>
<div class="outline-text-4" id="text-12-4-37">
<p>
作用和 detect 类似，head<sub>while</sub> 和 tail<sub>while</sub> 分别从向量开头和结尾找出预测值为真的元素。
</p>

<p>
Find head/tail that all satisfies a predicate.
</p>

<p>
Usage
head<sub>while</sub>(.x, .p, &#x2026;)
</p>

<p>
tail<sub>while</sub>(.x, .p, &#x2026;)
Arguments
.x  
A list or atomic vector.
</p>

<p>
.p  
A single predicate function, a formula describing such a predicate function, or a logical vector of the same length as .x. Alternatively, if the elements of .x are themselves lists of objects, a string indicating the name of a logical element in the inner lists. Only those elements where .p evaluates to TRUE will be modified.
</p>

<p>
&#x2026; 
Additional arguments passed on to the mapped function.
</p>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #0000ff;">pos</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>(x) x&gt;=<span style="color: #008b8b;">0</span>
head_while(<span style="color: #008b8b;">5</span>:-<span style="color: #008b8b;">5</span>,pos)
<span style="color: #0000ff;">big</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>(x) x &gt; <span style="color: #008b8b;">100</span>
head_while(<span style="color: #008b8b;">0</span>:<span style="color: #008b8b;">10</span>, big)
tail_while(<span style="color: #008b8b;">0</span>:<span style="color: #008b8b;">10</span>, big)
</pre>
</div>
</div>
</div>
<div id="org83ca9bd" class="outline-4">
<h4 id="org83ca9bd"><span class="section-number-4">12.4.38</span> rep<sub>along</sub></h4>
<div class="outline-text-4" id="text-12-4-38">
<p>
These functions take the idea of seq<sub>along</sub>() and apply it to repeating values.
对给定的序列，重复填充给定的数值。
</p>
<div class="org-src-container">
<pre class="src src-R">rep_along(x, <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">2</span>)
rep_along(x, <span style="color: #008b8b;">1</span>)

rep_along(x, na_int)
rep_along(x, na_chr)
                                  <span style="color: #b22222;"># </span><span style="color: #b22222;">rep_named() repeats a value along a names vectors</span>
rep_named(c(<span style="color: #8b2252;">"foo"</span>, <span style="color: #8b2252;">"bar"</span>), list(letters))  
</pre>
</div>
</div>
</div>


<div id="org015870e" class="outline-4">
<h4 id="org015870e"><span class="section-number-4">12.4.39</span> %||%</h4>
<div class="outline-text-4" id="text-12-4-39">
<p>
This infix function makes it easy to replace NULLs with a default value. It's inspired by the way that Ruby's or operation (||) works.
</p>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #008b8b;">1</span> <span style="color: #008b8b;">%||%</span> <span style="color: #008b8b;">2</span>
<span style="color: #228b22;">NULL</span> <span style="color: #008b8b;">%||%</span> <span style="color: #008b8b;">2</span>
</pre>
</div>
</div>
</div>
<div id="org562ea35" class="outline-4">
<h4 id="org562ea35"><span class="section-number-4">12.4.40</span> as<sub>mapper</sub></h4>
<div class="outline-text-4" id="text-12-4-40">
<p>
这个函数其实是一种函数代码，具体含义见下面样例。
</p>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
as_mapper(c(<span style="color: #8b2252;">"a"</span>, <span style="color: #8b2252;">"b"</span>, <span style="color: #8b2252;">"c"</span>))
                                      <span style="color: #b22222;"># </span><span style="color: #b22222;">Equivalent to function(x) x[["a"]][["b"]][["c"]]</span>
as_mapper(list(<span style="color: #008b8b;">1</span>, <span style="color: #8b2252;">"a"</span>, <span style="color: #008b8b;">2</span>))
                                      <span style="color: #b22222;"># </span><span style="color: #b22222;">Equivalent to function(x) x[[1]][["a"]][[2]]</span>
as_mapper(c(<span style="color: #8b2252;">"a"</span>, <span style="color: #8b2252;">"b"</span>, <span style="color: #8b2252;">"c"</span>), .default = <span style="color: #228b22;">NA</span>)

</pre>
</div>
</div>
</div>
<div id="orgc8f2f7f" class="outline-4">
<h4 id="orgc8f2f7f"><span class="section-number-4">12.4.41</span> as<sub>vector</sub></h4>
<div class="outline-text-4" id="text-12-4-41">
<p>
Coerce a list to a vector.as<sub>vector</sub>() collapses a list of vectors into one vector. It checks that the type of each vector is consistent with .type. 
当原始数据为 list 型时可以很方便将原始数据转化为 vector 型。
</p>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
as.list(letters) <span style="color: #008b8b;">%&gt;%</span> as_vector(<span style="color: #8b2252;">"character"</span>) <span style="color: #008b8b;">%&gt;%</span> typeof()
</pre>
</div>
</div>
</div>
<div id="orga77e782" class="outline-4">
<h4 id="orga77e782"><span class="section-number-4">12.4.42</span> attr<sub>getter</sub></h4>
<div class="outline-text-4" id="text-12-4-42">
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
get_rownames <span style="color: #008b8b;">&lt;-</span> attr_getter(<span style="color: #8b2252;">"row.names"</span>)
get_rownames(mtcars)

obj1 <span style="color: #008b8b;">&lt;-</span> structure(<span style="color: #8b2252;">"obj"</span>, obj_attr = <span style="color: #8b2252;">"foo"</span>)
obj2 <span style="color: #008b8b;">&lt;-</span> structure(<span style="color: #8b2252;">"obj"</span>, obj_attr = <span style="color: #8b2252;">"bar"</span>)
x <span style="color: #008b8b;">&lt;-</span> list(obj1, obj2)
pluck(x, <span style="color: #008b8b;">1</span>, attr_getter(<span style="color: #8b2252;">"obj_attr"</span>))  <span style="color: #b22222;"># </span><span style="color: #b22222;">From first object</span>
pluck(x, <span style="color: #008b8b;">2</span>, attr_getter(<span style="color: #8b2252;">"obj_attr"</span>)) 
</pre>
</div>
</div>
</div>
<div id="org4e0bf6e" class="outline-4">
<h4 id="org4e0bf6e"><span class="section-number-4">12.4.43</span> join (TO) lists</h4>
<div class="outline-text-4" id="text-12-4-43">
</div>
<div id="org3ba8b05" class="outline-5">
<h5 id="org3ba8b05"><span class="section-number-5">12.4.43.1</span> append</h5>
<div class="outline-text-5" id="text-12-4-43-1">
<div class="org-src-container">
<pre class="src src-R">append(list(<span style="color: #008b8b;">1</span>),list(<span style="color: #008b8b;">2</span>))      
</pre>
</div>
</div>
</div>
<div id="orge5f2fdb" class="outline-5">
<h5 id="orge5f2fdb"><span class="section-number-5">12.4.43.2</span> prepend</h5>
<div class="outline-text-5" id="text-12-4-43-2">
<div class="org-src-container">
<pre class="src src-R">prepend(list(<span style="color: #008b8b;">1</span>),list(<span style="color: #008b8b;">2</span>)) 
<span style="color: #b22222;">## </span><span style="color: #b22222;">[[1]]</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] 2</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">[[2]]</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] 1</span>
</pre>
</div>
</div>
</div>
<div id="org52582ab" class="outline-5">
<h5 id="org52582ab"><span class="section-number-5">12.4.43.3</span> splice</h5>
<div class="outline-text-5" id="text-12-4-43-3">
<p>
将多个对象添加到 list 型数据中，用 splice.
</p>

<p>
Combine objects into a list, storing S3 objects as sub-lists. splice(x, y, "foo")
</p>
<div class="org-src-container">
<pre class="src src-R">splice(list(<span style="color: #008b8b;">1</span>,<span style="color: #008b8b;">4</span>,<span style="color: #008b8b;">5</span>),list(<span style="color: #008b8b;">2</span>,<span style="color: #008b8b;">3</span>),<span style="color: #8b2252;">"foo"</span>)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[[1]]</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] 1</span>

<span style="color: #b22222;">## </span><span style="color: #b22222;">[[2]]</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] 5</span>

<span style="color: #b22222;">## </span><span style="color: #b22222;">[[3]]</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] 2</span>

<span style="color: #b22222;">## </span><span style="color: #b22222;">[[4]]</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] 3</span>

<span style="color: #b22222;">## </span><span style="color: #b22222;">[[5]]</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] "foo"</span>
</pre>
</div>
</div>
</div>
</div>
<div id="orge379322" class="outline-4">
<h4 id="orge379322"><span class="section-number-4">12.4.44</span> set<sub>names</sub></h4>
<div class="outline-text-4" id="text-12-4-44">
<p>
可以重新命名！
</p>
<div class="org-src-container">
<pre class="src src-R">purrr::set_names(iris[<span style="color: #008b8b;">1</span>, ], paste0(<span style="color: #8b2252;">"a"</span>, <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">5</span>))
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;    a1  a2  a3  a4     a5</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1 5.1 3.5 1.4 0.2 setosa      </span>
</pre>
</div>

<p>
配合 dplyr::num<sub>range</sub> 使用真香！
</p>

<div class="org-src-container">
<pre class="src src-R">purrr::set_names(iris[<span style="color: #008b8b;">1</span>, ], paste0(<span style="color: #8b2252;">"a"</span>, <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">5</span>)) <span style="color: #008b8b;">%&gt;%</span>
    dplyr::select(dplyr::num_range(prefix = <span style="color: #8b2252;">"a"</span>, range = <span style="color: #008b8b;">2</span>:<span style="color: #008b8b;">4</span>, width = <span style="color: #008b8b;">1</span>))
        <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;    a2  a3  a4</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1 3.5 1.4 0.2  </span>
</pre>
</div>
</div>
</div>
</div>


<div id="org0f72ed1" class="outline-3">
<h3 id="org0f72ed1"><span class="section-number-3">12.5</span> furrr</h3>
<div class="outline-text-3" id="text-12-5">
<p>
这个包其实就是 purrr 的并行版本。
</p>
</div>
<div id="org00aac7a" class="outline-4">
<h4 id="org00aac7a"><span class="section-number-4">12.5.1</span> future<sub>imap</sub><sub>chr</sub></h4>
<div class="outline-text-4" id="text-12-5-1">
<div class="org-src-container">
<pre class="src src-R"><span style="color: #008b8b;">library</span>(furrr)
plan(multiprocess)
future_imap_chr(sample(<span style="color: #008b8b;">10</span>), ~ paste0(.y, <span style="color: #8b2252;">": "</span>, .x))  
</pre>
</div>
</div>
</div>
<div id="org364f58a" class="outline-4">
<h4 id="org364f58a"><span class="section-number-4">12.5.2</span> future<sub>map</sub></h4>
<div class="outline-text-4" id="text-12-5-2">
<div class="org-src-container">
<pre class="src src-R"><span style="color: #008b8b;">library</span>(furrr)
<span style="color: #008b8b;">library</span>(dplyr) <span style="color: #b22222;"># </span><span style="color: #b22222;">for the pipe</span>
plan(multiprocess)
<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">10</span> <span style="color: #008b8b;">%&gt;%</span>
  future_map(rnorm, n = <span style="color: #008b8b;">10</span>) <span style="color: #008b8b;">%&gt;%</span>
  future_map_dbl(mean)      

mtcars <span style="color: #008b8b;">%&gt;%</span>
    split(.$cyl) <span style="color: #008b8b;">%&gt;%</span>
    future_map(~ lm(mpg ~ wt, data = .x)) <span style="color: #008b8b;">%&gt;%</span>
    future_map_dfr(~ as.data.frame(t(as.matrix(coef(.)))))
</pre>
</div>
</div>
</div>


<div id="org17f378f" class="outline-4">
<h4 id="org17f378f"><span class="section-number-4">12.5.3</span> future<sub>map2</sub></h4>
<div class="outline-text-4" id="text-12-5-3">
<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> list(<span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">10</span>, <span style="color: #008b8b;">100</span>)
y <span style="color: #008b8b;">&lt;-</span> list(<span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">3</span>)
z <span style="color: #008b8b;">&lt;-</span> list(<span style="color: #008b8b;">5</span>, <span style="color: #008b8b;">50</span>, <span style="color: #008b8b;">500</span>)
future_map2(x, y, ~ .x + .y)    
</pre>
</div>
</div>
</div>

<div id="orgd2fce62" class="outline-4">
<h4 id="orgd2fce62"><span class="section-number-4">12.5.4</span> future<sub>pmap</sub></h4>
<div class="outline-text-4" id="text-12-5-4">
<div class="org-src-container">
<pre class="src src-R">future_pmap(list(x, y, z), sum)

                                        <span style="color: #b22222;"># </span><span style="color: #b22222;">Vectorizing a function over multiple arguments</span>
df <span style="color: #008b8b;">&lt;-</span> data.frame(
    x = c(<span style="color: #8b2252;">"apple"</span>, <span style="color: #8b2252;">"banana"</span>, <span style="color: #8b2252;">"cherry"</span>),
    pattern = c(<span style="color: #8b2252;">"p"</span>, <span style="color: #8b2252;">"n"</span>, <span style="color: #8b2252;">"h"</span>),
    replacement = c(<span style="color: #8b2252;">"x"</span>, <span style="color: #8b2252;">"f"</span>, <span style="color: #8b2252;">"q"</span>),
    stringsAsFactors = <span style="color: #228b22;">FALSE</span>
)
df
future_pmap(df, gsub)
future_pmap_chr(df, gsub)      
</pre>
</div>
</div>
</div>
</div>

<div id="orgdc81d6b" class="outline-3">
<h3 id="orgdc81d6b"><span class="section-number-3">12.6</span> plyr</h3>
<div class="outline-text-3" id="text-12-6">
</div>
<div id="orga658308" class="outline-4">
<h4 id="orga658308"><span class="section-number-4">12.6.1</span> rbind.fill</h4>
<div class="outline-text-4" id="text-12-6-1">
<p>
这个函数可以将同一数据的不同的列进行合并。
rbinds a list of data frames filling missing columns with NA.
</p>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
plyr::rbind.fill(mtcars <span style="color: #008b8b;">%&gt;%</span> select(mpg,wt),mtcars <span style="color: #008b8b;">%&gt;%</span> select(wt,cyl))
</pre>
</div>
</div>
</div>
<div id="org5c2f1fa" class="outline-4">
<h4 id="org5c2f1fa"><span class="section-number-4">12.6.2</span> join<sub>all</sub></h4>
<div class="outline-text-4" id="text-12-6-2">
<p>
Recursively join a list of data frames.这个函数可以将 list 型数据转换为
data.frame 型。
</p>
<div class="org-src-container">
<pre class="src src-R">dfs <span style="color: #008b8b;">&lt;-</span> list(
            a = data.frame(x = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">10</span>, a = runif(<span style="color: #008b8b;">10</span>)),
            b = data.frame(x = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">10</span>, b = runif(<span style="color: #008b8b;">10</span>)),
            c = data.frame(x = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">10</span>, c = runif(<span style="color: #008b8b;">10</span>))
            )
       join_all(dfs)
       join_all(dfs, <span style="color: #8b2252;">"x"</span>)
</pre>
</div>
</div>
</div>

<div id="org7a0c347" class="outline-4">
<h4 id="org7a0c347"><span class="section-number-4">12.6.3</span> mlply</h4>
<div class="outline-text-4" id="text-12-6-3">
<p>
Call a multi-argument function with values taken from columns of an data frame
or array, and combine results into a list.
</p>

<p>
       .data,
       .fun = NULL,
       &#x2026;,
       .expand = TRUE,
       .progress = "none,
  .inform = FALSE,
  .parallel = FALSE,
  .paropts = NULL
)
</p>
<div class="org-src-container">
<pre class="src src-R">mlply(cbind(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">4</span>, <span style="color: #008b8b;">4</span>:<span style="color: #008b8b;">1</span>), rep)
mlply(cbind(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">4</span>, <span style="color: #008b8b;">4</span>:<span style="color: #008b8b;">1</span>), seq)
</pre>
</div>
</div>
</div>
<div id="orgc4d80ab" class="outline-4">
<h4 id="orgc4d80ab"><span class="section-number-4">12.6.4</span> each</h4>
<div class="outline-text-4" id="text-12-6-4">
<p>
Aggregate multiple functions into a single function.
</p>
<div class="org-src-container">
<pre class="src src-R">each(min,max,mean)(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">10</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  min  max mean </span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  1.0 10.0  5.5</span>
each(<span style="color: #8b2252;">"min"</span>, <span style="color: #8b2252;">"max"</span>)(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">10</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; min max </span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   1  10</span>
</pre>
</div>
</div>
</div>
<div id="org68cb447" class="outline-4">
<h4 id="org68cb447"><span class="section-number-4">12.6.5</span> failwith</h4>
<div class="outline-text-4" id="text-12-6-5">
<p>
Modify a function so that it returns a default value when there is an error.
这个函数可以方便对函数进行检验。
</p>
<div class="org-src-container">
<pre class="src src-R">f <span style="color: #008b8b;">&lt;-</span> functionq(x) <span style="color: #a020f0;">if</span> (x == <span style="color: #008b8b;">1</span>) <span style="color: #a020f0;">stop</span>(<span style="color: #8b2252;">"Error!"</span>) <span style="color: #a020f0;">else</span> <span style="color: #008b8b;">1</span>
safef <span style="color: #008b8b;">&lt;-</span> failwith(<span style="color: #228b22;">NULL</span>, f)
safef(<span style="color: #008b8b;">1</span>)
safef(<span style="color: #008b8b;">2</span>)      
</pre>
</div>
</div>
</div>
<div id="org31b1678" class="outline-4">
<h4 id="org31b1678"><span class="section-number-4">12.6.6</span> round<sub>any</sub></h4>
<div class="outline-text-4" id="text-12-6-6">
<p>
Round to multiple of any number.
</p>
<div class="org-src-container">
<pre class="src src-R">Round to multiple of any number.round_any(<span style="color: #008b8b;">135</span>, <span style="color: #008b8b;">10</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 140</span>
round_any(<span style="color: #008b8b;">135</span>, <span style="color: #008b8b;">100</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 100</span>
round_any(<span style="color: #008b8b;">135</span>, <span style="color: #008b8b;">25</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 125</span>
round_any(<span style="color: #008b8b;">135</span>, <span style="color: #008b8b;">10</span>, floor)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 130</span>
round_any(Sys.time() + <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">10</span>, <span style="color: #008b8b;">5</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Warning in as.POSIXlt.POSIXct(x, tz): unknown timezone 'CST'</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [1] "2020-02-08 13:07:45 GMT" "2020-02-08 13:07:45 GMT"</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [3] "2020-02-08 13:07:45 GMT" "2020-02-08 13:07:45 GMT"</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [5] "2020-02-08 13:07:45 GMT" "2020-02-08 13:07:50 GMT"</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [7] "2020-02-08 13:07:50 GMT" "2020-02-08 13:07:50 GMT"</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [9] "2020-02-08 13:07:50 GMT" "2020-02-08 13:07:50 GMT"</span>
</pre>
</div>
</div>
</div>
<div id="org6110d38" class="outline-4">
<h4 id="org6110d38"><span class="section-number-4">12.6.7</span> ddply</h4>
<div class="outline-text-4" id="text-12-6-7">
<p>
Split data frame, apply function, and return results in a data frame.这个函数可以对数据进行分组，然后再作施加函数计算。
</p>

<div class="org-src-container">
<pre class="src src-R">      <span style="color: #0000ff;">nmissing</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>(x) sum(is.na(x))
<span style="color: #b22222;"># </span><span style="color: #b22222;">Apply to every column in a data frame</span>
colwise(nmissing)(baseball)
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   id year stint team lg g ab r h X2b X3b hr rbi  sb   cs bb   so  ibb hbp</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1  0    0     0    0  0 0  0 0 0   0   0  0  12 250 4525  0 1305 7528 377</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;    sh   sf gidp</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1 960 7390 5272</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">This is particularly useful in conjunction with d*ply</span>
ddply(baseball, .(year), colwise(nmissing)) <span style="color: #008b8b;">%&gt;%</span> head()
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   year id stint team lg g ab r h X2b X3b hr rbi sb cs bb so ibb hbp sh sf</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1 1871  0     0    0  0 0  0 0 0   0   0  0   0  0  0  0  0   7   7  7  7</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2 1872  0     0    0  0 0  0 0 0   0   0  0   0  0  0  0  0  13  13 13 13</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3 1873  0     0    0  0 0  0 0 0   0   0  0   0  0  0  0  0  13  13 13 13</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 4 1874  0     0    0  0 0  0 0 0   0   0  0   0  0  0  0  0  15  15 15 15</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 5 1875  0     0    0  0 0  0 0 0   0   0  0   0  0  0  0  0  17  17 17 17</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 6 1876  0     0    0  0 0  0 0 0   0   0  0   0 15 15  0  0  15  15 15 15</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   gidp</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1    7</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2   13</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3   13</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 4   15</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 5   17</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 6   15</span>
</pre>
</div>
</div>
</div>
<div id="org02e09a5" class="outline-4">
<h4 id="org02e09a5"><span class="section-number-4">12.6.8</span> adply</h4>
<div class="outline-text-4" id="text-12-6-8">
<p>
Split array, apply function, and return results in a data frame.
</p>

<p>
adply(.data, .margins, .fun = NULL, &#x2026;, .expand = TRUE,
  .progress = "none", .inform = FALSE, .parallel = FALSE,
  .paropts = NULL, .id = NA)
</p>

<p>
这个函数可以方便地对每行或者每列数据进行施加函数计算。
</p>
<div class="org-src-container">
<pre class="src src-R">adply(baseball, .margins = <span style="color: #008b8b;">1</span>, nmissing) <span style="color: #008b8b;">%&gt;%</span> head()
</pre>
</div>
</div>
</div>
<div id="org698ba0e" class="outline-4">
<h4 id="org698ba0e"><span class="section-number-4">12.6.9</span> colwise</h4>
<div class="outline-text-4" id="text-12-6-9">
<div class="org-src-container">
<pre class="src src-R">
</pre>
</div>
</div>
</div>
</div>

<div id="org12984ce" class="outline-3">
<h3 id="org12984ce"><span class="section-number-3">12.7</span> pryr</h3>
<div class="outline-text-3" id="text-12-7">
</div>
<div id="org5e141ea" class="outline-4">
<h4 id="org5e141ea"><span class="section-number-4">12.7.1</span> %.%</h4>
<div class="outline-text-4" id="text-12-7-1">
<p>
compose multiple function.
</p>
<div class="org-src-container">
<pre class="src src-R">not_null <span style="color: #008b8b;">&lt;-</span> <span style="color: #000000; background-color: #ffffff;">`!`</span> <span style="color: #008b8b;">%.%</span> is.null
not_null(<span style="color: #008b8b;">4</span>)
not_null(<span style="color: #228b22;">NULL</span>)
</pre>
</div>
</div>
</div>

<div id="orgb762954" class="outline-4">
<h4 id="orgb762954"><span class="section-number-4">12.7.2</span> otype</h4>
<div class="outline-text-4" id="text-12-7-2">
<p>
用来确定对象是否是 S3 对象还是 S4 对象。
</p>
<div class="org-src-container">
<pre class="src src-R">df <span style="color: #008b8b;">&lt;-</span> data.frame(x = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">10</span>)
otype(df)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "S3"  </span>
</pre>
</div>

<p>
在 S3 中，方法属于函数，称为泛型函数，和简称泛型（generics）。S3 的方法不属于对象或类。S3 型函数可以用 UseMethod()函数查看它的源代码。
</p>
</div>
</div>
<div id="org4e478da" class="outline-4">
<h4 id="org4e478da"><span class="section-number-4">12.7.3</span> %&lt;a-%</h4>
<div class="outline-text-4" id="text-12-7-3">
<p>
Create an active binding.Infix form of makeActiveBinding which creates an active binding between a name and an expression: every time the name is accessed the expression is recomputed.
可以生成一列随机变换的数列。
</p>
<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">%&lt;a-%</span> runif(<span style="color: #008b8b;">10</span>)
x
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [1] 0.412364424 0.299694440 0.897495063 0.045052921 0.212648676</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [6] 0.043610815 0.711287616 0.690729571 0.001689326 0.227112587</span>
x
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [1] 0.78443420 0.06685143 0.93141146 0.49956063 0.61850142 0.15722230</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [7] 0.85773514 0.93594267 0.79835833 0.41395477</span>
</pre>
</div>
</div>
</div>
<div id="org1bd0cca" class="outline-4">
<h4 id="org1bd0cca"><span class="section-number-4">12.7.4</span> %&lt;d-%</h4>
<div class="outline-text-4" id="text-12-7-4">
<p>
Infix form of delayedAssign which creates an delayed or lazy binding, which only evaluates the expression the first time it is used.
</p>
<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">%&lt;d-%</span> (a + b)
a <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">10</span>
b <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">100</span>
x
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 110</span>
</pre>
</div>
</div>
</div>
<div id="org6c6cd05" class="outline-4">
<h4 id="org6c6cd05"><span class="section-number-4">12.7.5</span> %&lt;c-%</h4>
<div class="outline-text-4" id="text-12-7-5">
<p>
Infix wrapper for assign + lockBinding that creates a constant: a binding whose value can not be changed.
</p>
<div class="org-src-container">
<pre class="src src-R">y <span style="color: #008b8b;">%&lt;c-%</span> <span style="color: #008b8b;">1</span> + <span style="color: #008b8b;">2</span>
y
z <span style="color: #008b8b;">%&lt;c-%</span> (<span style="color: #008b8b;">1</span> + <span style="color: #008b8b;">2</span>)
z    
</pre>
</div>
</div>
</div>
<div id="org6a57248" class="outline-4">
<h4 id="org6a57248"><span class="section-number-4">12.7.6</span> typename</h4>
<div class="outline-text-4" id="text-12-7-6">
<p>
typename determines the internal C typename.
</p>
<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">10</span>
typename(x)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] "INTSXP"    </span>
</pre>
</div>
</div>
</div>
<div id="org04763a3" class="outline-4">
<h4 id="org04763a3"><span class="section-number-4">12.7.7</span> address</h4>
<div class="outline-text-4" id="text-12-7-7">
<p>
address returns the memory location of the object.
</p>
<div class="org-src-container">
<pre class="src src-R">    address(x)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] "0x7f96fa9b6408"</span>
</pre>
</div>
</div>
</div>
<div id="orgaa71d3c" class="outline-4">
<h4 id="orgaa71d3c"><span class="section-number-4">12.7.8</span> inspect</h4>
<div class="outline-text-4" id="text-12-7-8">
<div class="org-src-container">
<pre class="src src-R"> inspect(x)
<span style="color: #b22222;">## </span><span style="color: #b22222;">&lt;INTSXP 0x7f970d78a3a0&gt;    </span>
</pre>
</div>
</div>
</div>

<div id="org26fb1ec" class="outline-4">
<h4 id="org26fb1ec"><span class="section-number-4">12.7.9</span> f</h4>
<div class="outline-text-4" id="text-12-7-9">
<div class="org-src-container">
<pre class="src src-R">f(x + y)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; function (x, y) </span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; x + y</span>
f(x + y)(<span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">10</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 11</span>
f(x, y = <span style="color: #008b8b;">2</span>, x + y)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; function (x, y = 2) </span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; x + y  </span>
f({
    y <span style="color: #008b8b;">&lt;-</span> runif(<span style="color: #008b8b;">1</span>)
    x + y
})
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; function (x) </span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; {</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;     y &lt;- runif(1)</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;     x + y</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; }    </span>
</pre>
</div>
</div>
</div>
<div id="org89e05e5" class="outline-4">
<h4 id="org89e05e5"><span class="section-number-4">12.7.10</span> make<sub>call</sub></h4>
<div class="outline-text-4" id="text-12-7-10">
<div class="org-src-container">
<pre class="src src-R">make_call(<span style="color: #8b2252;">"f"</span>, a = <span style="color: #008b8b;">1</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; f(a = 1)</span>
make_call(quote(f), a = <span style="color: #008b8b;">1</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; f(a = 1)</span>
make_call(quote(f()), a = <span style="color: #008b8b;">1</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; f()(a = 1)</span>
make_call(quote(f), a = <span style="color: #008b8b;">1</span>, b = <span style="color: #008b8b;">2</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; f(a = 1, b = 2)</span>
make_call(quote(f), list(a = <span style="color: #008b8b;">1</span>, b = <span style="color: #008b8b;">2</span>))
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; f(a = 1, b = 2)      </span>
</pre>
</div>
</div>
</div>
<div id="org5e2a732" class="outline-4">
<h4 id="org5e2a732"><span class="section-number-4">12.7.11</span> f<sub>capture</sub></h4>
<div class="outline-text-4" id="text-12-7-11">
<p>
This should be used sparingly if you want to implement true non-standard evaluation with 100% magic. I recommend avoiding this unless you have strong reasons otherwise since requiring arguments to be formulas only adds one extra character to the inputs, and otherwise makes life much much simpler.
</p>
<div class="org-src-container">
<pre class="src src-R"> f_capture(a + b)
<span style="color: #b22222;">## </span><span style="color: #b22222;">~a + b</span>
</pre>
</div>
</div>
</div>
<div id="org0a6e2bb" class="outline-4">
<h4 id="org0a6e2bb"><span class="section-number-4">12.7.12</span> f<sub>eval</sub></h4>
<div class="outline-text-4" id="text-12-7-12">
<p>
f<sub>eval</sub><sub>rhs</sub> evaluates the RHS of a formula and f<sub>eval</sub><sub>lhs</sub> evaluates the LHS. f<sub>eval</sub> is a shortcut for f<sub>eval</sub><sub>rhs</sub> since that is what you most commonly need.
</p>
<div class="org-src-container">
<pre class="src src-R">f_eval(~ <span style="color: #008b8b;">1</span> + <span style="color: #008b8b;">2</span> + <span style="color: #008b8b;">3</span>)    
<span style="color: #b22222;"># </span><span style="color: #b22222;">6</span>
</pre>
</div>
</div>
</div>


<div id="org1aaa252" class="outline-4">
<h4 id="org1aaa252"><span class="section-number-4">12.7.13</span> dots<sub>capture</sub></h4>
<div class="outline-text-4" id="text-12-7-13">
<p>
This should be used sparingly if you want to implement true non-standard evaluation with 100% magic. I recommend avoiding this unless you have strong reasons otherwise since requiring arguments to be formulas only adds one extra character to the inputs, and otherwise makes life much much simpler.
</p>
<div class="org-src-container">
<pre class="src src-R"> dots_capture(a + b, c + d, e + f)
 <span style="color: #b22222;">## </span><span style="color: #b22222;">[[1]]</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">~a + b</span>

<span style="color: #b22222;">## </span><span style="color: #b22222;">[[2]]</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">~c + d</span>

<span style="color: #b22222;">## </span><span style="color: #b22222;">[[3]]</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">~e + f  </span>
</pre>
</div>
</div>
</div>

<div id="orgce462bb" class="outline-4">
<h4 id="orgce462bb"><span class="section-number-4">12.7.14</span> fget</h4>
<div class="outline-text-4" id="text-12-7-14">
<p>
Find a function with specified name.
</p>
<div class="org-src-container">
<pre class="src src-R">c <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">10</span>
fget(<span style="color: #8b2252;">"c"</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; function (...)  .Primitive("c")</span>
</pre>
</div>
</div>
</div>
<div id="org7fe2270" class="outline-4">
<h4 id="org7fe2270"><span class="section-number-4">12.7.15</span> find<sub>funs</sub></h4>
<div class="outline-text-4" id="text-12-7-15">
<p>
Find functions matching criteria.
</p>
<div class="org-src-container">
<pre class="src src-R">find_funs(<span style="color: #8b2252;">"package:base"</span>, fun_calls, <span style="color: #8b2252;">"match.fun"</span>, fixed = <span style="color: #228b22;">TRUE</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Using environment package:base</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [1] "apply"  "eapply" "Find"   "lapply" "Map"    "mapply" "Negate"</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [8] "outer"  "Reduce" "sapply" "sweep"  "tapply" "vapply"</span>
find_funs(<span style="color: #8b2252;">"package:stats"</span>, fun_args, <span style="color: #8b2252;">"^[A-Z]+$"</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Using environment package:stats</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [1] "addmargins"           "aggregate.data.frame" "aggregate.ts"        </span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [4] "ave"                  "chisq.test"           "cov2cor"             </span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [7] "dendrapply"           "fisher.test"          "poisson.test"        </span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [10] "SSfpl"                "SSmicmen"</span>
</pre>
</div>

<p>
This is a flexible function that matches function component against a regular expression, returning the name of the function if there are any matches. fun<sub>args</sub> and fun<sub>calls</sub> are helper functions that make it possible to search for functions with specified argument names, or which call certain functions.
</p>

<div class="org-src-container">
<pre class="src src-R">fun_calls(write.csv)
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [1] "{"           "&lt;-"          "match.call"  "for"         "c"          </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [6] "if"          "!"           "is.null"     "[["          "warning"    </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [11] "gettextf"    "eval.parent" "$"           "&amp;&amp;"          "is.logical" </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [16] "as.name"</span>
fun_body(write.csv)
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [1] "{"                                                                                                               </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [2] "    Call &lt;- match.call(expand.dots = TRUE)"                                                                      </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [3] "    for (argname in c(\"append\", \"col.names\", \"sep\", \"dec\", \"qmethod\")) if (!is.null(Call[[argname]])) "</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [4] "        warning(gettextf(\"attempt to set '%s' ignored\", argname), "                                            </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [5] "            domain = NA)"                                                                                        </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [6] "    rn &lt;- eval.parent(Call$row.names)"                                                                           </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [7] "    Call$append &lt;- NULL"                                                                                         </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [8] "    Call$col.names &lt;- if (is.logical(rn) &amp;&amp; !rn) "                                                               </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [9] "        TRUE"                                                                                                    </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [10] "    else NA"                                                                                                     </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [11] "    Call$sep &lt;- \",\""                                                                                           </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [12] "    Call$dec &lt;- \".\""                                                                                           </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [13] "    Call$qmethod &lt;- \"double\""                                                                                  </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [14] "    Call[[1L]] &lt;- as.name(\"write.table\")"                                                                      </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [15] "    eval.parent(Call)"                                                                                           </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [16] "}"  </span>
</pre>
</div>
</div>
</div>
<div id="orgf617a97" class="outline-4">
<h4 id="orgf617a97"><span class="section-number-4">12.7.16</span> modify<sub>lang</sub></h4>
<div class="outline-text-4" id="text-12-7-16">
<div class="org-src-container">
<pre class="src src-R">
</pre>
</div>
</div>
</div>
<div id="org2dee16f" class="outline-4">
<h4 id="org2dee16f"><span class="section-number-4">12.7.17</span> object<sub>size</sub></h4>
<div class="outline-text-4" id="text-12-7-17">
<p>
object<sub>size</sub> works similarly to object.size, but counts more accurately and includes the size of environments. compare<sub>size</sub> makes it easy to compare the output of object<sub>size</sub> and object.size.
</p>
<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">1e4</span>
z <span style="color: #008b8b;">&lt;-</span> list(x, x, x)
compare_size(z)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   base   pryr </span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 120224  40128</span>
object_size(x)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 40 kB</span>
object_size(z)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 40.1 kB</span>
object_size(x, z)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 40.1 kB      </span>
</pre>
</div>
</div>
</div>
<div id="org6c11546" class="outline-4">
<h4 id="org6c11546"><span class="section-number-4">12.7.18</span> find<sub>uses</sub></h4>
<div class="outline-text-4" id="text-12-7-18">
<p>
Find all functions in that call supplied functions.
</p>

<div class="org-src-container">
<pre class="src src-R"> names(find_uses(<span style="color: #8b2252;">"package:base"</span>, <span style="color: #8b2252;">"sum"</span>))
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [1] "[[&lt;-.data.frame"                   </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [2] "[&lt;-.data.frame"                    </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [3] "all.equal.character"               </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [4] "all.equal.numeric"                 </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [5] "all.equal.raw"                     </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [6] "as.numeric_version"                </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [7] "attach"                            </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [8] "getDLLRegisteredRoutines.character"</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [9] "margin.table"                      </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [10] "merge.data.frame"                  </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [11] "namespaceExport"                   </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [12] "namespaceImportMethods"            </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [13] "path.package"                      </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [14] "print.summary.warnings"            </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [15] "prop.table"                        </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [16] "rank"                              </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [17] "registerS3methods"                 </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [18] "save"                              </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [19] "scale.default"                     </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [20] "seq.Date"                          </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [21] "seq.POSIXt"                        </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [22] "strwrap"                           </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [23] "summary.default"                   </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [24] "summary.factor"                    </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [25] "summary.table"                     </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [26] "write.dcf" </span>
</pre>
</div>
</div>
</div>
<div id="orgec1fa6f" class="outline-4">
<h4 id="orgec1fa6f"><span class="section-number-4">12.7.19</span> partial</h4>
<div class="outline-text-4" id="text-12-7-19">
<p>
Partial apply a function, filling in some arguments.
</p>
<div class="org-src-container">
<pre class="src src-R">f <span style="color: #008b8b;">&lt;-</span> partial(runif, n = rpois(<span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">5</span>))
f
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; function (...) </span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; runif(n = rpois(1, 5), ...)      </span>
</pre>
</div>
</div>
</div>
<div id="orgee5f8b3" class="outline-4">
<h4 id="orgee5f8b3"><span class="section-number-4">12.7.20</span> rebind</h4>
<div class="outline-text-4" id="text-12-7-20">
<p>
Rebind an existing name
</p>
<div class="org-src-container">
<pre class="src src-R">a <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">1</span>
rebind(<span style="color: #8b2252;">"a"</span>, <span style="color: #008b8b;">2</span>)
a
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 2</span>
</pre>
</div>
</div>
</div>
<div id="orgbae01ae" class="outline-4">
<h4 id="orgbae01ae"><span class="section-number-4">12.7.21</span> lazy<sub>eval</sub></h4>
<div class="outline-text-4" id="text-12-7-21">
<div class="org-src-container">
<pre class="src src-python">f &lt;- function(x) {
  z &lt;- <span style="color: #008b8b;">100</span>
  ~ x + z
}
z &lt;- <span style="color: #008b8b;">10</span>
f(z)
lazy_eval(f(<span style="color: #008b8b;">10</span>))
lazy_eval(f(<span style="color: #008b8b;">10</span>), <span style="color: #483d8b;">list</span>(x = <span style="color: #008b8b;">100</span>))
lazy_eval(f(<span style="color: #008b8b;">10</span>), <span style="color: #483d8b;">list</span>(x = <span style="color: #008b8b;">1</span>, z = <span style="color: #008b8b;">1</span>))    
</pre>
</div>
</div>
</div>
</div>

<div id="org8b593b5" class="outline-3">
<h3 id="org8b593b5"><span class="section-number-3">12.8</span> tidyr</h3>
<div class="outline-text-3" id="text-12-8">
</div>
<div id="org2a1fd9f" class="outline-4">
<h4 id="org2a1fd9f"><span class="section-number-4">12.8.1</span> chop()</h4>
<div class="outline-text-4" id="text-12-8-1">
<p>
chop() 函数的作用和 nest() 类似，都属于嵌套函数，不同的是，nest() 会改变数据结构，而 chop() 不会。
</p>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
df <span style="color: #008b8b;">&lt;-</span> tibble(x = c(<span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">3</span>), y = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">6</span>, z = <span style="color: #008b8b;">6</span>:<span style="color: #008b8b;">1</span>)
df
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; # A tibble: 6 x 3</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;       x     y     z</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   &lt;dbl&gt; &lt;int&gt; &lt;int&gt;</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1     1     1     6</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2     1     2     5</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3     1     3     4</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 4     2     4     3</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 5     2     5     2</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 6     3     6     1</span>
df <span style="color: #008b8b;">%&gt;%</span> chop(c(y, z)) <span style="color: #008b8b;">%&gt;%</span> head()
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; # A tibble: 3 x 3</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;       x y         z        </span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   &lt;dbl&gt; &lt;list&gt;    &lt;list&gt;   </span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1     1 &lt;int [3]&gt; &lt;int [3]&gt;</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2     2 &lt;int [2]&gt; &lt;int [2]&gt;</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3     3 &lt;int [1]&gt; &lt;int [1]&gt;</span>
df <span style="color: #008b8b;">%&gt;%</span> nest(data = c(y, z)) <span style="color: #008b8b;">%&gt;%</span> head()
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; # A tibble: 3 x 2</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;       x data            </span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   &lt;dbl&gt; &lt;list&gt;          </span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1     1 &lt;tibble [3 &#215; 2]&gt;</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2     2 &lt;tibble [2 &#215; 2]&gt;</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3     3 &lt;tibble [1 &#215; 2]&gt;</span>
</pre>
</div>
</div>
</div>

<div id="orga818f62" class="outline-4">
<h4 id="orga818f62"><span class="section-number-4">12.8.2</span> unchop()</h4>
<div class="outline-text-4" id="text-12-8-2">
<p>
unchop() 作用是将 data.frame 中有 list 型的数据转换为正常的数据。值得注意的是 keep<sub>empty</sub> 参数，如果为 TRUE 那么将没有的数据设置为 na, 如果参数为 false, 那么自动忽略这行数据。
</p>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
df <span style="color: #008b8b;">&lt;-</span> tibble(x = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">4</span>, y = list(integer(), <span style="color: #008b8b;">1L</span>, <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>))
df
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; # A tibble: 4 x 2</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;       x y        </span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   &lt;int&gt; &lt;list&gt;   </span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1     1 &lt;int [0]&gt;</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2     2 &lt;int [1]&gt;</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3     3 &lt;int [2]&gt;</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 4     4 &lt;int [3]&gt;</span>
df <span style="color: #008b8b;">%&gt;%</span> unchop(y)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; # A tibble: 6 x 2</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;       x     y</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   &lt;int&gt; &lt;int&gt;</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1     2     1</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2     3     1</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3     3     2</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 4     4     1</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 5     4     2</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 6     4     3</span>
df <span style="color: #008b8b;">%&gt;%</span> unchop(y, keep_empty = <span style="color: #228b22;">TRUE</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; # A tibble: 7 x 2</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;       x     y</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   &lt;int&gt; &lt;int&gt;</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1     1    NA</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2     2     1</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3     3     1</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 4     3     2</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 5     4     1</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 6     4     2</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 7     4     3</span>
</pre>
</div>
</div>
</div>

<div id="org02df4e4" class="outline-4">
<h4 id="org02df4e4"><span class="section-number-4">12.8.3</span> complete()</h4>
<div class="outline-text-4" id="text-12-8-3">
<p>
这个函数的作用在于可以填补记录。 Turns implicit missing values into explicit missing values.这个函数可以根据特定的分组复制其记录,然后还可以补全缺失值。 
</p>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics</span>
df <span style="color: #008b8b;">&lt;-</span> tibble(
    group = c(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">1</span>),
    item_id = c(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">2</span>),
    item_name = c(<span style="color: #8b2252;">"a"</span>, <span style="color: #8b2252;">"b"</span>, <span style="color: #8b2252;">"b"</span>),
     value1 = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>,
     value2 = <span style="color: #008b8b;">4</span>:<span style="color: #008b8b;">6</span>
     )
df
<span style="color: #b22222;"># </span><span style="color: #b22222;">A tibble: 3 x 5</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">group item_id item_name value1 value2</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">&lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;      &lt;int&gt;  &lt;int&gt;</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">1     1       1 a              1      4</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">2     2       2 b              2      5</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">3     1       2 b              3      6</span>
df <span style="color: #008b8b;">%&gt;%</span> complete(group, nesting(item_id, item_name))
<span style="color: #b22222;"># </span><span style="color: #b22222;">A tibble: 4 x 5</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">group item_id item_name value1 value2</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">&lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;      &lt;int&gt;  &lt;int&gt;</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">1     1       1 a              1      4</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">2     1       2 b              3      6</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">3     2       1 a             NA     NA</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">4     2       2 b              2      5</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">You can also choose to fill in missing values</span>
df <span style="color: #008b8b;">%&gt;%</span> complete(group, nesting(item_id, item_name), fill = list(value1 = <span style="color: #008b8b;">0</span>))
                                      <span style="color: #b22222;"># </span><span style="color: #b22222;">A tibble: 4 x 5</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">group item_id item_name value1 value2</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">&lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt;  &lt;int&gt;</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">1     1       1 a              1      4</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">2     1       2 b              3      6</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">3     2       1 a              0     NA</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">4     2       2 b              2      5</span>
</pre>
</div>
</div>
</div>
<div id="org9aa1915" class="outline-4">
<h4 id="org9aa1915"><span class="section-number-4">12.8.4</span> expand</h4>
<div class="outline-text-4" id="text-12-8-4">
<p>
expand() is often useful in conjunction with left<sub>join</sub>() if you want to convert implicit missing values to explicit missing values. expand 经常配合 left<sub>join</sub> 函数使用。
expand 函数是在 distinct()的基础上进行操作的。
</p>

<p>
expand(nesting(x, y)) 这个函数和 expand(x, y) 函数最大的区别在于前者只会扩展 x,y 已有的枚举值.
</p>

<div class="org-src-container">
<pre class="src src-R">  <span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
  df <span style="color: #008b8b;">&lt;-</span> tibble(
      year   = c(<span style="color: #008b8b;">2010</span>, <span style="color: #008b8b;">2010</span>, <span style="color: #008b8b;">2010</span>, <span style="color: #008b8b;">2010</span>, <span style="color: #008b8b;">2012</span>, <span style="color: #008b8b;">2012</span>, <span style="color: #008b8b;">2012</span>),
      qtr    = c(   <span style="color: #008b8b;">1</span>,    <span style="color: #008b8b;">2</span>,    <span style="color: #008b8b;">3</span>,    <span style="color: #008b8b;">4</span>,    <span style="color: #008b8b;">1</span>,    <span style="color: #008b8b;">2</span>,    <span style="color: #008b8b;">3</span>),
      return = rnorm(<span style="color: #008b8b;">7</span>)
  )
  df <span style="color: #008b8b;">%&gt;%</span> expand(year, qtr)
  df <span style="color: #008b8b;">%&gt;%</span> expand(year = <span style="color: #008b8b;">2010</span>:<span style="color: #008b8b;">2012</span>, qtr)
  df <span style="color: #008b8b;">%&gt;%</span> expand(year = full_seq(year, <span style="color: #008b8b;">1</span>), qtr)

  <span style="color: #b22222;"># </span><span style="color: #b22222;">A tibble: 12 x 2</span>
  <span style="color: #b22222;">## </span><span style="color: #b22222;">year   qtr</span>
  <span style="color: #b22222;">## </span><span style="color: #b22222;">&lt;dbl&gt; &lt;dbl&gt;</span>
  <span style="color: #b22222;">##            </span><span style="color: #b22222;">1  2010     1</span>
  <span style="color: #b22222;">## </span><span style="color: #b22222;">2  2010     2</span>
  <span style="color: #b22222;">## </span><span style="color: #b22222;">3  2010     3</span>
  <span style="color: #b22222;">## </span><span style="color: #b22222;">4  2010     4</span>
  <span style="color: #b22222;">## </span><span style="color: #b22222;">5  2011     1</span>
  <span style="color: #b22222;">## </span><span style="color: #b22222;">6  2011     2</span>
  <span style="color: #b22222;">## </span><span style="color: #b22222;">7  2011     3</span>
  <span style="color: #b22222;">## </span><span style="color: #b22222;">8  2011     4</span>
  <span style="color: #b22222;">## </span><span style="color: #b22222;">9  2012     1</span>
  <span style="color: #b22222;">## </span><span style="color: #b22222;">10  2012     2</span>
  <span style="color: #b22222;">## </span><span style="color: #b22222;">11  2012     3</span>
  <span style="color: #b22222;">## </span><span style="color: #b22222;">12  2012     4</span>

  df <span style="color: #008b8b;">%&gt;%</span> complete(year = full_seq(year, <span style="color: #008b8b;">1</span>), qtr)
                                        <span style="color: #b22222;"># </span><span style="color: #b22222;">A tibble: 12 x 3</span>
  <span style="color: #b22222;">## </span><span style="color: #b22222;">year   qtr return</span>
  <span style="color: #b22222;">## </span><span style="color: #b22222;">&lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;</span>
  <span style="color: #b22222;">##                   </span><span style="color: #b22222;">1  2010     1 -0.649</span>
  <span style="color: #b22222;">## </span><span style="color: #b22222;">2  2010     2  0.961</span>
  <span style="color: #b22222;">## </span><span style="color: #b22222;">3  2010     3 -1.34 </span>
  <span style="color: #b22222;">## </span><span style="color: #b22222;">4  2010     4 -0.701</span>
  <span style="color: #b22222;">## </span><span style="color: #b22222;">5  2011     1 NA    </span>
  <span style="color: #b22222;">## </span><span style="color: #b22222;">6  2011     2 NA    </span>
  <span style="color: #b22222;">## </span><span style="color: #b22222;">7  2011     3 NA    </span>
  <span style="color: #b22222;">## </span><span style="color: #b22222;">8  2011     4 NA    </span>
  <span style="color: #b22222;">## </span><span style="color: #b22222;">9  2012     1  0.486</span>
  <span style="color: #b22222;">## </span><span style="color: #b22222;">10  2012     2 -0.195</span>
  <span style="color: #b22222;">## </span><span style="color: #b22222;">11  2012     3  1.31 </span>
  <span style="color: #b22222;">## </span><span style="color: #b22222;">12  2012     4 NA    </span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">All possible combinations of vs &amp; cyl, even those that aren't present in the data</span>
  expand(mtcars, vs, cyl) <span style="color: #b22222;">#</span><span style="color: #b22222;">all possible combinations of vs &amp; cyl, even those that aren't present in the data'</span>
                                        <span style="color: #b22222;"># </span><span style="color: #b22222;">A tibble: 6 x 2</span>
  <span style="color: #b22222;">## </span><span style="color: #b22222;">vs   cyl</span>
  <span style="color: #b22222;">## </span><span style="color: #b22222;">&lt;dbl&gt; &lt;dbl&gt;</span>
  <span style="color: #b22222;">##            </span><span style="color: #b22222;">1     0     4</span>
  <span style="color: #b22222;">## </span><span style="color: #b22222;">2     0     6</span>
  <span style="color: #b22222;">## </span><span style="color: #b22222;">3     0     8</span>
  <span style="color: #b22222;">## </span><span style="color: #b22222;">4     1     4</span>
  <span style="color: #b22222;">## </span><span style="color: #b22222;">5     1     6</span>
  <span style="color: #b22222;">## </span><span style="color: #b22222;">6     1     8</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">Only combinations of vs and cyl that appear in the data</span>
  expand(mtcars, nesting(vs, cyl))
  <span style="color: #b22222;"># </span><span style="color: #b22222;">A tibble: 5 x 2</span>
  <span style="color: #b22222;">## </span><span style="color: #b22222;">vs   cyl</span>
  <span style="color: #b22222;">## </span><span style="color: #b22222;">&lt;dbl&gt; &lt;dbl&gt;</span>
  <span style="color: #b22222;">##            </span><span style="color: #b22222;">1     0     4</span>
  <span style="color: #b22222;">## </span><span style="color: #b22222;">2     0     6</span>
  <span style="color: #b22222;">## </span><span style="color: #b22222;">3     0     8</span>
  <span style="color: #b22222;">## </span><span style="color: #b22222;">4     1     4</span>
  <span style="color: #b22222;">## </span><span style="color: #b22222;">5     1     6</span>
</pre>
</div>

<p>
To find only the combinations that occur in the data, use nest: expand(df, nesting(x, y, z)).
</p>
</div>
</div>

<div id="org5d8a2d0" class="outline-4">
<h4 id="org5d8a2d0"><span class="section-number-4">12.8.5</span> expand<sub>grid</sub></h4>
<div class="outline-text-4" id="text-12-8-5">
<p>
这个函数和 expand 一样，只不过生成了格子形状的数据(也就是笛卡儿积)。这个函数对生成最长的数据变量进行拉伸。
Compared to "expand.grid"
</p>
<ul class="org-ul">
<li>Varies the first element fastest.</li>
<li>Never converts strings to factors.</li>
<li>Does not add any additional attributes.</li>
<li>Returns a tibble, not a data frame.</li>
<li>Can expand any generalised vector, including data frames.</li>
</ul>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
expand_grid(x = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>, y = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">2</span>)
                                      <span style="color: #b22222;"># </span><span style="color: #b22222;">A tibble: 6 x 2</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">x     y</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">&lt;int&gt; &lt;int&gt;</span>
<span style="color: #b22222;">##            </span><span style="color: #b22222;">1     1     1</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">2     1     2</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">3     2     1</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">4     2     2</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">5     3     1</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">6     3     2</span>
expand_grid(l1 = letters, l2 = LETTERS)
<span style="color: #b22222;"># </span><span style="color: #b22222;">Can also expand data frames</span>
expand_grid(df = data.frame(x = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">2</span>, y = c(<span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">1</span>)), z = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>)
                                      <span style="color: #b22222;"># </span><span style="color: #b22222;">A tibble: 6 x 2</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">df$x    $y     z</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">&lt;int&gt; &lt;dbl&gt; &lt;int&gt;</span>
<span style="color: #b22222;">##                  </span><span style="color: #b22222;">1     1     2     1</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">2     1     2     2</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">3     1     2     3</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">4     2     1     1</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">5     2     1     2</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">6     2     1     3</span>
                                      <span style="color: #b22222;"># </span><span style="color: #b22222;">And matrices</span>
expand_grid(x1 = matrix(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">4</span>, nrow = <span style="color: #008b8b;">2</span>), x2 = matrix(<span style="color: #008b8b;">5</span>:<span style="color: #008b8b;">8</span>, nrow = <span style="color: #008b8b;">2</span>))
                                      <span style="color: #b22222;"># </span><span style="color: #b22222;">A tibble: 4 x 2</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">x1[,1]  [,2] x2[,1]  [,2]</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">&lt;int&gt; &lt;int&gt;  &lt;int&gt; &lt;int&gt;</span>
<span style="color: #b22222;">##                         </span><span style="color: #b22222;">1      1     3      5     7</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">2      1     3      6     8</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">3      2     4      5     7</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">4      2     4      6     8</span>
</pre>
</div>
</div>
</div>
<div id="orgecf6842" class="outline-4">
<h4 id="orgecf6842"><span class="section-number-4">12.8.6</span> drop<sub>na</sub></h4>
<div class="outline-text-4" id="text-12-8-6">
<p>
这个函数可以删除含有缺失值的行。所以说这个函数只是针对行而言。
</p>
<div class="org-src-container">
<pre class="src src-R">  <span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
data <span style="color: #008b8b;">&lt;-</span> data.frame(x=c(<span style="color: #228b22;">NA</span>,<span style="color: #008b8b;">1</span>,<span style="color: #008b8b;">2</span>),y=c(<span style="color: #008b8b;">1</span>,<span style="color: #008b8b;">2</span>,<span style="color: #228b22;">NA</span>))
data <span style="color: #008b8b;">%&gt;%</span> head
<span style="color: #b22222;">## </span><span style="color: #b22222;">x  y</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">1 NA  1</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">2  1  2</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">3  2 NA</span>
<span style="color: #b22222;">###</span><span style="color: #b22222;">drop_na--------------------------</span>
data <span style="color: #008b8b;">%&gt;%</span> drop_na(x,y) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21482;&#20445;&#30041;&#20840;&#20026;&#38750;&#31354;&#30340;&#25968;&#20540;&#34892;</span>
data <span style="color: #008b8b;">%&gt;%</span> drop_na(x) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21024;&#38500; x &#20026; NA &#30340;&#34892;</span>
</pre>
</div>
</div>
</div>

<div id="org9cb55b4" class="outline-4">
<h4 id="org9cb55b4"><span class="section-number-4">12.8.7</span> extract</h4>
<div class="outline-text-4" id="text-12-8-7">
<p>
这个函数可以将 data 转变为一个新的一列。Given a regular expression with capturing groups, extract() turns each group into a new column. If the groups don't match, or the input is NA, the output will be NA.
这个函数类似于 stringr 包的 str<sub>match</sub> 函数，所不同的是这个函数处理的是 tibble 或者 data.frame 类型的数据。
</p>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
df <span style="color: #008b8b;">&lt;-</span> data.frame(x = c(<span style="color: #228b22;">NA</span>, <span style="color: #8b2252;">"a-b"</span>, <span style="color: #8b2252;">"a-d"</span>, <span style="color: #8b2252;">"b-c"</span>, <span style="color: #8b2252;">"d-e"</span>))
df
df <span style="color: #008b8b;">%&gt;%</span> tidyr::extract(x, <span style="color: #8b2252;">"A"</span>)
df <span style="color: #008b8b;">%&gt;%</span> extract(x, c(<span style="color: #8b2252;">"A"</span>, <span style="color: #8b2252;">"B"</span>), <span style="color: #8b2252;">"([[:alnum:]]+)-([[:alnum:]]+)"</span>)
</pre>
</div>
</div>
</div>
<div id="orgdae9d38" class="outline-4">
<h4 id="orgdae9d38"><span class="section-number-4">12.8.8</span> unite</h4>
<div class="outline-text-4" id="text-12-8-8">
<p>
这个函数是 extract 的反函数。Convenience function to paste together multiple columns into one. unite 可以将多个变量连接起来。unite()直接使用列名即可，unite<sub>()</sub>需要在列名两边使用引号
</p>
<div class="org-src-container">
<pre class="src src-R">  <span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&#26500;&#36896;&#20102;&#19968;&#20010;&#26032;&#30340;&#21464;&#37327; unite_sepal&#65292;&#26681;&#25454; sepal.length&#65292;Sepal.Width &#20004;&#20010;&#21464;&#37327;&#36827;&#34892;&#21512;&#24182;</span>
demo <span style="color: #008b8b;">&lt;-</span> iris <span style="color: #008b8b;">%&gt;%</span>
  unite(unite_sepal, Sepal.Length, Sepal.Width, sep=<span style="color: #8b2252;">"_"</span>, remove=<span style="color: #228b22;">TRUE</span>) <span style="color: #008b8b;">%&gt;%</span>
  unite_(<span style="color: #8b2252;">"unite_petal"</span>, c(<span style="color: #8b2252;">"Petal.Length"</span>, <span style="color: #8b2252;">"Petal.Width"</span>), sep=<span style="color: #8b2252;">"_"</span>, remove=<span style="color: #228b22;">TRUE</span>)
  iris <span style="color: #008b8b;">%&gt;%</span>
      unite(unite_sepal, Sepal.Length, Sepal.Width, sep=<span style="color: #8b2252;">"_"</span>, remove=<span style="color: #228b22;">TRUE</span>) 

  df <span style="color: #008b8b;">&lt;-</span> expand_grid(x = c(<span style="color: #8b2252;">"a"</span>, <span style="color: #228b22;">NA</span>), y = c(<span style="color: #8b2252;">"b"</span>, <span style="color: #228b22;">NA</span>))
  df
  df <span style="color: #008b8b;">%&gt;%</span> unite(<span style="color: #8b2252;">"z"</span>, x:y, remove = <span style="color: #228b22;">FALSE</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20445;&#30041;&#25152;&#26377;&#29305;&#24449; </span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-R">iris[<span style="color: #008b8b;">1</span>,] <span style="color: #008b8b;">%&gt;%</span> 
    tidyr::unite(new_col, Sepal.Width, Species, 
                 sep = <span style="color: #8b2252;">""</span>, remove = <span style="color: #228b22;">FALSE</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   Sepal.Length   new_col Sepal.Width Petal.Length Petal.Width Species</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1          5.1 3.5setosa         3.5          1.4         0.2  setosa </span>
</pre>
</div>
</div>
</div>

<div id="org06b001d" class="outline-4">
<h4 id="org06b001d"><span class="section-number-4">12.8.9</span> fill</h4>
<div class="outline-text-4" id="text-12-8-9">
<p>
Fill in missing values with previous or next value.Fills missing values in selected columns using the next or previous entry. This is useful in the common output format where values are not repeated, and are only recorded when they change.
这个函数可以用固定的值填补缺失值。fill(data, &#x2026;, .direction = c("down", "up", "downup", "updown")) #direction 可以控制填充值方向。
</p>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
df <span style="color: #008b8b;">&lt;-</span> data.frame(Month = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">12</span>, Year = c(<span style="color: #008b8b;">2000</span>, rep(<span style="color: #228b22;">NA</span>, <span style="color: #008b8b;">11</span>)))
df
df <span style="color: #008b8b;">%&gt;%</span> fill(Year)
</pre>
</div>
</div>
</div>
<div id="org81650d1" class="outline-4">
<h4 id="org81650d1"><span class="section-number-4">12.8.10</span> full<sub>seq</sub></h4>
<div class="outline-text-4" id="text-12-8-10">
<p>
可以填补缺失值。This is useful if you want to fill in missing values that should have been observed but weren't. For example, full<sub>seq</sub>(c(1, 2, 4, 6), 1) will return 1:6.
</p>
<div class="org-src-container">
<pre class="src src-R">full_seq(c(<span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">4</span>, <span style="color: #008b8b;">5</span>, <span style="color: #008b8b;">10</span>), <span style="color: #008b8b;">1</span>)
  <span style="color: #b22222;">## </span><span style="color: #b22222;">[1]  1  2  3  4  5  6  7  8  9 10</span>
</pre>
</div>
</div>
</div>
<div id="orga97f333" class="outline-4">
<h4 id="orga97f333"><span class="section-number-4">12.8.11</span> gather</h4>
<div class="outline-text-4" id="text-12-8-11">
<p>
gather：可以将多列原始数据进行合并，按照一定组名，这样可以更好 ggplot2
</p>

<div class="org-src-container">
<pre class="src src-R">  <span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
  stocks <span style="color: #008b8b;">&lt;-</span> tibble(
      time = as.Date(<span style="color: #8b2252;">"2009-01-01"</span>) + <span style="color: #008b8b;">0</span>:<span style="color: #008b8b;">9</span>,
      X = rnorm(<span style="color: #008b8b;">10</span>, <span style="color: #008b8b;">0</span>, <span style="color: #008b8b;">1</span>),
      Y = rnorm(<span style="color: #008b8b;">10</span>, <span style="color: #008b8b;">0</span>, <span style="color: #008b8b;">2</span>),
      Z = rnorm(<span style="color: #008b8b;">10</span>, <span style="color: #008b8b;">0</span>, <span style="color: #008b8b;">4</span>)
  )
<span style="color: #b22222;">##</span><span style="color: #b22222;">&#36825;&#37324;&#21464;&#37327;&#30340;&#20540;&#26159;&#19968;&#20010;&#32500;&#24230;&#65292;&#25226;&#20540;&#20840;&#37096;&#25289;&#30452;</span>
head(stocks)
s <span style="color: #008b8b;">&lt;-</span> gather(stocks, <span style="color: #8b2252;">"stock"</span>, <span style="color: #8b2252;">"price"</span>, -time) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#36825;&#37324; stock &#28041;&#21450;&#20102;&#32452;&#65292;&#20063;&#23601;&#26159; key&#65292;price &#26159;&#20540;,value</span>
</pre>
</div>
</div>
</div>
<div id="org09a8e9a" class="outline-4">
<h4 id="org09a8e9a"><span class="section-number-4">12.8.12</span> spread</h4>
<div class="outline-text-4" id="text-12-8-12">
<p>
spread：将一列数据分割成多列，多用于 char 型数据
</p>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
  demo <span style="color: #008b8b;">%&gt;%</span>
      separate(unite_sepal, c(<span style="color: #8b2252;">"Sepal.Length"</span>, <span style="color: #8b2252;">"Sepal.Width"</span>), sep=<span style="color: #8b2252;">"_"</span>) <span style="color: #008b8b;">%&gt;%</span>
      separate_(<span style="color: #8b2252;">"unite_petal"</span>, c(<span style="color: #8b2252;">"Petal.Length"</span>, <span style="color: #8b2252;">"Petal.Width"</span>), sep=<span style="color: #8b2252;">"_"</span>)

stocks <span style="color: #008b8b;">&lt;-</span> data.frame(
  time = as.Date(<span style="color: #8b2252;">'2009-01-01'</span>) + <span style="color: #008b8b;">0</span>:<span style="color: #008b8b;">9</span>,
  X = rnorm(<span style="color: #008b8b;">10</span>, <span style="color: #008b8b;">0</span>, <span style="color: #008b8b;">1</span>),
  Y = rnorm(<span style="color: #008b8b;">10</span>, <span style="color: #008b8b;">0</span>, <span style="color: #008b8b;">2</span>),
  Z = rnorm(<span style="color: #008b8b;">10</span>, <span style="color: #008b8b;">0</span>, <span style="color: #008b8b;">4</span>)
)
stocksm <span style="color: #008b8b;">&lt;-</span> stocks <span style="color: #008b8b;">%&gt;%</span> gather(stock, price, -time)
stocksm <span style="color: #008b8b;">%&gt;%</span> spread(stock, price)
stocksm <span style="color: #008b8b;">%&gt;%</span> spread(time, price)
</pre>
</div>
</div>
</div>

<div id="org451d505" class="outline-4">
<h4 id="org451d505"><span class="section-number-4">12.8.13</span> nest/unnest</h4>
<div class="outline-text-4" id="text-12-8-13">
<p>
nest 可以处理分组数据，特别用于分组数据的建模特别有用。
</p>
<div class="org-src-container">
<pre class="src src-R">  df <span style="color: #008b8b;">&lt;-</span> tibble(x = c(<span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">3</span>), y = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">6</span>, z = <span style="color: #008b8b;">6</span>:<span style="color: #008b8b;">1</span>)
  df <span style="color: #008b8b;">%&gt;%</span> nest(data = c(y, z))
  df <span style="color: #008b8b;">%&gt;%</span> nest(data = one_of(<span style="color: #8b2252;">"y"</span>, <span style="color: #8b2252;">"z"</span>))
  iris <span style="color: #008b8b;">%&gt;%</span> nest(data = -Species) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36825;&#20010;&#21629;&#20196;&#29992;&#30340;&#22909;&#65281;</span>
  nest_vars <span style="color: #008b8b;">&lt;-</span> names(iris)[<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">4</span>]
nest_vars
  iris <span style="color: #008b8b;">%&gt;%</span> nest(data = one_of(nest_vars))
  iris <span style="color: #008b8b;">%&gt;%</span>
      nest(petal = starts_with(<span style="color: #8b2252;">"Petal"</span>), sepal = starts_with(<span style="color: #8b2252;">"Sepal"</span>))
  iris <span style="color: #008b8b;">%&gt;%</span>
      nest(width = contains(<span style="color: #8b2252;">"Width"</span>), length = contains(<span style="color: #8b2252;">"Length"</span>))
  fish_encounters <span style="color: #008b8b;">%&gt;%</span>
      group_by(fish) <span style="color: #008b8b;">%&gt;%</span>
      nest()
<span style="color: #b22222;"># </span><span style="color: #b22222;">Nesting is often useful for creating per group models</span>
mtcars <span style="color: #008b8b;">%&gt;%</span>
      group_by(cyl) <span style="color: #008b8b;">%&gt;%</span>
      nest() <span style="color: #008b8b;">%&gt;%</span>
      mutate(models = lapply(data, <span style="color: #a020f0;">function</span>(df) lm(mpg ~ wt, data = df)))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-R">df <span style="color: #008b8b;">&lt;-</span> tibble(
    x = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>,
    y = list(
        <span style="color: #228b22;">NULL</span>,
        tibble(a = <span style="color: #008b8b;">1</span>, b = <span style="color: #008b8b;">2</span>),
        tibble(a = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>, b = <span style="color: #008b8b;">3</span>:<span style="color: #008b8b;">1</span>)
    )
)
df <span style="color: #008b8b;">%&gt;%</span> unnest(y)
df <span style="color: #008b8b;">%&gt;%</span> unnest(y, keep_empty = <span style="color: #228b22;">TRUE</span>)
<span style="color: #b22222; font-weight: bold;">#</span><span style="color: #b22222; font-weight: bold;">'</span><span style="color: #b22222;"> # You can unnest multiple columns simultaneously</span>
df <span style="color: #008b8b;">&lt;-</span> tibble(
    a = list(c(<span style="color: #8b2252;">"a"</span>, <span style="color: #8b2252;">"b"</span>), <span style="color: #8b2252;">"c"</span>),
    b = list(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">3</span>),
    c = c(<span style="color: #008b8b;">11</span>, <span style="color: #008b8b;">22</span>)
)
df <span style="color: #008b8b;">%&gt;%</span> unnest(c(a, b))
df <span style="color: #008b8b;">%&gt;%</span> unnest(a) <span style="color: #008b8b;">%&gt;%</span> unnest(b)  
</pre>
</div>
</div>
</div>

<div id="org1d2d14a" class="outline-4">
<h4 id="org1d2d14a"><span class="section-number-4">12.8.14</span> pack</h4>
<div class="outline-text-4" id="text-12-8-14">
<p>
pack() makes df narrow by collapsing(收缩) a set of columns into a single df-column.
unpack() makes data wider by expanding df-columns back out into individual
columns.pack 可以将几个变量压缩起来，变成 x$x1,x$x2,x$x3 类似这种。unpack 反过来，将压缩的变量放缩起来。
</p>
<div class="org-src-container">
<pre class="src src-R">df <span style="color: #008b8b;">&lt;-</span> tibble(x1 = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>, x2 = <span style="color: #008b8b;">4</span>:<span style="color: #008b8b;">6</span>, x3 = <span style="color: #008b8b;">7</span>:<span style="color: #008b8b;">9</span>, y = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>)
df
df <span style="color: #008b8b;">%&gt;%</span> pack(x = starts_with(<span style="color: #8b2252;">"x"</span>))
df <span style="color: #008b8b;">%&gt;%</span> pack(x = c(x1, x2, x3), y = y)      
</pre>
</div>

<div class="org-src-container">
<pre class="src src-R">df <span style="color: #008b8b;">&lt;-</span> tibble(
    x = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>,
    y = tibble(a = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>, b = <span style="color: #008b8b;">3</span>:<span style="color: #008b8b;">1</span>),
    z = tibble(X = c(<span style="color: #8b2252;">"a"</span>, <span style="color: #8b2252;">"b"</span>, <span style="color: #8b2252;">"c"</span>), Y = runif(<span style="color: #008b8b;">3</span>), Z = c(<span style="color: #228b22;">TRUE</span>, <span style="color: #228b22;">FALSE</span>, <span style="color: #228b22;">NA</span>))
)
df
df <span style="color: #008b8b;">%&gt;%</span> unpack(y)
df <span style="color: #008b8b;">%&gt;%</span> unpack(c(y, z))
df <span style="color: #008b8b;">%&gt;%</span> unpack(c(y, z), names_sep = <span style="color: #8b2252;">"_"</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">names_sep &#21487;&#20197;&#25903;&#25345;&#29305;&#27530;&#30340;&#38142;&#25509;&#31526;&#12290;     </span>
</pre>
</div>
</div>
</div>
<div id="orgf8bd9bb" class="outline-4">
<h4 id="orgf8bd9bb"><span class="section-number-4">12.8.15</span> hoist</h4>
<div class="outline-text-4" id="text-12-8-15">
<p>
hoist(), unnest<sub>longer</sub>(), and unnest<sub>wider</sub>() provide tools for rectangling, collapsing deeply nested lists into regular columns. hoist() allows you to selectively pull components of a list-column out in to their own top-level columns, using the same syntax as purrr::pluck(). unnest<sub>wider</sub>() turns each element of a list-column into a column, and unnest<sub>longer</sub>() turns each element of a list-column into a row. unnest<sub>auto</sub>() picks between unnest<sub>wider</sub>() or unnest<sub>longer</sub>() based heuristics described below.
</p>

<p>
unnest<sub>wider</sub> 将每一个 list-column 中的每一个元素转换为一个列。
</p>

<ul class="org-ul">
<li>unnest<sub>wider</sub>() preserves the rows, but changes the columns.</li>
<li>unnest<sub>longer</sub>() preserves the columns, but changes the rows</li>
<li>unnest() can change both rows and columns.</li>
</ul>

<p>
`hoist()` is similar to `unnest<sub>wider</sub>()` but only plucks out selected,说白了就是有目的性的挑选出数据。   
</p>

<div class="org-src-container">
<pre class="src src-R"> <span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
 df <span style="color: #008b8b;">&lt;-</span> tibble(
     character = c(<span style="color: #8b2252;">"Toothless"</span>, <span style="color: #8b2252;">"Dory"</span>),
     metadata = list(
         list(
             species = <span style="color: #8b2252;">"dragon"</span>,
             color = <span style="color: #8b2252;">"black"</span>,
             films = c(
                 <span style="color: #8b2252;">"How to Train Your Dragon"</span>,
                 <span style="color: #8b2252;">"How to Train Your Dragon 2"</span>,
                 <span style="color: #8b2252;">"How to Train Your Dragon: The Hidden World"</span>
             )
         ),
         list(
             species = <span style="color: #8b2252;">"clownfish"</span>,
             color = <span style="color: #8b2252;">"blue"</span>,
             films = c(<span style="color: #8b2252;">"Finding Nemo"</span>, <span style="color: #8b2252;">"Finding Dory"</span>)
         )
     )
 )
 df
<span style="color: #b22222;"># </span><span style="color: #b22222;">Turn all components of metadata into columns</span>
 df <span style="color: #008b8b;">%&gt;%</span> unnest_wider(metadata)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-R">  <span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
df <span style="color: #008b8b;">%&gt;%</span> hoist(metadata,
             species = <span style="color: #8b2252;">"species"</span>,
             first_film = list(<span style="color: #8b2252;">"films"</span>, <span style="color: #008b8b;">1L</span>),
             third_film = list(<span style="color: #8b2252;">"films"</span>, <span style="color: #008b8b;">3L</span>)
)

acnh <span style="color: #008b8b;">&lt;-</span> tibble(
  item = c(<span style="color: #8b2252;">"Flimsy axe"</span>, <span style="color: #8b2252;">"DIY for beginners"</span>, <span style="color: #8b2252;">"Nook Miles Ticket"</span>, <span style="color: #8b2252;">"Top 8 Stylish Hair Colors"</span>),
  price = list(
    list(n = <span style="color: #008b8b;">800</span>,
         units = <span style="color: #8b2252;">"Bells"</span>),
    list(n = <span style="color: #008b8b;">480</span>,
         units = <span style="color: #8b2252;">"Bells"</span>),
    list(n = <span style="color: #008b8b;">2000</span>,
         units = <span style="color: #8b2252;">"Nook Miles"</span>),
    list(n = <span style="color: #008b8b;">3000</span>,
         units = <span style="color: #8b2252;">"Nook Miles"</span>)
  )
)  

acnh
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; # A tibble: 4 x 2</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   item                      price           </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   &lt;chr&gt;                     &lt;list&gt;          </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1 Flimsy axe                &lt;named list [2]&gt;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2 DIY for beginners         &lt;named list [2]&gt;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3 Nook Miles Ticket         &lt;named list [2]&gt;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 4 Top 8 Stylish Hair Colors &lt;named list [2]&gt;</span>
acnh <span style="color: #008b8b;">%&gt;%</span>
  hoist(.col = price,
        sale_price = <span style="color: #8b2252;">"n"</span>,
        sale_units = <span style="color: #8b2252;">"units"</span>)
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; # A tibble: 4 x 3</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   item                      sale_price sale_units</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   &lt;chr&gt;                          &lt;dbl&gt; &lt;chr&gt;     </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1 Flimsy axe                       800 Bells     </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2 DIY for beginners                480 Bells     </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3 Nook Miles Ticket               2000 Nook Miles</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 4 Top 8 Stylish Hair Colors       3000 Nook Miles</span>

  acnh <span style="color: #008b8b;">%&gt;%</span>
      hoist(.col = price,
            sale_price = <span style="color: #008b8b;">1</span>)
                                        <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; # A tibble: 4 x 3</span>
                                        <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   item                      sale_price price           </span>
                                        <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   &lt;chr&gt;                          &lt;dbl&gt; &lt;list&gt;          </span>
                                        <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1 Flimsy axe                       800 &lt;named list [1]&gt;</span>
                                        <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2 DIY for beginners                480 &lt;named list [1]&gt;</span>
                                        <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3 Nook Miles Ticket               2000 &lt;named list [1]&gt;</span>
                                        <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 4 Top 8 Stylish Hair Colors       3000 &lt;named list [1]&gt;</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
df <span style="color: #008b8b;">%&gt;%</span>
    unnest_wider(metadata) <span style="color: #008b8b;">%&gt;%</span>
    unnest_longer(films)
</pre>
</div>
</div>
</div>

<div id="org331b9fd" class="outline-4">
<h4 id="org331b9fd"><span class="section-number-4">12.8.16</span> unnest<sub>wider</sub></h4>
<div class="outline-text-4" id="text-12-8-16">
<p>
unnest<sub>wider</sub>() turns each element of a list-column into a column.
#unnest<sub>wider</sub> 将每一个 list-column 中的每一个元素转换为一个列。
</p>

<ul class="org-ul">
<li>unnest<sub>wider</sub>() preserves the rows, but changes the columns.</li>
</ul>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
df <span style="color: #008b8b;">&lt;-</span> tibble(
    character = c(<span style="color: #8b2252;">"Toothless"</span>, <span style="color: #8b2252;">"Dory"</span>),
    metadata = list(
        list(
            species = <span style="color: #8b2252;">"dragon"</span>,
            color = <span style="color: #8b2252;">"black"</span>,
            films = c(
                <span style="color: #8b2252;">"How to Train Your Dragon"</span>,
                <span style="color: #8b2252;">"How to Train Your Dragon 2"</span>,
                <span style="color: #8b2252;">"How to Train Your Dragon: The Hidden World"</span>
            )
        ),
        list(
            species = <span style="color: #8b2252;">"clownfish"</span>,
            color = <span style="color: #8b2252;">"blue"</span>,
            films = c(<span style="color: #8b2252;">"Finding Nemo"</span>, <span style="color: #8b2252;">"Finding Dory"</span>)
        )
    )
)
df
df <span style="color: #008b8b;">%&gt;%</span> unnest_wider(metadata)
</pre>
</div>
</div>
</div>

<div id="org781fcee" class="outline-4">
<h4 id="org781fcee"><span class="section-number-4">12.8.17</span> unnest<sub>longer</sub></h4>
<div class="outline-text-4" id="text-12-8-17">
<ul class="org-ul">
<li>unnest<sub>longer</sub>() preserves the columns, but changes the rows</li>

<li>unnest() can change both rows and columns.</li>
</ul>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
df <span style="color: #008b8b;">%&gt;%</span>
    unnest_wider(metadata) <span style="color: #008b8b;">%&gt;%</span>
    unnest_longer(films)
</pre>
</div>

<p>
可以通过下面的例子来展示 unnest<sub>longer</sub> 和 unnest<sub>wider</sub> 之间的不同。
</p>

<div class="org-src-container">
<pre class="src src-R">  <span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
df <span style="color: #008b8b;">&lt;-</span> tibble(
  x = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>,
  y = list(<span style="color: #228b22;">NULL</span>, <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>, <span style="color: #008b8b;">4</span>:<span style="color: #008b8b;">5</span>)
)
df
df <span style="color: #008b8b;">%&gt;%</span> unnest_longer(y)
<span style="color: #b22222;"># </span><span style="color: #b22222;">Automatically creates names if widening</span>
df <span style="color: #008b8b;">%&gt;%</span> unnest_wider(y)
</pre>
</div>
</div>
</div>

<div id="org7e76366" class="outline-4">
<h4 id="org7e76366"><span class="section-number-4">12.8.18</span> unnest<sub>auto</sub></h4>
<div class="outline-text-4" id="text-12-8-18">
<p>
一个更为灵活的函数是 unnest<sub>auto.它可以去猜</sub> guesses whether you want `unnest<sub>longer</sub>()` or `unnest<sub>wider</sub>()`.
</p>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>
df <span style="color: #008b8b;">%&gt;%</span> 
    unnest_auto(y)
</pre>
</div>
</div>
</div>

<div id="orgba092c3" class="outline-4">
<h4 id="orgba092c3"><span class="section-number-4">12.8.19</span> replace<sub>na</sub></h4>
<div class="outline-text-4" id="text-12-8-19">
<p>
replace<sub>na</sub> 函数可以定点将固定的变量的缺失值进行填补。
</p>
<div class="org-src-container">
<pre class="src src-R">data <span style="color: #008b8b;">%&gt;%</span> fill(x,.direction = c(<span style="color: #8b2252;">"updown"</span>)) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26681;&#25454;&#26368;&#38752;&#36817;&#19979;&#38754;&#30340;&#25968;&#20540;&#26469;&#22635;&#20805;&#25554;&#34917;</span>
data <span style="color: #008b8b;">%&gt;%</span> replace_na()
data <span style="color: #008b8b;">&lt;-</span> tibble(x=c(<span style="color: #008b8b;">1</span>,<span style="color: #008b8b;">2</span>,<span style="color: #228b22;">NA</span>),y=c(<span style="color: #8b2252;">"a"</span>,<span style="color: #228b22;">NA</span>,<span style="color: #8b2252;">"b"</span>))
<span style="color: #b22222;">###</span><span style="color: #b22222;">&#32570;&#22833;&#20540;&#22635;&#20805;--------------------------</span>
replace_na(data,replace = list(x=<span style="color: #008b8b;">1</span>,y=<span style="color: #8b2252;">"down"</span>))
</pre>
</div>
</div>
</div>
<div id="orgdaf7bd6" class="outline-4">
<h4 id="orgdaf7bd6"><span class="section-number-4">12.8.20</span> pivoting</h4>
<div class="outline-text-4" id="text-12-8-20">
</div>
<div id="org3d740b2" class="outline-5">
<h5 id="org3d740b2"><span class="section-number-5">12.8.20.1</span> pivot<sub>longer</sub></h5>
<div class="outline-text-5" id="text-12-8-20-1">
<p>
这个函数和 gather 很类似。The first argument is the dataset to reshape, relig<sub>income.The</sub> second argument
describes which columns need to be reshaped. In this case, it’s every column
apart from religion.
</p>

<p>
The <b>'names<sub>to</sub>'</b> gives the name of the variable that will be created from the data stored in the column names, i.e. income.The <b>values<sub>to</sub></b> gives the name of the variable that will be created from the data stored in the cell value, i.e. count.
</p>

<div class="org-src-container">
<pre class="src src-R">relig_income
<span style="color: #b22222;">#</span><span style="color: #b22222;">This dataset contains three variables:</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">religion, stored in the rows,</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">income spread across the column names, and</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">count stored in the cell values.</span>
relig_income <span style="color: #008b8b;">%&gt;%</span> colnames()
relig_income <span style="color: #008b8b;">%&gt;%</span> 
    pivot_longer(-religion, names_to = <span style="color: #8b2252;">"income"</span>, values_to = <span style="color: #8b2252;">"count"</span>)
</pre>
</div>

<p>
The first argument is the dataset to reshape, relig<sub>income</sub>.
</p>

<p>
The second argument describes which columns need to be reshaped. In this case, it’s every column apart from religion.
</p>

<p>
The names<sub>to</sub> gives the name of the variable that will be created from the data stored in the column names, i.e. income.The values<sub>to</sub> gives the name of the variable that will be created from the data stored in the cell value, i.e. count.
</p>

<div class="org-src-container">
<pre class="src src-R">billboard  <span style="color: #008b8b;">%&gt;%</span>
    colnames()
billboard <span style="color: #008b8b;">%&gt;%</span> 
    pivot_longer(
        cols = starts_with(<span style="color: #8b2252;">"wk"</span>), 
        names_to = <span style="color: #8b2252;">"week"</span>, 
        values_to = <span style="color: #8b2252;">"rank"</span>,
        values_drop_na = <span style="color: #228b22;">TRUE</span>
    )
</pre>
</div>

<p>
在 pivot<sub>longer</sub> 函数里，参数里 cols = starts<sub>with</sub>("wk"),表示原数据有很多的以“wk”标签的变量，也就是说将这些 wk 的变量拉长，然后丢失 NA.
</p>

<div class="org-src-container">
<pre class="src src-R">billboard <span style="color: #008b8b;">%&gt;%</span> 
    pivot_longer(
        cols = starts_with(<span style="color: #8b2252;">"wk"</span>), 
        names_to = <span style="color: #8b2252;">"week"</span>, 
        names_prefix = <span style="color: #8b2252;">"wk"</span>,
        names_ptypes = list(week = integer()),
        values_to = <span style="color: #8b2252;">"rank"</span>,
        values_drop_na = <span style="color: #228b22;">TRUE</span>,
        )  
</pre>
</div>

<p>
如果需要将 week 变量转换为整数，可以通过使用两个附加参数来做到这一点：names<sub>prefix</sub> 去除 wk 前缀，names<sub>ptypes</sub> 指定 week 应该为整数.
</p>
<div class="org-src-container">
<pre class="src src-R">who <span style="color: #008b8b;">%&gt;%</span> head()
who<span style="color: #008b8b;">%&gt;%</span> colnames()
who <span style="color: #008b8b;">%&gt;%</span> 
    pivot_longer(
        cols = new_sp_m014:newrel_f65,
        names_to = c(<span style="color: #8b2252;">"diagnosis"</span>, <span style="color: #8b2252;">"gender"</span>, <span style="color: #8b2252;">"age"</span>), 
        names_pattern = <span style="color: #8b2252;">"new_?(.*)_(.)(.*)"</span>,
        values_to = <span style="color: #8b2252;">"count"</span>
    )  
</pre>
</div>

<p>
可以通过在 names<sub>to</sub> 中指定多个列名称，然后提供 names<sub>sep</sub> 或 names<sub>pattern</sub> 来分解这些变量。在这里，names<sub>pattern</sub> 是最自然的选择。它具有类似的提取接口：您给它一个包含组的正则表达式（由（）定义），并将每个组放在一列中。
</p>

<div class="org-src-container">
<pre class="src src-R">who <span style="color: #008b8b;">%&gt;%</span>
    pivot_longer(
            cols = new_sp_m014:newrel_f65,
            names_to = c(<span style="color: #8b2252;">"diagnosis"</span>, <span style="color: #8b2252;">"gender"</span>, <span style="color: #8b2252;">"age"</span>), 
            names_pattern = <span style="color: #8b2252;">"new_?(.*)_(.)(.*)"</span>,
            names_ptypes = list(
                gender = factor(levels = c(<span style="color: #8b2252;">"f"</span>, <span style="color: #8b2252;">"m"</span>)),
                age = factor(
                    levels = c(<span style="color: #8b2252;">"014"</span>, <span style="color: #8b2252;">"1524"</span>, <span style="color: #8b2252;">"2534"</span>, <span style="color: #8b2252;">"3544"</span>, <span style="color: #8b2252;">"4554"</span>, <span style="color: #8b2252;">"5564"</span>, <span style="color: #8b2252;">"65"</span>), 
                    ordered = <span style="color: #228b22;">TRUE</span>
                )
            ),
            values_to = <span style="color: #8b2252;">"count"</span>
        )
</pre>
</div>

<p>
names<sub>ptypes</sub> 可以固定数据类型。 
</p>
<div class="org-src-container">
<pre class="src src-R">family <span style="color: #008b8b;">&lt;-</span> tribble(
    ~family,  ~dob_child1,  ~dob_child2, ~gender_child1, ~gender_child2,
    <span style="color: #008b8b;">1L</span>, <span style="color: #8b2252;">"1998-11-26"</span>, <span style="color: #8b2252;">"2000-01-29"</span>,             <span style="color: #008b8b;">1L</span>,             <span style="color: #008b8b;">2L</span>,
    <span style="color: #008b8b;">2L</span>, <span style="color: #8b2252;">"1996-06-22"</span>,           <span style="color: #228b22;">NA</span>,             <span style="color: #008b8b;">2L</span>,             <span style="color: #228b22;">NA</span>,
    <span style="color: #008b8b;">3L</span>, <span style="color: #8b2252;">"2002-07-11"</span>, <span style="color: #8b2252;">"2004-04-05"</span>,             <span style="color: #008b8b;">2L</span>,             <span style="color: #008b8b;">2L</span>,
    <span style="color: #008b8b;">4L</span>, <span style="color: #8b2252;">"2004-10-10"</span>, <span style="color: #8b2252;">"2009-08-27"</span>,             <span style="color: #008b8b;">1L</span>,             <span style="color: #008b8b;">1L</span>,
    <span style="color: #008b8b;">5L</span>, <span style="color: #8b2252;">"2000-12-05"</span>, <span style="color: #8b2252;">"2005-02-28"</span>,             <span style="color: #008b8b;">2L</span>,             <span style="color: #008b8b;">1L</span>,
    )
family <span style="color: #008b8b;">&lt;-</span> family <span style="color: #008b8b;">%&gt;%</span> mutate_at(vars(starts_with(<span style="color: #8b2252;">"dob"</span>)), parse_date)
family
family <span style="color: #008b8b;">%&gt;%</span> 
    pivot_longer(
        -family, 
        names_to = c(<span style="color: #8b2252;">".value"</span>, <span style="color: #8b2252;">"child"</span>), 
        names_sep = <span style="color: #8b2252;">"_"</span>, 
        values_drop_na = <span style="color: #228b22;">TRUE</span>
    )  
</pre>
</div>

<p>
除了 names<sub>pattern</sub> 设置模式，names<sub>sep</sub> 也可以设置模式。
</p>

<div class="org-src-container">
<pre class="src src-R">pnl <span style="color: #008b8b;">&lt;-</span> tibble(
    x = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">4</span>,
    a = c(<span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">1</span>,<span style="color: #008b8b;">0</span>, <span style="color: #008b8b;">0</span>),
    b = c(<span style="color: #008b8b;">0</span>, <span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">1</span>),
    y1 = rnorm(<span style="color: #008b8b;">4</span>),
    y2 = rnorm(<span style="color: #008b8b;">4</span>),
    z1 = rep(<span style="color: #008b8b;">3</span>, <span style="color: #008b8b;">4</span>),
    z2 = rep(-<span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">4</span>),
    )

pnl <span style="color: #008b8b;">%&gt;%</span> 
    pivot_longer(
        -c(x, a, b), 
        names_to = c(<span style="color: #8b2252;">".value"</span>, <span style="color: #8b2252;">"time"</span>), 
        names_pattern = <span style="color: #8b2252;">"(.)(.)"</span>
    )
</pre>
</div>
</div>
</div>

<div id="org3f31a29" class="outline-5">
<h5 id="org3f31a29"><span class="section-number-5">12.8.20.2</span> pivot<sub>wider</sub></h5>
<div class="outline-text-5" id="text-12-8-20-2">
<p>
pivot<sub>wider</sub> 是 pivot<sub>longer</sub> 的逆操作。
</p>

<div class="org-src-container">
<pre class="src src-R">fish_encounters <span style="color: #008b8b;">%&gt;%</span> 
    head()

fish_encounters <span style="color: #008b8b;">%&gt;%</span> 
    pivot_wider(names_from = station, values_from = seen)
</pre>
</div>

<p>
上面的值有缺失，所以需要进行填补缺失值
</p>

<div class="org-src-container">
<pre class="src src-R">fish_encounters <span style="color: #008b8b;">%&gt;%</span> 
    pivot_wider(
        names_from = station, 
        values_from = seen,
        values_fill = list(seen = <span style="color: #008b8b;">0</span>)
    )  
</pre>
</div>

<p>
上面的命令是说明用 seen=0 进行填补。
</p>
</div>
</div>
</div>

<div id="orga02d7f7" class="outline-4">
<h4 id="orga02d7f7"><span class="section-number-4">12.8.21</span> uncount</h4>
<div class="outline-text-4" id="text-12-8-21">
<p>
复制行记录。Performs the opposite operation to dplyr::count(), duplicating rows according to a weighting variable (or expression)。可以复制行记录。
</p>
<div class="org-src-container">
<pre class="src src-R">df <span style="color: #008b8b;">&lt;-</span> tibble(x = c(<span style="color: #8b2252;">"a"</span>, <span style="color: #8b2252;">"b"</span>), n = c(<span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">2</span>))
uncount(df, n)
uncount(df, <span style="color: #008b8b;">2</span>)
<span style="color: #b22222;"># </span><span style="color: #b22222;">Or expressions</span>
uncount(df, <span style="color: #008b8b;">2</span> / n)
</pre>
</div>
</div>
</div>
<div id="org4d6ae1f" class="outline-4">
<h4 id="org4d6ae1f"><span class="section-number-4">12.8.22</span> separate</h4>
<div class="outline-text-4" id="text-12-8-22">
<p>
Separate a character column into multiple columns using a regular expression separator.
</p>
<div class="org-src-container">
<pre class="src src-R">set.seed(<span style="color: #008b8b;">10</span>)
messy <span style="color: #008b8b;">&lt;-</span> data.frame(
    id = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">4</span>,
    trt = sample(rep(c(<span style="color: #8b2252;">'control'</span>, <span style="color: #8b2252;">'treatment'</span>), each = <span style="color: #008b8b;">2</span>)),
    work.T1 = runif(<span style="color: #008b8b;">4</span>),
    home.T1 = runif(<span style="color: #008b8b;">4</span>),
    work.T2 = runif(<span style="color: #008b8b;">4</span>),
    home.T2 = runif(<span style="color: #008b8b;">4</span>)
)
tidier <span style="color: #008b8b;">&lt;-</span> messy <span style="color: #008b8b;">%&gt;%</span>
    gather(key, time, -id, -trt)
tidier <span style="color: #008b8b;">%&gt;%</span> head(<span style="color: #008b8b;">3</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   id       trt     key       time</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1  1 treatment work.T1 0.08513597</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2  2   control work.T1 0.22543662</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3  3   control work.T1 0.27453052</span>
tidy <span style="color: #008b8b;">&lt;-</span> tidier <span style="color: #008b8b;">%&gt;%</span>
    separate(key, into = c(<span style="color: #8b2252;">"location"</span>, <span style="color: #8b2252;">"time"</span>), sep = <span style="color: #8b2252;">"\\."</span>)
tidy <span style="color: #008b8b;">%&gt;%</span> head(<span style="color: #008b8b;">8</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   id       trt location time</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1  1 treatment     work   T1</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2  2   control     work   T1</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3  3   control     work   T1</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 4  4 treatment     work   T1</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 5  1 treatment     home   T1</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 6  2   control     home   T1</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 7  3   control     home   T1</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 8  4 treatment     home   T1  </span>
</pre>
</div>
</div>

<div id="orgf8aaae2" class="outline-5">
<h5 id="orgf8aaae2"><span class="section-number-5">12.8.22.1</span> separate<sub>rows</sub></h5>
<div class="outline-text-5" id="text-12-8-22-1">
<div class="org-src-container">
<pre class="src src-R">df <span style="color: #008b8b;">&lt;-</span> data.frame(
    x = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>,
    y = c(<span style="color: #8b2252;">"a"</span>, <span style="color: #8b2252;">"d,e,f"</span>, <span style="color: #8b2252;">"g,h"</span>),
    z = c(<span style="color: #8b2252;">"1"</span>, <span style="color: #8b2252;">"2,3,4"</span>, <span style="color: #8b2252;">"5,6"</span>),
    stringsAsFactors = <span style="color: #228b22;">FALSE</span>
)
df
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   x     y     z</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1 1     a     1</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2 2 d,e,f 2,3,4</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3 3   g,h   5,6</span>
separate_rows(df, y, z, convert = <span style="color: #228b22;">TRUE</span>)
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   x y z</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1 1 a 1</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2 2 d 2</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3 2 e 3</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 4 2 f 4</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 5 3 g 5</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 6 3 h 6</span>
separate_rows(df, y, convert = <span style="color: #228b22;">TRUE</span>)
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   x y     z</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1 1 a     1</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2 2 d 2,3,4</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3 2 e 2,3,4</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 4 2 f 2,3,4</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 5 3 g   5,6</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 6 3 h   5,6  </span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="org554ac3c" class="outline-3">
<h3 id="org554ac3c"><span class="section-number-3">12.9</span> magrittr</h3>
<div class="outline-text-3" id="text-12-9">
</div>
<div id="org7db068c" class="outline-4">
<h4 id="org7db068c"><span class="section-number-4">12.9.1</span> set<sub>rownames</sub>()</h4>
<div class="outline-text-4" id="text-12-9-1">
<div class="org-src-container">
<pre class="src src-R"><span style="color: #008b8b;">library</span>(magrittr)
data =data.frame(x=c(<span style="color: #008b8b;">1</span>,<span style="color: #008b8b;">2</span>,<span style="color: #008b8b;">3</span>,<span style="color: #008b8b;">4</span>),y=c(<span style="color: #008b8b;">2</span>,<span style="color: #008b8b;">3</span>,<span style="color: #008b8b;">4</span>,<span style="color: #008b8b;">5</span>))
data
data <span style="color: #008b8b;">%&gt;%</span> set_rownames(c(<span style="color: #8b2252;">"a"</span>,<span style="color: #8b2252;">"b"</span>,<span style="color: #8b2252;">"c"</span>,<span style="color: #8b2252;">"d"</span>))
</pre>
</div>
</div>
</div>
<div id="orgdbcaf88" class="outline-4">
<h4 id="orgdbcaf88"><span class="section-number-4">12.9.2</span> extract</h4>
<div class="outline-text-4" id="text-12-9-2">
<p>
相当于 base 包中的 x[,]的作用
</p>
<div class="org-src-container">
<pre class="src src-R">iris <span style="color: #008b8b;">%&gt;%</span>
    magrittr::extract(, <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">4</span>) <span style="color: #008b8b;">%&gt;%</span>
    head
</pre>
</div>
</div>
</div>
<div id="org165759f" class="outline-4">
<h4 id="org165759f"><span class="section-number-4">12.9.3</span> %&gt;%/%&lt;&gt;%/%T&gt;%/%$%</h4>
<div class="outline-text-4" id="text-12-9-3">
<div class="org-src-container">
<pre class="src src-R">rnorm(<span style="color: #008b8b;">200</span>) <span style="color: #008b8b;">%&gt;%</span>
matrix(ncol = <span style="color: #008b8b;">2</span>)
</pre>
</div>
<p>
%T&gt;%向左操作符，其实功能和 %&gt;% 基本是一样的，只不过它是把左边的值做为传递的值，而不是右边的值。
Pipe a value forward into a function- or call expression and return the original value instead of the result. This is useful when an expression is used for its side-effect, say plotting or printing.
</p>
<div class="org-src-container">
<pre class="src src-R">rnorm(<span style="color: #008b8b;">200</span>) <span style="color: #008b8b;">%&gt;%</span>
    matrix(ncol = <span style="color: #008b8b;">2</span>) <span style="color: #008b8b;">%T&gt;%</span>
    plot <span style="color: #008b8b;">%&gt;%</span> <span style="color: #b22222;"># </span><span style="color: #b22222;">plot usually does not return anything.</span>
    colSums
</pre>
</div>
<p>
%$% 类似于 data.frame 中的$符号。
</p>
<div class="org-src-container">
<pre class="src src-R">data.frame(id = c(<span style="color: #008b8b;">1</span>),z = rnorm(<span style="color: #008b8b;">100</span>)) <span style="color: #008b8b;">%$%</span>
  ts.plot(z)  
</pre>
</div>
</div>
</div>
<div id="org3b6a227" class="outline-4">
<h4 id="org3b6a227"><span class="section-number-4">12.9.4</span> inset</h4>
<div class="outline-text-4" id="text-12-9-4">
<p>
该函数等价于 `[&lt;-`.
</p>

<div class="org-src-container">
<pre class="src src-R">iris <span style="color: #008b8b;">%&gt;%</span> 
    inset(<span style="color: #8b2252;">"Species"</span>, value = <span style="color: #008b8b;">1</span>) <span style="color: #008b8b;">%&gt;%</span> 
    head()
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1          5.1         3.5          1.4         0.2       1</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2          4.9         3.0          1.4         0.2       1</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3          4.7         3.2          1.3         0.2       1</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 4          4.6         3.1          1.5         0.2       1</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 5          5.0         3.6          1.4         0.2       1</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 6          5.4         3.9          1.7         0.4       1  </span>
</pre>
</div>
</div>
</div>

<div id="orga5087de" class="outline-4">
<h4 id="orga5087de"><span class="section-number-4">12.9.5</span> inset2</h4>
<div class="outline-text-4" id="text-12-9-5">
<p>
该函数等价于 `[[&lt;-`.
</p>

<div class="org-src-container">
<pre class="src src-R">iris <span style="color: #008b8b;">%&gt;%</span> 
    inset(<span style="color: #8b2252;">"Species"</span>, value = <span style="color: #008b8b;">1</span>) <span style="color: #008b8b;">%&gt;%</span> 
    head()
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1          5.1         3.5          1.4         0.2       1</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2          4.9         3.0          1.4         0.2       1</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3          4.7         3.2          1.3         0.2       1</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 4          4.6         3.1          1.5         0.2       1</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 5          5.0         3.6          1.4         0.2       1</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 6          5.4         3.9          1.7         0.4       1  </span>

</pre>
</div>
</div>
</div>

<div id="orgd8fbca7" class="outline-4">
<h4 id="orgd8fbca7"><span class="section-number-4">12.9.6</span> <span class="todo TODO">TODO</span> crossing()</h4>
<div class="outline-text-4" id="text-12-9-6">
<p>
暂时不会。
</p>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">ggplot::results output graphics,plot::results graphics </span>

</pre>
</div>
</div>
</div>
</div>
<div id="org8a0a1bd" class="outline-3">
<h3 id="org8a0a1bd"><span class="section-number-3">12.10</span> tidymodel</h3>
<div class="outline-text-3" id="text-12-10">
</div>
<div id="orgfe16220" class="outline-4">
<h4 id="orgfe16220"><span class="section-number-4">12.10.1</span> crayon</h4>
<div class="outline-text-4" id="text-12-10-1">
</div>
<div id="orgf2540f9" class="outline-5">
<h5 id="orgf2540f9"><span class="section-number-5">12.10.1.1</span> %+%</h5>
<div class="outline-text-5" id="text-12-10-1-1">
<p>
两个字符型 paste,但是必须长度要相等。
The length of the two arguments must match, or one of them must be of length one. If the length of one argument is one, then the output's length will match the length of the other argument. See examples below.
</p>
<div class="org-src-container">
<pre class="src src-R">letters[<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">10</span>] <span style="color: #008b8b;">%+%</span> chr(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">10</span>)      
</pre>
</div>
</div>
</div>
</div>
<div id="org2dc285a" class="outline-4">
<h4 id="org2dc285a"><span class="section-number-4">12.10.2</span> broom</h4>
</div>
<div id="org9427924" class="outline-4">
<h4 id="org9427924"><span class="section-number-4">12.10.3</span> tidy</h4>
<div class="outline-text-4" id="text-12-10-3">
<p>
可以标准化模型输出。
</p>

<p>
Tidy summarizes information about the components of a model. A model component might be a single term in a regression, a single hypothesis, a cluster, or a class. Exactly what tidy considers to be a model component varies cross models but is usually self-evident. If a model has several distinct types of components, you will need to specify which components to return.
</p>


<div class="org-src-container">
<pre class="src src-R"><span style="color: #008b8b;">library</span>(ggplot2)
<span style="color: #008b8b;">library</span>(dplyr)
mod <span style="color: #008b8b;">&lt;-</span> lm(mpg ~ wt + qsec, data = mtcars)
tidy(mod)
<span style="color: #b22222;"># </span><span style="color: #b22222;">A tibble: 3 x 5</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">term        estimate std.error statistic  p.value</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">&lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">1 (Intercept)   19.7       5.25       3.76 7.65e- 4</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">2 wt            -5.05      0.484    -10.4  2.52e-11</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">3 qsec           0.929     0.265      3.51 1.50e- 3</span>

glmfit <span style="color: #008b8b;">&lt;-</span> glm(am ~ wt, mtcars, family=<span style="color: #8b2252;">"binomial"</span>)
tidy(glmfit)
                                  <span style="color: #b22222;"># </span><span style="color: #b22222;">A tibble: 2 x 5</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">term  estimate std.error statistic p.value</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">&lt;chr&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;</span>
                                          <span style="color: #b22222;">## </span><span style="color: #b22222;">1 (Int&#8230;    12.0       4.51      2.67 0.00759</span>
                                             <span style="color: #b22222;">## </span><span style="color: #b22222;">2 wt       -4.02      1.44     -2.80 0.00509</span>

</pre>
</div>
</div>
</div>
<div id="org53c014d" class="outline-4">
<h4 id="org53c014d"><span class="section-number-4">12.10.4</span> glance</h4>
<div class="outline-text-4" id="text-12-10-4">
<p>
Glance accepts a model object and returns a tibble::tibble() with exactly one row of model summaries. The summaries are typically goodness of fit measures, p-values for hypothesis tests on residuals, or model convergence information.
</p>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #008b8b;">library</span>(ggplot2)
<span style="color: #008b8b;">library</span>(dplyr)
mod <span style="color: #008b8b;">&lt;-</span> lm(mpg ~ wt + qsec, data = mtcars)
tidy(mod)
glance(mod)      
</pre>
</div>
</div>
</div>
<div id="org689f23e" class="outline-4">
<h4 id="org689f23e"><span class="section-number-4">12.10.5</span> augment</h4>
<div class="outline-text-4" id="text-12-10-5">
<p>
augment adds columns to a dataset, containing information such as fitted values, residuals or cluster assignments. All columns added to a dataset have . prefix to prevent existing columns from being overwritten.
</p>

<div class="org-src-container">
<pre class="src src-R">fit <span style="color: #008b8b;">&lt;-</span> lm(Sepal.Width ~ Petal.Length + Petal.Width, iris)
tidy(fit)
augment(fit, data = iris)
</pre>
</div>
</div>
</div>
<div id="org23ba536" class="outline-4">
<h4 id="org23ba536"><span class="section-number-4">12.10.6</span> infer</h4>
<div class="outline-text-4" id="text-12-10-6">
</div>
<div id="orgb2e7bc8" class="outline-5">
<h5 id="orgb2e7bc8"><span class="section-number-5">12.10.6.1</span> specify</h5>
<div class="outline-text-5" id="text-12-10-6-1">
<p>
specify(x, formula, response = NULL, explanatory = NULL, success = NULL)
Arguments
x 
A data frame that can be coerced into a tibble.
</p>

<p>
formula 
A formula with the response variable on the left and the explanatory on the right. Alternatively, a response and explanatory argument can be supplied.
</p>

<p>
response  
The variable name in x that will serve as the response. This is an alternative to using the formula argument.
</p>

<p>
explanatory 
The variable name in x that will serve as the explanatory variable. This is an alternative to using the formula argument.
</p>

<p>
success 
The level of response that will be considered a success, as a string. Needed for inference on one proportion, a difference in proportions, and corresponding z stats.
</p>


<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;"># </span><span style="color: #b22222;">specifying for a point estimate on one variable</span>
gss <span style="color: #008b8b;">%&gt;%</span>
    specify(response = age)

                                 <span style="color: #b22222;"># </span><span style="color: #b22222;">...or with named arguments!</span>
gss <span style="color: #008b8b;">%&gt;%</span>
    specify(response = age, explanatory = partyid)       
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="orge7b04cc" class="outline-3">
<h3 id="orge7b04cc"><span class="section-number-3">12.11</span> rlang</h3>
<div class="outline-text-3" id="text-12-11">
</div>
<div id="orgfe621f9" class="outline-4">
<h4 id="orgfe621f9"><span class="section-number-4">12.11.1</span> missing</h4>
<div class="outline-text-4" id="text-12-11-1">
<p>
Missing values are represented in R with the general symbol NA. They can be inserted in almost all data containers: all atomic vectors except raw vectors can contain missing values. To achieve this, R automatically converts the general NA symbol to a typed missing value appropriate for the target vector. The objects provided here are aliases for those typed NA objects.
</p>

<p>
na<sub>lgl</sub>
na<sub>int</sub>
na<sub>dbl</sub>
na<sub>chr</sub>
na<sub>cpl</sub>
</p>

<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">0</span>:<span style="color: #008b8b;">5</span>
rep_along(x, <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">2</span>)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] 1 2 1 2 1 2</span>
rep_along(x, <span style="color: #008b8b;">1</span>)
rep_along(x, na_int)
rep_along(x, na_chr)  
</pre>
</div>
</div>
</div>

<div id="org753dd53" class="outline-4">
<h4 id="org753dd53"><span class="section-number-4">12.11.2</span> call2</h4>
<div class="outline-text-4" id="text-12-11-2">
<p>
Create a call.
</p>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #008b8b;">library</span>(rlang)
args <span style="color: #008b8b;">&lt;-</span> list(na.rm = <span style="color: #228b22;">TRUE</span>, trim = <span style="color: #008b8b;">0</span>)
call2(<span style="color: #8b2252;">"mean"</span>, <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">10</span>, !!!args)
<span style="color: #b22222;">## </span><span style="color: #b22222;">mean(1:10, na.rm = TRUE, trim = 0)</span>
call2(<span style="color: #8b2252;">"mean"</span>, <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">10</span>, !!!args)
<span style="color: #b22222;">## </span><span style="color: #b22222;">base::list(1, 2)</span>
call2(<span style="color: #8b2252;">"["</span>, quote(x), , drop = )
<span style="color: #b22222;">## </span><span style="color: #b22222;">x[, drop = ]</span>
</pre>
</div>
</div>
</div>
<div id="orgf4a413d" class="outline-4">
<h4 id="orgf4a413d"><span class="section-number-4">12.11.3</span> is<sub>call</sub></h4>
<div class="outline-text-4" id="text-12-11-3">
<p>
This function tests if x is a call. 
</p>
<div class="org-src-container">
<pre class="src src-R">is_call(quote(foo(bar)), <span style="color: #8b2252;">"foo"</span>)
is_call(quote(foo(bar)))  
</pre>
</div>
</div>
</div>
<div id="orgd27e375" class="outline-4">
<h4 id="orgd27e375"><span class="section-number-4">12.11.4</span> quo</h4>
<div class="outline-text-4" id="text-12-11-4">
<p>
Quotation is a mechanism by which an expression supplied as argument is captured by a function. Instead of seeing the value of the argument, the function sees the recipe (the R code) to make that value. This is possible because R expressions are representable as regular objects in R.
</p>
<div class="org-src-container">
<pre class="src src-R">quo <span style="color: #008b8b;">&lt;-</span> quo(letters)
quo
<span style="color: #b22222;">## </span><span style="color: #b22222;">&lt;quosure&gt;</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">expr: ^letters</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">env:  global</span>
</pre>
</div>
</div>
</div>
<div id="orgadba107" class="outline-4">
<h4 id="orgadba107"><span class="section-number-4">12.11.5</span> get<sub>expr</sub></h4>
<div class="outline-text-4" id="text-12-11-5">
<div class="org-src-container">
<pre class="src src-R">get_expr
<span style="color: #b22222;">## </span><span style="color: #b22222;">letters</span>
</pre>
</div>
</div>
</div>
<div id="orge7e066b" class="outline-4">
<h4 id="orge7e066b"><span class="section-number-4">12.11.6</span> eval<sub>tidy</sub></h4>
<div class="outline-text-4" id="text-12-11-6">
<p>
These helpers are useful to make your function work generically with quosures and raw expressions. 
</p>
<div class="org-src-container">
<pre class="src src-R">eval_tidy(quo)       
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] "a" "b" "c" "d" "e" "f" "g" "h" "i" "j" "k" "l" "m" "n" "o"</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">[16] "p" "q" "r" "s" "t" "u" "v" "w" "x" "y" "z"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-R">df <span style="color: #008b8b;">&lt;-</span> data.frame(x = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">5</span>, y = sample(<span style="color: #008b8b;">5</span>))
<span style="color: #0000ff;">with2</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>(df, expr){
    eval_tidy(enexpr(expr), df)
}
with2(df, x+y)
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1]  5  3  5  7 10       </span>
</pre>
</div>
</div>
</div>

<div id="org65fed0c" class="outline-4">
<h4 id="org65fed0c"><span class="section-number-4">12.11.7</span> seq2</h4>
<div class="outline-text-4" id="text-12-11-7">
<div class="org-src-container">
<pre class="src src-R">seq2(<span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">10</span>)
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1]  2  3  4  5  6  7  8  9 10</span>
seq2(<span style="color: #008b8b;">10</span>, <span style="color: #008b8b;">2</span>)
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; integer(0)</span>
seq(<span style="color: #008b8b;">10</span>, <span style="color: #008b8b;">2</span>)
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 10  9  8  7  6  5  4  3  2</span>
seq2_along(<span style="color: #008b8b;">10</span>, letters)
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [1] 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26       </span>
</pre>
</div>
</div>
</div>
<div id="org67f185f" class="outline-4">
<h4 id="org67f185f"><span class="section-number-4">12.11.8</span> type-predicates</h4>
<div class="outline-text-4" id="text-12-11-8">
<div class="org-src-container">
<pre class="src src-R">x=c(<span style="color: #008b8b;">1</span>,<span style="color: #008b8b;">2</span>,<span style="color: #008b8b;">3</span>) 
is_character(x)
is_integer(x)
is_vector(x)
x=list(<span style="color: #008b8b;">1</span>,<span style="color: #008b8b;">2</span>,<span style="color: #008b8b;">3</span>)
is_list(x)
</pre>
</div>
</div>
</div>
<div id="org3094ec6" class="outline-4">
<h4 id="org3094ec6"><span class="section-number-4">12.11.9</span> tidy-dots</h4>
</div>
<div id="org3079d5b" class="outline-4">
<h4 id="org3079d5b"><span class="section-number-4">12.11.10</span> ensyms</h4>
<div class="outline-text-4" id="text-12-11-10">
<p>
ensym() and ensyms() provide additional type checking to ensure the user calling your function has supplied bare object names:
</p>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #0000ff;">sym_inputs</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>(...) {
    user_symbols <span style="color: #008b8b;">&lt;-</span> ensyms(...)
    user_symbols
}
sym_inputs(hello, <span style="color: #8b2252;">"bonjour"</span>) <span style="color: #008b8b;">%&gt;%</span> str()
</pre>
</div>
</div>
</div>

<div id="orge478e93" class="outline-4">
<h4 id="orge478e93"><span class="section-number-4">12.11.11</span> list2</h4>
<div class="outline-text-4" id="text-12-11-11">
<p>
list2() is equivalent to list(&#x2026;) but provides tidy dots semantics.
</p>
<div class="org-src-container">
<pre class="src src-R">name <span style="color: #008b8b;">&lt;-</span> <span style="color: #8b2252;">"Jane"</span>
list2(!!name := <span style="color: #008b8b;">1</span> + <span style="color: #008b8b;">2</span>)
<span style="color: #b22222;">## </span><span style="color: #b22222;">$Jane</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] 3  </span>
</pre>
</div>
</div>
</div>
<div id="orgb854321" class="outline-4">
<h4 id="orgb854321"><span class="section-number-4">12.11.12</span> as<sub>function</sub></h4>
<div class="outline-text-4" id="text-12-11-12">
<p>
as<sub>function</sub>() transforms a one-sided formula into a function. This powers the lambda syntax in packages like purrr.
</p>


<div class="org-src-container">
<pre class="src src-R">f <span style="color: #008b8b;">&lt;-</span> as_function(~ .x + <span style="color: #008b8b;">1</span>)
f(<span style="color: #008b8b;">10</span>)
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 11</span>
g <span style="color: #008b8b;">&lt;-</span> as_function(~ -<span style="color: #008b8b;">1</span> * .)
g(<span style="color: #008b8b;">4</span>)
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] -4</span>
h <span style="color: #008b8b;">&lt;-</span> as_function(~ .x - .y)
h(<span style="color: #008b8b;">6</span>, <span style="color: #008b8b;">3</span>)
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 3       </span>
</pre>
</div>
</div>
</div>
<div id="orgeaf206d" class="outline-4">
<h4 id="orgeaf206d"><span class="section-number-4">12.11.13</span> as<sub>label</sub></h4>
<div class="outline-text-4" id="text-12-11-13">
<p>
Create a default name for an R object.as<sub>label</sub>() transforms R objects into a short, human-readable description. 
</p>

<p>
You can use labels to:Display an object in a concise way, for example to labellise axes in a graphical plot.Give default names to columns in a data frame. In this case, labelling is the first step before name repair.
</p>
<div class="org-src-container">
<pre class="src src-R">as_label(expr(foo(bar)))
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "foo(bar)"</span>
as_label(expr(foobar))
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "foobar"       </span>
</pre>
</div>
</div>
</div>
<div id="org6829c32" class="outline-4">
<h4 id="org6829c32"><span class="section-number-4">12.11.14</span> as<sub>name</sub></h4>
<div class="outline-text-4" id="text-12-11-14">
<p>
Extract names from symbols.as<sub>name</sub>() converts symbols to character strings. 
</p>

<p>
as<sub>name</sub>() converts symbols to character strings. The conversion is deterministic. That is, the roundtrip symbol -&gt; name -&gt; symbol always gets the same result.
</p>

<p>
Use as<sub>name</sub>() when you need to transform a symbol to a string to refer to an object by its name.
</p>

<p>
Use as<sub>label</sub>() when you need to transform any kind of object to a string to represent that object with a short description.
</p>

<div class="org-src-container">
<pre class="src src-R">foo <span style="color: #008b8b;">&lt;-</span> quote(foo)
bar <span style="color: #008b8b;">&lt;-</span> sym(<span style="color: #8b2252;">"bar"</span>)
                                 <span style="color: #b22222;"># </span><span style="color: #b22222;">as_name() converts symbols to strings:</span>
foo <span style="color: #008b8b;">%&gt;%</span> str()
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  symbol foo</span>
as_name(foo)
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "foo"</span>
as_label(foo)
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "foo"</span>
typeof(bar)
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "symbol"</span>
typeof(as_name(bar))
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "character"       </span>
</pre>
</div>
</div>
</div>

<div id="org0bf6e59" class="outline-4">
<h4 id="org0bf6e59"><span class="section-number-4">12.11.15</span> names2</h4>
<div class="outline-text-4" id="text-12-11-15">
<p>
This names getter always returns a character vector, even when an object does not have a names attribute. In this case, it returns a vector of empty names "". It also standardises missing names to "".
</p>

<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> set_names(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>, c(<span style="color: #8b2252;">"a"</span>, <span style="color: #228b22;">NA</span>, <span style="color: #8b2252;">"b"</span>))
names(x)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "a" NA  "b"</span>
</pre>
</div>
</div>

<div id="orgfa52c8c" class="outline-5">
<h5 id="orgfa52c8c"><span class="section-number-5">12.11.15.1</span> nse-defuse</h5>
<div class="outline-text-5" id="text-12-11-15-1">
</div>
<div id="org33eae65" class="outline-6">
<h6 id="org33eae65"><span class="section-number-6">12.11.15.1.1</span> expr()/enquo()</h6>
<div class="outline-text-6" id="text-12-11-15-1-1">
<p>
这两个函数可以阻止 R code 评价。Whereas expr() defuses your own expression, enquo() defuses expressions supplied as argument by the user of a function. See section on function arguments for more on this distinction.
</p>
</div>
</div>
</div>
<div id="org4ae3770" class="outline-5">
<h5 id="org4ae3770"><span class="section-number-5">12.11.15.2</span> env<sub>get</sub></h5>
<div class="outline-text-5" id="text-12-11-15-2">
<p>
env<sub>get</sub>() extracts an object from an enviroment env. By default, it does not look in the parent environments. env<sub>get</sub><sub>list</sub>() extracts multiple objects from an environment into a named list.
</p>
<div class="org-src-container">
<pre class="src src-R">parent <span style="color: #008b8b;">&lt;-</span> child_env(<span style="color: #228b22;">NULL</span>, foo = <span style="color: #8b2252;">"foo"</span>)
env <span style="color: #008b8b;">&lt;-</span> child_env(parent, bar = <span style="color: #8b2252;">"bar"</span>)
env_get(env, <span style="color: #8b2252;">"bar"</span>)
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "bar"</span>
get(envir = env,<span style="color: #8b2252;">"bar"</span>)
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "bar"       </span>
</pre>
</div>
</div>
</div>
<div id="org909c871" class="outline-5">
<h5 id="org909c871"><span class="section-number-5">12.11.15.3</span> env<sub>print</sub></h5>
<div class="outline-text-5" id="text-12-11-15-3">
<p>
Pretty-print an environment.
</p>
<div class="org-src-container">
<pre class="src src-R">parent <span style="color: #008b8b;">&lt;-</span> child_env(<span style="color: #228b22;">NULL</span>, foo = <span style="color: #8b2252;">"foo"</span>)
env <span style="color: #008b8b;">&lt;-</span> child_env(parent, bar = <span style="color: #8b2252;">"bar"</span>)
env_get(env, <span style="color: #8b2252;">"bar"</span>)
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "bar"</span>
get(envir = env,<span style="color: #8b2252;">"bar"</span>)
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "bar"</span>
env_print(env)
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; &lt;environment: 0x7fae3317eb68&gt;</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; parent: &lt;environment: 0x7fae331198f8&gt;</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; bindings:</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  * bar: &lt;chr&gt;       </span>
</pre>
</div>
</div>
</div>
<div id="org2aa0002" class="outline-5">
<h5 id="org2aa0002"><span class="section-number-5">12.11.15.4</span> f<sub>text</sub></h5>
<div class="outline-text-5" id="text-12-11-15-4">
<p>
Equivalent of expr<sub>text</sub>() and expr<sub>label</sub>() for formulas.
</p>
<div class="org-src-container">
<pre class="src src-R">f <span style="color: #008b8b;">&lt;-</span> ~ a + b + bc
f_text(f)
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "a + b + bc"       </span>
</pre>
</div>
</div>
</div>
<div id="orgb1df2e0" class="outline-5">
<h5 id="orgb1df2e0"><span class="section-number-5">12.11.15.5</span> f<sub>rhs</sub>/f<sub>lhs</sub></h5>
<div class="outline-text-5" id="text-12-11-15-5">
<p>
f<sub>rhs</sub> extracts the righthand side, f<sub>lhs</sub> extracts the lefthand side, and f<sub>env</sub> extracts the environment. All functions throw an error if f is not a formula.
</p>

<div class="org-src-container">
<pre class="src src-R">f_rhs(~ x)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; x</span>
f_rhs(~ <span style="color: #8b2252;">"A"</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "A"</span>
f_rhs(<span style="color: #008b8b;">1</span> ~ <span style="color: #008b8b;">2</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 2</span>
f_lhs(<span style="color: #008b8b;">1</span>~ y)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 1  </span>
</pre>
</div>
</div>
</div>

<div id="orga358e99" class="outline-5">
<h5 id="orga358e99"><span class="section-number-5">12.11.15.6</span> env<sub>bind</sub></h5>
<div class="outline-text-5" id="text-12-11-15-6">
<p>
Bind symbols to objects in an environment.
env<sub>bind</sub>() takes named values which are bound in .env. env<sub>bind</sub>() is equivalent to base::assign().
</p>
<div class="org-src-container">
<pre class="src src-R">
</pre>
</div>
</div>
</div>


<div id="orge24623a" class="outline-5">
<h5 id="orge24623a"><span class="section-number-5">12.11.15.7</span> vector-construcion</h5>
<div class="outline-text-5" id="text-12-11-15-7">
<div class="org-src-container">
<pre class="src src-R">       <span style="color: #b22222;"># </span><span style="color: #b22222;">These constructors are like a typed version of c():</span>
       c(<span style="color: #228b22;">TRUE</span>, <span style="color: #228b22;">FALSE</span>)
       lgl(<span style="color: #228b22;">TRUE</span>, <span style="color: #228b22;">FALSE</span>)       
       dbl(!!! list(a = <span style="color: #008b8b;">1</span>))
                                        <span style="color: #b22222;"># </span><span style="color: #b22222;">Lists can be spliced:</span>
       dbl(<span style="color: #008b8b;">10</span>, !!! list(<span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">2L</span>), <span style="color: #228b22;">TRUE</span>)
<span style="color: #b22222;"># </span><span style="color: #b22222;">They follow a restricted set of coercion rules:</span>
       int(<span style="color: #228b22;">TRUE</span>, <span style="color: #228b22;">FALSE</span>, <span style="color: #008b8b;">20</span>)       
</pre>
</div>
</div>
</div>
<div id="org8b61e93" class="outline-5">
<h5 id="org8b61e93"><span class="section-number-5">12.11.15.8</span> missing</h5>
<div class="outline-text-5" id="text-12-11-15-8">
<p>
na<sub>lgl,na</sub><sub>int,na</sub><sub>dbl,na</sub><sub>chr,na</sub><sub>cpl.类似</sub> NA<sub>integer</sub>_ 等命令。
</p>
<div class="org-src-container">
<pre class="src src-R">typeof(<span style="color: #228b22;">NA</span>)
typeof(na_lgl)
typeof(na_int)
                                 <span style="color: #b22222;"># </span><span style="color: #b22222;">Note that while the base R missing symbols cannot be overwritten,</span>
                                 <span style="color: #b22222;"># </span><span style="color: #b22222;">that's not the case for rlang's aliases:</span>
na_dbl <span style="color: #008b8b;">&lt;-</span> <span style="color: #228b22;">NA</span>
typeof(na_dbl)
</pre>
</div>
</div>
</div>
<div id="orgfeb73e0" class="outline-5">
<h5 id="orgfeb73e0"><span class="section-number-5">12.11.15.9</span> quasiquotation</h5>
<div class="outline-text-5" id="text-12-11-15-9">
</div>
<div id="org46b96de" class="outline-6">
<h6 id="org46b96de"><span class="section-number-6">12.11.15.9.1</span> !!</h6>
<div class="outline-text-6" id="text-12-11-15-9-1">
<p>
The !! operator unquotes its argument. It gets evaluated immediately in the surrounding context.
</p>
<div class="org-src-container">
<pre class="src src-R">name <span style="color: #008b8b;">&lt;-</span> <span style="color: #8b2252;">"Jane"</span>
list2(!!name := <span style="color: #008b8b;">1</span> + <span style="color: #008b8b;">2</span>)       
</pre>
</div>
</div>
</div>
<div id="org3dd862a" class="outline-6">
<h6 id="org3dd862a"><span class="section-number-6">12.11.15.9.2</span> !!!</h6>
<div class="outline-text-6" id="text-12-11-15-9-2">
<p>
The !!! operator unquotes and splices its argument. The argument should
represent a list or a vector. Each element will be embedded in the surrounding
call, i.e. each element is inserted as an argument. If the vector is named, the
names are used as argument names.
</p>
<div class="org-src-container">
<pre class="src src-R">args <span style="color: #008b8b;">&lt;-</span> list(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>, na.rm = <span style="color: #228b22;">TRUE</span>)
quo(mean(!!!args))
</pre>
</div>
</div>
</div>
</div>

<div id="org95281c8" class="outline-5">
<h5 id="org95281c8"><span class="section-number-5">12.11.15.10</span> new<sub>list</sub>/new<sub>logical</sub></h5>
<div class="outline-text-5" id="text-12-11-15-10">
<p>
These functions construct vectors of a given length, with attributes specified via dots. Except for new<sub>list</sub>() and new<sub>raw</sub>(), the empty vectors are filled with typed missing values.
</p>
<div class="org-src-container">
<pre class="src src-R">new_list(<span style="color: #008b8b;">10</span>)
new_logical(<span style="color: #008b8b;">10</span>)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] NA NA NA NA NA NA NA NA NA NA</span>
new_character(<span style="color: #008b8b;">10</span>)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] NA NA NA NA NA NA NA NA NA NA       </span>
</pre>
</div>
</div>
</div>

<div id="org073c56b" class="outline-5">
<h5 id="org073c56b"><span class="section-number-5">12.11.15.11</span> %|%</h5>
<div class="outline-text-5" id="text-12-11-15-11">
<p>
Replace missing values.This infix function is similar to %||% but is vectorised and provides a default value for missing elements. It is faster than using base::ifelse() and does not perform type conversions.
</p>

<div class="org-src-container">
<pre class="src src-R">c(<span style="color: #8b2252;">"a"</span>, <span style="color: #8b2252;">"b"</span>, <span style="color: #228b22;">NA</span>, <span style="color: #8b2252;">"c"</span>) <span style="color: #008b8b;">%|%</span> <span style="color: #8b2252;">"default"</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] "a"       "b"       "default" "c" </span>
</pre>
</div>
</div>
</div>

<div id="org09675d9" class="outline-5">
<h5 id="org09675d9"><span class="section-number-5">12.11.15.12</span> %||%</h5>
<div class="outline-text-5" id="text-12-11-15-12">
<p>
Default value for NULL.
</p>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #008b8b;">1</span> <span style="color: #008b8b;">%||%</span> <span style="color: #008b8b;">2</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] 1</span>
<span style="color: #228b22;">NULL</span> <span style="color: #008b8b;">%||%</span> <span style="color: #008b8b;">2</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] 2</span>
</pre>
</div>
</div>
</div>
</div>

<div id="org120caab" class="outline-4">
<h4 id="org120caab"><span class="section-number-4">12.11.16</span> rsample</h4>
<div class="outline-text-4" id="text-12-11-16">
</div>
<div id="org47ee43c" class="outline-5">
<h5 id="org47ee43c"><span class="section-number-5">12.11.16.1</span> bootstraps</h5>
<div class="outline-text-5" id="text-12-11-16-1">
<p>
A bootstrap sample is a sample that is the same size as the original data set that is made using replacement. 
</p>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #008b8b;">library</span>(purrr)
iris2 <span style="color: #008b8b;">&lt;-</span> iris[<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">130</span>, ]
set.seed(<span style="color: #008b8b;">13</span>)
resample1 <span style="color: #008b8b;">&lt;-</span> bootstraps(iris2, times = <span style="color: #008b8b;">3</span>)
</pre>
</div>
</div>
</div>
</div>
<div id="orgb875d62" class="outline-4">
<h4 id="orgb875d62"><span class="section-number-4">12.11.17</span> tibble</h4>
<div class="outline-text-4" id="text-12-11-17">
</div>
<div id="org5ecd490" class="outline-5">
<h5 id="org5ecd490"><span class="section-number-5">12.11.17.1</span> add<sub>row</sub></h5>
<div class="outline-text-5" id="text-12-11-17-1">
<p>
This is a convenient way to add one or more rows of data to an existing data frame. 
</p>
<div class="org-src-container">
<pre class="src src-R">df <span style="color: #008b8b;">&lt;-</span> tibble(x = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>, y = <span style="color: #008b8b;">3</span>:<span style="color: #008b8b;">1</span>)
add_row(df, x = <span style="color: #008b8b;">4</span>, y = <span style="color: #008b8b;">0</span>)
add_row(df, x = <span style="color: #008b8b;">4</span>, y = <span style="color: #008b8b;">0</span>, .before = <span style="color: #008b8b;">2</span>)
add_row(df, x = <span style="color: #008b8b;">4</span>:<span style="color: #008b8b;">5</span>, y = <span style="color: #008b8b;">0</span>:-<span style="color: #008b8b;">1</span>)
</pre>
</div>
</div>
</div>
<div id="org3cc9d9b" class="outline-5">
<h5 id="org3cc9d9b"><span class="section-number-5">12.11.17.2</span> add<sub>column</sub></h5>
<div class="outline-text-5" id="text-12-11-17-2">
<div class="org-src-container">
<pre class="src src-R">df <span style="color: #008b8b;">&lt;-</span> tibble(x = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>, y = <span style="color: #008b8b;">3</span>:<span style="color: #008b8b;">1</span>)
add_column(df, z = -<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">1</span>, w = <span style="color: #008b8b;">0</span>)       
</pre>
</div>
</div>
</div>
<div id="org272b9e6" class="outline-5">
<h5 id="org272b9e6"><span class="section-number-5">12.11.17.3</span> as<sub>tibble</sub></h5>
<div class="outline-text-5" id="text-12-11-17-3">
<p>
Coerce lists, matrices, and more to data frames.
强制将 list 转变成 data.frame.
</p>
<div class="org-src-container">
<pre class="src src-R">l <span style="color: #008b8b;">&lt;-</span> list(x = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">500</span>, y = runif(<span style="color: #008b8b;">500</span>), z = <span style="color: #008b8b;">500</span>:<span style="color: #008b8b;">1</span>)
df <span style="color: #008b8b;">&lt;-</span> as_tibble(l)
                                 <span style="color: #b22222;"># </span><span style="color: #b22222;">A tibble: 500 x 3</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">x     y     z</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">&lt;int&gt; &lt;dbl&gt; &lt;int&gt;</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">1     1 0.942   500</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">2     2 0.557   499</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">3     3 0.832   498</span>
</pre>
</div>
<div class="org-src-container">
<pre class="src src-R">m <span style="color: #008b8b;">&lt;-</span> matrix(rnorm(<span style="color: #008b8b;">50</span>), ncol = <span style="color: #008b8b;">5</span>)
colnames(m) <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #8b2252;">"a"</span>, <span style="color: #8b2252;">"b"</span>, <span style="color: #8b2252;">"c"</span>, <span style="color: #8b2252;">"d"</span>, <span style="color: #8b2252;">"e"</span>)
df <span style="color: #008b8b;">&lt;-</span> as_tibble(m)
                                 <span style="color: #b22222;"># </span><span style="color: #b22222;">A tibble: 10 x 5</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">a       b      c       d      e</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">&lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">1  0.240  -0.0386 -1.47   0.480   0.372</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">2 -0.205  -0.820   0.559 -0.350  -1.01 </span>
</pre>
</div>
</div>
</div>
<div id="org683df92" class="outline-5">
<h5 id="org683df92"><span class="section-number-5">12.11.17.4</span> enframe</h5>
<div class="outline-text-5" id="text-12-11-17-4">
<p>
Converting vectors to data frames, and vice versa.enframe() converts named atomic vectors or lists to one- or two-column data frames. For a list, the result will be a nested tibble with a column of type list. For unnamed vectors, the natural sequence is used as name column.
</p>
<div class="org-src-container">
<pre class="src src-R">enframe(c(a = <span style="color: #008b8b;">5</span>, b = <span style="color: #008b8b;">7</span>))
                                 <span style="color: #b22222;"># </span><span style="color: #b22222;">A tibble: 2 x 2</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">name  value</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">&lt;chr&gt; &lt;dbl&gt;</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">1 a       5</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">2 b       7</span>
</pre>
</div>
</div>
</div>
<div id="orgbf03c9f" class="outline-5">
<h5 id="orgbf03c9f"><span class="section-number-5">12.11.17.5</span> deframe</h5>
<div class="outline-text-5" id="text-12-11-17-5">
<p>
deframe() converts two-column data frames to a named vector or list, using the first column as name and the second column as value. If the input has only one column, an unnamed vector is returned.
</p>
<div class="org-src-container">
<pre class="src src-R">deframe(enframe(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>))
deframe(tibble(a = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>))
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] 1 2 3</span>
deframe(tibble(a = as.list(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>)))       
</pre>
</div>
</div>
</div>
<div id="org449a558" class="outline-5">
<h5 id="org449a558"><span class="section-number-5">12.11.17.6</span> has<sub>rownames</sub></h5>
<div class="outline-text-5" id="text-12-11-17-6">
<div class="org-src-container">
<pre class="src src-R">has_rownames(mtcars)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] TRUE</span>
has_rownames(iris)       
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] FALSE </span>
</pre>
</div>
</div>
</div>
<div id="orgb85b08b" class="outline-5">
<h5 id="orgb85b08b"><span class="section-number-5">12.11.17.7</span> glimpse</h5>
<div class="outline-text-5" id="text-12-11-17-7">
<p>
This is like a transposed version of print(): columns run down the page, and
data runs across. This makes it possible to see every column in a data frame. 
</p>
<div class="org-src-container">
<pre class="src src-R">glimpse(mtcars)
<span style="color: #b22222;">## </span><span style="color: #b22222;">Observations: 32</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">Variables: 11</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">$ mpg  &lt;dbl&gt; 21.0, 21.0, 22.8, 21.4, 18.7, 18.1, 14.3, 24.4, &#8230;</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">$ cyl  &lt;dbl&gt; 6, 6, 4, 6, 8, 6, 8, 4, 4, 6, 6, 8, 8, 8, 8, 8, &#8230;</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">$ disp &lt;dbl&gt; 160.0, 160.0, 108.0, 258.0, 360.0, 225.0, 360.0,&#8230;</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">$ hp   &lt;dbl&gt; 110, 110, 93, 110, 175, 105, 245, 62, 95, 123, 1&#8230;</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">$ drat &lt;dbl&gt; 3.90, 3.90, 3.85, 3.08, 3.15, 2.76, 3.21, 3.69, &#8230;</span>
</pre>
</div>
</div>
</div>
<div id="org86d95ec" class="outline-5">
<h5 id="org86d95ec"><span class="section-number-5">12.11.17.8</span> is<sub>tibble</sub></h5>
<div class="outline-text-5" id="text-12-11-17-8">
<p>
Test if the object is a tibble.This function returns TRUE for tibbles or subclasses thereof, and FALSE for all other objects, including regular data frames.
</p>
<div class="org-src-container">
<pre class="src src-R">is_tibble(tibble(a = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>)) 
</pre>
</div>
</div>
</div>
<div id="orgc8115c3" class="outline-5">
<h5 id="orgc8115c3"><span class="section-number-5">12.11.17.9</span> type<sub>sum</sub></h5>
<div class="outline-text-5" id="text-12-11-17-9">
<div class="org-src-container">
<pre class="src src-R">obj_sum(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">10</span>)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] "int [10]"</span>
obj_sum(matrix(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">10</span>))
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] "int[,1] [10 &#215; 1]"       </span>
</pre>
</div>
</div>
</div>
<div id="org44f01f6" class="outline-5">
<h5 id="org44f01f6"><span class="section-number-5">12.11.17.10</span> subsetting</h5>
<div class="outline-text-5" id="text-12-11-17-10">
<div class="org-src-container">
<pre class="src src-R">df <span style="color: #008b8b;">&lt;-</span> data.frame(a = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>, bc = <span style="color: #008b8b;">4</span>:<span style="color: #008b8b;">6</span>)
tbl <span style="color: #008b8b;">&lt;-</span> tibble(a = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>, bc = <span style="color: #008b8b;">4</span>:<span style="color: #008b8b;">6</span>)
                                 <span style="color: #b22222;"># </span><span style="color: #b22222;">Subsetting single columns:</span>
df[, <span style="color: #8b2252;">"a"</span>]
tbl[, <span style="color: #8b2252;">"a"</span>]
tbl[, <span style="color: #8b2252;">"a"</span>, drop = <span style="color: #228b22;">TRUE</span>]
as.data.frame(tbl)[, <span style="color: #8b2252;">"a"</span>]      
</pre>
</div>
</div>
</div>
<div id="org113d106" class="outline-5">
<h5 id="org113d106"><span class="section-number-5">12.11.17.11</span> tribble</h5>
<div class="outline-text-5" id="text-12-11-17-11">
<p>
Create tibbles using an easier to read row-by-row layout.
</p>
<div class="org-src-container">
<pre class="src src-R">tribble(
    ~colA, ~colB,
    <span style="color: #8b2252;">"a"</span>,   <span style="color: #008b8b;">1</span>,
    <span style="color: #8b2252;">"b"</span>,   <span style="color: #008b8b;">2</span>,
    <span style="color: #8b2252;">"c"</span>,   <span style="color: #008b8b;">3</span>
)
tribble(
    ~x,  ~y,
    <span style="color: #8b2252;">"a"</span>, <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>,
    <span style="color: #8b2252;">"b"</span>, <span style="color: #008b8b;">4</span>:<span style="color: #008b8b;">6</span>
)
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="orgf7bebd4" class="outline-3">
<h3 id="orgf7bebd4"><span class="section-number-3">12.12</span> abind</h3>
<div class="outline-text-3" id="text-12-12">
<p>
这个函数主要生成的是 matrix 类型数据。
</p>
<div class="org-src-container">
<pre class="src src-R">abind(x = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">4</span>, y = <span style="color: #008b8b;">5</span>:<span style="color: #008b8b;">8</span>)
                                   <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; x1 x2 x3 x4 y1 y2 y3 y4 </span>
                                   <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  1  2  3  4  5  6  7  8     </span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-R">abind(x = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">4</span>, y = <span style="color: #008b8b;">5</span>:<span style="color: #008b8b;">8</span>, along = <span style="color: #008b8b;">2</span>)
                                   <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;      x y</span>
                                   <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1,] 1 5</span>
                                   <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [2,] 2 6</span>
                                   <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [3,] 3 7</span>
                                   <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [4,] 4 8 </span>
</pre>
</div>

<p>
可以很方便地生成 3 维 array.
</p>
<div class="org-src-container">
<pre class="src src-R">abind(x=matrix(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">16</span>,nrow=<span style="color: #008b8b;">4</span>), y=matrix(<span style="color: #008b8b;">17</span>:<span style="color: #008b8b;">32</span>,nrow=<span style="color: #008b8b;">4</span>), along=<span style="color: #008b8b;">3</span>)
</pre>
</div>


<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> matrix(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">12</span>,<span style="color: #008b8b;">3</span>,<span style="color: #008b8b;">4</span>)
y <span style="color: #008b8b;">&lt;-</span> x+<span style="color: #008b8b;">100</span>
abind(x, y, along = <span style="color: #008b8b;">0</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; , , 1</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;      [,1] [,2] [,3]</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1,]    1    2    3</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [2,]  101  102  103</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; , , 2</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;      [,1] [,2] [,3]</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1,]    4    5    6</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [2,]  104  105  106</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; , , 3</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;      [,1] [,2] [,3]</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1,]    7    8    9</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [2,]  107  108  109</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; , , 4</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;      [,1] [,2] [,3]</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1,]   10   11   12</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [2,]  110  111  112</span>
abind(x, y, along = <span style="color: #008b8b;">3</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; , , 1</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;      [,1] [,2] [,3] [,4]</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1,]    1    4    7   10</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [2,]    2    5    8   11</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [3,]    3    6    9   12</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; , , 2</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;      [,1] [,2] [,3] [,4]</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1,]  101  104  107  110</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [2,]  102  105  108  111</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [3,]  103  106  109  112</span>
</pre>
</div>

<p>
还能这么玩？？
</p>

<div class="org-src-container">
<pre class="src src-R">abind(x,y,along=<span style="color: #008b8b;">1.5</span>)  
</pre>
</div>
</div>
</div>
<div id="org7552909" class="outline-3">
<h3 id="org7552909"><span class="section-number-3">12.13</span> glue</h3>
<div class="outline-text-3" id="text-12-13">
</div>
<div id="orgdc3ed74" class="outline-4">
<h4 id="orgdc3ed74"><span class="section-number-4">12.13.1</span> glue</h4>
<div class="outline-text-4" id="text-12-13-1">
<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">5</span>
glue(<span style="color: #8b2252;">'Values of x: {glue_collapse(backtick(x), sep = ", ", last = " and ")}'</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Values of x: `1`, `2`, `3`, `4` and `5`      </span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-R">name <span style="color: #008b8b;">&lt;-</span> <span style="color: #8b2252;">"Fred"</span>
age <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">50</span>
anniversary <span style="color: #008b8b;">&lt;-</span> as.Date(<span style="color: #8b2252;">"1991-10-12"</span>)
glue(<span style="color: #8b2252;">'My name is {name},'</span>,
     <span style="color: #8b2252;">'my age next year is {age + 1},'</span>,
     <span style="color: #8b2252;">'my anniversary is {format(anniversary, "%A, %B %d, %Y")}.'</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; My name is Fred,my age next year is 51,my anniversary is Saturday, October 12, 1991.      </span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-R">name <span style="color: #008b8b;">&lt;-</span> <span style="color: #8b2252;">"Fred"</span>
glue(<span style="color: #8b2252;">'My name is {name}.'</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; My name is Fred.      </span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-R">glue(<span style="color: #8b2252;">'My name is {name},'</span>,
     <span style="color: #8b2252;">' my age next year is {age + 1},'</span>,
     <span style="color: #8b2252;">' my anniversary is {format(anniversary, "%A, %B %d, %Y")}.'</span>,
     name = <span style="color: #8b2252;">"Joe"</span>,
     age = <span style="color: #008b8b;">40</span>,
     anniversary = as.Date(<span style="color: #8b2252;">"2001-10-12"</span>))
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; My name is Joe, my age next year is 41, my anniversary is Friday, October 12, 2001.      </span>
</pre>
</div>
</div>
</div>

<div id="orgf3413bd" class="outline-4">
<h4 id="orgf3413bd"><span class="section-number-4">12.13.2</span> glue<sub>collapse</sub></h4>
<div class="outline-text-4" id="text-12-13-2">
<p>
Collapses a character vector of any length into a length 1 vector.
</p>
<div class="org-src-container">
<pre class="src src-R">glue_collapse(glue(<span style="color: #8b2252;">"{1:10}"</span>))
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 12345678910</span>
glue(<span style="color: #8b2252;">"{1:10}"</span>) <span style="color: #008b8b;">%&gt;%</span> paste0(collapse = <span style="color: #8b2252;">""</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "12345678910"      </span>
</pre>
</div>
</div>
</div>

<div id="org9ec84fb" class="outline-4">
<h4 id="org9ec84fb"><span class="section-number-4">12.13.3</span> glue<sub>data</sub></h4>
<div class="outline-text-4" id="text-12-13-3">
<div class="org-src-container">
<pre class="src src-R">head(mtcars) <span style="color: #008b8b;">%&gt;%</span> glue_data(<span style="color: #8b2252;">"{rownames(.)} has {hp} hp"</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Mazda RX4 has 110 hp</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Mazda RX4 Wag has 110 hp</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Datsun 710 has 93 hp</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Hornet 4 Drive has 110 hp</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Hornet Sportabout has 175 hp</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Valiant has 105 hp      </span>
</pre>
</div>
</div>
</div>

<div id="orgf6ccc57" class="outline-4">
<h4 id="orgf6ccc57"><span class="section-number-4">12.13.4</span> glue<sub>col</sub></h4>
<div class="outline-text-4" id="text-12-13-4">
<p>
Construct strings with color.The crayon package defines a number of functions used to color terminal output. glue<sub>col</sub>() and glue<sub>data</sub><sub>col</sub>() functions provide additional syntax to make using these functions in glue strings easier.
</p>

<div class="org-src-container">
<pre class="src src-R">glue_col(<span style="color: #8b2252;">"{blue foo bar}"</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; foo bar  </span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #a020f0;">if</span> (<span style="color: #008b8b;">require</span>(crayon)) {
    <span style="color: #008b8b;">library</span>(crayon)
    glue_col(<span style="color: #8b2252;">"{blue foo bar}"</span>)
    glue_col(<span style="color: #8b2252;">"{blue 1 + 1 = {1 + 1}}"</span>)
    white_on_grey <span style="color: #008b8b;">&lt;-</span> bgBlack $ white
    glue_col(<span style="color: #8b2252;">"{white_on_grey</span>
<span style="color: #8b2252;">  Roses are {red {colors()[[552]]}}</span>
<span style="color: #8b2252;">  Violets are {blue {colors()[[26]]}}</span>
<span style="color: #8b2252;">  `glue_col()` can show {red c}{yellow o}{green l}{cyan o}{blue r}{magenta s}</span>
<span style="color: #8b2252;">  and {bold bold} and {underline underline} too!</span>
<span style="color: #8b2252;">  }"</span>)
}  
</pre>
</div>
</div>
</div>

<div id="org3d01a7d" class="outline-4">
<h4 id="org3d01a7d"><span class="section-number-4">12.13.5</span> glue<sub>sql</sub></h4>
<div class="outline-text-4" id="text-12-13-5">
<div class="org-src-container">
<pre class="src src-R">    con <span style="color: #008b8b;">&lt;-</span> DBI::dbConnect(RSQLite::SQLite(), <span style="color: #8b2252;">":memory:"</span>)
    iris2 <span style="color: #008b8b;">&lt;-</span> iris
    colnames(iris2) <span style="color: #008b8b;">&lt;-</span> gsub(<span style="color: #8b2252;">"[.]"</span>, <span style="color: #8b2252;">"_"</span>, tolower(colnames(iris)))
    DBI::dbWriteTable(con, <span style="color: #8b2252;">"iris"</span>, iris2)
    var <span style="color: #008b8b;">&lt;-</span> <span style="color: #8b2252;">"sepal_width"</span>
    tbl <span style="color: #008b8b;">&lt;-</span> <span style="color: #8b2252;">"iris"</span>
    num <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">2</span>
    val <span style="color: #008b8b;">&lt;-</span> <span style="color: #8b2252;">"setosa"</span>
    glue_sql(<span style="color: #8b2252;">"</span>
<span style="color: #8b2252;">SELECT {`var`}</span>
<span style="color: #8b2252;">FROM {`tbl`}</span>
<span style="color: #8b2252;">WHERE {`tbl`}.sepal_length &gt; {num}</span>
<span style="color: #8b2252;">  AND {`tbl`}.species = {val}</span>
<span style="color: #8b2252;">"</span>, .con = con)      

    <span style="color: #b22222;">#</span><span style="color: #b22222;">&lt;SQL&gt; SELECT `sepal_width`</span>
    <span style="color: #b22222;">#</span><span style="color: #b22222;">FROM `iris`</span>
    <span style="color: #b22222;">#</span><span style="color: #b22222;">WHERE `iris`.sepal_length &gt; 2</span>
    <span style="color: #b22222;">#</span><span style="color: #b22222;">AND `iris`.species = 'setosa'</span>
</pre>
</div>
</div>
</div>
</div>

<div id="orgbd4150d" class="outline-3">
<h3 id="orgbd4150d"><span class="section-number-3">12.14</span> unglue<sub>data</sub></h3>
<div class="outline-text-3" id="text-12-14">
<div class="org-src-container">
<pre class="src src-R">acnh <span style="color: #008b8b;">&lt;-</span> c(
    <span style="color: #8b2252;">"Flimsy axe costs 800 bells"</span>,
    <span style="color: #8b2252;">"DIY for beginners costs 480 bells"</span>,
    <span style="color: #8b2252;">"Nook Miles Ticket costs 2000 Nook Miles"</span>,
    <span style="color: #8b2252;">"Top 8 Stylish Hair Colors costs 3000 Nook Miles"</span>
)

                                   <span style="color: #b22222;"># </span><span style="color: #b22222;">Extract matching values using a syntax like glue::glue()!</span>
                                   <span style="color: #b22222;"># </span><span style="color: #b22222;">Byebye regex! (except you can use regex within if you want/need ok)</span>
acnh <span style="color: #008b8b;">%&gt;%</span>
    unglue_data(<span style="color: #8b2252;">"{item} costs {price} {units}"</span>)
                                   <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;                        item price      units</span>
                                   <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1                Flimsy axe   800      bells</span>
                                   <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2         DIY for beginners   480      bells</span>
                                   <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3         Nook Miles Ticket  2000 Nook Miles</span>
                                   <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 4 Top 8 Stylish Hair Colors  3000 Nook Miles     </span>
</pre>
</div>
</div>
</div>

<div id="org1257745" class="outline-3">
<h3 id="org1257745"><span class="section-number-3">12.15</span> data.table</h3>
<div class="outline-text-3" id="text-12-15">
</div>
<div id="org6264bce" class="outline-4">
<h4 id="org6264bce"><span class="section-number-4">12.15.1</span> as.data.table</h4>
<div class="outline-text-4" id="text-12-15-1">
<p>
Coerce to data.table.Functions to check if an object is data.table, or coerce it if possible.
</p>
<div class="org-src-container">
<pre class="src src-R">cc = c(X=<span style="color: #8b2252;">"a"</span>, Y=<span style="color: #8b2252;">"b"</span>, Z=<span style="color: #8b2252;">"c"</span>)
as.data.table(cc)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;    cc</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1:  a</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2:  b</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3:  c</span>
as.data.table(cc, keep.rownames=<span style="color: #228b22;">TRUE</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;    rn cc</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1:  X  a</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2:  Y  b</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3:  Z  c</span>
nn = c(a=<span style="color: #008b8b;">0.1</span>, b=<span style="color: #008b8b;">0.2</span>, c=<span style="color: #008b8b;">0.3</span>, d=<span style="color: #008b8b;">0.4</span>)
as.data.table(nn, keep.rownames = <span style="color: #8b2252;">"rownames"</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;    rownames  nn</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1:        a 0.1</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2:        b 0.2</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3:        c 0.3</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 4:        d 0.4  </span>
</pre>
</div>
</div>
</div>

<div id="orga4b9a6c" class="outline-4">
<h4 id="orga4b9a6c"><span class="section-number-4">12.15.2</span> address</h4>
<div class="outline-text-4" id="text-12-15-2">
<p>
Address in RAM of a variable.
</p>

<div class="org-src-container">
<pre class="src src-R">x = <span style="color: #008b8b;">1</span>
address(x)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "0x7f93e030f528"  </span>
</pre>
</div>
</div>
</div>

<div id="org896eaf5" class="outline-4">
<h4 id="org896eaf5"><span class="section-number-4">12.15.3</span> %between%</h4>
<div class="outline-text-4" id="text-12-15-3">
<p>
data.table 中的这个函数类似于 dplyr 中的%&gt;% between(7,9). between is equivalent to lower&lt;=x &amp; x&lt;=upper when incbounds=TRUE, or lower&lt;x &amp; y&lt;upper when FALSE.
</p>

<div class="org-src-container">
<pre class="src src-R">X = data.table(a=<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">5</span>, b=<span style="color: #008b8b;">6</span>:<span style="color: #008b8b;">10</span>, c=c(<span style="color: #008b8b;">5</span>:<span style="color: #008b8b;">1</span>))
X[b <span style="color: #008b8b;">%between%</span> c(<span style="color: #008b8b;">7</span>,<span style="color: #008b8b;">9</span>)]
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;    a b c</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1: 2 7 4</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2: 3 8 3</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3: 4 9 2</span>
X <span style="color: #008b8b;">%&gt;%</span> filter(b <span style="color: #008b8b;">%&gt;%</span> between(<span style="color: #008b8b;">7</span>,<span style="color: #008b8b;">9</span>,incbounds = F))
<span style="color: #b22222;">#</span><span style="color: #b22222;">a b c</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">1 3 8 3</span>
X <span style="color: #008b8b;">%&gt;%</span> filter(b <span style="color: #008b8b;">%&gt;%</span> between(<span style="color: #008b8b;">7</span>,<span style="color: #008b8b;">9</span>))
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   a b c</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1 2 7 4</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2 3 8 3</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3 4 9 2</span>
</pre>
</div>
</div>
</div>

<div id="org85c33d3" class="outline-4">
<h4 id="org85c33d3"><span class="section-number-4">12.15.4</span> %inrange%</h4>
<div class="outline-text-4" id="text-12-15-4">
<p>
重新学习了这个函数。
inrange checks whether each value in x is in between any of the intervals provided in lower,upper.
</p>
<div class="org-src-container">
<pre class="src src-R">Y = data.table(a=c(<span style="color: #008b8b;">8</span>,<span style="color: #008b8b;">3</span>,<span style="color: #008b8b;">10</span>,<span style="color: #008b8b;">7</span>,-<span style="color: #008b8b;">10</span>), val=runif(<span style="color: #008b8b;">5</span>))
range = data.table(start = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">5</span>, end = <span style="color: #008b8b;">6</span>:<span style="color: #008b8b;">10</span>)
range
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;    start end</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1:     1   6</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2:     2   7</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3:     3   8</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 4:     4   9</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 5:     5  10</span>
Y <span style="color: #008b8b;">%&gt;%</span> filter(a <span style="color: #008b8b;">%inrange%</span> range)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;    a       val</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1  8 0.7770304</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2  3 0.2374742</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3 10 0.8177270</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 4  7 0.9298817      </span>
</pre>
</div>
</div>
</div>

<div id="org408522a" class="outline-4">
<h4 id="org408522a"><span class="section-number-4">12.15.5</span> all.equal</h4>
<div class="outline-text-4" id="text-12-15-5">
<p>
Equality Test Between Two Data Tables.
</p>
<div class="org-src-container">
<pre class="src src-R">dt1 <span style="color: #008b8b;">&lt;-</span> data.table(A = letters[<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">10</span>], X = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">10</span>, key = <span style="color: #8b2252;">"A"</span>)
dt2 <span style="color: #008b8b;">&lt;-</span> data.table(A = letters[<span style="color: #008b8b;">5</span>:<span style="color: #008b8b;">14</span>], Y = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">10</span>, key = <span style="color: #8b2252;">"A"</span>)
all.equal(dt1, dt1)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] TRUE</span>
all.equal(dt1, dt2)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "Different column names"</span>
x <span style="color: #008b8b;">&lt;-</span> setkeyv(copy(dt1), <span style="color: #228b22;">NULL</span>)
y <span style="color: #008b8b;">&lt;-</span> dt1[sample(nrow(dt1))]
all.equal(x, y)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "Column 'A': 9 string mismatches"</span>
all.equal(x, y, ignore.row.order = <span style="color: #228b22;">TRUE</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] TRUE</span>
all.equal(x, y, check.attributes = <span style="color: #228b22;">FALSE</span>)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> data.table(A = factor(letters[<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">10</span>])[<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">4</span>]) <span style="color: #b22222;"># </span><span style="color: #b22222;">10 levels</span>
y <span style="color: #008b8b;">&lt;-</span> data.table(A = factor(letters[<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">5</span>])[<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">4</span>]) <span style="color: #b22222;"># </span><span style="color: #b22222;">5 levels</span>
all.equal(x, y, trim.levels = T)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] TRUE</span>
all.equal(x, y, trim.levels = <span style="color: #228b22;">FALSE</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "Column 'A': Levels not identical. No attempt to refactor because trim.levels is FALSE"</span>
all.equal(x, y, trim.levels = <span style="color: #228b22;">FALSE</span>, check.attributes = <span style="color: #228b22;">FALSE</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "Column 'A': Levels not identical. No attempt to refactor because trim.levels is FALSE"  </span>
</pre>
</div>
</div>
</div>
<div id="org1f42c71" class="outline-4">
<h4 id="org1f42c71"><span class="section-number-4">12.15.6</span> duplicated</h4>
<div class="outline-text-4" id="text-12-15-6">
<p>
这个函数主要用来检查行记录是否会有重复.
duplicated returns a logical vector indicating which rows of a data.table are duplicates of a row with smaller subscripts.
</p>
<div class="org-src-container">
<pre class="src src-R">DT <span style="color: #008b8b;">&lt;-</span> data.table(A = rep(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>, each=<span style="color: #008b8b;">4</span>), B = rep(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">4</span>, each=<span style="color: #008b8b;">3</span>),
                 C = rep(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">6</span>), key = <span style="color: #8b2252;">"A,B"</span>)
duplicated(DT)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [1] FALSE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [12]  TRUE</span>
unique(DT)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;     A B C</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  1: 1 1 1</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  2: 1 1 2</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  3: 1 2 2</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  4: 2 2 1</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  5: 2 2 2</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  6: 2 3 1</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  7: 2 3 2</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  8: 3 3 1</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  9: 3 4 2</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 10: 3 4 1      </span>
</pre>
</div>
</div>
</div>
<div id="org9df63fe" class="outline-4">
<h4 id="org9df63fe"><span class="section-number-4">12.15.7</span> anyDuplicated</h4>
<div class="outline-text-4" id="text-12-15-7">
<p>
只返回第一个重复记录。
anyDuplicated returns the index i of the <b>first duplicated entry</b> if there is one, and 0 otherwise.
</p>
<div class="org-src-container">
<pre class="src src-R">DT <span style="color: #008b8b;">&lt;-</span> data.table(A = rep(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>, each=<span style="color: #008b8b;">4</span>), B = rep(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">4</span>, each=<span style="color: #008b8b;">3</span>),
                 C = rep(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">6</span>), key = <span style="color: #8b2252;">"A,B"</span>)
anyDuplicated(DT, by=c(<span style="color: #8b2252;">"A"</span>, <span style="color: #8b2252;">"B"</span>),fromLast=T)    <span style="color: #b22222;"># </span><span style="color: #b22222;">3L</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 11</span>
any(duplicated(DT, by=c(<span style="color: #8b2252;">"A"</span>, <span style="color: #8b2252;">"B"</span>)))  <span style="color: #b22222;"># </span><span style="color: #b22222;">TRUE</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] TRUE</span>
</pre>
</div>
</div>
</div>
<div id="org5a06b30" class="outline-4">
<h4 id="org5a06b30"><span class="section-number-4">12.15.8</span> uniqueN</h4>
<div class="outline-text-4" id="text-12-15-8">
<p>
uniqueN is equivalent to length(unique(x)) when x is an atomic vector, and
nrow(unique(x)) when x is a data.frame or data.table. The number of unique rows
are computed directly without materialising the intermediate unique data.table
and is therefore faster and memory efficient.
</p>

<div class="org-src-container">
<pre class="src src-R">DT <span style="color: #008b8b;">&lt;-</span> data.table(A = rep(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>, each=<span style="color: #008b8b;">4</span>), B = rep(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">4</span>, each=<span style="color: #008b8b;">3</span>),
                 C = rep(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">6</span>), key = <span style="color: #8b2252;">"A,B"</span>)
uniqueN(DT, by = key(DT))
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 6</span>
                                  <span style="color: #b22222;"># </span><span style="color: #b22222;">uniqueN, unique rows on all columns</span>
uniqueN(DT)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 10</span>
                                  <span style="color: #b22222;"># </span><span style="color: #b22222;">uniqueN while grouped by "A"</span>
DT[, .(uN=uniqueN(.SD)), by=A]
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;    A uN</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1: 1  3</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2: 2  4</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3: 3  3 </span>
</pre>
</div>
</div>
</div>
<div id="org6093efe" class="outline-4">
<h4 id="org6093efe"><span class="section-number-4">12.15.9</span> IDateTime</h4>
<div class="outline-text-4" id="text-12-15-9">
<p>
Date and time classes with integer storage for fast sorting and grouping. Still experimental!
</p>
</div>
<div id="org810929d" class="outline-5">
<h5 id="org810929d"><span class="section-number-5">12.15.9.1</span> as.ITime</h5>
<div class="outline-text-5" id="text-12-15-9-1">
<div class="org-src-container">
<pre class="src src-R">as.POSIXct(<span style="color: #8b2252;">"2001-01-01"</span>) + as.ITime(<span style="color: #8b2252;">"10:45"</span>)
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "2001-01-01 10:45:00 CST"       </span>
</pre>
</div>
<p>
用这个 round 函数可以很快地取到每个月的第一天。
</p>
<div class="org-src-container">
<pre class="src src-R">(seqdates <span style="color: #008b8b;">&lt;-</span> seq(as.IDate(<span style="color: #8b2252;">"2001-01-01"</span>), as.IDate(<span style="color: #8b2252;">"2001-08-03"</span>), by = <span style="color: #8b2252;">"3 weeks"</span>))
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [1] "2001-01-01" "2001-01-22" "2001-02-12" "2001-03-05" "2001-03-26"</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [6] "2001-04-16" "2001-05-07" "2001-05-28" "2001-06-18" "2001-07-09"</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [11] "2001-07-30"</span>
round(seqdates, <span style="color: #8b2252;">"months"</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [1] "2001-01-01" "2001-01-01" "2001-02-01" "2001-03-01" "2001-03-01"</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [6] "2001-04-01" "2001-05-01" "2001-05-01" "2001-06-01" "2001-07-01"</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [11] "2001-07-01"  </span>
</pre>
</div>
</div>
</div>
</div>
<div id="org085fb27" class="outline-4">
<h4 id="org085fb27"><span class="section-number-4">12.15.10</span> roll</h4>
<div class="outline-text-4" id="text-12-15-10">
</div>
<div id="orgbf81e3f" class="outline-5">
<h5 id="orgbf81e3f"><span class="section-number-5">12.15.10.1</span> froll</h5>
<div class="outline-text-5" id="text-12-15-10-1">
<p>
Fast rolling functions to calculate aggregates on sliding window. Function name and arguments are experimental.
</p>
<div class="org-src-container">
<pre class="src src-R">d = as.data.table(list(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">6</span>/<span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">3</span>:<span style="color: #008b8b;">8</span>/<span style="color: #008b8b;">4</span>))
                                 <span style="color: #b22222;"># </span><span style="color: #b22222;">rollmean of single vector and single window</span>
frollmean(d[, V1], <span style="color: #008b8b;">3</span>)
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1]  NA  NA 1.0 1.5 2.0 2.5</span>
frollsum(d, <span style="color: #008b8b;">3</span>:<span style="color: #008b8b;">4</span>)
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[1]]</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1]  NA  NA 3.0 4.5 6.0 7.5</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[2]]</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] NA NA NA  5  7  9</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[3]]</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1]   NA   NA 3.00 3.75 4.50 5.25</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[4]]</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1]  NA  NA  NA 4.5 5.5 6.5</span>
frollapply(d, <span style="color: #008b8b;">3</span>:<span style="color: #008b8b;">4</span>, sum)
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[1]]</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1]  NA  NA 3.0 4.5 6.0 7.5</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[2]]</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] NA NA NA  5  7  9</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[3]]</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1]   NA   NA 3.00 3.75 4.50 5.25</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[4]]</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1]  NA  NA  NA 4.5 5.5 6.5</span>
f = <span style="color: #a020f0;">function</span>(x, ...) <span style="color: #a020f0;">if</span> (sum(x, ...)&gt;<span style="color: #008b8b;">5</span>) min(x, ...) <span style="color: #a020f0;">else</span> max(x, ...)
frollapply(d, <span style="color: #008b8b;">3</span>:<span style="color: #008b8b;">4</span>, f, na.rm=<span style="color: #228b22;">TRUE</span>)
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[1]]</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1]  NA  NA 1.5 2.0 1.5 2.0</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[2]]</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1]  NA  NA  NA 2.0 1.0 1.5</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[3]]</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1]   NA   NA 1.25 1.50 1.75 1.50</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[4]]</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1]   NA   NA   NA 1.50 1.00 1.25 </span>
</pre>
</div>
</div>
</div>
</div>
<div id="org717e70d" class="outline-4">
<h4 id="org717e70d"><span class="section-number-4">12.15.11</span> nafill</h4>
<div class="outline-text-4" id="text-12-15-11">
<div class="org-src-container">
<pre class="src src-R">x = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">10</span>
x[c(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">5</span>:<span style="color: #008b8b;">6</span>, <span style="color: #008b8b;">9</span>:<span style="color: #008b8b;">10</span>)] = <span style="color: #228b22;">NA</span>
nafill(x, fill = <span style="color: #008b8b;">4</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [1] 4 4 3 4 4 4 7 8 4 4     </span>
</pre>
</div>
</div>
</div>
<div id="org3921e0b" class="outline-4">
<h4 id="org3921e0b"><span class="section-number-4">12.15.12</span> melt</h4>
<div class="outline-text-4" id="text-12-15-12">
<p>
patterns returns the matching indices in the argument cols corresponding to the regular expression patterns provided. The patterns must be supported by grep.
</p>

<div class="org-src-container">
<pre class="src src-R">DT = data.table(x1 = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">5</span>, x2 = <span style="color: #008b8b;">6</span>:<span style="color: #008b8b;">10</span>, y1 = letters[<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">5</span>], y2 = letters[<span style="color: #008b8b;">6</span>:<span style="color: #008b8b;">10</span>])
DT
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;    x1 x2 y1 y2</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1:  1  6  a  f</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2:  2  7  b  g</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3:  3  8  c  h</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 4:  4  9  d  i</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 5:  5 10  e  j</span>
melt(DT, measure.vars = patterns(<span style="color: #8b2252;">"^x"</span>, <span style="color: #8b2252;">"^y"</span>, cols=names(DT)))
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;     variable value1 value2</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  1:        1      1      a</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  2:        1      2      b</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  3:        1      3      c</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  4:        1      4      d</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  5:        1      5      e</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  6:        2      6      f</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  7:        2      7      g</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  8:        2      8      h</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  9:        2      9      i</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 10:        2     10      j  </span>
</pre>
</div>
</div>
</div>
<div id="org475f6e2" class="outline-4">
<h4 id="org475f6e2"><span class="section-number-4">12.15.13</span> %like%</h4>
<div class="outline-text-4" id="text-12-15-13">
<p>
Convenience function for calling grep.Intended for use in i in [.data.table, i.e., for subsetting/filtering. Syntax should be familiar to SQL users, with interpretation as regex.
</p>

<div class="org-src-container">
<pre class="src src-R">DT = data.table(Name=c(<span style="color: #8b2252;">"Mary"</span>,<span style="color: #8b2252;">"George"</span>,<span style="color: #8b2252;">"Martha"</span>), Salary=c(<span style="color: #008b8b;">2</span>,<span style="color: #008b8b;">3</span>,<span style="color: #008b8b;">4</span>))
DT[Name <span style="color: #008b8b;">%like%</span> <span style="color: #8b2252;">"^Mar"</span>]
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;      Name Salary</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1:   Mary      2</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2: Martha      4</span>
DT <span style="color: #008b8b;">%&gt;%</span> filter(Name <span style="color: #008b8b;">%like%</span> <span style="color: #8b2252;">"^Mar"</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;     Name Salary</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1   Mary      2</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2 Martha      4</span>
DT[Name <span style="color: #008b8b;">%ilike%</span> <span style="color: #8b2252;">"mar"</span>]
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;      Name Salary</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1:   Mary      2</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2: Martha      4</span>
DT[Name <span style="color: #008b8b;">%flike%</span> <span style="color: #8b2252;">"Mar"</span>]
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;      Name Salary</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1:   Mary      2</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2: Martha      4  </span>
</pre>
</div>
</div>
</div>

<div id="orgeb3fc46" class="outline-4">
<h4 id="orgeb3fc46"><span class="section-number-4">12.15.14</span> chmatch</h4>
<div class="outline-text-4" id="text-12-15-14">
<p>
这个函数等价于 match 函数。而 match 函数的作用在于确定前一个数据元素在后一个数据列中的位置。
</p>
<div class="org-src-container">
<pre class="src src-R">print(match(<span style="color: #008b8b;">5</span>, c(<span style="color: #008b8b;">1</span>,<span style="color: #008b8b;">2</span>,<span style="color: #008b8b;">9</span>,<span style="color: #008b8b;">5</span>,<span style="color: #008b8b;">3</span>,<span style="color: #008b8b;">6</span>,<span style="color: #008b8b;">7</span>,<span style="color: #008b8b;">4</span>,<span style="color: #008b8b;">5</span>)))
<span style="color: #b22222;">#</span><span style="color: #b22222;">[1] 4</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-R">&gt; v1 <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #8b2252;">"a1"</span>,<span style="color: #8b2252;">"b2"</span>,<span style="color: #8b2252;">"c1"</span>,<span style="color: #8b2252;">"d2"</span>)
&gt; v2 <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #8b2252;">"g1"</span>,<span style="color: #8b2252;">"x2"</span>,<span style="color: #8b2252;">"d2"</span>,<span style="color: #8b2252;">"e2"</span>,<span style="color: #8b2252;">"f1"</span>,<span style="color: #8b2252;">"a1"</span>,<span style="color: #8b2252;">"c2"</span>,<span style="color: #8b2252;">"b2"</span>,<span style="color: #8b2252;">"a2"</span>)
&gt; x <span style="color: #008b8b;">&lt;-</span> match(v1,v2)
&gt; x
<span style="color: #b22222;">#</span><span style="color: #b22222;">[1] 6 8 NA 3</span>
&gt; x <span style="color: #008b8b;">&lt;-</span> chmatch(v1,v2)
&gt; x
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">[1] 6 8 NA 3</span>
</pre>
</div>
</div>
</div>

<div id="orgfbfa99a" class="outline-4">
<h4 id="orgfbfa99a"><span class="section-number-4">12.15.15</span> %chin%</h4>
<div class="outline-text-4" id="text-12-15-15">
<p>
函数作用和 %in% 一样。
</p>
<div class="org-src-container">
<pre class="src src-R">N = <span style="color: #008b8b;">1e5</span>
u = as.character(as.hexmode(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">10000</span>))
y = sample(u,N,replace=<span style="color: #228b22;">TRUE</span>)
x = sample(u)

system.time(a <span style="color: #008b8b;">&lt;-</span> match(x,y))               <span style="color: #b22222;">#  </span><span style="color: #b22222;">4.6s</span>
system.time(b <span style="color: #008b8b;">&lt;-</span> chmatch(x,y))             <span style="color: #b22222;">#  </span><span style="color: #b22222;">1.8s</span>
identical(a,b)

system.time(a <span style="color: #008b8b;">&lt;-</span> x <span style="color: #008b8b;">%in%</span> y)               <span style="color: #b22222;">#  </span><span style="color: #b22222;">4.5s</span>
system.time(b <span style="color: #008b8b;">&lt;-</span> x <span style="color: #008b8b;">%chin%</span> y)             <span style="color: #b22222;">#  </span><span style="color: #b22222;">1.7s</span>
identical(a,b)      
</pre>
</div>
</div>
</div>

<div id="org04ec66a" class="outline-4">
<h4 id="org04ec66a"><span class="section-number-4">12.15.16</span> na.omit</h4>
<div class="outline-text-4" id="text-12-15-16">
<p>
Remove rows with missing values on columns specified.
</p>
<div class="org-src-container">
<pre class="src src-R">DT = data.table(x=c(<span style="color: #008b8b;">1</span>,<span style="color: #228b22;">NaN</span>,<span style="color: #228b22;">NA</span>,<span style="color: #008b8b;">3</span>), y=c(<span style="color: #228b22;">NA_integer_</span>, <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>), z=c(<span style="color: #8b2252;">"a"</span>, <span style="color: #228b22;">NA_character_</span>, <span style="color: #8b2252;">"b"</span>, <span style="color: #8b2252;">"c"</span>))
                                      <span style="color: #b22222;"># </span><span style="color: #b22222;">default behaviour</span>
na.omit(DT)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;    x y z</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1: 3 3 c  </span>
</pre>
</div>
</div>
</div>

<div id="org5a10cc3" class="outline-4">
<h4 id="org5a10cc3"><span class="section-number-4">12.15.17</span> rleid</h4>
<div class="outline-text-4" id="text-12-15-17">
<p>
Generate run-length type group id.
</p>

<p>
A convenience function for generating a run-length type id column to be used in grouping operations. It accepts atomic vectors, lists, data.frames or data.tables as input.
</p>

<p>
这个函数类似于 group<sub>indices</sub>.
</p>

<div class="org-src-container">
<pre class="src src-R">DT = data.table(grp=rep(c(<span style="color: #8b2252;">"A"</span>, <span style="color: #8b2252;">"B"</span>, <span style="color: #8b2252;">"C"</span>, <span style="color: #8b2252;">"A"</span>, <span style="color: #8b2252;">"B"</span>), c(<span style="color: #008b8b;">2</span>,<span style="color: #008b8b;">2</span>,<span style="color: #008b8b;">3</span>,<span style="color: #008b8b;">1</span>,<span style="color: #008b8b;">2</span>)), value=<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">10</span>)
rleid(DT$grp)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [1] 1 1 2 2 3 3 3 4 5 5</span>
</pre>
</div>
</div>
</div>

<div id="org79d7d35" class="outline-4">
<h4 id="org79d7d35"><span class="section-number-4">12.15.18</span> tstrsplit</h4>
<div class="outline-text-4" id="text-12-15-18">
<p>
这个函数和 tidyr::separate 一样。
</p>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #008b8b;">library</span>(data.table)
dt <span style="color: #008b8b;">&lt;-</span> data.table(
    Start_Date = as.Date(c(
        <span style="color: #8b2252;">"2019-05-01"</span>, <span style="color: #8b2252;">"2019-08-04"</span>, <span style="color: #8b2252;">"2019-07-05"</span>,
        <span style="color: #8b2252;">"2019-07-04"</span>, <span style="color: #8b2252;">"2019-04-27"</span>, <span style="color: #8b2252;">"2019-04-26"</span>,
        <span style="color: #8b2252;">"2019-02-13"</span>, <span style="color: #8b2252;">"2019-02-15"</span>, <span style="color: #8b2252;">"2018-11-26"</span>,
        <span style="color: #8b2252;">"2018-11-11"</span>
    )),
    End_Date = as.Date(c(
        <span style="color: #8b2252;">"2019-06-01"</span>, <span style="color: #8b2252;">"2019-08-09"</span>, <span style="color: #8b2252;">"2019-08-14"</span>,
        <span style="color: #8b2252;">"2019-07-05"</span>, <span style="color: #8b2252;">"2019-05-10"</span>, <span style="color: #8b2252;">"2019-05-20"</span>,
        <span style="color: #8b2252;">"2019-02-16"</span>, <span style="color: #8b2252;">"2019-03-02"</span>, <span style="color: #8b2252;">"2018-12-17"</span>,
        <span style="color: #8b2252;">"2018-11-19"</span>
    )),
    Category = c(
        <span style="color: #8b2252;">"Q-Y-M-V"</span>, <span style="color: #8b2252;">"E-E-E-H"</span>, <span style="color: #8b2252;">"A-N-T-D"</span>,
        <span style="color: #8b2252;">"J-T-B-X"</span>, <span style="color: #8b2252;">"D-R-H-Z"</span>, <span style="color: #8b2252;">"R-O-C-R"</span>,
        <span style="color: #8b2252;">"Z-C-A-M"</span>, <span style="color: #8b2252;">"O-I-J-E"</span>, <span style="color: #8b2252;">"G-D-K-W"</span>, <span style="color: #8b2252;">"V-Z-O-B"</span>
    )
)
dt

dt[, paste0(<span style="color: #8b2252;">"Category_"</span>, <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">4</span>) := tstrsplit(Category, split = <span style="color: #8b2252;">"-"</span>)][]

dt <span style="color: #008b8b;">%&gt;%</span> 
    separate(Category, into = paste0(<span style="color: #8b2252;">"Category_"</span>, <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">4</span>),remove = F,sep = <span style="color: #8b2252;">"-"</span>)  
</pre>
</div>
</div>
</div>
</div>

<div id="orga7518c5" class="outline-3">
<h3 id="orga7518c5"><span class="section-number-3">12.16</span> readr</h3>
<div class="outline-text-3" id="text-12-16">
</div>
<div id="orgc398cdc" class="outline-4">
<h4 id="orgc398cdc"><span class="section-number-4">12.16.1</span> parse<sub>*</sub></h4>
</div>

<div id="org44bc04e" class="outline-4">
<h4 id="org44bc04e"><span class="section-number-4">12.16.2</span> type<sub>convert</sub></h4>
<div class="outline-text-4" id="text-12-16-2">
<div class="org-src-container">
<pre class="src src-R">df <span style="color: #008b8b;">&lt;-</span> tribble(
    ~x, ~y,
    <span style="color: #8b2252;">"1"</span>, <span style="color: #8b2252;">"1.21"</span>,
    <span style="color: #8b2252;">"2"</span>, <span style="color: #8b2252;">"2.32"</span>,
    <span style="color: #8b2252;">"3"</span>, <span style="color: #8b2252;">"4.56"</span>
)
df <span style="color: #008b8b;">%&gt;%</span> type_convert()
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Parsed with column specification:</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; cols(</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   x = col_double(),</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   y = col_double()</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; )</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; # A tibble: 3 x 2</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;       x     y</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   &lt;dbl&gt; &lt;dbl&gt;</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1     1  1.21</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2     2  2.32</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3     3  4.56      </span>
</pre>
</div>
</div>
</div>
</div>

<div id="orgbe9ed46" class="outline-3">
<h3 id="orgbe9ed46"><span class="section-number-3">12.17</span> stringr</h3>
<div class="outline-text-3" id="text-12-17">
</div>
<div id="org17ab774" class="outline-4">
<h4 id="org17ab774"><span class="section-number-4">12.17.1</span> 其他类型的模式</h4>
<div class="outline-text-4" id="text-12-17-1">
</div>
<div id="orgba5c7f9" class="outline-5">
<h5 id="orgba5c7f9"><span class="section-number-5">12.17.1.1</span> regex()</h5>
<div class="outline-text-5" id="text-12-17-1-1">
</div>
<div id="org78857c8" class="outline-6">
<h6 id="org78857c8"><span class="section-number-6">12.17.1.1.1</span> ignore<sub>case</sub> = TRUE</h6>
<div class="outline-text-6" id="text-12-17-1-1-1">
<p>
既可以匹配大写字母，也可以匹配小写字母，它总是使用当前的区域设催产
</p>
<div class="org-src-container">
<pre class="src src-R">str_view(bananas,<span style="color: #8b2252;">"banana"</span>)
str_view(bananas,regex(<span style="color: #8b2252;">"banana"</span>,ignore_case = <span style="color: #228b22;">TRUE</span>))       
</pre>
</div>
</div>
</div>
<div id="org93535cb" class="outline-6">
<h6 id="org93535cb"><span class="section-number-6">12.17.1.1.2</span> multiline = TRUE</h6>
<div class="outline-text-6" id="text-12-17-1-1-2">
<p>
可以使得 ^ 和 $ 从每行的开头和末尾开始匹配，而不是从完整字符串的开头和末尾开始匹配。
</p>
<div class="org-src-container">
<pre class="src src-R">str_extract(x,<span style="color: #8b2252;">"^Line"</span>)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] "Line"</span>
str_extract_all(x, regex(<span style="color: #8b2252;">"^Line"</span>, multiline = <span style="color: #228b22;">TRUE</span> ))[[<span style="color: #008b8b;">1</span>]]       
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] "Line" "Line" "Line"</span>
</pre>
</div>
</div>
</div>
<div id="orga296bc4" class="outline-6">
<h6 id="orga296bc4"><span class="section-number-6">12.17.1.1.3</span> comments = TRUE</h6>
<div class="outline-text-6" id="text-12-17-1-1-3">
<p>
可以让你在复杂的正则表达式中加入注释和空白字符，以便更易理解。匹配时会忽略空格和 # 后面的内容。如果想要匹配一个空格，需要对其进行转义："\\"
</p>
<div class="org-src-container">
<pre class="src src-R">phone <span style="color: #008b8b;">&lt;-</span> regex(<span style="color: #8b2252;">"</span>
<span style="color: #8b2252;">\\(? # &#21487;&#36873;&#30340;&#24320;&#25324;&#21495; </span>
<span style="color: #8b2252;">        (\\d{3}) # &#22320;&#21306;&#32534;&#30721; </span>
<span style="color: #8b2252;">        [)- ]? # &#21487;&#36873;&#30340;&#38381;&#25324;&#21495;&#12289;&#30701;&#21010;&#32447;&#25110;&#31354;&#26684; </span>
<span style="color: #8b2252;">        (\\d{3}) # &#21478;&#22806;3&#20010;&#25968;&#23383; </span>
<span style="color: #8b2252;">        [ -]? # &#21487;&#36873;&#30340;&#31354;&#26684;&#25110;&#30701;&#21010;&#32447; </span>
<span style="color: #8b2252;">        (\\d{3}) # &#21478;&#22806;3&#20010;&#25968;&#23383;</span>
<span style="color: #8b2252;">        "</span>, comments = <span style="color: #228b22;">TRUE</span>)
str_match(<span style="color: #8b2252;">"514-791-8141"</span>, phone)
</pre>
</div>
</div>
</div>
<div id="org03465d9" class="outline-6">
<h6 id="org03465d9"><span class="section-number-6">12.17.1.1.4</span> dotall = TRUE</h6>
<div class="outline-text-6" id="text-12-17-1-1-4">
<p>
可以使得 . 匹配包括 \n 在内的所有字符。
</p>
</div>
</div>
</div>
<div id="orgb03064d" class="outline-5">
<h5 id="orgb03064d"><span class="section-number-5">12.17.1.2</span> fixed()</h5>
<div class="outline-text-5" id="text-12-17-1-2">
<p>
fix() 函数可以按照字符串的字节形式进行精确匹配，它会忽略正则表达式中的所有特殊字符，并在非常低的层次上进行操作。
</p>

<div class="org-src-container">
<pre class="src src-R">str_detect(sentences,fixed(<span style="color: #8b2252;">"the"</span>))  
</pre>
</div>
<p>
在匹配非英语数据时，要慎用 fixed() 函数，它可能会出现问题，因为此时同一个字符经常有多种表达方式。
</p>
</div>
</div>
<div id="orgca41e43" class="outline-5">
<h5 id="orgca41e43"><span class="section-number-5">12.17.1.3</span> coll()</h5>
<div class="outline-text-5" id="text-12-17-1-3">
<p>
<b>函数使用标准排序规则来比较字符串，这在进行不区分大小写的匹配时是非常有效的。</b>  注意，可以在 coll() 函数中设置 locale 参数，以确定使用哪种规则来比较字符。 遗憾的是，世界各地所使用的规则是不同的！
</p>

<div class="org-src-container">
<pre class="src src-R">i <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #8b2252;">"I"</span>, <span style="color: #8b2252;">" &#304; "</span>, <span style="color: #8b2252;">"i"</span>, <span style="color: #8b2252;">"&#305;"</span>)
str_subset(i, coll(<span style="color: #8b2252;">"i"</span>, ignore_case = <span style="color: #228b22;">TRUE</span> ))
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] "I" "i"</span>
str_subset(i, coll(<span style="color: #8b2252;">"i"</span>, ignore_case = <span style="color: #228b22;">TRUE</span> , locale = <span style="color: #8b2252;">"tr"</span>))
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] "&#304;" "i"</span>
</pre>
</div>
</div>
</div>

<div id="org3f66514" class="outline-5">
<h5 id="org3f66514"><span class="section-number-5">12.17.1.4</span> boundary</h5>
<div class="outline-text-5" id="text-12-17-1-4">
<p>
在介绍 str<sub>split</sub>() 函数时，你已经知道可以使用 boundary() 函数来匹配边界。
</p>

<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> <span style="color: #8b2252;">"This is a sentence."</span> 
str_view_all(x, boundary(<span style="color: #8b2252;">"word"</span>))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #008b8b;">library</span>(stringr)
x <span style="color: #008b8b;">&lt;-</span> <span style="color: #8b2252;">"this is a sentence."</span>
str_extract_all(x, boundary(<span style="color: #8b2252;">"word"</span>))
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[1]]</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "this"     "is"       "a"        "sentence"</span>
</pre>
</div>
</div>
</div>

<div id="orga27f153" class="outline-5">
<h5 id="orga27f153"><span class="section-number-5">12.17.1.5</span> 匹配.</h5>
<div class="outline-text-5" id="text-12-17-1-5">
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#26356;&#22797;&#26434;&#19968;&#20123;&#30340;&#27169;&#24335;&#26159;&#20351;&#29992; .&#65292;&#23427;&#21487;&#20197;&#21305;&#37197;&#20219;&#24847;&#23383;&#31526;&#65288;&#38500;&#20102;&#25442;&#34892;&#31526;&#65289;</span>
str_view(x,<span style="color: #8b2252;">".a."</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">\\.&#21305;&#37197;.</span>
x=c(<span style="color: #8b2252;">"b.a"</span>,<span style="color: #8b2252;">"ab"</span>)
str_view(x,<span style="color: #8b2252;">"\\."</span>)  
</pre>
</div>
</div>
</div>
<div id="org3bce782" class="outline-5">
<h5 id="org3bce782"><span class="section-number-5">12.17.1.6</span> 匹配\</h5>
<div class="outline-text-5" id="text-12-17-1-6">
<p>
那么如何匹配\?如果 \ 在正则表达式中用作转义字符，那么如何匹配 \ 这个字符呢？我们还是需要去除其特殊意义，建立形式为 \\ 的正则表达式。要想建立这样的正则表达式，我们需要使用一个字符串，其中还需要对 \ 进行转义。这意味着要想匹配字符 \，我们需要输入 "\\\\
</p>
<div class="org-src-container">
<pre class="src src-R">x=c(<span style="color: #8b2252;">"b.a"</span>,<span style="color: #8b2252;">"ab"</span>,<span style="color: #8b2252;">"a\b"</span>)
str_view(x,<span style="color: #8b2252;">"\\\\"</span>)
</pre>
</div>
</div>
</div>
<div id="org8888e6a" class="outline-5">
<h5 id="org8888e6a"><span class="section-number-5">12.17.1.7</span> 锚点</h5>
<div class="outline-text-5" id="text-12-17-1-7">
<p>
^ 从字符串开头进行匹配
$ 从字符串末尾进行匹配
</p>
</div>
</div>
<div id="orgb26fd51" class="outline-5">
<h5 id="orgb26fd51"><span class="section-number-5">12.17.1.8</span> 匹配多个字符</h5>
<div class="outline-text-5" id="text-12-17-1-8">
<p>
\d:matches any digit.The complement, \D, matches any character that is not a decimal digit.
</p>
<div class="org-src-container">
<pre class="src src-R">str_extract_all(<span style="color: #8b2252;">"1 + 2 = 3"</span>, <span style="color: #8b2252;">"\\d"</span>,simplify = T)
str_extract_all(<span style="color: #8b2252;">"1 + 2 = 3"</span>, <span style="color: #8b2252;">"\\d+"</span>,simplify = T)
str_extract_all(<span style="color: #8b2252;">"1 + 2 = 3"</span>, <span style="color: #8b2252;">"\\D"</span>,simplify = T)
str_extract_all(<span style="color: #8b2252;">"1 + 2 = 3"</span>, <span style="color: #8b2252;">"\\D+"</span>,simplify = T) 
</pre>
</div>
<p>
\s: matches any whitespace.
</p>
<div class="org-src-container">
<pre class="src src-R">(text <span style="color: #008b8b;">&lt;-</span> <span style="color: #8b2252;">"Some  \t badly\n\t\tspaced \f text"</span>)
str_replace_all(text, <span style="color: #8b2252;">"\\s+"</span>,<span style="color: #8b2252;">" "</span>)
str_extract_all(text, <span style="color: #8b2252;">"\\S+"</span>,simplify = T) 
</pre>
</div>
<p>
\p{property name} matches any character with specific unicode property, like \p{Uppercase} or \p{Diacritic}. 
</p>
<div class="org-src-container">
<pre class="src src-R">(text <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #8b2252;">'"Double quotes"'</span>, <span style="color: #8b2252;">"&#171;Guillemet&#187;"</span>, <span style="color: #8b2252;">"&#8220;Fancy quotes&#8221;"</span>))
str_replace_all(text, <span style="color: #8b2252;">"\\p{quotation mark}"</span>, <span style="color: #8b2252;">"'"</span>)  
</pre>
</div>
<p>
\w matches any “word” character, which includes alphabetic characters, marks and decimal numbers. The complement, \W, matches any non-word character.
</p>

<div class="org-src-container">
<pre class="src src-R">str_extract_all(<span style="color: #8b2252;">"Don't eat that!"</span>, <span style="color: #8b2252;">"\\w+"</span>)[[<span style="color: #008b8b;">1</span>]]
<span style="color: #b22222;">#</span><span style="color: #b22222;">"Don"  "t"    "eat"  "that"</span>
str_extract_all(<span style="color: #8b2252;">"Don't eat that!"</span>, <span style="color: #8b2252;">"\\W+"</span>)[[<span style="color: #008b8b;">1</span>]]
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">[1] "'" " " " " "!"</span>
str_split(<span style="color: #8b2252;">"Don't eat that!"</span>, <span style="color: #8b2252;">"\\W"</span>)[[<span style="color: #008b8b;">1</span>]]
str_split(<span style="color: #8b2252;">"Don't eat that!"</span>, <span style="color: #8b2252;">"\\w+"</span>)[[<span style="color: #008b8b;">1</span>]]
</pre>
</div>

<p>
\b matches word boundaries, the transition between word and non-word characters. \B matches the opposite: boundaries that have either both word or non-word characters on either side.
</p>

<div class="org-src-container">
<pre class="src src-R">str_replace_all(<span style="color: #8b2252;">"The quick brown fox"</span>, <span style="color: #8b2252;">"\\b"</span>, <span style="color: #8b2252;">"_"</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "_The_ _quick_ _brown_ _fox_"</span>
str_replace_all(<span style="color: #8b2252;">"The quick brown fox"</span>, <span style="color: #8b2252;">"\\B"</span>, <span style="color: #8b2252;">"_"</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "T_h_e q_u_i_c_k b_r_o_w_n f_o_x"</span>
</pre>
</div>
<p>
[abc]:匹配 a,b,c
[a-z]:匹配每个在 a-z 之间的字符
[<sup>abc</sup>]:匹配 anything 除了 a,b,c
[\^&#x00ad;]:匹配^ 或 -.
There are a number of pre-built classes that you can use inside []:
</p>

<p>
[:punct:]: punctuation.
[:alpha:]: letters.
[:lower:]: lowercase letters.
[:upper:]: upperclass letters.
[:digit:]: digits.
[:xdigit:]: hex digits.
[:alnum:]: letters and numbers.
[:cntrl:]: control characters.
[:graph:]: letters, numbers, and punctuation.
[:print:]: letters, numbers, punctuation, and whitespace.
[:space:]: space characters (basically equivalent to \s).
[:blank:]: space and tab.
</p>
<div class="org-src-container">
<pre class="src src-R">str_view(x,<span style="color: #8b2252;">"^a"</span>)
str_view(x,<span style="color: #8b2252;">"a$"</span>)
str_view(x,<span style="color: #8b2252;">"^b.a$"</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#24378;&#21046;&#27491;&#21017;&#34920;&#36798;&#24335;&#21305;&#37197;&#19968;&#20010;&#23436;&#25972;&#23383;&#31526;&#20018;&#65292;&#21487;&#20197;&#21516;&#26102;&#35774;&#32622;^&#21644;$&#36825;&#20004;&#20010;&#38170;&#28857;        </span>
</pre>
</div>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">is the alternation operator, which will pick between one or more possible matches. For example, abc</td>
<td class="org-left">def will match abc or def.</td>
</tr>
</tbody>
</table>
<div class="org-src-container">
<pre class="src src-R">str_detect(c(<span style="color: #8b2252;">"abc"</span>, <span style="color: #8b2252;">"def"</span>, <span style="color: #8b2252;">"ghi"</span>), <span style="color: #8b2252;">"abc|def"</span>)  
</pre>
</div>

<div class="org-src-container">
<pre class="src src-R">str_extract(c(<span style="color: #8b2252;">"grey"</span>, <span style="color: #8b2252;">"gray"</span>), <span style="color: #8b2252;">"gre|ay"</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "gre" "ay"</span>
str_extract(c(<span style="color: #8b2252;">"grey"</span>, <span style="color: #8b2252;">"gray"</span>), <span style="color: #8b2252;">"gr(e|a)y"</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "grey" "gray"  </span>
</pre>
</div>

<p>
匹配多次重复字符
?:0 次或 1 次
+:1 次或多次
*:0 次或多次
</p>
<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> <span style="color: #8b2252;">"1888 is the longest year in Roman numerals: MDCCCLXXXVIII"</span>
str_view(x,<span style="color: #8b2252;">"CC?"</span>)
str_view(x,<span style="color: #8b2252;">"CC+"</span>)
str_view(x,<span style="color: #8b2252;">"CC*"</span>)
str_view(x,<span style="color: #8b2252;">"C[LX]+"</span>)  
</pre>
</div>

<p>
需要注意这些运算符的优先级非常高，因此使用 colou?r 既可以匹配 color,也可以匹配 colour.这意味着很多时候需要使用括号，比如 bana(na)+.
</p>

<p>
你还可以精确设置匹配的次数：
</p>

<ul class="org-ul">
<li>{n}:匹配 n 次</li>
<li>{n,}:匹配 n 次或更多次</li>
<li>{,m}:最多匹配 m 次</li>
<li>{n,m}:匹配 n 到 m 次</li>
</ul>

<div class="org-src-container">
<pre class="src src-R">str_view(x,<span style="color: #8b2252;">"C{2}"</span>)
str_view(x,<span style="color: #8b2252;">"C{2,}"</span>)
str_view(x,<span style="color: #8b2252;">"C{2,3}"</span>)
str_view(x,<span style="color: #8b2252;">"C{2,3}?"</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#21305;&#37197;&#23613;&#37327;&#30701;&#30340;&#23383;&#31526;&#20018;</span>
str_view(x,<span style="color: #8b2252;">"C[LX]+?"</span>)  
</pre>
</div>
</div>
</div>
</div>

<div id="orge981edf" class="outline-4">
<h4 id="orge981edf"><span class="section-number-4">12.17.2</span> str<sub>c</sub></h4>
<div class="outline-text-4" id="text-12-17-2">
<p>
字符串组合。两个字符串相连。要想组合两个字符或更多的字符串，可以使用 str<sub>c.这个函数就相当于</sub> paste 和 paste0.
</p>
<div class="org-src-container">
<pre class="src src-R">str_c(<span style="color: #8b2252;">"x"</span>,<span style="color: #8b2252;">"y"</span>)
str_c(<span style="color: #8b2252;">"x"</span>,<span style="color: #8b2252;">"y"</span>,sep = <span style="color: #8b2252;">","</span>)
</pre>
</div>

<p>
base 包中 paste0,paste 有两个函数功能与 str<sub>c</sub> 函数相同.需要注意的是，两个函数对缺失值的处理也不相同。
</p>
<div class="org-src-container">
<pre class="src src-R">paste(<span style="color: #8b2252;">"x"</span>,<span style="color: #8b2252;">"y"</span>,<span style="color: #228b22;">NA</span>)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] "x y NA"</span>
paste0(<span style="color: #8b2252;">"x"</span>,<span style="color: #8b2252;">"y"</span>,<span style="color: #228b22;">NA</span>)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] "xyNA"</span>
str_c(<span style="color: #8b2252;">"x"</span>,<span style="color: #8b2252;">"y"</span>,<span style="color: #228b22;">NA_character_</span>)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] NA</span>
str_c(<span style="color: #8b2252;">"x"</span>,<span style="color: #8b2252;">"y"</span>,<span style="color: #228b22;">NA</span>,sep = <span style="color: #8b2252;">" "</span>)  
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] NA</span>
</pre>
</div>

<p>
处理缺失值的时候需要用到 str<sub>replace</sub><sub>na</sub> 函数。
</p>
<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #8b2252;">"abc"</span>,<span style="color: #228b22;">NA</span>)
str_c(<span style="color: #8b2252;">"|-"</span>,x,<span style="color: #8b2252;">"-|"</span>)
str_c(<span style="color: #8b2252;">"|-"</span>,str_replace_na(x),<span style="color: #8b2252;">"-|"</span>)  
</pre>
</div>
<p>
与 if 相结合，长度为 0 的对象会被丢弃。
</p>
<div class="org-src-container">
<pre class="src src-R">name <span style="color: #008b8b;">&lt;-</span> <span style="color: #8b2252;">"Hadley"</span>
time_of_day <span style="color: #008b8b;">&lt;-</span> <span style="color: #8b2252;">"morning"</span>
birthday <span style="color: #008b8b;">&lt;-</span> <span style="color: #228b22;">FALSE</span>
str_c(
    <span style="color: #8b2252;">"Good "</span>,time_of_day,<span style="color: #8b2252;">" "</span>,name,
    <span style="color: #a020f0;">if</span>(birthday) <span style="color: #8b2252;">" and Happy birthday"</span>,
    <span style="color: #8b2252;">"."</span>
)  
</pre>
</div>
<p>
要想将字符向量合并为字符串，可以使用 collapse() 函数.
</p>
<div class="org-src-container">
<pre class="src src-R">str_c(c(<span style="color: #8b2252;">"x"</span>,<span style="color: #8b2252;">"y"</span>),collapse = <span style="color: #8b2252;">", "</span>)
</pre>
</div>
</div>
</div>
<div id="orge926e98" class="outline-4">
<h4 id="orge926e98"><span class="section-number-4">12.17.3</span> str<sub>length</sub></h4>
<div class="outline-text-4" id="text-12-17-3">
<p>
字符长度
</p>
<div class="org-src-container">
<pre class="src src-R">str_length(<span style="color: #8b2252;">"abc"</span>)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] 3</span>
</pre>
</div>
</div>
</div>
<div id="org2fea3cd" class="outline-4">
<h4 id="org2fea3cd"><span class="section-number-4">12.17.4</span> str<sub>sub</sub></h4>
<div class="outline-text-4" id="text-12-17-4">
<p>
字符串取子集。str<sub>sub</sub>()函数中还有 start 和 end 参数，给出了子串的位置。
</p>
<div class="org-src-container">
<pre class="src src-R">       x <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #8b2252;">"abcdef"</span>, <span style="color: #8b2252;">"ghifjk"</span>)
<span style="color: #b22222;"># </span><span style="color: #b22222;">The 3rd letter</span>
       str_sub(x, <span style="color: #008b8b;">3</span>, <span style="color: #008b8b;">3</span>)
                                        <span style="color: #b22222;"># </span><span style="color: #b22222;">The 2nd to 2nd-to-last character</span>
       str_sub(x, <span style="color: #008b8b;">2</span>, -<span style="color: #008b8b;">2</span>)
                                        <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "bcde" "hifj"</span>
       str_sub(x, <span style="color: #008b8b;">3</span>, <span style="color: #008b8b;">3</span>) <span style="color: #008b8b;">&lt;-</span> <span style="color: #8b2252;">"X"</span>
       x
                                        <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "abXdef" "ghXfjk"</span>
</pre>
</div>

<p>
Return the last letter of a string, subset a string.
</p>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#36127;&#25968;&#34920;&#31034;&#20174;&#21518;&#24448;&#21069;&#25968;</span>
stringr::str_sub(c(<span style="color: #8b2252;">"five"</span>, <span style="color: #8b2252;">"six"</span>), -<span style="color: #008b8b;">1</span>)
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "e" "x"</span>
str_sub(x,-<span style="color: #008b8b;">3</span>,-<span style="color: #008b8b;">1</span>)
str_sub(<span style="color: #8b2252;">"a"</span>,<span style="color: #008b8b;">1</span>,<span style="color: #008b8b;">5</span>)
str_sub(x,<span style="color: #008b8b;">1</span>,<span style="color: #008b8b;">1</span>) <span style="color: #008b8b;">&lt;-</span> str_to_lower(str_sub(x,<span style="color: #008b8b;">1</span>,<span style="color: #008b8b;">1</span>))
x
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] "apple"  "banana" "pear"         </span>
</pre>
</div>
</div>
</div>
<div id="org3392852" class="outline-4">
<h4 id="org3392852"><span class="section-number-4">12.17.5</span> str<sub>sort</sub></h4>
<div class="outline-text-4" id="text-12-17-5">
<p>
字符排序。不同语言体系有不同的字符排序方式。
</p>
<div class="org-src-container">
<pre class="src src-R">str_sort(x,locale = <span style="color: #8b2252;">"en"</span>)
str_sort(x,locale = <span style="color: #8b2252;">"haw"</span>)
</pre>
</div>
</div>
</div>
<div id="orgb5ba2c2" class="outline-4">
<h4 id="orgb5ba2c2"><span class="section-number-4">12.17.6</span> str<sub>order</sub></h4>
<div class="outline-text-4" id="text-12-17-6">
<div class="org-src-container">
<pre class="src src-R">str_order(letters, locale = <span style="color: #8b2252;">"en"</span>)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26</span>
</pre>
</div>
</div>
</div>
<div id="orgf38d35f" class="outline-4">
<h4 id="orgf38d35f"><span class="section-number-4">12.17.7</span> str<sub>dup</sub></h4>
<div class="outline-text-4" id="text-12-17-7">
<p>
To duplicate individual strings, you can use str<sub>dup</sub>():
str<sub>dup</sub>(string, times),times:Number of times to duplicate each string.
</p>
<div class="org-src-container">
<pre class="src src-R">str_dup(x, c(<span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">3</span>))
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] "abcdefabcdef"       "ghifjkghifjkghifjk"</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-R">str_dup(<span style="color: #8b2252;">"banana"</span>, <span style="color: #008b8b;">5</span>)
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">[1] "bananabananabananabananabanana"</span>
                                 <span style="color: #b22222;"># </span><span style="color: #b22222;">Or the same!</span>
str_dup(c(<span style="color: #8b2252;">"apple"</span>, <span style="color: #8b2252;">"banana"</span>), <span style="color: #008b8b;">3</span>)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] "appleappleapple"    "bananabananabanana"</span>
</pre>
</div>
</div>
</div>

<div id="org0760677" class="outline-4">
<h4 id="org0760677"><span class="section-number-4">12.17.8</span> str<sub>pad</sub></h4>
<div class="outline-text-4" id="text-12-17-8">
<p>
这个命令就是填补空格键，或者其他模式。这个函数其实是 str<sub>trim</sub> 的逆函数。
str<sub>pad</sub>(string, width, side = c("left", "right", "both"), pad = " ")
str<sub>pad</sub>() pads(填补) a string to a fixed length by adding extra whitespace on the left, right, or both sides.
</p>
<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #8b2252;">"abc"</span>, <span style="color: #8b2252;">"defghi"</span>)
str_pad(x, <span style="color: #008b8b;">10</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">default pads on left</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "       abc" "    defghi"       </span>
</pre>
</div>
</div>
</div>
<div id="orge2d4b46" class="outline-4">
<h4 id="orge2d4b46"><span class="section-number-4">12.17.9</span> str<sub>detect</sub></h4>
<div class="outline-text-4" id="text-12-17-9">
<p>
模式匹配。Control matching behaviour with modifier functions.
fixed Compare literal bytes in the string. This is very fast, but not usually
what you want for non-ASCII character sets. coll Compare strings respecting standard collation rules.
</p>

<p>
regex
The default. Uses ICU regular expressions.
</p>

<p>
boundary
Match boundaries between things.
</p>
<div class="org-src-container">
<pre class="src src-R">pattern <span style="color: #008b8b;">&lt;-</span> <span style="color: #8b2252;">"a.b"</span>
strings <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #8b2252;">"abb"</span>, <span style="color: #8b2252;">"a.b"</span>)
str_detect(strings, pattern)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] TRUE TRUE</span>
i <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #8b2252;">"I"</span>, <span style="color: #8b2252;">"\u0130"</span>, <span style="color: #8b2252;">"i"</span>)
i
str_detect(i, fixed(<span style="color: #8b2252;">"i"</span>, <span style="color: #228b22;">TRUE</span>))
str_detect(i, coll(<span style="color: #8b2252;">"i"</span>, <span style="color: #228b22;">TRUE</span>))
str_detect(i, coll(<span style="color: #8b2252;">"i"</span>, <span style="color: #228b22;">TRUE</span>, locale = <span style="color: #8b2252;">"tr"</span>))
</pre>
</div>

<p>
fixed(),coll() 还是非常管用的！下面这个例子可以说明。
</p>
<div class="org-src-container">
<pre class="src src-R">pattern <span style="color: #008b8b;">&lt;-</span> <span style="color: #8b2252;">"a.b"</span>
strings <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #8b2252;">"abb"</span>, <span style="color: #8b2252;">"a.b"</span>)
str_detect(strings, pattern)
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] TRUE TRUE</span>
str_detect(strings, fixed(pattern))
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] FALSE  TRUE</span>
str_detect(strings, coll(pattern))
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] FALSE  TRUE       </span>
</pre>
</div>
</div>
</div>

<div id="orgbb0a064" class="outline-4">
<h4 id="orgbb0a064"><span class="section-number-4">12.17.10</span> str<sub>remove</sub></h4>
<div class="outline-text-4" id="text-12-17-10">
<p>
Remove matched patterns in a string.
</p>
<div class="org-src-container">
<pre class="src src-R">fruits <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #8b2252;">"one apple"</span>, <span style="color: #8b2252;">"two pears"</span>, <span style="color: #8b2252;">"three bananas"</span>)
str_remove(fruits, <span style="color: #8b2252;">"[aeiou]"</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "ne apple"     "tw pears"     "thre bananas"</span>
str_remove_all(fruits, <span style="color: #8b2252;">"[aeiou]"</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "n ppl"    "tw prs"   "thr bnns"</span>

fruits <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #8b2252;">"o.app.le"</span>, <span style="color: #8b2252;">"two pears"</span>, <span style="color: #8b2252;">"three bananas"</span>)
str_remove(fruits, <span style="color: #8b2252;">"[.]"</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "oapp.le"       "two pears"     "three bananas"</span>
str_remove_all(fruits, <span style="color: #8b2252;">"[.]"</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "oapple"        "two pears"     "three bananas"      </span>
</pre>
</div>
</div>
</div>
<div id="org3895a76" class="outline-4">
<h4 id="org3895a76"><span class="section-number-4">12.17.11</span> str<sub>subset</sub></h4>
<div class="outline-text-4" id="text-12-17-11">
<p>
str<sub>detect</sub> 函数的一种常见用法是选取出匹配某种模式的元素，还可以用 str<sub>subset</sub> 通过逻辑取子集。
</p>
<div class="org-src-container">
<pre class="src src-R">words[str_detect(words,<span style="color: #8b2252;">"x$"</span>)]
str_subset(words,<span style="color: #8b2252;">"x$"</span>)  
</pre>
</div>
</div>
</div>
<div id="org63f9b57" class="outline-4">
<h4 id="org63f9b57"><span class="section-number-4">12.17.12</span> str<sub>count</sub></h4>
<div class="outline-text-4" id="text-12-17-12">
<p>
str<sub>count</sub> 返回的是字符串中匹配的数量。
</p>
<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #8b2252;">"apple"</span>,<span style="color: #8b2252;">"banana"</span>)
str_count(x,<span style="color: #8b2252;">"a"</span>)
</pre>
</div>
</div>
</div>
<div id="org0e034ed" class="outline-4">
<h4 id="org0e034ed"><span class="section-number-4">12.17.13</span> str<sub>view</sub></h4>
<div class="outline-text-4" id="text-12-17-13">
<p>
字符匹配
</p>
<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #8b2252;">"Apple"</span>,<span style="color: #8b2252;">"Banana"</span>,<span style="color: #8b2252;">"Pear"</span>)
str_view(x,<span style="color: #8b2252;">"an"</span>) <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26368;&#22522;&#30784;&#26159;&#31934;&#30830;&#21305;&#37197; </span>
</pre>
</div>
</div>
<div id="orgb52f4a7" class="outline-5">
<h5 id="orgb52f4a7"><span class="section-number-5">12.17.13.1</span> str<sub>view</sub><sub>all</sub></h5>
<div class="outline-text-5" id="text-12-17-13-1">
<p>
注意 str<sub>view</sub><sub>all</sub>() 函数的使用。你很快就会知道，很多 stringr 函数都是成对出现的：一 个函数用于单个匹配，另一个函数用于全部匹配，后者会有后缀 _all。
</p>
<div class="org-src-container">
<pre class="src src-R">str_view(<span style="color: #8b2252;">"abababa"</span>,<span style="color: #8b2252;">"aba"</span>)
str_view_all(<span style="color: #8b2252;">"abababa"</span>,<span style="color: #8b2252;">"aba"</span>)          
</pre>
</div>
</div>
</div>
</div>

<div id="org6a00b6b" class="outline-4">
<h4 id="org6a00b6b"><span class="section-number-4">12.17.14</span> str<sub>to</sub><sub>lower</sub>/str<sub>to</sub><sub>upper</sub></h4>
<div class="outline-text-4" id="text-12-17-14">
<p>
这个函数可以方便地将字符变成大写还是小写。
</p>

<div class="org-src-container">
<pre class="src src-R">str_to_upper(c(<span style="color: #8b2252;">"i"</span>))
str_to_lower(c(<span style="color: #8b2252;">"I"</span>))
</pre>
</div>
</div>
</div>

<div id="org9268437" class="outline-4">
<h4 id="org9268437"><span class="section-number-4">12.17.15</span> str<sub>to</sub><sub>title</sub></h4>
<div class="outline-text-4" id="text-12-17-15">
<div class="org-src-container">
<pre class="src src-R">dog <span style="color: #008b8b;">&lt;-</span> <span style="color: #8b2252;">"The quick brown dog"</span>
str_to_title(dog)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] "The Quick Brown Dog"</span>
</pre>
</div>
</div>
</div>
<div id="orga67815b" class="outline-4">
<h4 id="orga67815b"><span class="section-number-4">12.17.16</span> str<sub>to</sub><sub>sentence</sub></h4>
<div class="outline-text-4" id="text-12-17-16">
<div class="org-src-container">
<pre class="src src-R">str_to_sentence(<span style="color: #8b2252;">"the quick brown dog"</span>)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] "The quick brown dog"</span>
</pre>
</div>
</div>
</div>
<div id="org99919c1" class="outline-4">
<h4 id="org99919c1"><span class="section-number-4">12.17.17</span> str<sub>extract</sub></h4>
<div class="outline-text-4" id="text-12-17-17">
<p>
Extract matching patterns from a string. 可以提取符合特定模式的 string.
</p>
<div class="org-src-container">
<pre class="src src-R">str_extract_all(<span style="color: #8b2252;">"1 + 2 = 3"</span>, <span style="color: #8b2252;">"\\d"</span>,simplify = T)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[,1] [,2] [,3]</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1,] "1"  "2"  "3" </span>
str_extract_all(<span style="color: #8b2252;">"1 + 2 = 3"</span>, <span style="color: #8b2252;">"\\d+"</span>,simplify = T)
str_extract_all(<span style="color: #8b2252;">"1 + 2 = 3"</span>, <span style="color: #8b2252;">"\\D"</span>,simplify = T)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[,1] [,2] [,3] [,4] [,5] [,6]</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1,] " "  "+"  " "  " "  "="  " " </span>
str_extract_all(<span style="color: #8b2252;">"1 + 2 = 3"</span>, <span style="color: #8b2252;">"\\D+"</span>,simplify = T) 
</pre>
</div>
</div>
</div>
<div id="orgd8680ed" class="outline-4">
<h4 id="orgd8680ed"><span class="section-number-4">12.17.18</span> str<sub>match</sub></h4>
<div class="outline-text-4" id="text-12-17-18">
<p>
Extract matched groups from a string.str<sub>match</sub>()函数可以给出每个独立分组，该函数返回的不是字符向量，而是一个矩阵，其中一列是完整匹配，后面的列是每个分组的匹配。
</p>

<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #8b2252;">"&lt;a&gt; &lt;b&gt;"</span>, <span style="color: #8b2252;">"&lt;a&gt; &lt;&gt;"</span>, <span style="color: #8b2252;">"&lt;a&gt;"</span>, <span style="color: #8b2252;">""</span>, <span style="color: #228b22;">NA</span>)
str_match(x, <span style="color: #8b2252;">"&lt;(.*?)&gt; &lt;(.*?)&gt;"</span>)  
</pre>
</div>
</div>
</div>
<div id="orge460b60" class="outline-4">
<h4 id="orge460b60"><span class="section-number-4">12.17.19</span> str<sub>which</sub></h4>
<div class="outline-text-4" id="text-12-17-19">
<p>
输出匹配到字符的位置。
</p>
<div class="org-src-container">
<pre class="src src-R">fruit <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #8b2252;">"apple"</span>, <span style="color: #8b2252;">"banana"</span>, <span style="color: #8b2252;">"pear"</span>, <span style="color: #8b2252;">"pinapple"</span>)
str_which(fruit, <span style="color: #8b2252;">"a"</span>)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] 1 2 3 4 #&#36825;&#35828;&#26126;&#25152;&#26377;&#30340;&#23383;&#31526;&#37117;&#26377;&#8220;a&#8221;</span>
fruit <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #8b2252;">"apple"</span>, <span style="color: #8b2252;">"hdos"</span>)
str_which(fruit, <span style="color: #8b2252;">"a"</span>,negate = <span style="color: #228b22;">TRUE</span>)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] 2 #&#36825;&#35828;&#26126;&#31532;2&#20010;&#23383;&#31526;&#27809;&#26377;&#8220;a&#8221;&#12290;</span>
</pre>
</div>
</div>
</div>
<div id="orgbd4b9cc" class="outline-4">
<h4 id="orgbd4b9cc"><span class="section-number-4">12.17.20</span> str<sub>replace</sub></h4>
<div class="outline-text-4" id="text-12-17-20">
<p>
str<sub>replace</sub>(string, pattern, replacement),str<sub>replace</sub><sub>all</sub>(string, pattern, replacement).
</p>

<p>
Replace matched patterns in a string.
</p>
<div class="org-src-container">
<pre class="src src-R">fruits <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #8b2252;">"one apple"</span>, <span style="color: #8b2252;">"two pears"</span>, <span style="color: #8b2252;">"three bananas"</span>)
str_replace(fruits, <span style="color: #8b2252;">"[aeiou]"</span>, <span style="color: #8b2252;">"-"</span>)
</pre>
</div>
</div>
<div id="orgdd9773f" class="outline-5">
<h5 id="orgdd9773f"><span class="section-number-5">12.17.20.1</span> str<sub>replace</sub><sub>all</sub></h5>
<div class="outline-text-5" id="text-12-17-20-1">
<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #8b2252;">"apple"</span>, <span style="color: #8b2252;">"pear"</span>, <span style="color: #8b2252;">"banana"</span>) 
str_replace(x, <span style="color: #8b2252;">"[aeiou]"</span>, <span style="color: #8b2252;">"-"</span>)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] "-pple"  "p-ar"   "b-nana"</span>
str_replace_all(x, <span style="color: #8b2252;">"[aeiou]"</span>, <span style="color: #8b2252;">"-"</span>)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] "-ppl-"  "p--r"   "b-n-n-"</span>
(text <span style="color: #008b8b;">&lt;-</span> <span style="color: #8b2252;">"Some  \t badly\n\t\tspaced \f text"</span>)
str_replace_all(text, <span style="color: #8b2252;">"\\s+"</span>,<span style="color: #8b2252;">" "</span>)        
</pre>
</div>

<p>
主要喜欢这个正则匹配模式。
</p>

<div class="org-src-container">
<pre class="src src-R">c(<span style="color: #8b2252;">"Var 1"</span>, <span style="color: #8b2252;">"Var-2"</span>, <span style="color: #8b2252;">"Var.3"</span>, <span style="color: #8b2252;">"Var4"</span>) <span style="color: #008b8b;">%&gt;%</span>
    stringr::str_replace_all(<span style="color: #8b2252;">"\\s|-|\\."</span>, <span style="color: #8b2252;">"_"</span>) <span style="color: #008b8b;">%&gt;%</span> 
    stringr::str_to_lower()
                               <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "var_1" "var_2" "var_3" "var4"         </span>
</pre>
</div>


<p>
在 base R 版本中有 chartr(old, new, x) 函数指定一个字符型对应关系，旧字符在 old
中，新字符在 new 中。
</p>

<div class="org-src-container">
<pre class="src src-R">chartr(<span style="color: #8b2252;">"!;"</span>, <span style="color: #8b2252;">".,"</span>, c(<span style="color: #8b2252;">"Hi; boy!"</span>, <span style="color: #8b2252;">"How do you do!"</span>))  
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] "Hi, boy."       "How do you do."</span>
chartr(<span style="color: #8b2252;">"&#12290;&#65292;&#65307;&#21439;"</span>, <span style="color: #8b2252;">".,;&#21306;"</span>, <span style="color: #8b2252;">"&#26124;&#24179;&#21439;&#65292;&#22823;&#20852;&#21439;&#65307;&#22266;&#23433;&#21439;&#12290;"</span>)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] "&#26124;&#24179;&#21306;,&#22823;&#20852;&#21306;;&#22266;&#23433;&#21306;."</span>
</pre>
</div>
</div>
</div>
</div>

<div id="org7c16ca7" class="outline-4">
<h4 id="org7c16ca7"><span class="section-number-4">12.17.21</span> str<sub>split</sub></h4>
<div class="outline-text-4" id="text-12-17-21">
<p>
str<sub>split</sub>()函数可以将字符串拆分为多个片段。通过设置 simplify=TRUE 返回一个矩阵。
</p>
<div class="org-src-container">
<pre class="src src-R">sentences <span style="color: #008b8b;">%&gt;%</span> 
    head(<span style="color: #008b8b;">5</span>) <span style="color: #008b8b;">%&gt;%</span> 
    str_split(<span style="color: #8b2252;">" "</span>)
sentences <span style="color: #008b8b;">%&gt;%</span> 
    head(<span style="color: #008b8b;">5</span>) <span style="color: #008b8b;">%&gt;%</span> 
    str_split(<span style="color: #8b2252;">" "</span>,simplify = <span style="color: #228b22;">TRUE</span>)
</pre>
</div>

<p>
还可以设定拆分片段的最大数量：
</p>
<div class="org-src-container">
<pre class="src src-R">fields <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #8b2252;">"Name: Hadley"</span>, <span style="color: #8b2252;">"Country: NZ"</span>, <span style="color: #8b2252;">"Age: 35"</span>) 
fields <span style="color: #008b8b;">%&gt;%</span> str_split(<span style="color: #8b2252;">": "</span>, n = <span style="color: #008b8b;">2</span>, simplify = <span style="color: #228b22;">TRUE</span> )
</pre>
</div>
</div>
</div>
<div id="org25ed4fe" class="outline-4">
<h4 id="org25ed4fe"><span class="section-number-4">12.17.22</span> str<sub>split</sub><sub>fixed</sub></h4>
<div class="outline-text-4" id="text-12-17-22">
<div class="org-src-container">
<pre class="src src-R">fruits <span style="color: #008b8b;">&lt;-</span> c(
    <span style="color: #8b2252;">"apples and oranges and pears and bananas"</span>,
    <span style="color: #8b2252;">"pineapples and mangos and guavas"</span>
)
str_split_fixed(fruits, <span style="color: #8b2252;">" and "</span>, <span style="color: #008b8b;">3</span>)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[,1]         [,2]      [,3]               </span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1,] "apples"     "oranges" "pears and bananas"</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">[2,] "pineapples" "mangos"  "guavas" </span>
str_split_fixed(fruits, <span style="color: #8b2252;">" and "</span>, <span style="color: #008b8b;">4</span>)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[,1]         [,2]      [,3]     [,4]     </span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1,] "apples"     "oranges" "pears"  "bananas"</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">[2,] "pineapples" "mangos"  "guavas" ""   </span>
</pre>
</div>
</div>
</div>

<div id="org288e66f" class="outline-4">
<h4 id="org288e66f"><span class="section-number-4">12.17.23</span> str<sub>locate</sub></h4>
<div class="outline-text-4" id="text-12-17-23">
<p>
str<sub>locate</sub>() 和 str<sub>locate</sub><sub>all</sub>() 函数可以给出每个匹配的开始位置和结束位置。当没有 其他函数能够精确地满足需求时，这两个函数特别有用。你可以使用 str<sub>locate</sub>() 函数找 出匹配的模式，然后使用 str<sub>sub</sub>() 函数来提取或修改匹配的内容。
</p>
<div class="org-src-container">
<pre class="src src-R">fruit <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #8b2252;">"apple"</span>, <span style="color: #8b2252;">"banana"</span>, <span style="color: #8b2252;">"pear"</span>, <span style="color: #8b2252;">"pineapple"</span>)
str_locate(fruit, <span style="color: #8b2252;">"$"</span>)
str_locate(fruit, <span style="color: #8b2252;">"a"</span>)      
</pre>
</div>
</div>
</div>
<div id="orgc9d78f7" class="outline-4">
<h4 id="orgc9d78f7"><span class="section-number-4">12.17.24</span> str<sub>wrap</sub></h4>
<div class="outline-text-4" id="text-12-17-24">
<p>
Wrap strings into nicely formatted paragraphs.
</p>
<div class="org-src-container">
<pre class="src src-R">thanks_path <span style="color: #008b8b;">&lt;-</span> file.path(R.home(<span style="color: #8b2252;">"doc"</span>), <span style="color: #8b2252;">"THANKS"</span>)
thanks <span style="color: #008b8b;">&lt;-</span> str_c(readLines(thanks_path), collapse = <span style="color: #8b2252;">"\n"</span>)
thanks <span style="color: #008b8b;">&lt;-</span> word(thanks, <span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">3</span>, fixed(<span style="color: #8b2252;">"\n\n"</span>))
cat(str_wrap(thanks), <span style="color: #8b2252;">"\n"</span>)
cat(str_wrap(thanks, width = <span style="color: #008b8b;">40</span>), <span style="color: #8b2252;">"\n"</span>)       
</pre>
</div>
</div>
</div>
<div id="orge99d91e" class="outline-4">
<h4 id="orge99d91e"><span class="section-number-4">12.17.25</span> str<sub>trim</sub></h4>
<div class="outline-text-4" id="text-12-17-25">
<p>
这个函数可以取出字符串中的空白格。
str<sub>trim</sub>() removes whitespace from start and end of string; str<sub>squish</sub>() also reduces repeated whitespace inside a string.str<sub>trim</sub> 不光能够处理空格符，还能处理\n,\t 这些转义符。
</p>
<div class="org-src-container">
<pre class="src src-R">str_trim(<span style="color: #8b2252;">"  String with trailing and leading white space\t"</span>)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] "String with trailing and leading white space"</span>
str_trim(<span style="color: #8b2252;">"\n\nString with trailing and leading white space\n\n"</span>)  
</pre>
</div>
</div>
</div>
<div id="orgebda3d2" class="outline-4">
<h4 id="orgebda3d2"><span class="section-number-4">12.17.26</span> str<sub>starts</sub></h4>
<div class="outline-text-4" id="text-12-17-26">
<p>
Detect the presence or absence of a pattern at the beginning or end of a string.str<sub>starts</sub>(string, pattern) 判断 string 的每个元素是否以模式 pattern 开头，加选项 negate = T 表示输出反面结果，pattern 是正则表达式，如果需要用非正则表达式，可以用 fixed() 或 coll() 保护。
</p>
<div class="org-src-container">
<pre class="src src-R">fruit <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #8b2252;">"apple"</span>, <span style="color: #8b2252;">"banana"</span>, <span style="color: #8b2252;">"pear"</span>, <span style="color: #8b2252;">"pinapple"</span>)
str_starts(fruit, <span style="color: #8b2252;">"p"</span>)
str_starts(fruit, <span style="color: #8b2252;">"p"</span>,negate = T)      
</pre>
</div>

<div class="org-src-container">
<pre class="src src-R">str_starts(c(<span style="color: #8b2252;">"xyz123"</span>, <span style="color: #8b2252;">"tu004"</span>), fixed(<span style="color: #8b2252;">"tu"</span>))
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] FALSE  TRUE</span>
</pre>
</div>
</div>
</div>

<div id="org6e0aac5" class="outline-4">
<h4 id="org6e0aac5"><span class="section-number-4">12.17.27</span> str<sub>end</sub></h4>
<div class="outline-text-4" id="text-12-17-27">
<div class="org-src-container">
<pre class="src src-R">fruit <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #8b2252;">"apple"</span>, <span style="color: #8b2252;">"banana"</span>, <span style="color: #8b2252;">"pear"</span>, <span style="color: #8b2252;">"pinapple"</span>)
str_ends(fruit, <span style="color: #8b2252;">"e"</span>)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1]  TRUE FALSE FALSE  TRUE</span>
str_ends(fruit, <span style="color: #8b2252;">"e"</span>,negate = <span style="color: #228b22;">TRUE</span>)
</pre>
</div>
</div>
</div>
<div id="orgc9cb431" class="outline-4">
<h4 id="orgc9cb431"><span class="section-number-4">12.17.28</span> grepl</h4>
<div class="outline-text-4" id="text-12-17-28">
<p>
在 grepl()函数中加 fixed=TRUE 选项表示查找一般文本内容（非正则表达式）。
</p>
</div>
</div>

<div id="org7572334" class="outline-4">
<h4 id="org7572334"><span class="section-number-4">12.17.29</span> str<sub>glue</sub></h4>
<div class="outline-text-4" id="text-12-17-29">
<p>
Format and interpolate a string with glue。These functions are wrappers around
glue::glue() and glue::glue<sub>data</sub>(), which provide a powerful and elegant syntax
for interpolating strings. These wrappers provide a small set of the full
options. Use the functions directly from glue for more control.
str<sub>glue</sub> 提供了字符串插值的功能。
str<sub>glue</sub>(&#x2026;, .sep = "", .envir = parent.frame())
str<sub>glue</sub><sub>data</sub>(.x, &#x2026;, .sep = "", .envir = parent.frame(),
  .na = "NA")
</p>

<div class="org-src-container">
<pre class="src src-R">name <span style="color: #008b8b;">&lt;-</span> <span style="color: #8b2252;">"Fred"</span>
age <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">50</span>
anniversary <span style="color: #008b8b;">&lt;-</span> as.Date(<span style="color: #8b2252;">"1991-10-12"</span>)
str_glue(
    <span style="color: #8b2252;">"My name is {name}, "</span>,
    <span style="color: #8b2252;">"my age next year is {age + 1}, "</span>,
    <span style="color: #8b2252;">"and my anniversary is {format(anniversary, '%A, %B %d, %Y')}."</span>
)
                                  <span style="color: #b22222;"># </span><span style="color: #b22222;">single braces can be inserted by doubling them</span>
str_glue(<span style="color: #8b2252;">"My name is {name}, not {{name}}."</span>)      
</pre>
</div>
</div>
</div>
<div id="org59b48d3" class="outline-4">
<h4 id="org59b48d3"><span class="section-number-4">12.17.30</span> str<sub>glue</sub><sub>data</sub></h4>
<div class="outline-text-4" id="text-12-17-30">
<div class="org-src-container">
<pre class="src src-R">mtcars <span style="color: #008b8b;">%&gt;%</span> str_glue_data(<span style="color: #8b2252;">"{rownames(.)} has {hp} hp"</span>)      
</pre>
</div>

<p>
stringr::str<sub>glue</sub><sub>data</sub>() 则以一个包含变量定义的对象.x 为第一自变量，类型可以是环境、列表、数据框等。
</p>

<div class="org-src-container">
<pre class="src src-R">str_glue_data(list(name = <span style="color: #8b2252;">"&#29579;&#20116;"</span>, tele = <span style="color: #8b2252;">"13500000000"</span>),
              <span style="color: #8b2252;">"&#22995;&#21517;: {name}"</span>, <span style="color: #8b2252;">"&#30005;&#35805;&#21495;&#30721;: {tele}"</span>, .sep=<span style="color: #8b2252;">"; "</span>)
<span style="color: #b22222;">## </span><span style="color: #b22222;">&#22995;&#21517;: &#29579;&#20116;; &#30005;&#35805;&#21495;&#30721;: 13500000000</span>
</pre>
</div>
</div>
</div>
<div id="org1ef6e01" class="outline-4">
<h4 id="org1ef6e01"><span class="section-number-4">12.17.31</span> str<sub>squish</sub></h4>
<div class="outline-text-4" id="text-12-17-31">
<p>
 str<sub>squish</sub>() also reduces repeated whitespace inside a string.
对字符型向量 string 每个元素，删去首尾空格，将重复空格变成单个，返回变换后的结果。
</p>
     str_squish("\n\nString with excess,  trailing and leading white   space\n\n")
# [1] "String with excess, trailing and leading white space"

<div class="org-src-container">
<pre class="src src-R">str_squish(c(<span style="color: #8b2252;">"  &#26446;&#26126;"</span>, <span style="color: #8b2252;">"&#26446;&#26126;  "</span>, <span style="color: #8b2252;">"  &#26446;&#26126;  "</span>, <span style="color: #8b2252;">"&#26446;  &#26126;"</span>))
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] "&#26446;&#26126;"  "&#26446;&#26126;"  "&#26446;&#26126;"  "&#26446; &#26126;"</span>
</pre>
</div>

<p>
为了去掉输入字符串中所有空格，可以用 gsub() 替换功能，如
</p>
<div class="org-src-container">
<pre class="src src-R">gsub(<span style="color: #8b2252;">" "</span>, <span style="color: #8b2252;">""</span>, c(<span style="color: #8b2252;">"  &#26446;&#26126;"</span>, <span style="color: #8b2252;">"&#26446;&#26126;  "</span>, <span style="color: #8b2252;">"  &#26446;&#26126;  "</span>, <span style="color: #8b2252;">"&#26446;  &#26126;"</span>), fixed=<span style="color: #228b22;">TRUE</span>)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] "&#26446;&#26126;" "&#26446;&#26126;" "&#26446;&#26126;" "&#26446;&#26126;"</span>
</pre>
</div>
</div>
</div>

<div id="org800c74b" class="outline-4">
<h4 id="org800c74b"><span class="section-number-4">12.17.32</span> str<sub>flatten</sub></h4>
<div class="outline-text-4" id="text-12-17-32">
<div class="org-src-container">
<pre class="src src-R">str_flatten(letters, <span style="color: #8b2252;">""</span>)
<span style="color: #b22222;">#</span><span style="color: #b22222;">[1] "abcdefghijklmnopqrstuvwxyz"</span>
</pre>
</div>
</div>
</div>
<div id="orge20da17" class="outline-4">
<h4 id="orge20da17"><span class="section-number-4">12.17.33</span> word</h4>
<div class="outline-text-4" id="text-12-17-33">
<p>
Extract words from a sentence.
</p>
<div class="org-src-container">
<pre class="src src-R">sentences <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #8b2252;">"Jane saw a cat"</span>, <span style="color: #8b2252;">"Jane sat down"</span>)
word(sentences, <span style="color: #008b8b;">1</span>)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] "Jane" "Jane"</span>
word(sentences,<span style="color: #008b8b;">2</span>)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] "saw" "sat"</span>
str <span style="color: #008b8b;">&lt;-</span> <span style="color: #8b2252;">'abc.def..123.4568.999'</span>
word(str, <span style="color: #008b8b;">1</span>, sep = fixed(<span style="color: #8b2252;">'..'</span>))
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] "abc.def"</span>
word(str, <span style="color: #008b8b;">2</span>, sep = fixed(<span style="color: #8b2252;">'..'</span>))
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] "123.4568.999"</span>
</pre>
</div>

<p>
Return the first two words of a string.
</p>
<div class="org-src-container">
<pre class="src src-R">stringr::word(<span style="color: #8b2252;">"Hello, how are you?"</span>, <span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">3</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "Hello, how"</span>
</pre>
</div>
</div>
</div>

<div id="org97db18b" class="outline-4">
<h4 id="org97db18b"><span class="section-number-4">12.17.34</span> invert<sub>match</sub></h4>
<div class="outline-text-4" id="text-12-17-34">
<p>
Invert a matrix of match locations to match the opposite of what was previously matched.
</p>
<div class="org-src-container">
<pre class="src src-R">numbers <span style="color: #008b8b;">&lt;-</span> <span style="color: #8b2252;">"1 and 2 and 4 and 456"</span>
num_loc <span style="color: #008b8b;">&lt;-</span> str_locate_all(numbers, <span style="color: #8b2252;">"[0-9]+"</span>)[[<span style="color: #008b8b;">1</span>]]
str_sub(numbers, num_loc[, <span style="color: #8b2252;">"start"</span>], num_loc[, <span style="color: #8b2252;">"end"</span>])

text_loc <span style="color: #008b8b;">&lt;-</span> invert_match(num_loc)
str_sub(numbers, text_loc[, <span style="color: #8b2252;">"start"</span>], text_loc[, <span style="color: #8b2252;">"end"</span>])
</pre>
</div>
</div>
</div>
</div>
<div id="orgd6c6054" class="outline-3">
<h3 id="orgd6c6054"><span class="section-number-3">12.18</span> stringi</h3>
<div class="outline-text-3" id="text-12-18">
<p>
这个包含有更多地处理 string 格式的数据。
</p>
</div>
<div id="org2988f47" class="outline-4">
<h4 id="org2988f47"><span class="section-number-4">12.18.1</span> stri<sub>extract</sub><sub>all</sub><sub>words</sub></h4>
<div class="outline-text-4" id="text-12-18-1">
<div class="org-src-container">
<pre class="src src-R">stri_extract_all_words(<span style="color: #8b2252;">"Lorem ipsum dolor sit amet"</span>)
                                     <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[1]]</span>
                                     <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "Lorem" "ipsum" "dolor" "sit"   "amet"</span>
</pre>
</div>
</div>
</div>
<div id="orgba23ec0" class="outline-4">
<h4 id="orgba23ec0"><span class="section-number-4">12.18.2</span> stri<sub>flatten</sub></h4>
<div class="outline-text-4" id="text-12-18-2">
<p>
Flatten a String.
</p>
</div>
</div>
<div id="orgb464ddb" class="outline-4">
<h4 id="orgb464ddb"><span class="section-number-4">12.18.3</span> stri<sub>rand</sub><sub>strings</sub></h4>
<div class="outline-text-4" id="text-12-18-3">
<p>
可以随机生成 string,stri<sub>rand</sub><sub>strings</sub>(n, length, pattern = "[A-Za-z0-9]").
</p>
<div class="org-src-container">
<pre class="src src-R">stri_rand_strings(<span style="color: #008b8b;">5</span>, <span style="color: #008b8b;">10</span>)
<span style="color: #b22222;">#</span><span style="color: #b22222;">[1] "Z2yoKl6KlW" "Om44P7Ycqh" "p346SacVaO"</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">[4] "6Cu4hOcZGU" "c90KRaf6c9"</span>
</pre>
</div>
</div>
</div>
<div id="orgd9fd732" class="outline-4">
<h4 id="orgd9fd732"><span class="section-number-4">12.18.4</span> stri<sub>reverse</sub></h4>
<div class="outline-text-4" id="text-12-18-4">
<p>
Reverses the order of the code points in every string.
</p>

<div class="org-src-container">
<pre class="src src-R">stri_reverse(c(<span style="color: #8b2252;">"123"</span>, <span style="color: #8b2252;">"abc d e f"</span>))
<span style="color: #b22222;">#</span><span style="color: #b22222;">[1] "321"       "f e d cba"</span>
</pre>
</div>
</div>
</div>
</div>
<div id="orga1e84cd" class="outline-3">
<h3 id="orga1e84cd"><span class="section-number-3">12.19</span> assertthat</h3>
<div class="outline-text-3" id="text-12-19">
</div>
<div id="org0498383" class="outline-4">
<h4 id="org0498383"><span class="section-number-4">12.19.1</span> has<sub>name</sub></h4>
<div class="outline-text-4" id="text-12-19-1">
<p>
可以检查是否有 attribute or name?
</p>
<div class="org-src-container">
<pre class="src src-R">y <span style="color: #008b8b;">&lt;-</span> list(a = <span style="color: #008b8b;">1</span>, b = <span style="color: #008b8b;">2</span>)
y <span style="color: #008b8b;">%has_name%</span> <span style="color: #8b2252;">"c"</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] FALSE</span>
</pre>
</div>
</div>
</div>
<div id="orgcb6fcc4" class="outline-4">
<h4 id="orgcb6fcc4"><span class="section-number-4">12.19.2</span> has<sub>attr</sub></h4>
<div class="outline-text-4" id="text-12-19-2">
<p>
Has attribute or name?
</p>
<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">10</span>
x <span style="color: #008b8b;">%has_attr%</span> <span style="color: #8b2252;">"a"</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] FALSE  </span>
</pre>
</div>
</div>
</div>

<div id="org1cb559f" class="outline-4">
<h4 id="org1cb559f"><span class="section-number-4">12.19.3</span> assert-is</h4>
<div class="outline-text-4" id="text-12-19-3">
<p>
该函数可以检查是否有错误信息。is.error(x)/is.time(x)/is.date(x).
</p>
<div class="org-src-container">
<pre class="src src-R">a <span style="color: #008b8b;">&lt;-</span> Sys.time()
is.time(a)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] TRUE</span>
b <span style="color: #008b8b;">&lt;-</span> Sys.Date()
is.date(b)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] TRUE</span>
c <span style="color: #008b8b;">&lt;-</span> try(<span style="color: #a020f0;">stop</span>(<span style="color: #8b2252;">"!!"</span>))
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Error in try(stop("!!")) : !!</span>
is.error(c)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] TRUE </span>
</pre>
</div>
</div>
</div>

<div id="org4429b95" class="outline-4">
<h4 id="org4429b95"><span class="section-number-4">12.19.4</span> assert<sub>that</sub></h4>
<div class="outline-text-4" id="text-12-19-4">
</div>
<div id="orga6f4963" class="outline-5">
<h5 id="orga6f4963"><span class="section-number-5">12.19.4.1</span> assert<sub>that</sub></h5>
<div class="outline-text-5" id="text-12-19-4-1">
<div class="org-src-container">
<pre class="src src-R">assert_that(length(x) == <span style="color: #008b8b;">3</span>)
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Error: length(x) not equal to 3 </span>
</pre>
</div>
</div>
</div>

<div id="org6a24bca" class="outline-5">
<h5 id="org6a24bca"><span class="section-number-5">12.19.4.2</span> see<sub>if</sub></h5>
<div class="outline-text-5" id="text-12-19-4-2">
<div class="org-src-container">
<pre class="src src-R">see_if(is.character(x))
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] FALSE</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; attr(,"msg")</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "x is not a character vector" </span>
</pre>
</div>
</div>
</div>
</div>

<div id="orga6635dd" class="outline-4">
<h4 id="orga6635dd"><span class="section-number-4">12.19.5</span> not<sub>empty</sub></h4>
<div class="outline-text-4" id="text-12-19-5">
<div class="org-src-container">
<pre class="src src-R">    not_empty(numeric())
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] FALSE</span>
</pre>
</div>
</div>
</div>

<div id="orgc9e1427" class="outline-4">
<h4 id="orgc9e1427"><span class="section-number-4">12.19.6</span> noNA</h4>
<div class="outline-text-4" id="text-12-19-6">
<div class="org-src-container">
<pre class="src src-R">see_if(noNA(<span style="color: #8b2252;">"a"</span>))
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] TRUE    </span>
</pre>
</div>
</div>
</div>

<div id="orge0f1edf" class="outline-4">
<h4 id="orge0f1edf"><span class="section-number-4">12.19.7</span> is<sub>dir</sub></h4>
<div class="outline-text-4" id="text-12-19-7">
<div class="org-src-container">
<pre class="src src-R">tmp <span style="color: #008b8b;">&lt;-</span> tempfile()
see_if(file.exists(tmp))
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] FALSE</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; attr(,"msg")</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "Path 'C:\\Users\\tonylu\\AppData\\Local\\Temp\\RtmpyURS1m\\file48986f6775dd' does not exist"</span>
see_if(is.dir(tmp))
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] FALSE</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; attr(,"msg")</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "Path 'C:\\Users\\tonylu\\AppData\\Local\\Temp\\RtmpyURS1m\\file48986f6775dd' does not exist"    </span>
</pre>
</div>
</div>
</div>
</div>

<div id="orge1605da" class="outline-3">
<h3 id="orge1605da"><span class="section-number-3">12.20</span> parallel</h3>
<div class="outline-text-3" id="text-12-20">
</div>
<div id="org5cb5d23" class="outline-4">
<h4 id="org5cb5d23"><span class="section-number-4">12.20.1</span> clusterApply</h4>
<div class="outline-text-4" id="text-12-20-1">
<div class="org-src-container">
<pre class="src src-R">cl <span style="color: #008b8b;">&lt;-</span> makeCluster(getOption(<span style="color: #8b2252;">"cl.cores"</span>, <span style="color: #008b8b;">2</span>))
clusterApply(cl, <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">2</span>, get(<span style="color: #8b2252;">"+"</span>), <span style="color: #008b8b;">3</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[1]]</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 4</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[2]]</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 5</span>
xx <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">1</span>
clusterExport(cl, <span style="color: #8b2252;">"xx"</span>)
clusterCall(cl, <span style="color: #a020f0;">function</span>(y) xx + y, <span style="color: #008b8b;">2</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[1]]</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 3</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[2]]</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 3      </span>
</pre>
</div>
</div>
</div>
</div>

<div id="org5c681d3" class="outline-3">
<h3 id="org5c681d3"><span class="section-number-3">12.21</span> rlang</h3>
<div class="outline-text-3" id="text-12-21">
<p>
rlang 包的思想就是元编程，认为 code is data.
</p>
</div>
<div id="org8c903a5" class="outline-4">
<h4 id="org8c903a5"><span class="section-number-4">12.21.1</span> vocabulary</h4>
<div class="outline-text-4" id="text-12-21-1">
</div>
<div id="org7714e82" class="outline-5">
<h5 id="org7714e82"><span class="section-number-5">12.21.1.1</span> symbol</h5>
<div class="outline-text-5" id="text-12-21-1-1">
<p>
A symbol represents the name of an object like x, mtcars, or mean. 
Base R, is.name() == is.symbole().
Is object a symbol? a name that represents a value or object stored in R.
</p>

<p>
you can turn a symbol back into a string with as.character() or rlang::as<sub>string</sub>().
</p>

<div class="org-src-container">
<pre class="src src-R">is_symbol(expr(pi))
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] TRUE       </span>
</pre>
</div>
</div>
</div>

<div id="orga8fe885" class="outline-5">
<h5 id="orga8fe885"><span class="section-number-5">12.21.1.2</span> environment</h5>
<div class="outline-text-5" id="text-12-21-1-2">
<p>
我以前一直不知道环境的重要性！直到遇到了以下的情况！！
</p>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #0000ff;">group_func</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>(.data, var) {
    list(.data <span style="color: #008b8b;">%&gt;%</span>
         group_by(var), current = rlang::current_env(), caller = rlang::caller_env())
}
group_func(mtcars, var = mpg)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Error: Column `var` is unknown  </span>
</pre>
</div>

<p>
从这个例子可以看出，在 group<sub>func</sub> 函数环境中，没有 var 这个变量，所以无法识别 var,所以需要借助 rlang::enquo.
</p>

<div class="org-src-container">
<pre class="src src-R"> <span style="color: #0000ff;">group_func</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>(.data, var) {
  var <span style="color: #008b8b;">&lt;-</span> enquo(var)
  list(.data <span style="color: #008b8b;">%&gt;%</span>
    group_by({
      {
        var
      }
    }), current = rlang::current_env(), caller = rlang::caller_env())
}
group_func(mtcars, mpg) <span style="color: #008b8b;">%&gt;%</span> head()
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[1]]</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; # A tibble: 32 x 11</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; # Groups:   mpg [25]</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;      mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  * &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  1  21       6  160    110  3.9   2.62  16.5     0     1     4     4</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  2  21       6  160    110  3.9   2.88  17.0     0     1     4     4</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  3  22.8     4  108     93  3.85  2.32  18.6     1     1     4     1</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  4  21.4     6  258    110  3.08  3.22  19.4     1     0     3     1</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  5  18.7     8  360    175  3.15  3.44  17.0     0     0     3     2</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  6  18.1     6  225    105  2.76  3.46  20.2     1     0     3     1</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  7  14.3     8  360    245  3.21  3.57  15.8     0     0     3     4</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  8  24.4     4  147.    62  3.69  3.19  20       1     0     4     2</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  9  22.8     4  141.    95  3.92  3.15  22.9     1     0     4     2</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 10  19.2     6  168.   123  3.92  3.44  18.3     1     0     4     4</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; # ... with 22 more rows</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; $current</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; &lt;environment: 0x00000000131c80d8&gt;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; $caller</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; &lt;environment: R_GlobalEnv&gt; </span>
</pre>
</div>


<p>
a list-like object that binds symbols (names) to objects stored in memory. Each env contains a link to a second, parent env, which creates a chain, or search path, of environments. is<sub>environment</sub>(current<sub>env</sub>()).
</p>
<div class="org-src-container">
<pre class="src src-R">caller_env(n=<span style="color: #008b8b;">1</span>)
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; &lt;environment: 0x7fdf57145ce0&gt;</span>
env <span style="color: #008b8b;">&lt;-</span> env(a = <span style="color: #008b8b;">1</span>, b = <span style="color: #8b2252;">"foo"</span>)
env$b
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "foo"</span>
identical(env_parent(env), current_env())
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] TRUE</span>

env <span style="color: #008b8b;">&lt;-</span> env(base_env(), a = <span style="color: #008b8b;">1</span>, b = <span style="color: #8b2252;">"foo"</span>)
identical(env_parent(env), base_env())
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] TRUE</span>

                                 <span style="color: #b22222;"># </span><span style="color: #b22222;">child_env() lets you specify a parent:</span>
child <span style="color: #008b8b;">&lt;-</span> child_env(env, c = <span style="color: #8b2252;">"bar"</span>)
identical(env_parent(child), env)
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] TRUE</span>

                                 <span style="color: #b22222;"># </span><span style="color: #b22222;">This child environment owns `c` but inherits `a` and `b` from `env`:</span>
env_has(child, c(<span style="color: #8b2252;">"a"</span>, <span style="color: #8b2252;">"b"</span>, <span style="color: #8b2252;">"c"</span>, <span style="color: #8b2252;">"d"</span>))
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;     a     b     c     d </span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; FALSE FALSE  TRUE FALSE</span>
env_has(child, c(<span style="color: #8b2252;">"a"</span>, <span style="color: #8b2252;">"b"</span>, <span style="color: #8b2252;">"c"</span>, <span style="color: #8b2252;">"d"</span>), inherit = <span style="color: #228b22;">TRUE</span>)
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;     a     b     c     d </span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  TRUE  TRUE  TRUE FALSE</span>
<span style="color: #0000ff;">fn</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>() list(current = current_env(), caller = caller_env())
                                 <span style="color: #b22222;"># </span><span style="color: #b22222;">The current environment is an unique execution environment</span>
                                 <span style="color: #b22222;"># </span><span style="color: #b22222;">created when `fn()` was called. The caller environment is the</span>
                                 <span style="color: #b22222;"># </span><span style="color: #b22222;">global env because that's where we called `fn()`.</span>
fn()
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; $current</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; &lt;environment: 0x7fa17bda3800&gt;</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; $caller</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; &lt;environment: R_GlobalEnv&gt;</span>
</pre>
</div>
</div>
</div>
<div id="org50f8c85" class="outline-5">
<h5 id="org50f8c85"><span class="section-number-5">12.21.1.3</span> constant</h5>
<div class="outline-text-5" id="text-12-21-1-3">
<p>
a bare value (i.e. an atomic vector of length 1)
</p>
<div class="org-src-container">
<pre class="src src-R">is_bare_atomic(<span style="color: #008b8b;">1</span>)
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] TRUE       </span>
</pre>
</div>
</div>
</div>
<div id="org392e367" class="outline-5">
<h5 id="org392e367"><span class="section-number-5">12.21.1.4</span> call object</h5>
<div class="outline-text-5" id="text-12-21-1-4">
<p>
a vector of symbols/constants/calls that begins with a function name, possibly followed by arguments.
</p>
<div class="org-src-container">
<pre class="src src-R">is_call(expr(abs(<span style="color: #008b8b;">1</span>)))
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] TRUE</span>
</pre>
</div>
</div>
</div>
<div id="org920dbae" class="outline-5">
<h5 id="org920dbae"><span class="section-number-5">12.21.1.5</span> code</h5>
<div class="outline-text-5" id="text-12-21-1-5">
<p>
a sequence of symbols/constants/calls that will return a result if evaluated.
Code can be:
</p>

<p>
1.evaluated immediately (standard eval)
2.quoted to use later (non-standard eval)
</p>

<div class="org-src-container">
<pre class="src src-R">is_expression(expr(pi))
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] TRUE       </span>
</pre>
</div>
</div>
</div>
<div id="org7b21546" class="outline-5">
<h5 id="org7b21546"><span class="section-number-5">12.21.1.6</span> expression</h5>
<div class="outline-text-5" id="text-12-21-1-6">
<p>
an object that stores quoted code without evaluating it. 
</p>
<div class="org-src-container">
<pre class="src src-R">is_expression(expr(a + b))
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] TRUE </span>
</pre>
</div>
</div>
</div>
<div id="orgaffa814" class="outline-5">
<h5 id="orgaffa814"><span class="section-number-5">12.21.1.7</span> quosure</h5>
<div class="outline-text-5" id="text-12-21-1-7">
<p>
an object that stores both quoted code (without evaluating it) and the code's environment. is<sub>quosure</sub>(quo(a + b)).
</p>

<p>
rlang::quo<sub>get</sub><sub>env</sub>(quo) Return the environment of a quosure.
rlang::quo<sub>set</sub><sub>env</sub>(quo, expr) Set the environment of a quosure.
rlang::quo<sub>get</sub><sub>expr</sub>(quo) Return the expression of a quosure.
</p>

<div class="org-src-container">
<pre class="src src-R">quo <span style="color: #008b8b;">&lt;-</span> quo(my_quosure)
quo
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; &lt;quosure&gt;</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; expr: ^my_quosure</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; env:  global</span>
quo_get_expr(quo)
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; my_quosure</span>
quo_get_env(quo)
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; &lt;environment: R_GlobalEnv&gt;</span>
quo <span style="color: #008b8b;">&lt;-</span> quo_set_env(quo, empty_env())
quo
<span style="color: #b22222;">## </span><span style="color: #b22222;">&lt;quosure&gt;</span>
     <span style="color: #b22222;">## </span><span style="color: #b22222;">expr: ^my_quosure</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">env:  empty</span>
</pre>
</div>

<p>
expression vector: a list of pieces of quoted code created by base R's expression and parse functions. Not to be confused with expression.
</p>
</div>
</div>
</div>
<div id="org8da7504" class="outline-4">
<h4 id="org8da7504"><span class="section-number-4">12.21.2</span> quoting code</h4>
<div class="outline-text-4" id="text-12-21-2">
</div>
<div id="orgcb8cf52" class="outline-5">
<h5 id="orgcb8cf52"><span class="section-number-5">12.21.2.1</span> quosures</h5>
<div class="outline-text-5" id="text-12-21-2-1">
<p>
Quote code in one of two ways (if in doubt use a quosure):
</p>

<p>
Quosure- An expression that has been saved with an environment (aka a closure).A quosure can be evaluated later in the stored environment to return a predictable result.
</p>

<p>
rlang::quo(expr) Quote contents as a quosure. Also quos to quote multiple expressions. a &lt;- 1; b &lt;- 2; q &lt;- quo(a + b); qs &lt;- quos(a, b)
</p>

<p>
化解符 defusing operator expr() 和 enquo() 能够阻止 R code evaluation. When a function argument is defused, R doesn't return its value like it normally would but it returns the R expression describing how to make the value.
</p>

<p>
Defusing prevents the evaluation of R code, but you can still force evaluation inside a defused expression with the forcing operators !! and !!!.化解符虽然能够阻止 R code 的解析，但是!! 能够强制解析。
</p>

<div class="org-src-container">
<pre class="src src-R">a <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">1</span>
b <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">2</span>
q <span style="color: #008b8b;">&lt;-</span> quo(a+b)
q
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; &lt;quosure&gt;</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; expr: ^a + b</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; env:  global</span>
qs <span style="color: #008b8b;">&lt;-</span> quos(a,b)
qs
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; &lt;list_of&lt;quosure&gt;&gt;</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[1]]</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; &lt;quosure&gt;</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; expr: ^a</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; env:  global</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[2]]</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; &lt;quosure&gt;</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; expr: ^b</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; env:  global  </span>
</pre>
</div>

<p>
rlang::enquo(arg) Call from within a function to quote what the user passed to an argument as a quosure. Also enquos for multiple args. quote<sub>this</sub> &lt; - function(x) enquo(x) quote<sub>these</sub> &lt; - function(…) enquos(…)
</p>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #0000ff;">group_mean</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>(data,group_var,mean_var,varnames){
    group_var_e <span style="color: #008b8b;">&lt;-</span> enquo(group_var)
    mean_var_e <span style="color: #008b8b;">&lt;-</span> enquo(mean_var)
    data <span style="color: #008b8b;">%&gt;%</span>
        group_by(!!group_var_e) <span style="color: #008b8b;">%&gt;%</span>

  summarise(!!varnames :=mean(!!mean_var_e))
}
group_mean(data=mtcars,
           group_var=cyl,
           mean_var=mpg,
           varnames=<span style="color: #8b2252;">"mpg"</span>)
</pre>
</div>
<p>
rlang::new<sub>quosure</sub>(expr, env = caller<sub>env</sub>()) Build a quosure from a quoted expression and an environment. new<sub>quosure</sub>(expr(a + b), current<sub>env</sub>()).
</p>

<div class="org-src-container">
<pre class="src src-R">new_quosure(expr(a+b),current_env())
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; &lt;quosure&gt;</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; expr: ^a + b</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; env:  global  </span>
</pre>
</div>

<p>
真是谁用谁知道哈！
</p>

<div class="org-src-container">
<pre class="src src-R">df1 <span style="color: #008b8b;">&lt;-</span> enframe(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>) <span style="color: #008b8b;">%&gt;%</span> 
    add_column(id=c(<span style="color: #8b2252;">"1"</span>,<span style="color: #8b2252;">"1"</span>,<span style="color: #8b2252;">"2"</span>))
df1
                                     <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; # A tibble: 3 x 3</span>
                                     <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;    name value id   </span>
                                     <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   &lt;int&gt; &lt;int&gt; &lt;chr&gt;</span>
                                     <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1     1     1 1    </span>
                                     <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2     2     2 1    </span>
                                     <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3     3     3 2</span>
<span style="color: #0000ff;">filter_fun</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>(.data,var,id1){
    var <span style="color: #008b8b;">&lt;-</span> enquo(var)
    id1 <span style="color: #008b8b;">&lt;-</span> enquo(id1)
    .data <span style="color: #008b8b;">%&gt;%</span> filter(!!var==!!id1)
}
filter_fun(df1, id, <span style="color: #8b2252;">"2"</span>)
                                     <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; # A tibble: 1 x 3</span>
                                     <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;    name value id   </span>
                                     <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   &lt;int&gt; &lt;int&gt; &lt;chr&gt;</span>
                                     <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1     3     3 2</span>
</pre>
</div>
</div>
</div>

<div id="org5a87ca9" class="outline-5">
<h5 id="org5a87ca9"><span class="section-number-5">12.21.2.2</span> expression</h5>
<div class="outline-text-5" id="text-12-21-2-2">
<p>
Quoted Expression - An expression that has been saved by itself.A quoted expression can be evaluated later to return a result that will depend on the environment it is evaluated in.
</p>

<p>
rlang::expr(expr) Quote contents. Also exprs to quote multiple expressions. a &lt;- 1; b &lt;- 2; e &lt;- expr(a + b); es &lt;- exprs(a, b, a + b)
</p>

<p>
rlang::enexpr(arg) Call from within a function to quote what the user passed to
an argument. Also enexprs to quote multiple arguments. quote<sub>that</sub> &lt; -
function(x) enexpr(x) quote<sub>those</sub> &lt; - function(…) enexprs(…)
</p>

<p>
rlang::ensym(x) Call from within a function to quote what the user passed to an argument as a symbol, accepts strings. Also ensyms. quote<sub>name</sub> &lt; - function(name) ensym(name) quote<sub>names</sub> &lt; - function(…) ensyms(…).
</p>

<div class="org-src-container">
<pre class="src src-R">a <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">1</span>
b <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">2</span>
(e <span style="color: #008b8b;">&lt;-</span> expr(a+b))
                                     <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; a + b</span>
(es <span style="color: #008b8b;">&lt;-</span> exprs(a,b,a+b))
                                     <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[1]]</span>
                                     <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; a</span>
                                     <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                     <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[2]]</span>
                                     <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; b</span>
                                     <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                     <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[3]]</span>
                                     <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; a + b</span>
</pre>
</div>
</div>
</div>
</div>

<div id="org3339fd0" class="outline-4">
<h4 id="org3339fd0"><span class="section-number-4">12.21.3</span> parsing and deparsing</h4>
<div class="outline-text-4" id="text-12-21-3">
<p>
parse:convert a string to a saved expression.rlang::parse<sub>expr</sub>(x) Convert a string to an expression. Also parse<sub>exprs</sub>, sym, parse<sub>quo</sub>, parse<sub>quos</sub>.
</p>
<div class="org-src-container">
<pre class="src src-R">parse_expr(<span style="color: #8b2252;">"a+b"</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; a + b</span>
</pre>
</div>

<p>
Deparse - Convert a saved expression to a string.
rlang::expr<sub>text</sub>(expr, width = 60L, nlines = Inf) Convert expr to a string. Also quo<sub>name</sub>. expr<sub>text</sub>(e).
</p>
<div class="org-src-container">
<pre class="src src-R">expr_label(<span style="color: #008b8b;">10</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "10" </span>
</pre>
</div>
</div>
</div>
<div id="org5c1eca2" class="outline-4">
<h4 id="org5c1eca2"><span class="section-number-4">12.21.4</span> building calls</h4>
<div class="outline-text-4" id="text-12-21-4">
<p>
rlang::call2(.fn, &#x2026;, .ns = NULL) Create a call from a function and a list of args. Use exec to create and then evaluate the call. (See back page for !!!) args &lt;- list(x = 4, base = 2).
</p>

<div class="org-src-container">
<pre class="src src-R">args <span style="color: #008b8b;">&lt;-</span> list(x=<span style="color: #008b8b;">4</span>,base=<span style="color: #008b8b;">2</span>)
call2(<span style="color: #8b2252;">"log"</span>,x=<span style="color: #008b8b;">4</span>,base=<span style="color: #008b8b;">2</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; log(x = 4, base = 2)</span>
call2(<span style="color: #8b2252;">"log"</span>,!!!args)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; log(x = 4, base = 2)</span>
exec(<span style="color: #8b2252;">"log"</span>,x=<span style="color: #008b8b;">4</span>,base=<span style="color: #008b8b;">2</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 2</span>
exec(<span style="color: #8b2252;">"log"</span>,!!!args)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 2  </span>
</pre>
</div>
</div>
</div>
<div id="org5f061e4" class="outline-4">
<h4 id="org5f061e4"><span class="section-number-4">12.21.5</span> evaluation</h4>
<div class="outline-text-4" id="text-12-21-5">
<p>
To evaluate an expression,R:
</p>

<p>
1.Looks up the symbols in the expression in the active environment (or a supplied one), followed by the environment's parents.
2.Executes the calls in the expression.
The result of an expression depends on which environment it is evaluated in.
</p>

<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> quote(letters[<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">5</span>])
x
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; letters[1:5]</span>
eval(x)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "a" "b" "c" "d" "e"</span>
context <span style="color: #008b8b;">&lt;-</span> list(letters = rev(LETTERS))
x
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; letters[1:5]</span>
eval_tidy(x, context)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "Z" "Y" "X" "W" "V"  </span>
</pre>
</div>
</div>

<div id="orgf695545" class="outline-5">
<h5 id="orgf695545"><span class="section-number-5">12.21.5.1</span> quoted expression</h5>
<div class="outline-text-5" id="text-12-21-5-1">
<p>
rlang::eval<sub>bare</sub>(expr, env = parent.frame()) Evaluate expr in env. eval<sub>bare</sub>(e, env =.GlobalEnv).
</p>
<div class="org-src-container">
<pre class="src src-R">e <span style="color: #008b8b;">&lt;-</span> parse_expr(<span style="color: #8b2252;">"a+b"</span>)
parse_expr(<span style="color: #8b2252;">"mean(mtcars$wt)"</span>) <span style="color: #008b8b;">%&gt;%</span> eval_tidy()
parse_exprs(<span style="color: #8b2252;">"mean(mtcars$wt); mean(mtcars$am)"</span>) <span style="color: #008b8b;">%&gt;%</span> eval_tidy()
parse_expr(<span style="color: #8b2252;">"mean(mtcars$wt)"</span>) <span style="color: #008b8b;">%&gt;%</span> eval_bare() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#22914;&#26524;&#19981;&#28041;&#21363;&#26032;&#30340;&#25968;&#25454;&#65292;&#23601;&#21487;&#20197;&#20351;&#29992;eval_bare,&#22914;&#26524;&#38656;&#35201;&#29992;&#21040;&#25968;&#25454;&#65292;&#37027;&#20040;&#23601;&#38656;&#35201;&#29992;eval_tidy &#36827;&#34892;&#27714;&#20540;</span>
parse_expr(<span style="color: #8b2252;">"mean(wt)"</span>) <span style="color: #008b8b;">%&gt;%</span> eval_tidy(data=mtcars)
parse_expr(<span style="color: #8b2252;">"mean(wt)"</span>) <span style="color: #008b8b;">%&gt;%</span> eval_bare() <span style="color: #b22222;">#</span><span style="color: #b22222;">Error in mean(wt) : &#25214;&#19981;&#21040;&#23545;&#35937;'wt'</span>
parse_expr(<span style="color: #8b2252;">"mean(wt)"</span>) <span style="color: #008b8b;">%&gt;%</span> 
    eval_tidy(data = mtcars)
parse_expr(<span style="color: #8b2252;">"mean(mtcars$wt)"</span>) <span style="color: #008b8b;">%&gt;%</span> 
    eval_bare()
</pre>
</div>
</div>
</div>
<div id="org6c600e1" class="outline-5">
<h5 id="org6c600e1"><span class="section-number-5">12.21.5.2</span> quosures</h5>
<div class="outline-text-5" id="text-12-21-5-2">
<p>
rlang::eval<sub>tidy</sub>(expr, data = NULL, env = caller<sub>env</sub>()) Evaluate expr in env,
using data as a data mask. Will evaluate quosures in their stored environment.
eval<sub>tidy</sub>(q).
</p>

<p>
Data Mask - If data is non-NULL, eval<sub>tidy</sub> inserts data into the search path before env, matching symbols to names in data.Use the pronoun .data$ to force a symbol to be matched in data, and !! (see back) to force a symbol to be matched in the environments.
</p>
<div class="org-src-container">
<pre class="src src-R">parse_expr(<span style="color: #8b2252;">"mean(wt)"</span>) <span style="color: #008b8b;">%&gt;%</span> 
    eval_tidy(data = mtcars)
parse_expr(<span style="color: #8b2252;">"mean(mtcars$wt)"</span>) <span style="color: #008b8b;">%&gt;%</span> 
    eval_bare()
</pre>
</div>
</div>
</div>
</div>
<div id="orgd3630a3" class="outline-4">
<h4 id="orgd3630a3"><span class="section-number-4">12.21.6</span> quasiquotation(!!,!!!,:=)</h4>
<div class="outline-text-4" id="text-12-21-6">
<p>
rlang provides !!, !!!, and := for doing quasiquotation.
</p>

<p>
!!, !!!, and := are not functions but syntax (symbols recognized by the
functions they are passed to). Compare this to how
</p>

<p>
. is used by magrittr::%&gt;%() . is used by stats::lm() .x is used by purrr::map(), and so on.
</p>

<p>
!!, !!!, and := are only recognized by some rlang functions and functions that use those functions (such as tidyverse functions).
</p>

<p>
!!Unquotes the symbol or call that follows. Pronounced "unquote" or "bang-
bang." a &lt;- 1; b &lt;- 2 expr(log(!!a + b)).
</p>

<p>
Combine !! with () to unquote a longer expression. a &lt;- 1; b &lt;- 2 expr(log(!!(a + b))).
</p>

<p>
!!!Unquotes a vector or list and splices the results as arguments into the
surrounding call. Pronounced "unquote splice" or "bang-bang-bang." x &lt;- list(8,
b = 2) expr(log(!!!x)).也就是说:= 等于＝。
</p>

<p>
:= Replaces an = to allow unquoting within the name that appears on the left hand side of the =. Use with !!
</p>
</div>

<div id="org2eb837e" class="outline-5">
<h5 id="org2eb837e"><span class="section-number-5">12.21.6.1</span> quotation</h5>
<div class="outline-text-5" id="text-12-21-6-1">
<p>
Storing an expression without evaluate it.
</p>
<div class="org-src-container">
<pre class="src src-R">(e <span style="color: #008b8b;">&lt;-</span> expr(a+b))
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; a + b  </span>
</pre>
</div>

<p>
要用:＝ 这个符号！！
</p>

<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> <span style="color: #8b2252;">"birth_year"</span>
summarise(starwars, !!x := n())
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; # A tibble: 1 x 1</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   birth_year</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;        &lt;int&gt;</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1         87  </span>
</pre>
</div>
</div>
</div>

<div id="org7ec79d2" class="outline-5">
<h5 id="org7ec79d2"><span class="section-number-5">12.21.6.2</span> quasiquotation</h5>
<div class="outline-text-5" id="text-12-21-6-2">
<p>
Quoting some parts of an expression while evaluating and then inserting the
results of others (unquoting others).
来个实际例子来说明!!!的魅力！
</p>
<div class="org-src-container">
<pre class="src src-R">n <span style="color: #008b8b;">&lt;-</span> expr(uno)
tibble::tibble(!!n:=<span style="color: #008b8b;">1</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; # A tibble: 1 x 1</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;     uno</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   &lt;dbl&gt;</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1     1</span>
name <span style="color: #008b8b;">&lt;-</span> <span style="color: #8b2252;">"Jane"</span>
list2(!!name := <span style="color: #008b8b;">1</span> + <span style="color: #008b8b;">2</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; $Jane</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 3</span>
exprs(!!name := <span style="color: #008b8b;">1</span> + <span style="color: #008b8b;">2</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; $Jane</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1 + 2</span>
<span style="color: #008b8b;">library</span>(rlang)
<span style="color: #008b8b;">library</span>(tidyverse)
e2 <span style="color: #008b8b;">&lt;-</span> <span style="color: #8b2252;">"vs + am ; am +vs"</span>
mtcars <span style="color: #008b8b;">%&gt;%</span>
    mutate(!!!parse_exprs(e2)) <span style="color: #008b8b;">%&gt;%</span>
    head()
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;    mpg cyl disp  hp drat    wt  qsec vs am gear carb vs + am am + vs</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1 21.0   6  160 110 3.90 2.620 16.46  0  1    4    4       1       1</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2 21.0   6  160 110 3.90 2.875 17.02  0  1    4    4       1       1</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3 22.8   4  108  93 3.85 2.320 18.61  1  1    4    1       2       2</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 4 21.4   6  258 110 3.08 3.215 19.44  1  0    3    1       1       1</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 5 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2       0       0</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 6 18.1   6  225 105 2.76 3.460 20.22  1  0    3    1       1       1</span>
</pre>
</div>
</div>
</div>
</div>
<div id="orgb2479ae" class="outline-4">
<h4 id="orgb2479ae"><span class="section-number-4">12.21.7</span> programming recipes</h4>
<div class="outline-text-4" id="text-12-21-7">
<p>
Quoting function- A function that quotes any of its arguments internally for delayed evaluation in a chosen environment. You must take special steps to program safely with a quoting function.
</p>

<ul class="org-ul">
<li>PROGRAM WITH A QUOTING FUNCTION</li>
</ul>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #0000ff;">data_mean</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>(data,var){
    <span style="color: #008b8b;">require</span>(dplyr)
    var <span style="color: #008b8b;">&lt;-</span> rlang::enquo(var)
    data <span style="color: #008b8b;">%&gt;%</span> 
        summarise(mean=mean(!!var))
} 
</pre>
</div>

<ol class="org-ol">
<li>Capture user argument that will be quoted with rlang::enquo.</li>
<li>Unquote the user argument into the quoting function with !!.</li>

<li>PASS MULTIPLE ARGUMENTS TO A QUOTING FUNCTION</li>
</ol>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #0000ff;">group_mean</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>(data, var,group_vars) { 
    <span style="color: #008b8b;">require</span>(dplyr) 
    var <span style="color: #008b8b;">&lt;-</span> rlang::enquo(var) 
    group_vars <span style="color: #008b8b;">&lt;-</span> rlang::enquos(group_vars) 
    data <span style="color: #008b8b;">%&gt;%</span> 
        group_by(!!!group_vars) <span style="color: #008b8b;">%&gt;%</span> 
        summarise(mean = mean(!!var)) 
}  
</pre>
</div>

<ol class="org-ol">
<li>Capture user arguments that will be quoted with rlang::enquos.</li>
<li>Unquote splice the user arguments into the quoting function with !!!.</li>

<li>PASS TO ARGUMENT NAMES OF A QUOTING FUNCTION</li>
</ol>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #0000ff;">named_m</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>(data, var, name) {
    <span style="color: #008b8b;">require</span>(dplyr)
    var <span style="color: #008b8b;">&lt;-</span> rlang::enquo(var)
    name <span style="color: #008b8b;">&lt;-</span> rlang::ensym(name)
    data <span style="color: #008b8b;">%&gt;%</span> summarise(!!name := mean(!!var)) }  
</pre>
</div>

<ol class="org-ol">
<li>Capture user argument that will be quoted with rlang::ensym.</li>
<li>Unquote the name into the quoting function with !! and :=.</li>

<li>MODIFY USER ARGUMENTS</li>
</ol>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #0000ff;">my_do</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>(f, v, df) {
    f <span style="color: #008b8b;">&lt;-</span> rlang::enquo(f)              <span style="color: #b22222;">#</span><span style="color: #b22222;">1</span>
    v <span style="color: #008b8b;">&lt;-</span> rlang::enquo(v)
    todo <span style="color: #008b8b;">&lt;-</span> rlang::quo((!!f)(!!v))    <span style="color: #b22222;">#</span><span style="color: #b22222;">2</span>
    rlang::eval_tidy(todo, df)        <span style="color: #b22222;">#</span><span style="color: #b22222;">3</span>
}  
</pre>
</div>

<ol class="org-ol">
<li>Capture user arguments with rlang::enquo.</li>
<li>Unquote user arguments into a new expression or quosure to use</li>
<li>Evaluate the new expression/ quosure instead of the original argument</li>

<li>APPLY AN ARGUMENT TO A DATA FRAME</li>
</ol>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #0000ff;">subset2</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>(df, rows){
    rows <span style="color: #008b8b;">&lt;-</span> rlang::enquo(rows) <span style="color: #b22222;">#</span><span style="color: #b22222;">1</span>
    vals <span style="color: #008b8b;">&lt;-</span> rlang::eval_tidy(rows, data = df)
    df[vals, , drop = <span style="color: #228b22;">FALSE</span>] <span style="color: #b22222;">#</span><span style="color: #b22222;">2</span>
}
</pre>
</div>

<ol class="org-ol">
<li>Capture user argument with rlang::enquo.</li>
<li>Evaluate the argument with rlang::eval<sub>tidy</sub>. Pass the data frame to data to use as a data mask.</li>
<li>Suggest in your documentation that your users use the .data and .env pronouns.</li>

<li>PASS CRAN CHECK</li>
</ol>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222; font-weight: bold;">#</span><span style="color: #b22222; font-weight: bold;">'</span><span style="color: #b22222;"> </span><span style="color: #a020f0;">@importFrom</span><span style="color: #b22222;"> </span><span style="color: #a0522d;">rlang</span><span style="color: #b22222;"> .data</span>
<span style="color: #0000ff;">mutate_y</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>(df) { dplyr::mutate(df, y = .data$a +<span style="color: #008b8b;">1</span>) }  
</pre>
</div>
<p>
Quoted arguments in tidyverse functions can trigger an R CMD check NOTE about
undefined global variables. To avoid this:
</p>

<ol class="org-ol">
<li>Import rlang::.data to your package, perhaps with the roxygen2 tag
@importFrom rlang .data</li>

<li>Use the .data$ pronoun in front of variable names in tidyverse functions.</li>
</ol>
</div>
</div>
<div id="orgfed7f6b" class="outline-4">
<h4 id="orgfed7f6b"><span class="section-number-4">12.21.8</span> functions</h4>
<div class="outline-text-4" id="text-12-21-8">
</div>
<div id="orgee5a3d8" class="outline-5">
<h5 id="orgee5a3d8"><span class="section-number-5">12.21.8.1</span> sym</h5>
<div class="outline-text-5" id="text-12-21-8-1">
<p>
A symbol is much more than a string, it is a reference to an R object. That’s why you have to use symbols to refer to data frame columns. Fortunately transforming strings to symbols is straightforward with the tidy eval sym() function:
</p>

<p>
说白了，sym 的处理对象就是 string 型，将 string 型的对象处理成标志 symbol,这样数据可以用来选择。
</p>

<div class="org-src-container">
<pre class="src src-R">sym(<span style="color: #8b2252;">"height"</span>)
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; height  </span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #0000ff;">grouped_mean</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>(data, group_var, summary_var) {
    group_var <span style="color: #008b8b;">&lt;-</span> enquo(group_var)
    summary_var <span style="color: #008b8b;">&lt;-</span> enquo(summary_var)

    data <span style="color: #008b8b;">%&gt;%</span>
        group_by(!!group_var) <span style="color: #008b8b;">%&gt;%</span>
        summarise(mean = mean(!!summary_var))
}
grouped_mean(mtcars, cyl, mpg)
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Error in eval(lhs, parent, parent): object 'mtcars' not found       </span>
</pre>
</div>

<p>
再举一个例子说明 sym 的应用。
</p>
<div class="org-src-container">
<pre class="src src-R">vars <span style="color: #008b8b;">&lt;-</span> syms(c(<span style="color: #8b2252;">"height"</span>, <span style="color: #8b2252;">"mass"</span>))
                                      <span style="color: #b22222;"># </span><span style="color: #b22222;">Force-splicing is equivalent to supplying the elements separately</span>
starwars <span style="color: #008b8b;">%&gt;%</span> select(!!!vars)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; # A tibble: 87 x 2</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;    height  mass</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;     &lt;int&gt; &lt;dbl&gt;</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  1    172    77</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  2    167    75</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  3     96    32</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  4    202   136</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  5    150    49</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  6    178   120</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  7    165    75</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  8     97    32</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  9    183    84</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 10    182    77</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; # ... with 77 more rows</span>
</pre>
</div>

<p>
从上面的例子可以看出，syms 返回的是 list 型数据，而针对 list 型数据需要用!!! 来解析。
</p>
</div>
</div>
<div id="org9299249" class="outline-5">
<h5 id="org9299249"><span class="section-number-5">12.21.8.2</span> {{.}} (curly-curly operator)</h5>
<div class="outline-text-5" id="text-12-21-8-2">
<p>
The curly-curly operator {{ }} for function arguments is a bit special because it forces the function argument and immediately defuses it.
</p>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #0000ff;">mean_by</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>(data, by, var) {
    data <span style="color: #008b8b;">%&gt;%</span>
        group_by({
            {
                by
            }
        }) <span style="color: #008b8b;">%&gt;%</span>
        summarise(avg = mean({
            {
                var
            }
        }, na.rm = <span style="color: #228b22;">TRUE</span>))
}
                                      <span style="color: #b22222;"># </span><span style="color: #b22222;">The env-variables `by` and `var` are forced but defused.</span>
                                      <span style="color: #b22222;"># </span><span style="color: #b22222;">The data-variables they contain are evaluated by dplyr later on</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">in data context.</span>
iris <span style="color: #008b8b;">%&gt;%</span> mean_by(by = Species, var = Sepal.Width)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; # A tibble: 3 x 2</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   Species      avg</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   &lt;fct&gt;      &lt;dbl&gt;</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1 setosa      3.43</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2 versicolor  2.77</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3 virginica   2.97  </span>
</pre>
</div>
</div>
</div>

<div id="orgee1de56" class="outline-5">
<h5 id="orgee1de56"><span class="section-number-5">12.21.8.3</span> &#x2026; argument</h5>
<div class="outline-text-5" id="text-12-21-8-3">
<p>
The dot-dot-dot argument is one of the nicest aspects of the R language. A function that takes &#x2026; accepts any number of arguments, named or unnamed. As a programmer you can do three things with &#x2026;:
</p>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #0000ff;">materialise</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>(data, ...) {
    dots <span style="color: #008b8b;">&lt;-</span> list(...)
    dots
}
materialise(mtcars, <span style="color: #008b8b;">1</span> + <span style="color: #008b8b;">2</span>, important_name = letters)
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[1]]</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 3</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; $important_name</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [1] "a" "b" "c" "d" "e" "f" "g" "h" "i" "j" "k" "l" "m" "n" "o" "p" "q"</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [18] "r" "s" "t" "u" "v" "w" "x" "y" "z"       </span>
</pre>
</div>
</div>
</div>
<div id="org3a94ffb" class="outline-5">
<h5 id="org3a94ffb"><span class="section-number-5">12.21.8.4</span> expr,exprs,enquo</h5>
<div class="outline-text-5" id="text-12-21-8-4">
<ul class="org-ul">
<li>The defusing operator expr() is similar to quote(). Like bquote(), it allows forcing evaluation of parts of an expression.</li>

<li>The plural variant exprs() is similar to alist().</li>

<li>The argument-defusing operator enquo() is similar to substitute().</li>
</ul>
</div>
</div>
<div id="orgcce187d" class="outline-5">
<h5 id="orgcce187d"><span class="section-number-5">12.21.8.5</span> %|%</h5>
<div class="outline-text-5" id="text-12-21-8-5">
<p>
replace missing values。
</p>

<div class="org-src-container">
<pre class="src src-R">c(<span style="color: #8b2252;">"a"</span>, <span style="color: #8b2252;">"b"</span>, <span style="color: #228b22;">NA</span>, <span style="color: #8b2252;">"c"</span>) <span style="color: #008b8b;">%|%</span> <span style="color: #8b2252;">"default"</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "a"       "b"       "default" "c"</span>
c(<span style="color: #008b8b;">1L</span>, <span style="color: #228b22;">NA</span>, <span style="color: #008b8b;">3L</span>, <span style="color: #228b22;">NA</span>, <span style="color: #228b22;">NA</span>) <span style="color: #008b8b;">%|%</span> (<span style="color: #008b8b;">6L</span>:<span style="color: #008b8b;">10L</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1]  1  7  3  9 10</span>
</pre>
</div>
</div>
</div>
<div id="org5f6ca6a" class="outline-5">
<h5 id="org5f6ca6a"><span class="section-number-5">12.21.8.6</span> exec</h5>
<div class="outline-text-5" id="text-12-21-8-6">
<p>
This function constructs and evaluates a call to .fn. It has two primary uses:
</p>

<p>
To call a function with arguments stored in a list (if the function doesn't support tidy-dots)
</p>

<p>
To call every function stored in a list (in conjunction with map()/ lapply())
</p>
<div class="org-src-container">
<pre class="src src-R">args <span style="color: #008b8b;">&lt;-</span> list(x = c(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">10</span>, <span style="color: #008b8b;">100</span>, <span style="color: #228b22;">NA</span>), na.rm = <span style="color: #228b22;">TRUE</span>)
exec(<span style="color: #8b2252;">"mean"</span>, !!!args, trim = <span style="color: #008b8b;">0.2</span>)
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 6</span>

</pre>
</div>
</div>
</div>
<div id="org7064577" class="outline-5">
<h5 id="org7064577"><span class="section-number-5">12.21.8.7</span> pairlist2</h5>
<div class="outline-text-5" id="text-12-21-8-7">
<p>
Create pairlists with splicing support.
</p>
<div class="org-src-container">
<pre class="src src-R">new_function(pairlist2(x = , y = <span style="color: #008b8b;">3</span> * <span style="color: #008b8b;">6</span>), quote(x * y))
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; function (x, y = 18) </span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; x * y</span>
new_function(exprs(x = <span style="color: #008b8b;">1</span>, y = <span style="color: #008b8b;">3</span> * <span style="color: #008b8b;">6</span>), quote(x * y))
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; function (x = 1, y = 3 * 6) </span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; x * y       </span>
</pre>
</div>
</div>
</div>
<div id="org3d5ece5" class="outline-5">
<h5 id="org3d5ece5"><span class="section-number-5">12.21.8.8</span> f<sub>rhs</sub></h5>
<div class="outline-text-5" id="text-12-21-8-8">
<p>
Get or set formula components.
f<sub>rhs</sub> extracts the righthand side, f<sub>lhs</sub> extracts the lefthand side, and f<sub>env</sub> extracts the environment. All functions throw an error if f is not a formula.
</p>
<div class="org-src-container">
<pre class="src src-R">f_rhs(~ <span style="color: #008b8b;">1</span> + <span style="color: #008b8b;">2</span> + <span style="color: #008b8b;">3</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1 + 2 + 3</span>
</pre>
</div>
</div>
</div>
<div id="org53843bd" class="outline-5">
<h5 id="org53843bd"><span class="section-number-5">12.21.8.9</span> f<sub>lhs</sub></h5>
<div class="outline-text-5" id="text-12-21-8-9">
<div class="org-src-container">
<pre class="src src-R">f_lhs(~y)
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; NULL</span>
f_lhs(x ~ y)
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; x</span>
</pre>
</div>
</div>
</div>

<div id="orgec25690" class="outline-5">
<h5 id="orgec25690"><span class="section-number-5">12.21.8.10</span> fn<sub>body</sub></h5>
<div class="outline-text-5" id="text-12-21-8-10">
<p>
Get or set function body.
</p>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #0000ff;">fn</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>() do()
body(fn)
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; do()</span>
fn_body(fn)
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; {</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;     do()</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; }       </span>
</pre>
</div>
</div>
</div>

<div id="org99c3201" class="outline-5">
<h5 id="org99c3201"><span class="section-number-5">12.21.8.11</span> fn<sub>env</sub></h5>
<div class="outline-text-5" id="text-12-21-8-11">
<p>
Return the closure environment of a function.
</p>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #0000ff;">fn</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>() do()
fn_env(fn)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; &lt;environment: R_GlobalEnv&gt;  </span>
</pre>
</div>
</div>
</div>

<div id="org4bb0ad4" class="outline-5">
<h5 id="org4bb0ad4"><span class="section-number-5">12.21.8.12</span> f<sub>text</sub></h5>
<div class="outline-text-5" id="text-12-21-8-12">
<div class="org-src-container">
<pre class="src src-R">f <span style="color: #008b8b;">&lt;-</span> ~ a + b + bc
f_text(f)
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "a + b + bc"</span>
f_label(f)
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "`a + b + bc`"</span>

                                 <span style="color: #b22222;"># </span><span style="color: #b22222;">Names a quoted with ``</span>
f_label(~x)
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "`x`"</span>
                                 <span style="color: #b22222;"># </span><span style="color: #b22222;">Strings are encoded</span>
f_label(~<span style="color: #8b2252;">"a\nb"</span>)
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "\"a\\nb\""</span>
                                 <span style="color: #b22222;"># </span><span style="color: #b22222;">Long expressions are collapsed</span>
f_label(~ foo({
    <span style="color: #008b8b;">1</span> + <span style="color: #008b8b;">2</span>
    print(x)
}))
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "`foo(...)`"</span>
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="org56f2b79" class="outline-3">
<h3 id="org56f2b79"><span class="section-number-3">12.22</span> blorr</h3>
<div class="outline-text-3" id="text-12-22">
</div>
<div id="org8909ada" class="outline-4">
<h4 id="org8909ada"><span class="section-number-4">12.22.1</span> blr<sub>plot</sub><sub>leverage</sub></h4>
<div class="outline-text-4" id="text-12-22-1">
<div class="org-src-container">
<pre class="src src-R">model <span style="color: #008b8b;">&lt;-</span> glm(honcomp ~ female + read + science, data = hsb2,
             family = binomial(link = <span style="color: #8b2252;">'logit'</span>))
blr_plot_leverage(model)  
</pre>
</div>
</div>
</div>
</div>

<div id="orgf982332" class="outline-3">
<h3 id="orgf982332"><span class="section-number-3">12.23</span> caret</h3>
<div class="outline-text-3" id="text-12-23">
</div>
<div id="org134bc28" class="outline-4">
<h4 id="org134bc28"><span class="section-number-4">12.23.1</span> confusionMatrix</h4>
<div class="outline-text-4" id="text-12-23-1">
<div class="org-src-container">
<pre class="src src-R"><span style="color: #008b8b;">library</span>(caret)
two_class_sample1 <span style="color: #008b8b;">&lt;-</span> as.factor(sample(letters[<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">2</span>], <span style="color: #008b8b;">100</span>, <span style="color: #228b22;">TRUE</span>))
two_class_sample2 <span style="color: #008b8b;">&lt;-</span> as.factor(sample(letters[<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">2</span>], <span style="color: #008b8b;">100</span>, <span style="color: #228b22;">TRUE</span>))
two_class_cm <span style="color: #008b8b;">&lt;-</span> caret::confusionMatrix(
                           two_class_sample1,
                           two_class_sample2
                       )

tidy(two_class_cm)
tidy(two_class_cm, by_class = <span style="color: #228b22;">FALSE</span>)      
</pre>
</div>
</div>
</div>
</div>
<div id="org7758330" class="outline-3">
<h3 id="org7758330"><span class="section-number-3">12.24</span> tibble</h3>
<div class="outline-text-3" id="text-12-24">
</div>
<div id="orgf2d1829" class="outline-4">
<h4 id="orgf2d1829"><span class="section-number-4">12.24.1</span> new<sub>tibble</sub></h4>
<div class="outline-text-4" id="text-12-24-1">
<p>
Tibble constructor and validator.
new<sub>tibble</sub>() creates a new object as a subclass of tbl<sub>df</sub>, tbl and data.frame. This function is optimized for performance, checks are reduced to a minimum.
</p>

<div class="org-src-container">
<pre class="src src-R">new_tibble(list(a = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>, b = <span style="color: #008b8b;">4</span>:<span style="color: #008b8b;">6</span>), nrow = <span style="color: #008b8b;">3</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; # A tibble: 3 x 2</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;       a     b</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   &lt;int&gt; &lt;int&gt;</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1     1     4</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2     2     5</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3     3     6      </span>
</pre>
</div>
</div>
</div>
<div id="org82b8ab3" class="outline-4">
<h4 id="org82b8ab3"><span class="section-number-4">12.24.2</span> enframe</h4>
<div class="outline-text-4" id="text-12-24-2">
<p>
enframe() converts named atomic vectors or lists to one- or two-column data frames. For a list, the result will be a nested tibble with a column of type list. For unnamed vectors, the natural sequence is used as name column. 
</p>
<div class="org-src-container">
<pre class="src src-R">enframe(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; # A tibble: 3 x 2</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;    name value</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   &lt;int&gt; &lt;int&gt;</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1     1     1</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2     2     2</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3     3     3</span>
enframe(c(a = <span style="color: #008b8b;">5</span>, b = <span style="color: #008b8b;">7</span>))
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; # A tibble: 2 x 2</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   name  value</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   &lt;chr&gt; &lt;dbl&gt;</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1 a         5</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2 b         7</span>
enframe(list(one = <span style="color: #008b8b;">1</span>, two = <span style="color: #008b8b;">2</span>:<span style="color: #008b8b;">3</span>, three = <span style="color: #008b8b;">4</span>:<span style="color: #008b8b;">6</span>))
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; # A tibble: 3 x 2</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   name  value    </span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   &lt;chr&gt; &lt;list&gt;   </span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1 one   &lt;dbl [1]&gt;</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2 two   &lt;int [2]&gt;</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3 three &lt;int [3]&gt;</span>
</pre>
</div>
</div>
</div>
<div id="orgd373aaa" class="outline-4">
<h4 id="orgd373aaa"><span class="section-number-4">12.24.3</span> deframe</h4>
<div class="outline-text-4" id="text-12-24-3">
<p>
deframe() converts two-column data frames to a named vector or list, using the first column as name and the second column as value. If the input has only one column, an unnamed vector is returned. 
</p>
<div class="org-src-container">
<pre class="src src-R">deframe(enframe(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>))
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1 2 3 </span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1 2 3</span>
deframe(tibble(a = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>))
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 1 2 3</span>
deframe(tibble(a = as.list(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>)))
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[1]]</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 1</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[2]]</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 2</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[3]]</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 3</span>
</pre>
</div>
</div>
</div>
<div id="org1a15d6f" class="outline-4">
<h4 id="org1a15d6f"><span class="section-number-4">12.24.4</span> trunc<sub>mat</sub></h4>
<div class="outline-text-4" id="text-12-24-4">
<p>
Printing tibbles.方便打印 tibble
</p>

<div class="org-src-container">
<pre class="src src-R">trunc_mat(mtcars)  
print(mtcars, width = <span style="color: #008b8b;">10</span>) <span style="color: #b22222;">##</span><span style="color: #b22222;">print &#36824;&#21487;&#20197;&#25511;&#21046;&#23485;&#24230;</span>
</pre>
</div>
</div>
</div>
</div>
<div id="orgf41d3b6" class="outline-3">
<h3 id="orgf41d3b6"><span class="section-number-3">12.25</span> cli</h3>
<div class="outline-text-3" id="text-12-25">
</div>
<div id="org43a09bf" class="outline-4">
<h4 id="org43a09bf"><span class="section-number-4">12.25.1</span> ansi-styles</h4>
<div class="outline-text-4" id="text-12-25-1">
<p>
确定输出的字体颜色。
</p>
</div>
<div id="org1c60032" class="outline-5">
<h5 id="org1c60032"><span class="section-number-5">12.25.1.1</span> col<sub>blue</sub></h5>
<div class="outline-text-5" id="text-12-25-1-1">
<p>
输出蓝色字体文字。
</p>
<div class="org-src-container">
<pre class="src src-R">col_blue(<span style="color: #8b2252;">"Hello "</span>, <span style="color: #8b2252;">"world!"</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; &lt;ansi_string&gt;</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] Hello world! </span>
cat(col_blue(<span style="color: #8b2252;">"Hello "</span>, <span style="color: #8b2252;">"world!"</span>))
</pre>
</div>
</div>
</div>

<div id="org466da2a" class="outline-5">
<h5 id="org466da2a"><span class="section-number-5">12.25.1.2</span> col<sub>red</sub></h5>
<div class="outline-text-5" id="text-12-25-1-2">
<div class="org-src-container">
<pre class="src src-R">col_red(<span style="color: #8b2252;">"Hello "</span>, <span style="color: #8b2252;">"world!"</span>)
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; &lt;ansi_string&gt;</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] Hello world!       </span>
</pre>
</div>
</div>
</div>
</div>

<div id="org91fbb6d" class="outline-4">
<h4 id="org91fbb6d"><span class="section-number-4">12.25.2</span> style<sub>italic</sub></h4>
<div class="outline-text-4" id="text-12-25-2">
<p>
字体斜体。
</p>
<div class="org-src-container">
<pre class="src src-R">style_italic(<span style="color: #8b2252;">"Hello"</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; &lt;ansi_string&gt;</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] Hello </span>
</pre>
</div>
</div>
</div>

<div id="orgea7b10e" class="outline-4">
<h4 id="orgea7b10e"><span class="section-number-4">12.25.3</span> combine<sub>ansi</sub><sub>styles</sub></h4>
<div class="outline-text-4" id="text-12-25-3">
<p>
可以合并多种字体类型进行展示。
</p>
<div class="org-src-container">
<pre class="src src-R">combine_ansi_styles(<span style="color: #8b2252;">"red"</span>, bg_cyan)
</pre>
</div>
</div>
</div>

<div id="org649d03e" class="outline-4">
<h4 id="org649d03e"><span class="section-number-4">12.25.4</span> cat<sub>line</sub></h4>
<div class="outline-text-4" id="text-12-25-4">
<p>
These helpers provide useful wrappers around cat(): most importantly they all set sep = "", and cat<sub>line</sub>() automatically adds a newline.
</p>

<p>
生成一条红色的线。
</p>
<div class="org-src-container">
<pre class="src src-R">cat_line(<span style="color: #8b2252;">"This is "</span>, <span style="color: #8b2252;">"a "</span>, <span style="color: #8b2252;">"line of text."</span>, col = <span style="color: #8b2252;">"red"</span>) 
</pre>
</div>
</div>
</div>

<div id="org76d76db" class="outline-4">
<h4 id="org76d76db"><span class="section-number-4">12.25.5</span> cat<sub>bullet</sub></h4>
<div class="outline-text-4" id="text-12-25-5">
<p>
生成如下格式数据。
</p>
<div class="org-src-container">
<pre class="src src-R">cat_bullet(letters[<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">5</span>], bullet = <span style="color: #8b2252;">"tick"</span>, bullet_col = <span style="color: #8b2252;">"green"</span>)
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; &#8730; a</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; &#8730; b</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; &#8730; c</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; &#8730; d</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; &#8730; e</span>
</pre>
</div>
</div>
</div>

<div id="orge0c5f17" class="outline-4">
<h4 id="orge0c5f17"><span class="section-number-4">12.25.6</span> boxx</h4>
<div class="outline-text-4" id="text-12-25-6">
<p>
生成一个盒子，具体形式如下。
</p>
<div class="org-src-container">
<pre class="src src-R">boxx(<span style="color: #8b2252;">"Hello there!"</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; +------------------+</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; |                  |</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; |   Hello there!   |</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; |                  |</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; +------------------+ </span>
</pre>
</div>
</div>
</div>

<div id="org0da24d9" class="outline-4">
<h4 id="org0da24d9"><span class="section-number-4">12.25.7</span> custom spinner</h4>
<div class="outline-text-4" id="text-12-25-7">
<div class="org-src-container">
<pre class="src src-R">sp3 <span style="color: #008b8b;">&lt;-</span> make_spinner(<span style="color: #8b2252;">"simpleDotsScrolling"</span>, template = <span style="color: #8b2252;">"Downloading {spin}"</span>)
<span style="color: #0000ff;">fun_with_spinner3</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>() {
    lapply(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">100</span>, <span style="color: #a020f0;">function</span>(x) { sp3$spin(); Sys.sleep(<span style="color: #008b8b;">0.05</span>) })
    sp2$finish()
}
<span style="color: #b22222;">## </span><span style="color: #b22222;">Downloading .</span>
</pre>
</div>
</div>
</div>

<div id="org241b260" class="outline-4">
<h4 id="org241b260"><span class="section-number-4">12.25.8</span> cli<sub>alert</sub></h4>
<div class="outline-text-4" id="text-12-25-8">
<p>
Alerts are typically short status messages.
</p>
<div class="org-src-container">
<pre class="src src-R">cli_alert(<span style="color: #8b2252;">"Cannot lock package library."</span>)
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Cannot lock package library.</span>
</pre>
</div>
</div>
</div>

<div id="orgd84b6df" class="outline-4">
<h4 id="orgd84b6df"><span class="section-number-4">12.25.9</span> cli<sub>alert</sub><sub>success</sub></h4>
<div class="outline-text-4" id="text-12-25-9">
<div class="org-src-container">
<pre class="src src-R">cli_alert_success(<span style="color: #8b2252;">"Package {.pkg cli} installed successfully."</span>)
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Cannot lock package library.</span>
</pre>
</div>
</div>
</div>
</div>

<div id="orgffd9a7c" class="outline-3">
<h3 id="orgffd9a7c"><span class="section-number-3">12.26</span> clipr</h3>
<div class="outline-text-3" id="text-12-26">
<p>
复制函数。
</p>
<div class="org-src-container">
<pre class="src src-R">clip_text <span style="color: #008b8b;">&lt;-</span> read_clip()
</pre>
</div>
</div>
</div>

<div id="orgc0c1d07" class="outline-3">
<h3 id="orgc0c1d07"><span class="section-number-3">12.27</span> janitor</h3>
<div class="outline-text-3" id="text-12-27">
</div>
<div id="org885329f" class="outline-4">
<h4 id="org885329f"><span class="section-number-4">12.27.1</span> row<sub>to</sub><sub>names</sub></h4>
<div class="outline-text-4" id="text-12-27-1">
<div class="org-src-container">
<pre class="src src-R">df <span style="color: #008b8b;">&lt;-</span> tribble(
  ~<span style="color: #000000; background-color: #ffffff;">`...1`</span>, ~<span style="color: #000000; background-color: #ffffff;">`...2`</span>,
  <span style="color: #8b2252;">"Nintendo hardware sales in millions"</span>, <span style="color: #228b22;">NA_character_</span>, 
  <span style="color: #228b22;">NA_character_</span>, <span style="color: #228b22;">NA_character_</span>,
  <span style="color: #8b2252;">"console"</span>, <span style="color: #8b2252;">"hardware_sales"</span>,
  <span style="color: #8b2252;">"Nintendo Switch"</span>, <span style="color: #8b2252;">"52.48"</span>,
  <span style="color: #8b2252;">"Nintendo 3DS"</span>, <span style="color: #8b2252;">"75.71"</span>,
  <span style="color: #8b2252;">"Wii U"</span>, <span style="color: #8b2252;">"13.56"</span>,
  <span style="color: #8b2252;">"Wii"</span>, <span style="color: #8b2252;">"101.63"</span>,
  <span style="color: #8b2252;">"Nintendo DS"</span>, <span style="color: #8b2252;">"154.02"</span>,
  <span style="color: #8b2252;">"Game Boy Advance"</span>, <span style="color: #8b2252;">"81.51"</span>,
  <span style="color: #8b2252;">"Game Boy"</span>, <span style="color: #8b2252;">"118.69"</span>,
  <span style="color: #8b2252;">"Nintendo GameCube"</span>, <span style="color: #8b2252;">"21.74"</span>,
  <span style="color: #8b2252;">"Nintendo 64"</span>, <span style="color: #8b2252;">"32.93"</span>,
  <span style="color: #8b2252;">"SNES"</span>, <span style="color: #8b2252;">"49.10"</span>,
  <span style="color: #8b2252;">"NES"</span>, <span style="color: #8b2252;">"61.91"</span>
)

<span style="color: #b22222;"># </span><span style="color: #b22222;">Use row_to_names() to set the third row (the actual column names) as the variable names!</span>
row_to_names(df, row_number = <span style="color: #008b8b;">3</span>)
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; # A tibble: 11 x 2</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;    console           hardware_sales</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;    &lt;chr&gt;             &lt;chr&gt;         </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  1 Nintendo Switch   52.48         </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  2 Nintendo 3DS      75.71         </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  3 Wii U             13.56         </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  4 Wii               101.63        </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  5 Nintendo DS       154.02        </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  6 Game Boy Advance  81.51         </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  7 Game Boy          118.69        </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  8 Nintendo GameCube 21.74         </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  9 Nintendo 64       32.93         </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 10 SNES              49.10         </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 11 NES               61.91      </span>
</pre>
</div>
</div>
</div>
<div id="orgabcc373" class="outline-4">
<h4 id="orgabcc373"><span class="section-number-4">12.27.2</span> tabyl</h4>
<div class="outline-text-4" id="text-12-27-2">
<div class="org-src-container">
<pre class="src src-R"><span style="color: #008b8b;">library</span>(janitor)
<span style="color: #008b8b;">library</span>(tibble)

grades <span style="color: #008b8b;">&lt;-</span> tribble(
    ~student, ~course, ~grade,
    <span style="color: #008b8b;">1</span>, <span style="color: #8b2252;">"Statistics"</span>, <span style="color: #8b2252;">"A"</span>,
    <span style="color: #008b8b;">2</span>, <span style="color: #8b2252;">"Statistics"</span>, <span style="color: #8b2252;">"B+"</span>,
    <span style="color: #008b8b;">3</span>, <span style="color: #8b2252;">"Statistics"</span>, <span style="color: #8b2252;">"A-"</span>,
    <span style="color: #008b8b;">1</span>, <span style="color: #8b2252;">"Calculus"</span>, <span style="color: #8b2252;">"A-"</span>,
    <span style="color: #008b8b;">2</span>, <span style="color: #8b2252;">"Calculus"</span>, <span style="color: #8b2252;">"A-"</span>
)

                                  <span style="color: #b22222;"># </span><span style="color: #b22222;">Use tabyl to easily count a variable</span>
grades <span style="color: #008b8b;">%&gt;%</span>
    tabyl(grade)
<span style="color: #b22222;">##  </span><span style="color: #b22222;">grade n percent</span>
<span style="color: #b22222;">##      </span><span style="color: #b22222;">A 1     0.2</span>
<span style="color: #b22222;">##     </span><span style="color: #b22222;">A- 3     0.6</span>
<span style="color: #b22222;">##     </span><span style="color: #b22222;">B+ 1     0.2</span>
</pre>
</div>
</div>
</div>
<div id="orgf6af0b1" class="outline-4">
<h4 id="orgf6af0b1"><span class="section-number-4">12.27.3</span> remove<sub>constant</sub></h4>
<div class="outline-text-4" id="text-12-27-3">
<p>
这个函数可以用来快速识别哪些列是一个数值。
</p>
<div class="org-src-container">
<pre class="src src-R">remove_constant(data.frame(A=<span style="color: #008b8b;">1</span>, B=<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>))
      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   B</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1 1</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2 2</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3 3</span>
data.frame(A=<span style="color: #008b8b;">1</span>, B=<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>) <span style="color: #008b8b;">%&gt;%</span>
    dplyr::select_at(setdiff(names(.), names(remove_constant(.))))
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   A</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1 1</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2 1</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3 1</span>
</pre>
</div>
</div>
</div>
<div id="org28cd62b" class="outline-4">
<h4 id="org28cd62b"><span class="section-number-4">12.27.4</span> get<sub>dupes</sub></h4>
<div class="outline-text-4" id="text-12-27-4">
<p>
Get rows of a data.frame with identical values for the specified variables.以后用这个函数来确定 xiaomi<sub>id</sub>, credit<sub>time</sub> 是否有重复的记录。
</p>

<div class="org-src-container">
<pre class="src src-R">mtcars <span style="color: #008b8b;">%&gt;%</span> 
    get_dupes(wt)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; # A tibble: 5 x 12</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;      wt dupe_count   mpg   cyl  disp    hp  drat  qsec    vs    am  gear</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   &lt;dbl&gt;      &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1  3.44          3  18.7     8  360    175  3.15  17.0     0     0     3</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2  3.44          3  19.2     6  168.   123  3.92  18.3     1     0     4</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3  3.44          3  17.8     6  168.   123  3.92  18.9     1     0     4</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 4  3.57          2  14.3     8  360    245  3.21  15.8     0     0     3</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 5  3.57          2  15       8  301    335  3.54  14.6     0     1     5</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; # &#8230; with 1 more variable: carb &lt;dbl&gt;      </span>
</pre>
</div>
</div>
</div>
<div id="orgfbb152d" class="outline-4">
<h4 id="orgfbb152d"><span class="section-number-4">12.27.5</span> adorn<sub>total</sub></h4>
<div class="outline-text-4" id="text-12-27-5">
<p>
这个函数是添加了一行 total 汇总信息。
</p>
<div class="org-src-container">
<pre class="src src-R">mtcars <span style="color: #008b8b;">%&gt;%</span>
    tabyl(am, cyl) <span style="color: #008b8b;">%&gt;%</span>
    adorn_totals()
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;     am  4 6  8</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;      0  3 4 12</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;      1  8 3  2</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  Total 11 7 14</span>
</pre>
</div>
</div>
</div>
<div id="org9d616ed" class="outline-4">
<h4 id="org9d616ed"><span class="section-number-4">12.27.6</span> adorn<sub>percentages</sub></h4>
<div class="outline-text-4" id="text-12-27-6">
<p>
添加可以按照行和列给出观测的比例信息。
</p>
<div class="org-src-container">
<pre class="src src-R">mtcars <span style="color: #008b8b;">%&gt;%</span>
    tabyl(am, cyl) <span style="color: #008b8b;">%&gt;%</span>
    adorn_percentages(<span style="color: #8b2252;">"col"</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  am         4         6         8</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   0 0.2727273 0.5714286 0.8571429</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   1 0.7272727 0.4285714 0.1428571      </span>
</pre>
</div>
</div>
</div>
<div id="org506c580" class="outline-4">
<h4 id="org506c580"><span class="section-number-4">12.27.7</span> adorn<sub>ns</sub></h4>
<div class="outline-text-4" id="text-12-27-7">
<p>
Add underlying Ns to a tabyl displaying percentages.
</p>
<div class="org-src-container">
<pre class="src src-R">mtcars <span style="color: #008b8b;">%&gt;%</span>
    tabyl(am, cyl) <span style="color: #008b8b;">%&gt;%</span>
    adorn_percentages(<span style="color: #8b2252;">"col"</span>) <span style="color: #008b8b;">%&gt;%</span>
    adorn_pct_formatting() <span style="color: #008b8b;">%&gt;%</span>
    adorn_ns(position = <span style="color: #8b2252;">"front"</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  am         4         6          8</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   0 3 (27.3%) 4 (57.1%) 12 (85.7%)</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   1 8 (72.7%) 3 (42.9%)  2 (14.3%)</span>
</pre>
</div>
</div>
</div>
<div id="org8c16e9b" class="outline-4">
<h4 id="org8c16e9b"><span class="section-number-4">12.27.8</span> adorn<sub>title</sub></h4>
<div class="outline-text-4" id="text-12-27-8">
<p>
Add column name to the top of a two-way tabyl.
</p>
<div class="org-src-container">
<pre class="src src-R">mtcars <span style="color: #008b8b;">%&gt;%</span>
    tabyl(am, cyl) <span style="color: #008b8b;">%&gt;%</span>
    adorn_title(placement = <span style="color: #8b2252;">"top"</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;     cyl     </span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  am   4 6  8</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   0   3 4 12</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   1   8 3  2</span>
</pre>
</div>


<div class="org-src-container">
<pre class="src src-R">mtcars <span style="color: #008b8b;">%&gt;%</span>
    group_by(gear, am) <span style="color: #008b8b;">%&gt;%</span>
    summarise(avg_mpg = mean(mpg)) <span style="color: #008b8b;">%&gt;%</span>
    spread(gear, avg_mpg) <span style="color: #008b8b;">%&gt;%</span>
    adorn_title(<span style="color: #8b2252;">"top"</span>, row_name = <span style="color: #8b2252;">"Gears"</span>, col_name = <span style="color: #8b2252;">"Cylinders"</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;                Cylinders             </span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1 Gears                3      4     5</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2     0 16.1066666666667  21.05  &lt;NA&gt;</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3     1             &lt;NA&gt; 26.275 21.38      </span>
</pre>
</div>
</div>
</div>
<div id="org9415f0d" class="outline-4">
<h4 id="org9415f0d"><span class="section-number-4">12.27.9</span> top<sub>levels</sub></h4>
<div class="outline-text-4" id="text-12-27-9">
<p>
Generate a frequency table of a factor grouped into top-n, bottom-n, and all other levels.
</p>
<div class="org-src-container">
<pre class="src src-R">top_levels(as.factor(mtcars$hp), <span style="color: #008b8b;">2</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;                  as.factor(mtcars$hp)  n percent</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;                                52, 62  2  0.0625</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  &lt;&lt;&lt; Middle Group (18 categories) &gt;&gt;&gt; 28  0.8750</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;                              264, 335  2  0.0625</span>
</pre>
</div>
</div>
</div>
<div id="org16b664c" class="outline-4">
<h4 id="org16b664c"><span class="section-number-4">12.27.10</span> clean<sub>names</sub></h4>
<div class="outline-text-4" id="text-12-27-10">
<p>
Resulting names are unique and consist only of the _ character, numbers, and letters. Capitalization preferences can be specified using the case parameter.
</p>

<p>
clean<sub>names</sub>(dat, case = c("snake", "lower<sub>camel</sub>",
  "upper<sub>camel</sub>", "screaming<sub>snake</sub>", "lower<sub>upper</sub>", "upper<sub>lower</sub>",
  "all<sub>caps</sub>", "small<sub>camel</sub>", "big<sub>camel</sub>", "old<sub>janitor</sub>", "parsed", "mixed",
  "none"))
</p>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #008b8b;">library</span>(janitor)
<span style="color: #008b8b;">library</span>(dplyr)
df <span style="color: #008b8b;">&lt;-</span> tibble(
    Date = <span style="color: #8b2252;">"2020-02-01"</span>,
    <span style="color: #000000; background-color: #ffffff;">`Dollars Earned`</span> = <span style="color: #008b8b;">10</span>,
    <span style="color: #000000; background-color: #ffffff;">`% Loss`</span> = <span style="color: #008b8b;">5</span>,
    <span style="color: #000000; background-color: #ffffff;">`2020 Total`</span> = <span style="color: #008b8b;">100</span>
)

                                  <span style="color: #b22222;"># </span><span style="color: #b22222;">Clean up the column names, make them easier (and safer!) to use!</span>
clean_names(df)
<span style="color: #b22222;">## </span><span style="color: #b22222;"># A tibble: 1 x 4</span>
<span style="color: #b22222;">##   </span><span style="color: #b22222;">date       dollars_earned percent_loss x2020_total</span>
<span style="color: #b22222;">##   </span><span style="color: #b22222;">&lt;chr&gt;               &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt;</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">1 2020-02-01             10            5         100</span>
</pre>
</div>
</div>
</div>
<div id="org89cab9a" class="outline-4">
<h4 id="org89cab9a"><span class="section-number-4">12.27.11</span> adorn<sub>rounding</sub></h4>
<div class="outline-text-4" id="text-12-27-11">
<p>
Round the numeric columns in a data.frame.
</p>
<div class="org-src-container">
<pre class="src src-R">mtcars <span style="color: #008b8b;">%&gt;%</span>
    tabyl(am, cyl) <span style="color: #008b8b;">%&gt;%</span>
    adorn_percentages() <span style="color: #008b8b;">%&gt;%</span>
    adorn_rounding(digits = <span style="color: #008b8b;">2</span>, rounding = <span style="color: #8b2252;">"half up"</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  am    4    6    8</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   0 0.16 0.21 0.63</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   1 0.62 0.23 0.15 </span>
</pre>
</div>
</div>
</div>
</div>

<div id="orga7eee06" class="outline-3">
<h3 id="orga7eee06"><span class="section-number-3">12.28</span> parallel</h3>
<div class="outline-text-3" id="text-12-28">
</div>
<div id="orgac1f3cc" class="outline-4">
<h4 id="orgac1f3cc"><span class="section-number-4">12.28.1</span> mclapply</h4>
<div class="outline-text-4" id="text-12-28-1">
<p>
Parallel Versions of lapply and mapply using Forking.
</p>
<div class="org-src-container">
<pre class="src src-R">mclapply(rep(<span style="color: #008b8b;">4</span>, <span style="color: #008b8b;">5</span>), rnorm, mc.preschedule = <span style="color: #228b22;">FALSE</span>,
         mc.set.seed = <span style="color: #228b22;">FALSE</span>)
</pre>
</div>
</div>
</div>
<div id="org65ab167" class="outline-4">
<h4 id="org65ab167"><span class="section-number-4">12.28.2</span> mcMap</h4>
<div class="outline-text-4" id="text-12-28-2">
<p>
这个函数就是 parallel 版本的 Map.
</p>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;"># </span><span style="color: #b22222;">Generate some sample data</span>
xs <span style="color: #008b8b;">&lt;-</span> replicate(<span style="color: #008b8b;">5</span>, runif(<span style="color: #008b8b;">10</span>), simplify = <span style="color: #228b22;">FALSE</span>)
xs
ws <span style="color: #008b8b;">&lt;-</span> replicate(<span style="color: #008b8b;">5</span>, rpois(<span style="color: #008b8b;">10</span>, <span style="color: #008b8b;">5</span>) + <span style="color: #008b8b;">1</span>, simplify = <span style="color: #228b22;">FALSE</span>)
ws
mcMap(weighted.mean, xs, ws)
</pre>
</div>
</div>
</div>
<div id="org91259b1" class="outline-4">
<h4 id="org91259b1"><span class="section-number-4">12.28.3</span> parSapply</h4>
<div class="outline-text-4" id="text-12-28-3">
<div class="org-src-container">
<pre class="src src-R"><span style="color: #008b8b;">library</span>(parallel)
cl <span style="color: #008b8b;">&lt;-</span> makeCluster(getOption(<span style="color: #8b2252;">"cl.cores"</span>, <span style="color: #008b8b;">2</span>))
parSapply(cl, <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">20</span>, get(<span style="color: #8b2252;">"+"</span>), <span style="color: #008b8b;">3</span>)      
</pre>
</div>
</div>
</div>
</div>
<div id="orgeedee08" class="outline-3">
<h3 id="orgeedee08"><span class="section-number-3">12.29</span> tidyselect</h3>
<div class="outline-text-3" id="text-12-29">
</div>
<div id="org61659ea" class="outline-4">
<h4 id="org61659ea"><span class="section-number-4">12.29.1</span> vars<sub>select</sub></h4>
<div class="outline-text-4" id="text-12-29-1">
<p>
该函数可以针对特定的字符串进行选择。
</p>
<div class="org-src-container">
<pre class="src src-R">nms <span style="color: #008b8b;">&lt;-</span> names(iris)
nms <span style="color: #008b8b;">%&gt;%</span> vars_select(starts_with(<span style="color: #8b2252;">"Petal"</span>)) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25148;&#15974;&#25404;&#15929;&#25660;&#15922;&#25660;&#15924;&#25660;&#15923;&#25404;&#15923;&#25404;&#15920;&#25148;&#15924;&#1121;&#25660;&#15924;&#26172;&#15921;&#25660;&#15927;&#1463;&#26172;&#15970;&#25660;&#15920;&#25404;&#15972;&#25404;&#15969;&#26172;&#15972;&#25148;&#15973;&#25660;&#15972;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   Petal.Length    Petal.Width </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; "Petal.Length"  "Petal.Width"</span>
vars_select(nms, ends_with(<span style="color: #8b2252;">"Width"</span>))
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   Sepal.Width   Petal.Width </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; "Sepal.Width" "Petal.Width"</span>
vars_select(nms, contains(<span style="color: #8b2252;">"etal"</span>))
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   Petal.Length    Petal.Width </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; "Petal.Length"  "Petal.Width"</span>
vars_select(nms, matches(<span style="color: #8b2252;">".t."</span>)) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25660;&#15925;&#25916;&#15922;&#25148;&#15928;&#26172;&#15926;match(".t.") &#25148;&#15969;&#25660;&#15971;&#25660;&#15923;&#25660;&#15920;&#25660;&#15922;&#25916;&#15922;&#764;&#24892;&#15921;&#24892;&#15923;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   Sepal.Length    Sepal.Width   Petal.Length    Petal.Width </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; "Sepal.Length"  "Sepal.Width" "Petal.Length"  "Petal.Width"</span>
vars_select(nms, Petal.Length, Petal.Width)
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   Petal.Length    Petal.Width </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; "Petal.Length"  "Petal.Width"</span>
vars_select(nms, everything())
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   Sepal.Length    Sepal.Width   Petal.Length    Petal.Width        Species </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; "Sepal.Length"  "Sepal.Width" "Petal.Length"  "Petal.Width"      "Species"</span>
vars_select(nms, last_col())
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   Species </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; "Species"</span>
vars_select(nms, last_col(offset = <span style="color: #008b8b;">2</span>))
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   Petal.Length </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; "Petal.Length"</span>
vars <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #8b2252;">"Petal.Length"</span>, <span style="color: #8b2252;">"Petal.Width"</span>)
vars_select(nms, one_of(vars))
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   Petal.Length    Petal.Width </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; "Petal.Length"  "Petal.Width"</span>
df <span style="color: #008b8b;">&lt;-</span> as.data.frame(matrix(runif(<span style="color: #008b8b;">100</span>), nrow = <span style="color: #008b8b;">10</span>))
df <span style="color: #008b8b;">&lt;-</span> df[c(<span style="color: #008b8b;">3</span>, <span style="color: #008b8b;">4</span>, <span style="color: #008b8b;">7</span>, <span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">9</span>, <span style="color: #008b8b;">8</span>, <span style="color: #008b8b;">5</span>, <span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">6</span>, <span style="color: #008b8b;">10</span>)]
select_vars(names(df), num_range(<span style="color: #8b2252;">"V"</span>, <span style="color: #008b8b;">4</span>:<span style="color: #008b8b;">6</span>))
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Warning: select_vars() is deprecated. </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Please use tidyselect::vars_select() instead</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; This warning is displayed once per session.</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   V4   V5   V6 </span>
                                        <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; "V4" "V5" "V6"</span>
                                        <span style="color: #b22222;"># </span><span style="color: #b22222;">`!` negates a selection:</span>
vars_select(nms, !ends_with(<span style="color: #8b2252;">"Width"</span>))
                                        <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   Sepal.Length   Petal.Length        Species </span>
                                        <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; "Sepal.Length" "Petal.Length"      "Species"</span>
                                        <span style="color: #b22222;"># </span><span style="color: #b22222;">`&amp;` and `|` take the intersection or the union of two selections:</span>
                                        <span style="color: #b22222;"># </span><span style="color: #b22222;">`&amp;` and `|` take the intersection or the union of two selections:</span>
vars_select(nms, starts_with(<span style="color: #8b2252;">"Petal"</span>) &amp; ends_with(<span style="color: #8b2252;">"Width"</span>))
                                        <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   Petal.Width </span>
                                        <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; "Petal.Width"</span>
vars_select(nms, starts_with(<span style="color: #8b2252;">"Petal"</span>) | ends_with(<span style="color: #8b2252;">"Width"</span>))
                                        <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   Petal.Length    Petal.Width    Sepal.Width </span>
                                        <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; "Petal.Length"  "Petal.Width"  "Sepal.Width"</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">`/` takes the difference of two selections</span>
vars_select(nms, starts_with(<span style="color: #8b2252;">"Petal"</span>) / ends_with(<span style="color: #8b2252;">"Width"</span>))
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   Petal.Length </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; "Petal.Length"</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">`all_of()` selects the variables in a character vector:</span>
vars <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #8b2252;">"Petal.Length"</span>, <span style="color: #8b2252;">"Petal.Width"</span>)
vars_select(nms, all_of(vars))
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   Petal.Length    Petal.Width </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; "Petal.Length"  "Petal.Width"</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">Whereas `all_of()` is strict, `any_of()` allows missing</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">variables.</span>
try(vars_select(nms, all_of(c(<span style="color: #8b2252;">"Species"</span>, <span style="color: #8b2252;">"Genres"</span>))))
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Error : Can't subset columns that don't exist.</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; x The column `Genres` doesn't exist.</span>
vars_select(nms, any_of(c(<span style="color: #8b2252;">"Species"</span>, <span style="color: #8b2252;">"Genres"</span>)))
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   Species </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; "Species"</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">The lax variant is especially useful to make sure a variable is</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">selected out:</span>
vars_select(nms, -any_of(c(<span style="color: #8b2252;">"Species"</span>, <span style="color: #8b2252;">"Genres"</span>)))
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   Sepal.Length    Sepal.Width   Petal.Length    Petal.Width </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; "Sepal.Length"  "Sepal.Width" "Petal.Length"  "Petal.Width"</span>

<span style="color: #b22222;"># </span><span style="color: #b22222;">The order of selected columns is determined from the inputs</span>
vars_select(names(mtcars), starts_with(<span style="color: #8b2252;">"c"</span>), starts_with(<span style="color: #8b2252;">"d"</span>))
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;    cyl   carb   disp   drat </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  "cyl" "carb" "disp" "drat"</span>
vars_select(names(mtcars), one_of(c(<span style="color: #8b2252;">"carb"</span>, <span style="color: #8b2252;">"mpg"</span>)))
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   carb    mpg </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; "carb"  "mpg"  </span>
</pre>
</div>
</div>
</div>

<div id="orgf00cbb6" class="outline-4">
<h4 id="orgf00cbb6"><span class="section-number-4">12.29.2</span> vars<sub>pull</sub></h4>
<div class="outline-text-4" id="text-12-29-2">
<p>
vars<sub>pull</sub> 可以摘取固定位置上的字符。
</p>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;"># </span><span style="color: #b22222;">You can unquote variables:</span>
var <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">10</span>
vars_pull(letters, !! var)
vars_pull(letters, c)
</pre>
</div>
</div>
</div>

<div id="org4ce6552" class="outline-4">
<h4 id="org4ce6552"><span class="section-number-4">12.29.3</span> eval<sub>select</sub></h4>
<div class="outline-text-4" id="text-12-29-3">
<div class="org-src-container">
<pre class="src src-R"><span style="color: #0000ff;">select_var</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>(.data,var){
    expr <span style="color: #008b8b;">&lt;-</span> rlang::enquo(var)
    pos <span style="color: #008b8b;">&lt;-</span> tidyselect::eval_select(expr,data = .data)
    rlang::set_names(.data[pos],names(pos))
}

mtcars <span style="color: #008b8b;">%&gt;%</span> select_var(c(mpg,cyl))

</pre>
</div>
</div>
</div>

<div id="org3a4de33" class="outline-4">
<h4 id="org3a4de33"><span class="section-number-4">12.29.4</span> vars<sub>rename</sub></h4>
<div class="outline-text-4" id="text-12-29-4">
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;"># </span><span style="color: #b22222;">Rename variables preserving all existing</span>
vars_rename(names(iris), petal_length = Petal.Length)
</pre>
</div>
</div>
</div>

<div id="org20e750d" class="outline-4">
<h4 id="org20e750d"><span class="section-number-4">12.29.5</span> poker<sub>vars</sub>/peek<sub>vars</sub></h4>
<div class="outline-text-4" id="text-12-29-5">
<p>
peek<sub>vars</sub>() returns the variables currently registered.
</p>
<div class="org-src-container">
<pre class="src src-R">poke_vars(letters)
peek_vars()
</pre>
</div>
</div>
</div>

<div id="orgbf693d5" class="outline-4">
<h4 id="orgbf693d5"><span class="section-number-4">12.29.6</span> eval<sub>rename</sub></h4>
<div class="outline-text-4" id="text-12-29-6">
<p>
eval<sub>select</sub>() and eval<sub>rename</sub>() evaluate defused R code (i.e. quoted expressions) according to the special rules of the tidyselect syntax. They power functions like dplyr::select(), dplyr::rename(), or tidyr::pivot<sub>longer</sub>().
</p>
<div class="org-src-container">
<pre class="src src-R">
</pre>
</div>
</div>
</div>
<div id="orgeac1c61" class="outline-4">
<h4 id="orgeac1c61"><span class="section-number-4">12.29.7</span> where</h4>
<div class="outline-text-4" id="text-12-29-7">
<p>
select variables with a function. where(fn).
</p>

<div class="org-src-container">
<pre class="src src-R">iris <span style="color: #008b8b;">%&gt;%</span> 
    select(where(is.numeric)) <span style="color: #008b8b;">%&gt;%</span> 
    head()  
</pre>
</div>

<p>
选择所有数字型以及均值大于 3.5 的变量。
</p>
<div class="org-src-container">
<pre class="src src-R">iris <span style="color: #008b8b;">%&gt;%</span> 
    select(where(~ is.numeric(.x) &amp; mean(.x) &gt; <span style="color: #008b8b;">3.5</span>))
</pre>
</div>
</div>
</div>
</div>

<div id="orge8c988c" class="outline-3">
<h3 id="orge8c988c"><span class="section-number-3">12.30</span> forcats</h3>
<div class="outline-text-3" id="text-12-30">
</div>
<div id="org9ac7255" class="outline-4">
<h4 id="org9ac7255"><span class="section-number-4">12.30.1</span> as<sub>factor</sub></h4>
<div class="outline-text-4" id="text-12-30-1">
<p>
    相比较 baseR,as<sub>factor</sub> 能够保留原始 string 的字符水平。需要注意的是，character,factor,numeric 都可以转化为 factor 型。
</p>
<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #8b2252;">"a"</span>,<span style="color: #8b2252;">"z"</span>,<span style="color: #8b2252;">"g"</span>)
as_factor(x)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] a z g</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">Levels: a z g</span>
as.factor(x)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] a z g</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">Levels: a g z</span>
y <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #8b2252;">"1.1"</span>, <span style="color: #8b2252;">"11"</span>, <span style="color: #8b2252;">"2.2"</span>, <span style="color: #8b2252;">"22"</span>)
as_factor(y)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] 1.1 11  2.2 22 </span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">Levels: 1.1 11 2.2 22</span>
as.factor(y)      
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] 1.1 11  2.2 22 </span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">Levels: 1.1 11 2.2 22</span>
</pre>
</div>
</div>
</div>
<div id="orge09b93d" class="outline-4">
<h4 id="orge09b93d"><span class="section-number-4">12.30.2</span> fct<sub>anon</sub></h4>
<div class="outline-text-4" id="text-12-30-2">
<p>
Anonymise factor levels.Replaces factor levels with arbitary numeric identifiers. Neither the values nor the order of the levels are preserved.
</p>
<div class="org-src-container">
<pre class="src src-R">gss_cat$relig <span style="color: #008b8b;">%&gt;%</span> fct_count()
                                      <span style="color: #b22222;"># </span><span style="color: #b22222;">A tibble: 16 x 2</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">f                           n</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">&lt;fct&gt;                   &lt;int&gt;</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">1 No answer                  93</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">2 Don't know                 15</span>
gss_cat$relig <span style="color: #008b8b;">%&gt;%</span> fct_anon() <span style="color: #008b8b;">%&gt;%</span> fct_count()
                                      <span style="color: #b22222;"># </span><span style="color: #b22222;">A tibble: 16 x 2</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">f         n</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">&lt;fct&gt; &lt;int&gt;</span>
           <span style="color: #b22222;">## </span><span style="color: #b22222;">1 01      224</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">2 02      109</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">3 03      689</span>
</pre>
</div>
</div>
</div>
<div id="org49add48" class="outline-4">
<h4 id="org49add48"><span class="section-number-4">12.30.3</span> fct<sub>c</sub></h4>
<div class="outline-text-4" id="text-12-30-3">
<p>
Concatenate factors, combining levels,This is a useful way of patching together factors from multiple sources that really should have the same levels but don't.
</p>
<div class="org-src-container">
<pre class="src src-R">fa <span style="color: #008b8b;">&lt;-</span> factor(<span style="color: #8b2252;">"a"</span>)
fb <span style="color: #008b8b;">&lt;-</span> factor(<span style="color: #8b2252;">"b"</span>)
fab <span style="color: #008b8b;">&lt;-</span> factor(c(<span style="color: #8b2252;">"a"</span>, <span style="color: #8b2252;">"b"</span>))
c(fa, fb, fab) <span style="color: #008b8b;">%&gt;%</span> str
<span style="color: #b22222;">## </span><span style="color: #b22222;">int [1:4] 1 1 1 2</span>
fct_c(fa, fb, fab) <span style="color: #008b8b;">%&gt;%</span> str
<span style="color: #b22222;">## </span><span style="color: #b22222;">Factor w/ 2 levels "a","b": 1 2 1 2</span>
</pre>
</div>
</div>
</div>
<div id="org874977e" class="outline-4">
<h4 id="org874977e"><span class="section-number-4">12.30.4</span> fct<sub>collapse</sub></h4>
<div class="outline-text-4" id="text-12-30-4">
<p>
如果想要合并多个水平，那么可以使用 fct<sub>recode</sub>() 函数的变体 fct<sub>collapse</sub>() 函数。对于每个新水平，你都可以提供一个包含原水平的向量。
Collapse factor levels into manually defined groups.Collapse factor levels into manually defined groups
</p>
<div class="org-src-container">
<pre class="src src-R">partyid2 <span style="color: #008b8b;">&lt;-</span> fct_collapse(gss_cat$partyid,
                         missing = c(<span style="color: #8b2252;">"No answer"</span>, <span style="color: #8b2252;">"Don't know"</span>),
                         other = <span style="color: #8b2252;">"Other party"</span>,
                         rep = c(<span style="color: #8b2252;">"Strong republican"</span>, <span style="color: #8b2252;">"Not str republican"</span>),
                         ind = c(<span style="color: #8b2252;">"Ind,near rep"</span>, <span style="color: #8b2252;">"Independent"</span>, <span style="color: #8b2252;">"Ind,near dem"</span>),
                         dem = c(<span style="color: #8b2252;">"Not str democrat"</span>, <span style="color: #8b2252;">"Strong democrat"</span>)
                         )
fct_count(partyid2)
fct_count(gss_cat$partyid)  
</pre>
</div>
</div>
</div>
<div id="org98bc8ed" class="outline-4">
<h4 id="org98bc8ed"><span class="section-number-4">12.30.5</span> fct<sub>count</sub></h4>
<div class="outline-text-4" id="text-12-30-5">
<div class="org-src-container">
<pre class="src src-R">f <span style="color: #008b8b;">&lt;-</span> factor(sample(letters)[rpois(<span style="color: #008b8b;">1000</span>, <span style="color: #008b8b;">10</span>)])
table(f)
fct_count(f)
                                  <span style="color: #b22222;"># </span><span style="color: #b22222;">A tibble: 20 x 2</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">f         n</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">&lt;fct&gt; &lt;int&gt;</span>
<span style="color: #b22222;">##            </span><span style="color: #b22222;">1 a         4</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">2 c        83</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">3 d        99</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">4 e         8</span>
fct_count(f, sort = <span style="color: #228b22;">TRUE</span>)
                                  <span style="color: #b22222;"># </span><span style="color: #b22222;">A tibble: 20 x 2</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">f         n</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">&lt;fct&gt; &lt;int&gt;</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">1 u       129</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">2 m       122</span>
fct_count(f, sort = <span style="color: #228b22;">TRUE</span>, prop = <span style="color: #228b22;">TRUE</span>)
                                  <span style="color: #b22222;"># </span><span style="color: #b22222;">A tibble: 20 x 3</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">f         n     p</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">&lt;fct&gt; &lt;int&gt; &lt;dbl&gt;</span>
                 <span style="color: #b22222;">## </span><span style="color: #b22222;">1 u       129 0.129</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">2 m       122 0.122</span>
</pre>
</div>
</div>
</div>
<div id="orgfdef633" class="outline-4">
<h4 id="orgfdef633"><span class="section-number-4">12.30.6</span> fct<sub>cross</sub></h4>
<div class="outline-text-4" id="text-12-30-6">
<p>
fct<sub>cross</sub>(.f, &#x2026;, sep = ":", keep<sub>empty</sub> = FALSE)
</p>
<div class="org-src-container">
<pre class="src src-R">fruit <span style="color: #008b8b;">&lt;-</span> factor(c(<span style="color: #8b2252;">"apple"</span>, <span style="color: #8b2252;">"kiwi"</span>, <span style="color: #8b2252;">"apple"</span>, <span style="color: #8b2252;">"apple"</span>))
colour <span style="color: #008b8b;">&lt;-</span> factor(c(<span style="color: #8b2252;">"green"</span>, <span style="color: #8b2252;">"green"</span>, <span style="color: #8b2252;">"red"</span>, <span style="color: #8b2252;">"green"</span>))
eaten <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #8b2252;">"yes"</span>, <span style="color: #8b2252;">"no"</span>, <span style="color: #8b2252;">"yes"</span>, <span style="color: #8b2252;">"no"</span>)
fct_cross(fruit, colour)  
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] apple:green kiwi:green  apple:red   apple:green</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">Levels: apple:green apple:red kiwi:green</span>
fct_cross(fruit, colour, keep_empty = <span style="color: #228b22;">TRUE</span>)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] apple:green kiwi:green  apple:red   apple:green</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">Levels: apple:green kiwi:green apple:red kiwi:red</span>
</pre>
</div>
</div>
</div>
<div id="org83ccfef" class="outline-4">
<h4 id="org83ccfef"><span class="section-number-4">12.30.7</span> fct<sub>expand</sub></h4>
<div class="outline-text-4" id="text-12-30-7">
<p>
Add additional levels to a factor。
</p>
<div class="org-src-container">
<pre class="src src-R">f <span style="color: #008b8b;">&lt;-</span> factor(sample(letters[<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>], <span style="color: #008b8b;">20</span>, replace = <span style="color: #228b22;">TRUE</span>))
f
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] b b a c b b a a a b a a b a c a c a a c</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">Levels: a b c</span>
fct_expand(f, <span style="color: #8b2252;">"d"</span>, <span style="color: #8b2252;">"e"</span>, <span style="color: #8b2252;">"f"</span>)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] b b a c b b a a a b a a b a c a c a a c</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">Levels: a b c d e f</span>
</pre>
</div>
</div>
</div>
<div id="org67929b5" class="outline-4">
<h4 id="org67929b5"><span class="section-number-4">12.30.8</span> fct<sub>explicit</sub><sub>na</sub></h4>
<div class="outline-text-4" id="text-12-30-8">
<p>
Make missing values explicit. 
</p>
<div class="org-src-container">
<pre class="src src-R">f1 <span style="color: #008b8b;">&lt;-</span> factor(c(<span style="color: #8b2252;">"a"</span>, <span style="color: #8b2252;">"a"</span>, <span style="color: #228b22;">NA</span>, <span style="color: #228b22;">NA</span>, <span style="color: #8b2252;">"a"</span>, <span style="color: #8b2252;">"b"</span>, <span style="color: #228b22;">NA</span>, <span style="color: #8b2252;">"c"</span>, <span style="color: #8b2252;">"a"</span>, <span style="color: #8b2252;">"c"</span>, <span style="color: #8b2252;">"b"</span>))
table(f1)
<span style="color: #b22222;">## </span><span style="color: #b22222;">f1</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">a b c </span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">4 2 2 </span>
table(f1,useNA = <span style="color: #8b2252;">"ifany"</span>)
<span style="color: #b22222;">## </span><span style="color: #b22222;">f1</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">a    b    c &lt;NA&gt; </span>
              <span style="color: #b22222;">## </span><span style="color: #b22222;">4    2    2    3 </span>
f2 <span style="color: #008b8b;">&lt;-</span> fct_explicit_na(f1)
table(f2)
<span style="color: #b22222;">## </span><span style="color: #b22222;">f2</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">a         b         c (Missing) </span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">4         2         2         3 </span>
</pre>
</div>
</div>
</div>
<div id="org9db9d99" class="outline-4">
<h4 id="org9db9d99"><span class="section-number-4">12.30.9</span> fct<sub>inorder</sub>/fct<sub>infreq</sub>/fct<sub>inseq</sub></h4>
<div class="outline-text-4" id="text-12-30-9">
<p>
Reorder factors levels by first appearance, frequency, or numeric order.
</p>
<div class="org-src-container">
<pre class="src src-R">f <span style="color: #008b8b;">&lt;-</span> factor(c(<span style="color: #8b2252;">"b"</span>, <span style="color: #8b2252;">"b"</span>, <span style="color: #8b2252;">"a"</span>, <span style="color: #8b2252;">"c"</span>, <span style="color: #8b2252;">"c"</span>, <span style="color: #8b2252;">"c"</span>))
f
fct_inorder(f)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] b b a c c c</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">Levels: b a c</span>
fct_infreq(f)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] b b a c c c</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">Levels: c b a</span>
f <span style="color: #008b8b;">&lt;-</span> factor(sample(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">10</span>))
fct_inseq(f)      
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] 8  9  6  5  1  2  10 7  4  3 </span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">Levels: 1 2 3 4 5 6 7 8 9 10</span>
</pre>
</div>
</div>
</div>
<div id="orgbfe88c9" class="outline-4">
<h4 id="orgbfe88c9"><span class="section-number-4">12.30.10</span> fct<sub>lump</sub></h4>
<div class="outline-text-4" id="text-12-30-10">
<p>
fct<sub>lump</sub>(f, n, prop, w = NULL, other<sub>level</sub> = "Other",
  ties.method = c("min", "average", "first", "last", "random", "max")).
</p>

<p>
Arguments
f 
A factor (or character vector).
</p>

<p>
n, prop 
If both n and prop are missing, fct<sub>lump</sub> lumps together the least frequent levels into "other", while ensuring that "other" is still the smallest level. It's particularly useful in conjunction with fct<sub>inorder</sub>().
</p>

<p>
Positive n preserves the most common n values. Negative n preserves the least common -n values. It there are ties, you will get at least abs(n) values.
</p>

<p>
Positive prop preserves values that appear at least prop of the time. Negative prop preserves values that appear at most -prop of the time.
</p>

<p>
w 
An optional numeric vector giving weights for frequency of each value (not level) in f.
</p>

<p>
other<sub>level</sub> 
Value of level used for "other" values. Always placed at end of levels.
</p>

<p>
ties.method 
A character string specifying how ties are treated. See rank() for details.
</p>

<p>
min 
Preserves values that appear at least min number of times.
</p>

<p>
Lump together least/most common factor levels into "other". 这个函数默认的是如果其他因子 level 相加小于另一个因子水平，那么就 rename="other".
</p>

<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> factor(rep(LETTERS[<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">9</span>], times = c(<span style="color: #008b8b;">40</span>, <span style="color: #008b8b;">10</span>, <span style="color: #008b8b;">5</span>, <span style="color: #008b8b;">27</span>, <span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">1</span>)))
x <span style="color: #008b8b;">%&gt;%</span> table()
<span style="color: #b22222;">## </span><span style="color: #b22222;">.</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">A  B  C  D  E  F  G  H  I </span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">40 10  5 27  1  1  1  1  1 </span>

x <span style="color: #008b8b;">%&gt;%</span> fct_lump() <span style="color: #008b8b;">%&gt;%</span> table()
<span style="color: #b22222;">## </span><span style="color: #b22222;">.</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">A     D Other </span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">40    27    20 </span>
x <span style="color: #008b8b;">%&gt;%</span> fct_lump() <span style="color: #008b8b;">%&gt;%</span> fct_inorder() <span style="color: #008b8b;">%&gt;%</span> table()
<span style="color: #b22222;">## </span><span style="color: #b22222;">.</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">A Other     D </span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">40    20    27</span>
                                        <span style="color: #b22222;"># </span><span style="color: #b22222;">Use negative values to collapse the most common</span>
fct_lump(x, n = -<span style="color: #008b8b;">3</span>)
fct_lump(x, prop = -<span style="color: #008b8b;">0.1</span>)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> factor(letters[rpois(<span style="color: #008b8b;">100</span>, <span style="color: #008b8b;">5</span>)])
x
fct_lump_min(x, min = <span style="color: #008b8b;">10</span>)      
</pre>
</div>

<div class="org-src-container">
<pre class="src src-R">   <span style="color: #008b8b;">library</span>(forcats)
<span style="color: #008b8b;">library</span>(dplyr)

nintendo <span style="color: #008b8b;">&lt;-</span> tribble(
  ~console, ~hardware_sales_million,
  <span style="color: #8b2252;">"Nintendo Switch"</span>, <span style="color: #008b8b;">52.48</span>,
  <span style="color: #8b2252;">"Nintendo 3DS"</span>, <span style="color: #008b8b;">75.71</span>,
  <span style="color: #8b2252;">"Wii U"</span>, <span style="color: #008b8b;">13.56</span>,
  <span style="color: #8b2252;">"Wii"</span>, <span style="color: #008b8b;">101.63</span>,
  <span style="color: #8b2252;">"Nintendo DS"</span>, <span style="color: #008b8b;">154.02</span>,
  <span style="color: #8b2252;">"Game Boy Advance"</span>, <span style="color: #008b8b;">81.51</span>,
  <span style="color: #8b2252;">"Game Boy"</span>, <span style="color: #008b8b;">118.69</span>,
  <span style="color: #8b2252;">"Nintendo GameCube"</span>, <span style="color: #008b8b;">21.74</span>,
  <span style="color: #8b2252;">"Nintendo 64"</span>, <span style="color: #008b8b;">32.93</span>,
  <span style="color: #8b2252;">"SNES"</span>, <span style="color: #008b8b;">49.10</span>,
  <span style="color: #8b2252;">"NES"</span>, <span style="color: #008b8b;">61.91</span>
)

<span style="color: #b22222;"># </span><span style="color: #b22222;">Use fct_lump_n() to lump together everything except the top 5</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">Supply w (weight) because the frequency is pre-aggregated</span>
nintendo <span style="color: #008b8b;">%&gt;%</span>
  mutate(console = fct_lump_n(console, n = <span style="color: #008b8b;">5</span>, w = hardware_sales_million))
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; # A tibble: 11 x 2</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;    console          hardware_sales_million</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;    &lt;fct&gt;                             &lt;dbl&gt;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  1 Other                              52.5</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  2 Nintendo 3DS                       75.7</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  3 Other                              13.6</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  4 Wii                               102. </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  5 Nintendo DS                       154. </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  6 Game Boy Advance                   81.5</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  7 Game Boy                          119. </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  8 Other                              21.7</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  9 Other                              32.9</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 10 Other                              49.1</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 11 Other                              61.9</span>

nintendo <span style="color: #008b8b;">%&gt;%</span>
  mutate(console = fct_lump_min(console, min = <span style="color: #008b8b;">50</span>, w = hardware_sales_million, other_level = <span style="color: #8b2252;">"Other Consoles"</span>))
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; # A tibble: 11 x 2</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;    console          hardware_sales_million</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;    &lt;fct&gt;                             &lt;dbl&gt;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  1 Nintendo Switch                    52.5</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  2 Nintendo 3DS                       75.7</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  3 Other Consoles                     13.6</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  4 Wii                               102. </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  5 Nintendo DS                       154. </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  6 Game Boy Advance                   81.5</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  7 Game Boy                          119. </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  8 Other Consoles                     21.7</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  9 Other Consoles                     32.9</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 10 Other Consoles                     49.1</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 11 NES                                61.9</span>

nintendo <span style="color: #008b8b;">%&gt;%</span>
  mutate(console = fct_lump_prop(console, prop = <span style="color: #008b8b;">0.20</span>, w = hardware_sales_million))
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; # A tibble: 11 x 2</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;    console     hardware_sales_million</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;    &lt;fct&gt;                        &lt;dbl&gt;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  1 Other                         52.5</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  2 Other                         75.7</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  3 Other                         13.6</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  4 Other                        102. </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  5 Nintendo DS                  154. </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  6 Other                         81.5</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  7 Other                        119. </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  8 Other                         21.7</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  9 Other                         32.9</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 10 Other                         49.1</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 11 Other                         61.9   </span>
</pre>
</div>
</div>
</div>

<div id="orgbe537c9" class="outline-4">
<h4 id="orgbe537c9"><span class="section-number-4">12.30.11</span> fct<sub>match</sub></h4>
<div class="outline-text-4" id="text-12-30-11">
<p>
Test for presence of levels in a factor.
</p>
<div class="org-src-container">
<pre class="src src-R">fct_match(gss_cat$marital, c(<span style="color: #8b2252;">"Married"</span>, <span style="color: #8b2252;">"Divorced"</span>))
table(fct_match(gss_cat$marital, c(<span style="color: #8b2252;">"Married"</span>, <span style="color: #8b2252;">"Divorced"</span>)))
<span style="color: #b22222;">## </span><span style="color: #b22222;">FALSE  TRUE </span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">7983 13500 </span>
</pre>
</div>
</div>
</div>
<div id="orgf86f9c6" class="outline-4">
<h4 id="orgf86f9c6"><span class="section-number-4">12.30.12</span> fct<sub>other</sub></h4>
<div class="outline-text-4" id="text-12-30-12">
<p>
Replace levels with "other".
</p>
<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> factor(rep(LETTERS[<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">6</span>], times = c(<span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">1</span>)))
fct_other(x, keep = c(<span style="color: #8b2252;">"A"</span>, <span style="color: #8b2252;">"B"</span>))
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] A     A     B     B     Other Other Other Other Other</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">Levels: A B Other</span>
fct_other(x, drop = c(<span style="color: #8b2252;">"A"</span>, <span style="color: #8b2252;">"B"</span>))      
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] Other Other Other Other C     D     D     E     F    </span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">Levels: C D E F Other</span>
</pre>
</div>
</div>
</div>
<div id="org19f3672" class="outline-4">
<h4 id="org19f3672"><span class="section-number-4">12.30.13</span> fct<sub>recode</sub></h4>
<div class="outline-text-4" id="text-12-30-13">
<p>
Change factor levels by hand.
</p>
<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> factor(c(<span style="color: #8b2252;">"apple"</span>, <span style="color: #8b2252;">"bear"</span>, <span style="color: #8b2252;">"banana"</span>, <span style="color: #8b2252;">"dear"</span>))
fct_recode(x, fruit = <span style="color: #8b2252;">"apple"</span>, fruit = <span style="color: #8b2252;">"banana"</span>)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] fruit bear  fruit dear </span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">Levels: fruit bear dear</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-R">nintendo <span style="color: #008b8b;">&lt;-</span> tribble(
    ~console, ~hardware_sales_million,
    <span style="color: #8b2252;">"Nintendo Switch"</span>, <span style="color: #008b8b;">52.48</span>,
    <span style="color: #8b2252;">"Nintendo 3DS"</span>, <span style="color: #008b8b;">75.71</span>,
    <span style="color: #8b2252;">"Wii U"</span>, <span style="color: #008b8b;">13.56</span>,
    <span style="color: #8b2252;">"Wii"</span>, <span style="color: #008b8b;">101.63</span>,
    <span style="color: #8b2252;">"Nintendo DS"</span>, <span style="color: #008b8b;">154.02</span>,
    <span style="color: #8b2252;">"Game Boy Advance"</span>, <span style="color: #008b8b;">81.51</span>,
    <span style="color: #8b2252;">"Game Boy"</span>, <span style="color: #008b8b;">118.69</span>,
    <span style="color: #8b2252;">"Nintendo GameCube"</span>, <span style="color: #008b8b;">21.74</span>,
    <span style="color: #8b2252;">"Nintendo 64"</span>, <span style="color: #008b8b;">32.93</span>,
    <span style="color: #8b2252;">"SNES"</span>, <span style="color: #008b8b;">49.10</span>,
    <span style="color: #8b2252;">"NES"</span>, <span style="color: #008b8b;">61.91</span>
)

nintendo <span style="color: #008b8b;">%&gt;%</span>
    mutate(console = fct_reorder(console, hardware_sales_million)) <span style="color: #008b8b;">%&gt;%</span>
    pull(console) <span style="color: #008b8b;">%&gt;%</span>
    levels()
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [1] "Wii U"             "Nintendo GameCube" "Nintendo 64"      </span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [4] "SNES"              "Nintendo Switch"   "NES"              </span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [7] "Nintendo 3DS"      "Game Boy Advance"  "Wii"              </span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [10] "Game Boy"          "Nintendo DS"  </span>

nintendo <span style="color: #008b8b;">%&gt;%</span>
    mutate(console = fct_reorder(console, hardware_sales_million, .desc = <span style="color: #228b22;">TRUE</span>)) <span style="color: #008b8b;">%&gt;%</span>
    pull(console) <span style="color: #008b8b;">%&gt;%</span>
    levels()
<span style="color: #b22222;">##  </span><span style="color: #b22222;">[1] "Nintendo DS"       "Game Boy"          "Wii"              </span>
<span style="color: #b22222;">##  </span><span style="color: #b22222;">[4] "Game Boy Advance"  "Nintendo 3DS"      "NES"              </span>
<span style="color: #b22222;">##  </span><span style="color: #b22222;">[7] "Nintendo Switch"   "SNES"              "Nintendo 64"      </span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">[10] "Nintendo GameCube" "Wii U"</span>
</pre>
</div>
</div>
</div>

<div id="org99fe9c2" class="outline-4">
<h4 id="org99fe9c2"><span class="section-number-4">12.30.14</span> fct<sub>relabel</sub></h4>
<div class="outline-text-4" id="text-12-30-14">
<p>
Automatically relabel factor levels, collapse as necessary.
</p>
<div class="org-src-container">
<pre class="src src-R">gss_cat$partyid[<span style="color: #008b8b;">8</span>]
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] Ind,near dem</span>
gss_cat$partyid[<span style="color: #008b8b;">8</span>] <span style="color: #008b8b;">%&gt;%</span> fct_relabel(~ gsub(<span style="color: #8b2252;">","</span>, <span style="color: #8b2252;">", "</span>, .x))
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] Ind, near dem</span>
</pre>
</div>
</div>
</div>
<div id="org0111ac1" class="outline-4">
<h4 id="org0111ac1"><span class="section-number-4">12.30.15</span> fct<sub>relevel</sub></h4>
<div class="outline-text-4" id="text-12-30-15">
<p>
This is a generalisaton of stats::relevel() that allows you to move any number of levels to any location.
</p>
<div class="org-src-container">
<pre class="src src-R">f <span style="color: #008b8b;">&lt;-</span> factor(c(<span style="color: #8b2252;">"a"</span>, <span style="color: #8b2252;">"b"</span>, <span style="color: #8b2252;">"c"</span>, <span style="color: #8b2252;">"d"</span>), levels = c(<span style="color: #8b2252;">"b"</span>, <span style="color: #8b2252;">"c"</span>, <span style="color: #8b2252;">"d"</span>, <span style="color: #8b2252;">"a"</span>))
f
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] a b c d</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">Levels: b c d a</span>
fct_relevel(f)
fct_relevel(f, <span style="color: #8b2252;">"a"</span>)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] a b c d</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">Levels: a b c d</span>
fct_relevel(f, <span style="color: #8b2252;">"b"</span>, <span style="color: #8b2252;">"a"</span>)      
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] a b c d</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">Levels: b a c d</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">move to the third position</span>
fct_relevel(f, <span style="color: #8b2252;">"a"</span>, after = <span style="color: #008b8b;">2</span>)
                                  <span style="color: #b22222;"># </span><span style="color: #b22222;">Relevel to the end</span>
fct_relevel(f, <span style="color: #8b2252;">"a"</span>, after = <span style="color: #228b22;">Inf</span>)
fct_relevel(f, <span style="color: #8b2252;">"a"</span>, after = <span style="color: #008b8b;">3</span>)
                                  <span style="color: #b22222;"># </span><span style="color: #b22222;">Revel with a function</span>
fct_relevel(f, sort)
fct_relevel(f, sample)
fct_relevel(f, rev)
</pre>
</div>
</div>
</div>
<div id="org434c4d4" class="outline-4">
<h4 id="org434c4d4"><span class="section-number-4">12.30.16</span> fct<sub>reorder</sub></h4>
<div class="outline-text-4" id="text-12-30-16">
<p>
fct<sub>reorder</sub>() is useful for 1d displays where the factor is mapped to position; fct<sub>reorder2</sub>() for 2d displays where the factor is mapped to a non-position aesthetic. last2() is a helper for fct<sub>reorder2</sub>(); it finds the last value of y when sorted by x.
</p>

<div class="org-src-container">
<pre class="src src-R">boxplot(Sepal.Width ~ Species, data = iris)
boxplot(Sepal.Width ~ fct_reorder(Species, Sepal.Width), data = iris)
boxplot(Sepal.Width ~ fct_reorder(Species, Sepal.Width, .desc = <span style="color: #228b22;">TRUE</span>), data = iris)
</pre>
</div>
</div>
</div>
<div id="org4cf8a10" class="outline-4">
<h4 id="org4cf8a10"><span class="section-number-4">12.30.17</span> fct<sub>rev</sub></h4>
<div class="outline-text-4" id="text-12-30-17">
<p>
Reverse order of factor levels.This is sometimes useful when plotting a factor.
</p>
<div class="org-src-container">
<pre class="src src-R">f <span style="color: #008b8b;">&lt;-</span> factor(c(<span style="color: #8b2252;">"a"</span>, <span style="color: #8b2252;">"b"</span>, <span style="color: #8b2252;">"c"</span>))
fct_rev(f)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] a b c</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">Levels: c b a</span>
</pre>
</div>
</div>
</div>
<div id="orga643d50" class="outline-4">
<h4 id="orga643d50"><span class="section-number-4">12.30.18</span> fct<sub>shift</sub></h4>
<div class="outline-text-4" id="text-12-30-18">
<p>
Shift factor levels to left or right, wrapping around at end.
</p>
<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> factor(
    c(<span style="color: #8b2252;">"Mon"</span>, <span style="color: #8b2252;">"Tue"</span>, <span style="color: #8b2252;">"Wed"</span>),
    levels = c(<span style="color: #8b2252;">"Sun"</span>, <span style="color: #8b2252;">"Mon"</span>, <span style="color: #8b2252;">"Tue"</span>, <span style="color: #8b2252;">"Wed"</span>, <span style="color: #8b2252;">"Thu"</span>, <span style="color: #8b2252;">"Fri"</span>, <span style="color: #8b2252;">"Sat"</span>),
    ordered = <span style="color: #228b22;">TRUE</span>
)
x
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] Mon Tue Wed</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">Levels: Sun &lt; Mon &lt; Tue &lt; Wed &lt; Thu &lt; Fri &lt; Sat</span>
fct_shift(x)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] Mon Tue Wed</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">Levels: Mon &lt; Tue &lt; Wed &lt; Thu &lt; Fri &lt; Sat &lt; Sun</span>
fct_shift(x, <span style="color: #008b8b;">2</span>)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] Mon Tue Wed</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">Levels: Tue &lt; Wed &lt; Thu &lt; Fri &lt; Sat &lt; Sun &lt; Mon</span>
fct_shift(x, -<span style="color: #008b8b;">1</span>)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] Mon Tue Wed</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">Levels: Sat &lt; Sun &lt; Mon &lt; Tue &lt; Wed &lt; Thu &lt; Fri</span>
</pre>
</div>
</div>
</div>
<div id="orgc6ebfa9" class="outline-4">
<h4 id="orgc6ebfa9"><span class="section-number-4">12.30.19</span> fct<sub>shuffle</sub></h4>
<div class="outline-text-4" id="text-12-30-19">
<p>
Randomly permute factor levels.
</p>
<div class="org-src-container">
<pre class="src src-R">f <span style="color: #008b8b;">&lt;-</span> factor(c(<span style="color: #8b2252;">"a"</span>, <span style="color: #8b2252;">"b"</span>, <span style="color: #8b2252;">"c"</span>))
fct_shuffle(f)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] a b c</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">Levels: c b a</span>
fct_shuffle(f)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] a b c</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">Levels: a c b</span>
</pre>
</div>
</div>
</div>
<div id="orga77334d" class="outline-4">
<h4 id="orga77334d"><span class="section-number-4">12.30.20</span> fct<sub>unify</sub></h4>
<div class="outline-text-4" id="text-12-30-20">
<p>
Unify the levels in a list of factors.
</p>
<div class="org-src-container">
<pre class="src src-R">fs <span style="color: #008b8b;">&lt;-</span> list(factor(<span style="color: #8b2252;">"a"</span>), factor(<span style="color: #8b2252;">"b"</span>), factor(c(<span style="color: #8b2252;">"a"</span>, <span style="color: #8b2252;">"b"</span>)))
fs
<span style="color: #b22222;">## </span><span style="color: #b22222;">[[1]]</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] a</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">Levels: a</span>

<span style="color: #b22222;">## </span><span style="color: #b22222;">[[2]]</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] b</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">Levels: b</span>

<span style="color: #b22222;">## </span><span style="color: #b22222;">[[3]]</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] a b</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">Levels: a b</span>
fct_unify(fs)      
<span style="color: #b22222;">## </span><span style="color: #b22222;">[[1]]</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] a</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">Levels: a b</span>

<span style="color: #b22222;">## </span><span style="color: #b22222;">[[2]]</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] b</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">Levels: a b</span>

<span style="color: #b22222;">## </span><span style="color: #b22222;">[[3]]</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] a b</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">Levels: a b</span>
</pre>
</div>
</div>
</div>
<div id="orgb35b225" class="outline-4">
<h4 id="orgb35b225"><span class="section-number-4">12.30.21</span> fct<sub>unique</sub></h4>
<div class="outline-text-4" id="text-12-30-21">
<p>
Unique values of a factor.
</p>
<div class="org-src-container">
<pre class="src src-R">f <span style="color: #008b8b;">&lt;-</span> factor(letters[rpois(<span style="color: #008b8b;">100</span>, <span style="color: #008b8b;">10</span>)])
unique(f)     <span style="color: #b22222;"># </span><span style="color: #b22222;">in order of appearance</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] h q f n i j m e g k o l d</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">Levels: d e f g h i j k l m n o q</span>
fct_unique(f) <span style="color: #b22222;"># </span><span style="color: #b22222;">in order of levels      </span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] d e f g h i j k l m n o q</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">Levels: d e f g h i j k l m n o q</span>
</pre>
</div>
</div>
</div>
<div id="orgfa765ed" class="outline-4">
<h4 id="orgfa765ed"><span class="section-number-4">12.30.22</span> fct<sub>lump</sub><sub>*</sub></h4>
<div class="outline-text-4" id="text-12-30-22">
</div>
<div id="org6603f13" class="outline-5">
<h5 id="org6603f13"><span class="section-number-5">12.30.22.1</span> fct<sub>lump</sub><sub>min</sub></h5>
<div class="outline-text-5" id="text-12-30-22-1">
<p>
可以根据特定数值来设定因子水平。
</p>
<div class="org-src-container">
<pre class="src src-R">nintendo <span style="color: #008b8b;">&lt;-</span> tribble(
  ~console, ~hardware_sales_million,
  <span style="color: #8b2252;">"Nintendo Switch"</span>, <span style="color: #008b8b;">52.48</span>,
  <span style="color: #8b2252;">"Nintendo 3DS"</span>, <span style="color: #008b8b;">75.71</span>,
  <span style="color: #8b2252;">"Wii U"</span>, <span style="color: #008b8b;">13.56</span>,
  <span style="color: #8b2252;">"Wii"</span>, <span style="color: #008b8b;">101.63</span>,
  <span style="color: #8b2252;">"Nintendo DS"</span>, <span style="color: #008b8b;">154.02</span>,
  <span style="color: #8b2252;">"Game Boy Advance"</span>, <span style="color: #008b8b;">81.51</span>,
  <span style="color: #8b2252;">"Game Boy"</span>, <span style="color: #008b8b;">118.69</span>,
  <span style="color: #8b2252;">"Nintendo GameCube"</span>, <span style="color: #008b8b;">21.74</span>,
  <span style="color: #8b2252;">"Nintendo 64"</span>, <span style="color: #008b8b;">32.93</span>,
  <span style="color: #8b2252;">"SNES"</span>, <span style="color: #008b8b;">49.10</span>,
  <span style="color: #8b2252;">"NES"</span>, <span style="color: #008b8b;">61.91</span>
)
nintendo <span style="color: #008b8b;">%&gt;%</span>
  mutate(console = fct_lump_min(console, min = <span style="color: #008b8b;">50</span>, w = hardware_sales_million, other_level = <span style="color: #8b2252;">"Other Consoles"</span>))
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; # A tibble: 11 x 2</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;    console          hardware_sales_million</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;    &lt;fct&gt;                             &lt;dbl&gt;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  1 Nintendo Switch                    52.5</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  2 Nintendo 3DS                       75.7</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  3 Other Consoles                     13.6</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  4 Wii                               102. </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  5 Nintendo DS                       154. </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  6 Game Boy Advance                   81.5</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  7 Game Boy                          119. </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  8 Other Consoles                     21.7</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  9 Other Consoles                     32.9</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 10 Other Consoles                     49.1</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 11 NES                                61.9       </span>
</pre>
</div>
</div>
</div>
</div>

<div id="orgb37084c" class="outline-4">
<h4 id="orgb37084c"><span class="section-number-4">12.30.23</span> lvls</h4>
<div class="outline-text-4" id="text-12-30-23">
<p>
Low-level functions for manipulating levels.lvls<sub>reorder</sub> leaves values as they are, but changes the order. lvls<sub>revalue</sub> changes the values of existing levels; there must be one new level for each old level. lvls<sub>expand</sub> expands the set of levels; the new levels must include the old levels.
</p>
<div class="org-src-container">
<pre class="src src-R">f <span style="color: #008b8b;">&lt;-</span> factor(c(<span style="color: #8b2252;">"a"</span>, <span style="color: #8b2252;">"b"</span>, <span style="color: #8b2252;">"c"</span>))
lvls_reorder(f, <span style="color: #008b8b;">3</span>:<span style="color: #008b8b;">1</span>)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] a b c</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">Levels: c b a</span>
lvls_revalue(f, c(<span style="color: #8b2252;">"apple"</span>, <span style="color: #8b2252;">"banana"</span>, <span style="color: #8b2252;">"carrot"</span>))
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] apple  banana carrot</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">Levels: apple banana carrot</span>
lvls_expand(f, c(<span style="color: #8b2252;">"a"</span>, <span style="color: #8b2252;">"b"</span>, <span style="color: #8b2252;">"c"</span>, <span style="color: #8b2252;">"d"</span>))      
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] a b c</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">Levels: a b c d</span>
</pre>
</div>
</div>
</div>
<div id="org7120763" class="outline-4">
<h4 id="org7120763"><span class="section-number-4">12.30.24</span> lvls<sub>union</sub></h4>
<div class="outline-text-4" id="text-12-30-24">
<p>
Find all levels in a list of factors.
</p>
<div class="org-src-container">
<pre class="src src-R">fs <span style="color: #008b8b;">&lt;-</span> list(factor(<span style="color: #8b2252;">"a"</span>), factor(<span style="color: #8b2252;">"b"</span>), factor(c(<span style="color: #8b2252;">"a"</span>, <span style="color: #8b2252;">"b"</span>)))
fs
lvls_union(fs)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] "a" "b"</span>
</pre>
</div>
</div>
</div>
</div>
<div id="org138d52e" class="outline-3">
<h3 id="org138d52e"><span class="section-number-3">12.31</span> lubridate</h3>
<div class="outline-text-3" id="text-12-31">
</div>
<div id="org72af46b" class="outline-4">
<h4 id="org72af46b"><span class="section-number-4">12.31.1</span> 创建日期或时间</h4>
<div class="outline-text-4" id="text-12-31-1">
<p>
R 日期可以保存为 Date 类型， 一般用整数保存，数值为从 1970-1-1 经过的天数。
</p>

<p>
R 中用一种叫做 POSIXct 和 POSIXlt 的特殊数据类型保存日期和时间， 可以仅包含日期部分，也可以同时有日期和时间。 技术上，POSIXct 把日期时间保存为从 1970 年 1 月 1 日零时到该日期时间的时间间隔秒数， 所以数据框中需要保存日期时用 POSIXct 比较合适， 需要显示时再转换成字符串形式； POSIXlt 把日期时间保存为一个包含年、月、日、星期、时、分、秒等成分的列表， 所以求这些成分可以从 POSIXlt 格式日期的列表变量中获得。 日期时间会涉及到所在时区、夏时制等问题， 比较复杂。
</p>

<p>
有 3 种可以创建日期或时间：
</p>
<ul class="org-ul">
<li>通过字符串创建</li>
<li>通过日期时间的各个成分创建</li>
<li>通过现有的日期时间对象创建</li>
</ul>
</div>
<div id="org7057bed" class="outline-5">
<h5 id="org7057bed"><span class="section-number-5">12.31.1.1</span> 通过字符串创建</h5>
<div class="outline-text-5" id="text-12-31-1-1">
<p>
这些函数也可以接受不带引号的数值。
</p>
<div class="org-src-container">
<pre class="src src-R">ymd(<span style="color: #8b2252;">"2017-01-31"</span>)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] "2017-01-31"</span>
ymd(<span style="color: #008b8b;">20170131</span>)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] "2017-01-31"</span>
ymd(<span style="color: #8b2252;">"2017.01.31"</span>)
[<span style="color: #008b8b;">1</span>] <span style="color: #8b2252;">"2017-01-31"</span>
mdy(<span style="color: #8b2252;">"January 31st, 2017"</span>) 
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] "2017-01-31"</span>
dmy(<span style="color: #8b2252;">"31-Jan-2017"</span>)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] "2017-01-31"</span>
</pre>
</div>

<p>
ymd() 和类似的其他函数可以创建日期，要想创建日期时间型数据，可以在后面加一个下划线，以及 h,m 和 s 之中的一个或多个字母，这样就可以解析日期时间的函数了：
</p>

<div class="org-src-container">
<pre class="src src-R">ymd_hms(<span style="color: #8b2252;">"2017-01-31 20:11:59"</span>)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] "2017-01-31 20:11:59 UTC"</span>
mdy_hm(<span style="color: #8b2252;">"01/31/2017 08:01"</span>)  
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] "2017-01-31 08:01:00 UTC"</span>
</pre>
</div>
<p>
通过添加一个时区参数，你可以将一个日期强制转换为日期时间：
</p>
<div class="org-src-container">
<pre class="src src-R">ymd(<span style="color: #008b8b;">20170131</span>,tz = <span style="color: #8b2252;">"UTC"</span>)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] "2017-01-31 UTC"</span>
</pre>
</div>
</div>
</div>

<div id="org27afd74" class="outline-5">
<h5 id="org27afd74"><span class="section-number-5">12.31.1.2</span> ymd<sub>hms</sub></h5>
<div class="outline-text-5" id="text-12-31-1-2">
<div class="org-src-container">
<pre class="src src-R"><span style="color: #008b8b;">library</span>(lubridate)
dt_utc <span style="color: #008b8b;">&lt;-</span> ymd_hms(<span style="color: #8b2252;">"2010-08-03 00:50:50"</span>)
dt_utc <span style="color: #008b8b;">%&gt;%</span> str()
<span style="color: #b22222;">##</span>
dt_utc1 <span style="color: #008b8b;">&lt;-</span> ymd_hms(<span style="color: #8b2252;">"2010-08-03 00:50:50"</span>)
dt_utc2 <span style="color: #008b8b;">&lt;-</span> ymd_hms(<span style="color: #8b2252;">"2010-08-04 00:50:50"</span>)
min(dt_utc1, dt_utc2)
</pre>
</div>
</div>
</div>




<div id="org1256ece" class="outline-5">
<h5 id="org1256ece"><span class="section-number-5">12.31.1.3</span> 通过各个成分创建</h5>
<div class="outline-text-5" id="text-12-31-1-3">
<p>
除了单个字符串，日期时间数据的各个成分还经常分布在表格的多个列中。如果想要按照这种表示方法来创建日期或时间，可以使用 make<sub>date</sub>() 函数创建日期，使用
make<sub>datetime</sub>() 函数创建日期时间。
</p>

<div class="org-src-container">
<pre class="src src-R">nycflights13::flights <span style="color: #008b8b;">%&gt;%</span> 
    select(year,month,day,hour,minute) <span style="color: #008b8b;">%&gt;%</span> 
    str
<span style="color: #b22222;">## </span><span style="color: #b22222;">Classes &#8216;tbl_df&#8217;, &#8216;tbl&#8217; and 'data.frame':  336776 obs. of  5 variables:</span>
<span style="color: #b22222;">##                                                                 </span><span style="color: #b22222;">$ year  : int  2013 2013 2013 2013 2013 2013 2013 2013 2013 2013 ...</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">$ month : int  1 1 1 1 1 1 1 1 1 1 ...</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">$ day   : int  1 1 1 1 1 1 1 1 1 1 ...</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">$ hour  : num  5 5 5 5 6 5 6 6 6 6 ...</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">$ minute: num  15 29 40 45 0 58 0 0 0 0 ...</span>
flights <span style="color: #008b8b;">%&gt;%</span> 
    select(year,month,day,hour,minute) <span style="color: #008b8b;">%&gt;%</span> 
    mutate(departure=make_datetime(year,month,day,hour,minute)) <span style="color: #008b8b;">%&gt;%</span> 
    head()

                                      <span style="color: #b22222;"># </span><span style="color: #b22222;">A tibble: 6 x 6</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">year month   day  hour minute departure          </span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">&lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dttm&gt;             </span>
<span style="color: #b22222;">##                                     </span><span style="color: #b22222;">1  2013     1     1     5     15 2013-01-01 05:15:00</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">2  2013     1     1     5     29 2013-01-01 05:29:00</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">3  2013     1     1     5     40 2013-01-01 05:40:00</span>
</pre>
</div>
</div>
</div>
<div id="org0f6ea78" class="outline-5">
<h5 id="org0f6ea78"><span class="section-number-5">12.31.1.4</span> 通过其他类型数据创建</h5>
<div class="outline-text-5" id="text-12-31-1-4">
<p>
有时需要在日期时间型数据和日期型数据之间进行转换，这正是 as<sub>datetime</sub>() 和
as<sub>date</sub>() 函数的功能。
</p>
<div class="org-src-container">
<pre class="src src-R">as_datetime(today())
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] "2020-02-06 UTC"</span>
as_date(now())
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] "2020-02-06"</span>
as_datetime(now())
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] "2020-02-06 08:13:39 UTC"</span>
</pre>
</div>

<p>
有时我们会使用 "Unix 时间戳"(即 1970-01-01) 的偏移量来表示日期时间。如果偏移量单位是秒，那么就使用 as<sub>datetime</sub>() 函数来转换；如果偏移量单位是天，则使用 as<sub>date</sub>()
函数来转换：
</p>

<div class="org-src-container">
<pre class="src src-R">as_datetime(<span style="color: #008b8b;">60</span>*<span style="color: #008b8b;">60</span>*<span style="color: #008b8b;">10</span>)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] "1970-01-01 10:00:00 UTC"</span>
as_date(<span style="color: #008b8b;">365</span>*<span style="color: #008b8b;">10</span>+<span style="color: #008b8b;">2</span>)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] "1980-01-01"</span>
</pre>
</div>
</div>
</div>

<div id="orgeab1653" class="outline-5">
<h5 id="orgeab1653"><span class="section-number-5">12.31.1.5</span> year/month/mday/yday/wday/hour/&#x2026;..</h5>
<div class="outline-text-5" id="text-12-31-1-5">
<p>
日期时间成分：
</p>

<ul class="org-ul">
<li>year()取出年</li>
<li>month()取出月份数值</li>
<li>mday()取出日数值，这个返回的是当前月份的天数</li>
<li>yday()取出日期在一年中的序号，元旦为 1,这个返回的是这天在整个一年的天数。</li>
<li>wday()取出日期在一个星期内的序号， 但是一个星期从星期天开始， 星期天为 1,星期一为 2，星期六为 7。</li>
<li>hour()取出小时</li>
<li>minute()取出分钟</li>
<li>second()取出秒</li>
</ul>

<div class="org-src-container">
<pre class="src src-R">month(as.POSIXct(<span style="color: #8b2252;">"2018-1-17 13:15:40"</span>))
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] 1</span>
mday(as.POSIXct(<span style="color: #8b2252;">"2018-1-17 13:15:40"</span>))
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] 17</span>
wday(as.POSIXct(<span style="color: #8b2252;">"2018-1-17 13:15:40"</span>))
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] 4</span>
</pre>
</div>
</div>
</div>

<div id="org8aedab9" class="outline-5">
<h5 id="org8aedab9"><span class="section-number-5">12.31.1.6</span> update</h5>
<div class="outline-text-5" id="text-12-31-1-6">
<p>
update()可以对一个日期或一个日期型向量统一修改其组成部分的值.
</p>
<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> as.POSIXct(<span style="color: #8b2252;">"2018-1-17 13:15:40"</span>)
y <span style="color: #008b8b;">&lt;-</span> update(x, year=<span style="color: #008b8b;">2000</span>)
y
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] "2000-01-17 13:15:40 CST"</span>
</pre>
</div>
</div>
</div>
</div>

<div id="org8c8ee8b" class="outline-4">
<h4 id="org8c8ee8b"><span class="section-number-4">12.31.2</span> 获取成分</h4>
<div class="outline-text-4" id="text-12-31-2">
<p>
如果想要提取出日期中的独立成分，可以使用以下访问器函数：year(),month(),mday()(一个月中的第几天),yday()(一年中的第几天),wday()(一周中的第几天),hour(),minute() 和 second():
</p>

<div class="org-src-container">
<pre class="src src-R">datetime <span style="color: #008b8b;">&lt;-</span> ymd_hms(<span style="color: #8b2252;">"2016-07-08 12:34:56"</span>)
year(datetime)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] 2016</span>
month(datetime)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] 7</span>
mday(datetime)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] 8</span>
yday(datetime)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] 190</span>
wday(datetime)  
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] 6</span>
</pre>
</div>

<p>
对于 month() 和 wday() 函数，还可以设置 label=TRUE 来返回月份名称和星期数的缩写，还可以设置 abbr = FALSE 来返回全名。
</p>

<div class="org-src-container">
<pre class="src src-R">month(datetime,label = T)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] Jul</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">Levels: Jan &lt; Feb &lt; Mar &lt; Apr &lt; May &lt; Jun &lt; Jul &lt; Aug &lt; Sep &lt; Oct &lt; Nov &lt; Dec</span>
month(datetime,label = T, abbr = F)  
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] July</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">12 Levels: January &lt; February &lt; March &lt; April &lt; May &lt; June &lt; July &lt; ... &lt; December</span>
</pre>
</div>

<p>
绘制独立日期成分的另一种方法是，通过 floor<sub>date</sub>(),round<sub>date</sub>() 和 ceiling<sub>date</sub>()
函数将日期舍入到临近的一个时间单位。
</p>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #0000ff;">make_datetime_100</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>(year, month, day, time) {make_datetime(year, month, day, time <span style="color: #008b8b;">%/%</span> <span style="color: #008b8b;">100</span>, time %% <span style="color: #008b8b;">100</span>) }
flights_dt <span style="color: #008b8b;">&lt;-</span> flights <span style="color: #008b8b;">%&gt;%</span>
    filter(!is.na(dep_time), !is.na(arr_time)) <span style="color: #008b8b;">%&gt;%</span>
    mutate(dep_time = make_datetime_100(year, month, day, dep_time), arr_time = make_datetime_100(year, month, day, arr_time), sched_dep_time = make_datetime_100(year, month, day, sched_dep_time), sched_arr_time = make_datetime_100(year, month, day, sched_arr_time)) <span style="color: #008b8b;">%&gt;%</span>
    select(origin, dest, ends_with(<span style="color: #8b2252;">"delay"</span>), ends_with(<span style="color: #8b2252;">"time"</span>))

floor_date(flights_dt$dep_time[<span style="color: #008b8b;">1</span>],<span style="color: #8b2252;">"week"</span>)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] "2012-12-30 UTC"</span>
floor_date(as.POSIXct(<span style="color: #8b2252;">"2018-2-17 13:15:40"</span>), <span style="color: #8b2252;">"month"</span>)
round_date(as.POSIXct(<span style="color: #8b2252;">"2018-2-17 13:15:40"</span>), <span style="color: #8b2252;">"month"</span>)
ceiling_date(as.POSIXct(<span style="color: #8b2252;">"2018-2-17 13:15:40"</span>), <span style="color: #8b2252;">"month"</span>)
</pre>
</div>
</div>
</div>
<div id="org58eb8c4" class="outline-4">
<h4 id="org58eb8c4"><span class="section-number-4">12.31.3</span> 设置成分</h4>
<div class="outline-text-4" id="text-12-31-3">
<p>
可以使用每个访问器函数来设置日期时间中的成分。
</p>
<div class="org-src-container">
<pre class="src src-R">datetime <span style="color: #008b8b;">&lt;-</span> ymd_hms(<span style="color: #8b2252;">"2016-07-08 12:34:56"</span>)
year(datetime) <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">2020</span>
datetime
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "2020-07-08 12:34:56 UTC"</span>
month(datetime) <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">01</span>
datetime
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "2020-01-08 12:34:56 UTC"</span>
hour(datetime) <span style="color: #008b8b;">&lt;-</span> hour(datetime)+<span style="color: #008b8b;">1</span>
datetime
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "2020-01-08 13:34:56 UTC"</span>
</pre>
</div>

<p>
除了原地修改，还可以通过 update() 函数创建一个新日期时间，这样也也可以同时设置多个成分。
</p>

<div class="org-src-container">
<pre class="src src-R">datetime <span style="color: #008b8b;">&lt;-</span> ymd_hms(<span style="color: #8b2252;">"2016-07-08 12:34:56"</span>)
update(datetime,year=<span style="color: #008b8b;">2020</span>,month=<span style="color: #008b8b;">2</span>,mday=<span style="color: #008b8b;">2</span>,hour=<span style="color: #008b8b;">2</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "2020-02-02 02:34:56 UTC"  </span>
</pre>
</div>

<p>
如果设置的值过大，那么可以自动向后滚动：
</p>
<div class="org-src-container">
<pre class="src src-R">ymd(<span style="color: #8b2252;">"2015-02-01"</span>) <span style="color: #008b8b;">%&gt;%</span> 
    update(mday = <span style="color: #008b8b;">30</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "2015-03-02"</span>
ymd(<span style="color: #8b2252;">"2015-02-01"</span>) <span style="color: #008b8b;">%&gt;%</span> 
    update(hour=<span style="color: #008b8b;">400</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "2015-02-17 16:00:00 UTC"  </span>
</pre>
</div>
</div>
</div>
<div id="org1d157b1" class="outline-4">
<h4 id="org1d157b1"><span class="section-number-4">12.31.4</span> mdy</h4>
<div class="outline-text-4" id="text-12-31-4">
<div class="org-src-container">
<pre class="src src-R">mdy(c(<span style="color: #8b2252;">"12-01-20"</span>, <span style="color: #8b2252;">"06-06-06"</span>))
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "2020-12-01" "2006-06-06"      </span>
</pre>
</div>
</div>
</div>
<div id="org3f8aa43" class="outline-4">
<h4 id="org3f8aa43"><span class="section-number-4">12.31.5</span> stamp</h4>
<div class="outline-text-4" id="text-12-31-5">
<p>
Use stamp() to generate date formatting based on a template you supply.It
creates a <b>function</b> that applies the formatting.
</p>

<div class="org-src-container">
<pre class="src src-R">dates <span style="color: #008b8b;">&lt;-</span> ymd(c(<span style="color: #8b2252;">"2020-01-01"</span>, <span style="color: #8b2252;">"2020-03-30"</span>))
stamp(<span style="color: #8b2252;">"June 1, 2020"</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Multiple formats matched: "June %Om, %Y"(1), "%Om %d, %Y"(1), "%B %d, %Y"(1), "June %m, %Y"(1)</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Using: "%B %d, %Y"</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; function (x, locale = "en_US.UTF-8") </span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; {</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;     {</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;         old_lc_time &lt;- Sys.getlocale("LC_TIME")</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;         if (old_lc_time != locale) {</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;             on.exit(Sys.setlocale("LC_TIME", old_lc_time))</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;             Sys.setlocale("LC_TIME", locale)</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;         }</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;     }</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;     format(x, format = "%B %d, %Y")</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; }</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; &lt;environment: 0x7f9319b41478&gt;</span>
stamp(<span style="color: #8b2252;">"June 1, 2020"</span>)(dates)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Multiple formats matched: "June %Om, %Y"(1), "%Om %d, %Y"(1), "%B %d, %Y"(1), "June %m, %Y"(1)</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Using: "%B %d, %Y"</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "January 01, 2020" "March 30, 2020"</span>
                                  <span style="color: #b22222;"># </span><span style="color: #b22222;">It can extract the day of the week :O so smart</span>
stamp(<span style="color: #8b2252;">"January 2, 2020 was a Thursday"</span>, quiet = <span style="color: #228b22;">TRUE</span>)(dates)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] "January 01, 2020 was a Wednesday" "March 30, 2020 was a Monday "     </span>
stamp(<span style="color: #8b2252;">"This report was updated on the 24 day of June in 1991"</span>, quiet = <span style="color: #228b22;">TRUE</span>)(dates)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] "This report was updated on the 01 day of January in 2020"</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">[2] "This report was updated on the 30 day of March in 2020"</span>
</pre>
</div>
</div>
</div>

<div id="org0b6165f" class="outline-4">
<h4 id="org0b6165f"><span class="section-number-4">12.31.6</span> 时间间隔</h4>
<div class="outline-text-4" id="text-12-31-6">
<p>
表示时间差别的对象记录时间间隔的单位可以是秒，分钟，小时，日或周。lubridate 包提供了总是使用秒为单位的另一种计时对象——时期。
</p>
<div class="org-src-container">
<pre class="src src-R">l_age <span style="color: #008b8b;">&lt;-</span> today() - ymd(<span style="color: #008b8b;">19880423</span>)
l_age
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Time difference of 11611 days</span>
as.duration(l_age)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "1003190400s (~31.79 years)"</span>
dseconds(<span style="color: #008b8b;">15</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "15s"</span>
dminutes(<span style="color: #008b8b;">10</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "600s (~10 minutes)"</span>
dhours(c(<span style="color: #008b8b;">12</span>,<span style="color: #008b8b;">24</span>))
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "43200s (~12 hours)" "86400s (~1 days)"</span>
ddays(<span style="color: #008b8b;">0</span>:<span style="color: #008b8b;">5</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "0s"                "86400s (~1 days)"  "172800s (~2 days)"</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [4] "259200s (~3 days)" "345600s (~4 days)" "432000s (~5 days)"</span>
dweeks(<span style="color: #008b8b;">3</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "1814400s (~3 weeks)"</span>
dyears(<span style="color: #008b8b;">1</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "31536000s (~52.14 weeks)"</span>
<span style="color: #008b8b;">2</span>*dyears(<span style="color: #008b8b;">1</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "63072000s (~2 years)"</span>
dyears(<span style="color: #008b8b;">1</span>)+dweeks(<span style="color: #008b8b;">12</span>)+dhours(<span style="color: #008b8b;">15</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "38847600s (~1.23 years)"      </span>
</pre>
</div>

<p>
时期可以和日期型数据相加或相减。
</p>
<div class="org-src-container">
<pre class="src src-R">tomorrow
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "2020-02-07"</span>
last_year <span style="color: #008b8b;">&lt;-</span> today() - dyears(<span style="color: #008b8b;">1</span>)
last_year
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "2019-02-06"      </span>
</pre>
</div>
</div>
</div>
<div id="orge3802c2" class="outline-4">
<h4 id="orge3802c2"><span class="section-number-4">12.31.7</span> 阶段</h4>
<div class="outline-text-4" id="text-12-31-7">
<p>
时间函数因为夏时制问题，时间之间的算法比较麻烦，需要借助阶段对象。阶段也是一种时间间隔，但它不以秒为单位，相反，它使用“人工”时间，比如日和月。这使得他们使用起来更加直观。
</p>

<div class="org-src-container">
<pre class="src src-R">datetime <span style="color: #008b8b;">&lt;-</span> ymd_hms(<span style="color: #8b2252;">"2016-07-08 12:34:56"</span>)
datetime+days(<span style="color: #008b8b;">1</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "2016-07-09 12:34:56 UTC"</span>
seconds(<span style="color: #008b8b;">15</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "15S"</span>
minutes(<span style="color: #008b8b;">10</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "10M 0S"</span>
hours(c(<span style="color: #008b8b;">12</span>,<span style="color: #008b8b;">24</span>))
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "12H 0M 0S" "24H 0M 0S"</span>
days(<span style="color: #008b8b;">7</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "7d 0H 0M 0S"</span>
months(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">6</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "1m 0d 0H 0M 0S" "2m 0d 0H 0M 0S" "3m 0d 0H 0M 0S" "4m 0d 0H 0M 0S"</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [5] "5m 0d 0H 0M 0S" "6m 0d 0H 0M 0S"</span>
weeks(<span style="color: #008b8b;">3</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "21d 0H 0M 0S"</span>
years(<span style="color: #008b8b;">1</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "1y 0m 0d 0H 0M 0S"</span>
<span style="color: #008b8b;">10</span>*(months(<span style="color: #008b8b;">6</span>)+days(<span style="color: #008b8b;">1</span>))
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "60m 10d 0H 0M 0S"</span>
days(<span style="color: #008b8b;">50</span>)+hours(<span style="color: #008b8b;">25</span>)+minutes(<span style="color: #008b8b;">2</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "50d 25H 2M 0S"</span>
                                      <span style="color: #b22222;"># </span><span style="color: #b22222;">&#38384;&#24180;</span>
ymd(<span style="color: #8b2252;">"2016-01-01"</span>)+dyears(<span style="color: #008b8b;">1</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "2016-12-31"</span>
ymd(<span style="color: #8b2252;">"2016-01-01"</span>)+years(<span style="color: #008b8b;">1</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "2017-01-01"  </span>
</pre>
</div>
</div>
</div>
<div id="orgd15d53f" class="outline-4">
<h4 id="orgd15d53f"><span class="section-number-4">12.31.8</span> 区间</h4>
<div class="outline-text-4" id="text-12-31-8">
<p>
显然，dyears(1) / ddays(365) 应该返回 1,因为时期总是以秒来表示的，表示 1 年的时期就定义为相当于 365 天的秒数。那么 应该返回什么呢？如果年份是 2015 年，那么结果就是 365， 但如
</p>

<p>
years(1) / days(1) 果年份是 年，那么结果就是 366 ！没有足够的信息让 lubridate 返回一个明确的结果。
</p>

<p>
2016 lubridate 的做法是给出一个估计值，同时给出一条警告：
</p>
<div class="org-src-container">
<pre class="src src-R">years(<span style="color: #008b8b;">1</span>)/days(<span style="color: #008b8b;">1</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; estimate only: convert to intervals for accuracy</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 365.25</span>
</pre>
</div>

<p>
如果需要更精确的测量方式，那么你就必须使用区间。区间是带有起点的时期，这使得其非常精确，你可以确切地知道它的长度：
</p>

<div class="org-src-container">
<pre class="src src-R">next_year <span style="color: #008b8b;">&lt;-</span> today() + years(<span style="color: #008b8b;">1</span>)
next_year
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "2021-02-06"</span>
(today() <span style="color: #008b8b;">%--%</span> next_year) / ddays(<span style="color: #008b8b;">1</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 366</span>
(today() <span style="color: #008b8b;">%--%</span> next_year) / days(<span style="color: #008b8b;">1</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 366      </span>
</pre>
</div>
</div>
</div>
<div id="org1ca8a87" class="outline-4">
<h4 id="org1ca8a87"><span class="section-number-4">12.31.9</span> 时区</h4>
<div class="outline-text-4" id="text-12-31-9">
<p>
可以使用 Sys.timezone() 函数找出你的当前时区.
</p>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;">#</span><span style="color: #b22222;">&#25214;&#20986;&#24403;&#21069;&#26102;&#21306;</span>
Sys.timezone()
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "Asia/Shanghai"</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26597;&#30475;&#23436;&#25972;&#30340;&#26102;&#21306;&#21517;&#31216;</span>
length(OlsonNames())
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 593</span>
head(OlsonNames())
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "Africa/Abidjan"     "Africa/Accra"       "Africa/Addis_Ababa"</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [4] "Africa/Algiers"     "Africa/Asmara"      "Africa/Asmera"</span>
(x1 <span style="color: #008b8b;">&lt;-</span> ymd_hms(<span style="color: #8b2252;">"2015-06-01 12:00:00"</span>, tz = <span style="color: #8b2252;">"America/New_York"</span>))
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "2015-06-01 12:00:00 EDT"</span>
(x2 <span style="color: #008b8b;">&lt;-</span> ymd_hms(<span style="color: #8b2252;">"2015-06-01 18:00:00"</span>, tz = <span style="color: #8b2252;">"Europe/Copenhagen"</span>))
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "2015-06-01 18:00:00 CEST"</span>
(x3 <span style="color: #008b8b;">&lt;-</span> ymd_hms(<span style="color: #8b2252;">"2015-06-02 04:00:00"</span>, tz = <span style="color: #8b2252;">"Pacific/Auckland"</span>))
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "2015-06-02 04:00:00 NZST"</span>
x1-x2
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Time difference of 0 secs</span>
x1-x3
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Time difference of 0 secs</span>
(x4 <span style="color: #008b8b;">&lt;-</span> c(x1,x2,x3))
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "2015-06-01 12:00:00 EDT" "2015-06-01 12:00:00 EDT"</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [3] "2015-06-01 12:00:00 EDT"</span>
(x4a <span style="color: #008b8b;">&lt;-</span> with_tz(x4,tzone = <span style="color: #8b2252;">"Australia/Lord_Howe"</span>))
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "2015-06-02 02:30:00 +1030" "2015-06-02 02:30:00 +1030"</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [3] "2015-06-02 02:30:00 +1030"</span>
x4a-x4
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Time differences in secs</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 0 0 0      </span>
</pre>
</div>
</div>
</div>
<div id="org0e6ef6b" class="outline-4">
<h4 id="org0e6ef6b"><span class="section-number-4">12.31.10</span> 其他函数</h4>
<div class="outline-text-4" id="text-12-31-10">
</div>
<div id="orge7b1bd9" class="outline-5">
<h5 id="orge7b1bd9"><span class="section-number-5">12.31.10.1</span> with<sub>tz</sub></h5>
<div class="outline-text-5" id="text-12-31-10-1">
<p>
Get date-time in a different time zone.with<sub>tz</sub> returns a date-time as it would appear in a different time zone. 
</p>
<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> ymd_hms(<span style="color: #8b2252;">"2009-08-07 00:00:01"</span>, tz = <span style="color: #8b2252;">"America/New_York"</span>)
with_tz(x, <span style="color: #8b2252;">"GMT"</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "2009-08-07 04:00:01 GMT"  </span>
</pre>
</div>
</div>
</div>
<div id="orgab21dea" class="outline-5">
<h5 id="orgab21dea"><span class="section-number-5">12.31.10.2</span> force<sub>tz</sub></h5>
<div class="outline-text-5" id="text-12-31-10-2">
<p>
Replace time zone to create new date-time.force<sub>tz</sub> returns the date-time that has the same clock time as input time, but in the new time zone. force<sub>tzs</sub> is the parallel version of force<sub>tz</sub>, meaning that every element from time argument is matched with the corresponding time zone in tzones argument.
</p>
<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> ymd_hms(<span style="color: #8b2252;">"2009-08-07 00:00:01"</span>, tz = <span style="color: #8b2252;">"America/New_York"</span>)
with_tz(x,<span style="color: #8b2252;">"UTC"</span>)
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "2009-08-07 04:00:01 UTC"</span>
force_tz(x, <span style="color: #8b2252;">"UTC"</span>)
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "2009-08-07 00:00:01 UTC"       </span>
</pre>
</div>
</div>
</div>
<div id="org16060ef" class="outline-5">
<h5 id="org16060ef"><span class="section-number-5">12.31.10.3</span> now()</h5>
<div class="outline-text-5" id="text-12-31-10-3">
<div class="org-src-container">
<pre class="src src-R">now()
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "2020-04-04 19:33:50 CST"       </span>
</pre>
</div>
</div>
</div>
<div id="org31048a5" class="outline-5">
<h5 id="org31048a5"><span class="section-number-5">12.31.10.4</span> ymd<sub>hms</sub></h5>
<div class="outline-text-5" id="text-12-31-10-4">
<p>
lubridate 包的 ymd、mdy、dmy 等函数添加 hms、hm、h 等后缀， 可以用于将字符串转换成日期时间。 如
</p>
<div class="org-src-container">
<pre class="src src-R">ymd_hms(<span style="color: #8b2252;">"1998-03-16 13:15:45"</span>)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] "1998-03-16 13:15:45 UTC" </span>
</pre>
</div>
</div>
</div>

<div id="org8e45b67" class="outline-5">
<h5 id="org8e45b67"><span class="section-number-5">12.31.10.5</span> as<sub>date</sub></h5>
<div class="outline-text-5" id="text-12-31-10-5">
<p>
用 lubridate::as<sub>date</sub>()可以将日期时间型转换为日期型。
</p>
<div class="org-src-container">
<pre class="src src-R">as_date(as.POSIXct(<span style="color: #8b2252;">"1998-03-16 13:15:45"</span>))
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] "1998-03-16" </span>
</pre>
</div>
</div>
</div>

<div id="org64fb714" class="outline-5">
<h5 id="org64fb714"><span class="section-number-5">12.31.10.6</span> as<sub>datetime</sub></h5>
<div class="outline-text-5" id="text-12-31-10-6">
<p>
用 lubridate::as<sub>datetime</sub>()可以将日期型数据转换为日期时间型
</p>

<div class="org-src-container">
<pre class="src src-R">as_datetime(as.Date(<span style="color: #8b2252;">"1998-03-16"</span>))
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] "1998-03-16 UTC"</span>
</pre>
</div>
</div>
</div>

<div id="orgc1b6b57" class="outline-5">
<h5 id="orgc1b6b57"><span class="section-number-5">12.31.10.7</span> %m+% %m-%</h5>
<div class="outline-text-5" id="text-12-31-10-7">
<p>
平时计算时间一直不注意，以后一定要用这两个函数！！举个例子。当遇到 2 月份计算问题时就会遇到这个问题！
</p>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;"># </span><span style="color: #b22222;">And 2019 wasn't a leap year, so there's no February 29:</span>
as_date(<span style="color: #8b2252;">"2019-01-29"</span>) + months(<span style="color: #008b8b;">1</span>)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] NA</span>
                                      <span style="color: #b22222;"># </span><span style="color: #b22222;">Use %m+% instead to automatically account for the last day of the month</span>
as_date(<span style="color: #8b2252;">"2020-01-31"</span>) <span style="color: #008b8b;">%m+%</span> months(<span style="color: #008b8b;">1</span>)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] "2020-02-29"</span>
                                      <span style="color: #b22222;"># </span><span style="color: #b22222;">The subtraction version exists, of course</span>
as_date(<span style="color: #8b2252;">"2020-10-31"</span>) <span style="color: #008b8b;">%m-%</span> months(<span style="color: #008b8b;">1</span>)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] "2020-09-30"</span>
</pre>
</div>
</div>
</div>

<div id="org0ffc75c" class="outline-5">
<h5 id="org0ffc75c"><span class="section-number-5">12.31.10.8</span> leap<sub>year</sub></h5>
<div class="outline-text-5" id="text-12-31-10-8">
<p>
这个函数可以检查该年是否是闰平年。
</p>
<div class="org-src-container">
<pre class="src src-R">dates <span style="color: #008b8b;">&lt;-</span> as_date(c(<span style="color: #8b2252;">"2019-01-01"</span>, <span style="color: #8b2252;">"2020-01-01"</span>, <span style="color: #8b2252;">"2020-02-29"</span>))
leap_year(dates)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] FALSE  TRUE  TRUE</span>
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="org6b9015d" class="outline-3">
<h3 id="org6b9015d"><span class="section-number-3">12.32</span> DBI</h3>
<div class="outline-text-3" id="text-12-32">
</div>
<div id="org027aef2" class="outline-4">
<h4 id="org027aef2"><span class="section-number-4">12.32.1</span> dbGetQuery</h4>
<div class="outline-text-4" id="text-12-32-1">
<div class="org-src-container">
<pre class="src src-R">dbGetQuery(sc, <span style="color: #8b2252;">"SELECT count(*) FROM mtcars"</span>)
<span style="color: #b22222;">#</span><span style="color: #b22222;">count(1)</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">1       32 </span>
</pre>
</div>
</div>
</div>
</div>

<div id="org88e97b9" class="outline-3">
<h3 id="org88e97b9"><span class="section-number-3">12.33</span> sparklyr</h3>
<div class="outline-text-3" id="text-12-33">
</div>
<div id="org0fe8d44" class="outline-4">
<h4 id="org0fe8d44"><span class="section-number-4">12.33.1</span> spark<sub>web</sub></h4>
<div class="outline-text-4" id="text-12-33-1">
<div class="org-src-container">
<pre class="src src-R">spark_web(sc)      
</pre>
</div>
</div>
</div>

<div id="orga13d63c" class="outline-4">
<h4 id="orga13d63c"><span class="section-number-4">12.33.2</span> 复制多行数据</h4>
<div class="outline-text-4" id="text-12-33-2">
<p>
df<sub>tbl</sub> %&gt;%
  mutate(arr = explode(array(1, 1, 1))) %&gt;%
  select(-arr)
效果如下：
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-right">ROW1</td>
<td class="org-left">ROW2</td>
</tr>

<tr>
<td class="org-right">1</td>
<td class="org-left">A</td>
</tr>

<tr>
<td class="org-right">1</td>
<td class="org-left">A</td>
</tr>

<tr>
<td class="org-right">1</td>
<td class="org-left">A</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-left">B</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-left">B</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-left">B</td>
</tr>

<tr>
<td class="org-right">3</td>
<td class="org-left">C</td>
</tr>

<tr>
<td class="org-right">3</td>
<td class="org-left">C</td>
</tr>

<tr>
<td class="org-right">3</td>
<td class="org-left">C</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="org8dd0f97" class="outline-4">
<h4 id="org8dd0f97"><span class="section-number-4">12.33.3</span> <span class="todo TODO">TODO</span> 矩阵相乘</h4>
<div class="outline-text-4" id="text-12-33-3">
<p>
这块还需要进一步研究。
</p>

<div class="org-src-container">
<pre class="src src-R">ret = invoke_static(
      sc, <span style="color: #8b2252;">"utils.CalWxB"</span>, <span style="color: #8b2252;">"predictLinear"</span>, 
      sdf=sdf_br_onehot_all <span style="color: #008b8b;">%&gt;%</span> mutate(Intercept = <span style="color: #008b8b;">1.0</span>) <span style="color: #008b8b;">%&gt;%</span> spark_dataframe(), names(br_weights) <span style="color: #008b8b;">%&gt;%</span> as.list, br_weights <span style="color: #008b8b;">%&gt;%</span> as.list(), <span style="color: #8b2252;">"score_lx"</span>
    ) <span style="color: #008b8b;">%&gt;%</span> sdf_register()
</pre>
</div>
</div>
</div>

<div id="org502c568" class="outline-4">
<h4 id="org502c568"><span class="section-number-4">12.33.4</span> 添加日期</h4>
<div class="outline-text-4" id="text-12-33-4">
<ul class="org-ul">
<li>获取当前时区的 UNIX 时间戳：select unix<sub>timestamp</sub>()</li>
<li>将指定时间转为 UNIX 时间戳： select unix<sub>timestamp</sub>('2012-03-03 11:45:31');</li>
<li>将指定的实际转为贵 UNIX 时间戳：select unix<sub>timestamp</sub>('2018-08-08 16:22:01','yyyy-MM-dd HH:mm:ss');</li>
</ul>

<div class="org-src-container">
<pre class="src src-R">date_add(<span style="color: #8b2252;">"2016-12-29"</span>, <span style="color: #008b8b;">10</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#28155;&#21152; 10 &#26465;&#26085;&#26399;&#25968;&#25454;</span>

                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26085;&#26399;&#22788;&#29702;</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&#36935;&#21040;&#25972;&#22411;&#26085;&#26399;&#25968;&#25454; 20190101 &#26102;&#65292;&#21487;&#20197;&#21464;&#25104;&#23383;&#31526;&#22411; 2019-01-01&#65292;&#28982;&#21518;&#20877;&#29992; to_date &#22788;&#29702;</span>
mutate(date=                            to_date(paste(substr(date,<span style="color: #008b8b;">1</span>,<span style="color: #008b8b;">4</span>),substr(date,<span style="color: #008b8b;">5</span>,<span style="color: #008b8b;">6</span>),substr(date,<span style="color: #008b8b;">7</span>,<span style="color: #008b8b;">8</span>),sep=<span style="color: #8b2252;">"-"</span>),<span style="color: #8b2252;">'yyyy-MM-dd'</span>))
</pre>
</div>
</div>
</div>
</div>

<div id="orgd0347d2" class="outline-3">
<h3 id="orgd0347d2"><span class="section-number-3">12.34</span> readr</h3>
<div class="outline-text-3" id="text-12-34">
<p>
这个包功能类似于 data.table 包中的 fread/fwrite。
</p>
</div>
<div id="orge59eadc" class="outline-4">
<h4 id="orge59eadc"><span class="section-number-4">12.34.1</span> parse<sub>number</sub></h4>
<div class="outline-text-4" id="text-12-34-1">
<div class="org-src-container">
<pre class="src src-R"><span style="color: #008b8b;">library</span>(readr)
                                     <span style="color: #b22222;"># </span><span style="color: #b22222;">If you have numbers with formatting you want to remove...</span>
x <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #8b2252;">"$10.00"</span>, <span style="color: #8b2252;">"25%"</span>, <span style="color: #8b2252;">"Even just 1 number in text!"</span>)
                                     <span style="color: #b22222;"># </span><span style="color: #b22222;">Use parse_number()!</span>
parse_number(x)
                                     <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 10 25  1</span>
</pre>
</div>
</div>
</div>
</div>

<div id="orgae8e645" class="outline-3">
<h3 id="orgae8e645"><span class="section-number-3">12.35</span> remedy</h3>
<div class="outline-text-3" id="text-12-35">
<p>
该包可用于在 Rmarkdown 中快速建立标题、字体改变等。
```{r}
remedy::remedy<sub>opts</sub>$get("hotkeys") # 可以查看快捷键
```
</p>
</div>
</div>
<div id="org5083b17" class="outline-3">
<h3 id="org5083b17"><span class="section-number-3">12.36</span> vctrs</h3>
<div class="outline-text-3" id="text-12-36">
</div>
<div id="orgab766ad" class="outline-4">
<h4 id="orgab766ad"><span class="section-number-4">12.36.1</span> vec<sub>c</sub></h4>
<div class="outline-text-4" id="text-12-36-1">
<p>
Combine many vectors into one vector.Combine all arguments into a new vector of
common type.
</p>

<p>
可以很方便地将因子型变量定义为字符型变量。
</p>
<div class="org-src-container">
<pre class="src src-R">vec_c(Sys.Date(), Sys.time())
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "2020-03-01 00:00:00 CST" "2020-03-01 16:41:02 CST"</span>
vec_c(<span style="color: #228b22;">FALSE</span>, <span style="color: #008b8b;">1L</span>, <span style="color: #8b2252;">"x"</span>, .ptype = character())
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "FALSE" "1"     "x"</span>
c(factor(<span style="color: #8b2252;">"a"</span>), factor(<span style="color: #8b2252;">"b"</span>))
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 1 1</span>
vec_c(factor(<span style="color: #8b2252;">"a"</span>), factor(<span style="color: #8b2252;">"b"</span>))
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] a b</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Levels: a b</span>
vec_c(name = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>, .name_spec = <span style="color: #8b2252;">"{outer}_{inner}"</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; name_1 name_2 name_3 </span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;      1      2      3 </span>
</pre>
</div>
<p>
.name<sub>spec</sub> 对比 c() 很有意思。以下两个程序等价。
</p>
<div class="org-src-container">
<pre class="src src-R">vec_c(name = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>,
      .name_spec = <span style="color: #8b2252;">"{outer}{inner}"</span>)
c(name = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>)  
</pre>
</div>
</div>
</div>

<div id="orgce29c02" class="outline-4">
<h4 id="orgce29c02"><span class="section-number-4">12.36.2</span> vec<sub>assert</sub></h4>
<div class="outline-text-4" id="text-12-36-2">
<p>
声明型变量。 Assert an argument has known prototype and/or size.
vec<sub>assert</sub>(x, ptype = NULL, size = NULL, arg = as<sub>label</sub>(substitute(x))).
如果知道这个向量的大小和数据类型，那么就可以提出一个声明～，确保准确。
</p>

<p>
这个函数可以用于生成报错信息。
</p>

<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> c(a = <span style="color: #008b8b;">1</span>, b = <span style="color: #008b8b;">2</span>, c = <span style="color: #008b8b;">3</span>)
vec_assert(x, ptype = character())
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Error: `x` must be a vector with type &lt;character&gt;.</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Instead, it has type &lt;double&gt;.      </span>
</pre>
</div>
</div>
</div>
<div id="orgb378c57" class="outline-4">
<h4 id="orgb378c57"><span class="section-number-4">12.36.3</span> vec<sub>is</sub></h4>
<div class="outline-text-4" id="text-12-36-3">
<p>
判断 vector 类型。可以配合 vec<sub>assert</sub> 使用。
</p>
<div class="org-src-container">
<pre class="src src-R">vec_is(c(<span style="color: #8b2252;">"1"</span>),numeric())
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] FALSE      </span>
</pre>
</div>
</div>
</div>

<div id="orgebc50d7" class="outline-4">
<h4 id="orgebc50d7"><span class="section-number-4">12.36.4</span> vec<sub>bind</sub></h4>
<div class="outline-text-4" id="text-12-36-4">
<p>
这个函数和 rbind 函数主要不同在于，rbind/cbind 返回 matrix 类型数据，而 vec<sub>bind</sub> 返回的是 list 型数据。
</p>
<div class="org-src-container">
<pre class="src src-R">vec_rbind(
    data.frame(x = <span style="color: #008b8b;">1</span>),
    data.frame(x = <span style="color: #228b22;">FALSE</span>)
)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   x</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1 1</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2 0</span>
                                  <span style="color: #b22222;"># </span><span style="color: #b22222;">unique columns are filled with NAs</span>
vec_rbind(
    data.frame(x = <span style="color: #008b8b;">1</span>),
    data.frame(y = <span style="color: #8b2252;">"x"</span>)
)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;    x    y</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1  1 &lt;NA&gt;</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2 NA    x</span>

                                  <span style="color: #b22222;"># </span><span style="color: #b22222;">null inputs are ignored</span>
vec_rbind(
    data.frame(x = <span style="color: #008b8b;">1</span>),
    <span style="color: #228b22;">NULL</span>,
    data.frame(x = <span style="color: #008b8b;">2</span>)
)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   x</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1 1</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2 2</span>

vec_rbind(
    <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">2</span>,
    <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>,
    <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">4</span>
)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   ...1 ...2 ...3 ...4</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1    1    2   NA   NA</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2    1    2    3   NA</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3    1    2    3    4</span>
vec_cbind(
    data.frame(x = <span style="color: #008b8b;">1</span>),
    data.frame(y = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>)
)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   x y</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1 1 1</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2 1 2</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3 1 3</span>

</pre>
</div>
</div>
</div>
<div id="org273a64e" class="outline-4">
<h4 id="org273a64e"><span class="section-number-4">12.36.5</span> vec<sub>compare</sub></h4>
<div class="outline-text-4" id="text-12-36-5">
<p>
可以方便地比较两个向量，Compare two vectors.
1 说明前一个向量数值大于后者，如果等于 0,说明两者相等。
</p>

<div class="org-src-container">
<pre class="src src-R">vec_compare(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">10</span>, <span style="color: #008b8b;">5</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [1] -1 -1 -1 -1  0  1  1  1  1  1</span>
vec_compare(c(<span style="color: #228b22;">TRUE</span>, <span style="color: #228b22;">FALSE</span>, <span style="color: #228b22;">NA</span>), <span style="color: #228b22;">FALSE</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1]  1  0 NA</span>
vec_compare(runif(<span style="color: #008b8b;">10</span>), <span style="color: #008b8b;">0.5</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [1] -1 -1 -1  1 -1 -1 -1  1  1  1</span>
</pre>
</div>
</div>
</div>
<div id="orgb3f0a50" class="outline-4">
<h4 id="orgb3f0a50"><span class="section-number-4">12.36.6</span> vec<sub>duplicate</sub><sub>any</sub>/vec<sub>duplicate</sub><sub>detect</sub></h4>
<div class="outline-text-4" id="text-12-36-6">
<p>
vec<sub>duplicate</sub><sub>any</sub>(): detects the presence of duplicated values, similar to any duplicated().这个函数用于检查是否存在重复值。
vec<sub>duplicate</sub><sub>detect</sub>(): returns a logical vector describing if each element of
the vector is duplicated elsewhere. Unlike duplicated(), it reports all
duplicated values, not just the second and subsequent repetitions. 这个函数用于检查是否存在重复值，确认重复向量值的位置。
</p>

<p>
vec<sub>duplicate</sub><sub>id</sub>(): returns an integer vector giving the location of the first occurence of the value.
</p>
<div class="org-src-container">
<pre class="src src-R">vec_duplicate_any(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">10</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] FALSE</span>
vec_duplicate_any(c(<span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">10</span>))
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] TRUE</span>
x <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #008b8b;">10</span>, <span style="color: #008b8b;">10</span>, <span style="color: #008b8b;">20</span>, <span style="color: #008b8b;">30</span>, <span style="color: #008b8b;">30</span>, <span style="color: #008b8b;">40</span>)
vec_duplicate_detect(x)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1]  TRUE  TRUE FALSE  TRUE  TRUE FALSE</span>
vec_duplicate_id(x)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 1 1 3 4 4 6</span>
</pre>
</div>
</div>
</div>
<div id="org72d573b" class="outline-4">
<h4 id="org72d573b"><span class="section-number-4">12.36.7</span> vec<sub>match</sub></h4>
<div class="outline-text-4" id="text-12-36-7">
<p>
Find matching observations across vectors.返回观测值的位置。
vec<sub>in</sub>() returns a logical vector based on whether needle is found in haystack. vec<sub>match</sub>() returns an integer vector giving location of needle in haystack, or NA if it's not found.
vec<sub>in</sub>() is equivalent to %in%; vec<sub>match</sub>() is equivalen to match()
</p>

<p>
vec<sub>in</sub>(x, y):x 是否在 y 中， return T/F.
vec<sub>match</sub>(x, y):x 在 y 中的位置。
</p>

<div class="org-src-container">
<pre class="src src-R">hadley <span style="color: #008b8b;">&lt;-</span> strsplit(<span style="color: #8b2252;">"hadley"</span>, <span style="color: #8b2252;">""</span>)[[<span style="color: #008b8b;">1</span>]]
vec_match(hadley, letters)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1]  8  1  4 12  5 25  </span>
vowels <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #8b2252;">"a"</span>, <span style="color: #8b2252;">"e"</span>, <span style="color: #8b2252;">"i"</span>, <span style="color: #8b2252;">"o"</span>, <span style="color: #8b2252;">"u"</span>)
vec_in(hadley, vowels)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] FALSE  TRUE FALSE FALSE  TRUE FALSE</span>
vec_match(c(<span style="color: #8b2252;">"a"</span>, <span style="color: #8b2252;">"b"</span>), c(<span style="color: #8b2252;">"a"</span>, <span style="color: #8b2252;">"b"</span>, <span style="color: #8b2252;">"a"</span>, <span style="color: #8b2252;">"b"</span>))
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 1 2</span>
</pre>
</div>
</div>
</div>
<div id="org36c2dec" class="outline-4">
<h4 id="org36c2dec"><span class="section-number-4">12.36.8</span> vec<sub>in</sub></h4>
<div class="outline-text-4" id="text-12-36-8">
<div class="org-src-container">
<pre class="src src-R">vec_in(hadley, vowels)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] FALSE  TRUE FALSE FALSE  TRUE FALSE</span>
</pre>
</div>
</div>
</div>
<div id="org27f0a4f" class="outline-4">
<h4 id="org27f0a4f"><span class="section-number-4">12.36.9</span> vec<sub>chop</sub></h4>
<div class="outline-text-4" id="text-12-36-9">
<p>
vec<sub>chop</sub>() provides an efficient method to repeatedly slice a vector. It
captures the pattern of map(indices, vec<sub>slice</sub>, x = x).vec<sub>chop</sub> 可以提供一个有效的方法重复地对一个向量采样！按照特定的顺序对元素进行抽样。
</p>

<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #8b2252;">"a"</span>, <span style="color: #8b2252;">"b"</span>, <span style="color: #8b2252;">"c"</span>, <span style="color: #8b2252;">"d"</span>)
indices <span style="color: #008b8b;">&lt;-</span> list(<span style="color: #008b8b;">2</span>, c(<span style="color: #008b8b;">3</span>, <span style="color: #008b8b;">1</span>), <span style="color: #008b8b;">4</span>)
vec_chop(x, indices)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[1]]</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "b"</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[2]]</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "c" "a"</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[3]]</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "d"  </span>
</pre>
</div>
</div>
</div>
<div id="org7459d74" class="outline-4">
<h4 id="org7459d74"><span class="section-number-4">12.36.10</span> vec<sub>unchop</sub></h4>
<div class="outline-text-4" id="text-12-36-10">
<p>
vec<sub>unchop</sub>() combines a list of vectors into a single vector, placing elements in the output according to the locations specified by indices. It is similar to vec<sub>c</sub>(), but gives greater control over how the elements are combined. When no indices are supplied, it is identical to vec<sub>c</sub>().
就是 vec<sub>chop</sub> 的逆操作。
</p>
<div class="org-src-container">
<pre class="src src-R">vec_unchop(vec_chop(x, indices), indices)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "a" "b" "c" "d"</span>
</pre>
</div>
</div>
</div>
<div id="orgd1936f8" class="outline-4">
<h4 id="orgd1936f8"><span class="section-number-4">12.36.11</span> vec<sub>cast</sub></h4>
<div class="outline-text-4" id="text-12-36-11">
<p>
    这个函数类似于 as.character。
This function should typically be called from the default vec<sub>cast</sub>() method for your class, e.g. vec<sub>cast.myclass.default</sub>(). 
</p>
<div class="org-src-container">
<pre class="src src-R">enframe(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>) <span style="color: #008b8b;">%&gt;%</span> 
    mutate(name = vec_cast(name, character()))
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; # A tibble: 3 x 2</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   name  value</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   &lt;chr&gt; &lt;int&gt;</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1 1         1</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2 2         2</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3 3         3      </span>
</pre>
</div>
</div>
</div>

<div id="org7360860" class="outline-4">
<h4 id="org7360860"><span class="section-number-4">12.36.12</span> vec<sub>equal</sub></h4>
<div class="outline-text-4" id="text-12-36-12">
<p>
Test if two vectors are equal。也可以是 data.frame 和 vector 对比检查是否相等。
</p>
<div class="org-src-container">
<pre class="src src-R">df <span style="color: #008b8b;">&lt;-</span> data.frame(x = c(<span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">1</span>, <span style="color: #228b22;">NA</span>), y = c(<span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">1</span>, <span style="color: #228b22;">NA</span>, <span style="color: #228b22;">NA</span>))
vec_equal(df, data.frame(x = <span style="color: #008b8b;">1</span>, y = <span style="color: #008b8b;">2</span>))
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] FALSE  TRUE FALSE    NA    NA</span>
vec_equal_na(df)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] FALSE FALSE FALSE FALSE  TRUE  </span>
</pre>
</div>
</div>
</div>
<div id="org7dc6ec9" class="outline-4">
<h4 id="org7dc6ec9"><span class="section-number-4">12.36.13</span> vec<sub>init</sub></h4>
<div class="outline-text-4" id="text-12-36-13">
<p>
向量初始化。
</p>
<div class="org-src-container">
<pre class="src src-R">vec_init(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">10</span>, <span style="color: #008b8b;">3</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] NA NA NA</span>
vec_init(mtcars, <span style="color: #008b8b;">2</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;      mpg cyl disp hp drat wt qsec vs am gear carb</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; ...1  NA  NA   NA NA   NA NA   NA NA NA   NA   NA</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; ...2  NA  NA   NA NA   NA NA   NA NA NA   NA   NA</span>
vec_init(Sys.Date(), <span style="color: #008b8b;">5</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] NA NA NA NA NA      </span>
</pre>
</div>
</div>
</div>
<div id="orgd34a196" class="outline-4">
<h4 id="orgd34a196"><span class="section-number-4">12.36.14</span> vec<sub>seq</sub><sub>along</sub>/vec<sub>init</sub><sub>along</sub></h4>
<div class="outline-text-4" id="text-12-36-14">
<p>
vec<sub>seq</sub><sub>along</sub>() is equivalent to seq<sub>along</sub>() but uses size, not length. vec<sub>init</sub><sub>along</sub>() creates a vector of missing values with size matching an existing object.
</p>
<div class="org-src-container">
<pre class="src src-R">vec_seq_along(mtcars)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [24] 24 25 26 27 28 29 30 31 32</span>
vec_init_along(head(mtcars))
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;      mpg cyl disp hp drat wt qsec vs am gear carb</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; ...1  NA  NA   NA NA   NA NA   NA NA NA   NA   NA</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; ...2  NA  NA   NA NA   NA NA   NA NA NA   NA   NA</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; ...3  NA  NA   NA NA   NA NA   NA NA NA   NA   NA</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; ...4  NA  NA   NA NA   NA NA   NA NA NA   NA   NA</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; ...5  NA  NA   NA NA   NA NA   NA NA NA   NA   NA</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; ...6  NA  NA   NA NA   NA NA   NA NA NA   NA   NA</span>
</pre>
</div>
</div>
</div>
<div id="orgc50821d" class="outline-4">
<h4 id="orgc50821d"><span class="section-number-4">12.36.15</span> vec<sub>order</sub></h4>
<div class="outline-text-4" id="text-12-36-15">
<p>
Order and sort vectors.
</p>
<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> round(c(runif(<span style="color: #008b8b;">9</span>), <span style="color: #228b22;">NA</span>), <span style="color: #008b8b;">3</span>)
vec_order(x)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [1]  4  6  9  1  5  8  2  3  7 10</span>
vec_sort(x)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [1] 0.107 0.260 0.294 0.648 0.711 0.739 0.775 0.811 0.958    NA</span>
vec_sort(x, <span style="color: #8b2252;">"desc"</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [1]    NA 0.958 0.811 0.775 0.739 0.711 0.648 0.294 0.260 0.107</span>

                                  <span style="color: #b22222;"># </span><span style="color: #b22222;">Can also handle data frames</span>
df <span style="color: #008b8b;">&lt;-</span> data.frame(g = sample(<span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">10</span>, replace = <span style="color: #228b22;">TRUE</span>), x = x)
vec_order(df)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [1]  6  9  5  8  2  3  4  1  7 10</span>
</pre>
</div>
</div>
</div>
<div id="org1c6a392" class="outline-4">
<h4 id="org1c6a392"><span class="section-number-4">12.36.16</span> vec<sub>sort</sub></h4>
<div class="outline-text-4" id="text-12-36-16">
<div class="org-src-container">
<pre class="src src-R">vec_sort(df)
                                       <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;    g     x</span>
                                       <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1  1 0.260</span>
                                       <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2  1 0.294</span>
                                       <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3  1 0.711</span>
                                       <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 4  1 0.739</span>
                                       <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 5  1 0.775</span>
                                       <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 6  1 0.811</span>
                                       <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 7  2 0.107</span>
                                       <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 8  2 0.648</span>
                                       <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 9  2 0.958</span>
                                       <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 10 2    NA</span>
     vec_sort(df, <span style="color: #8b2252;">"desc"</span>)
                                       <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;    g     x</span>
                                       <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1  2    NA</span>
                                       <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2  2 0.958</span>
                                       <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3  2 0.648</span>
                                       <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 4  2 0.107</span>
                                       <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 5  1 0.811</span>
                                       <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 6  1 0.775</span>
                                       <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 7  1 0.739</span>
                                       <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 8  1 0.711</span>
                                       <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 9  1 0.294</span>
                                       <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 10 1 0.260      </span>
</pre>
</div>
</div>
</div>
<div id="orgff5420c" class="outline-4">
<h4 id="orgff5420c"><span class="section-number-4">12.36.17</span> vec<sub>count</sub></h4>
<div class="outline-text-4" id="text-12-36-17">
<p>
Count the number of unique values in a vector. vec<sub>count</sub>() has two important differences to table(): it returns a data frame, and when given multiple inputs (as a data frame), it only counts combinations that appear in the input.
这个函数和 table 类似，但是相比较 table 函数可以返回一个 data.frame 格式数据。
</p>

<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> letters[rpois(<span style="color: #008b8b;">100</span>, <span style="color: #008b8b;">6</span>)]
                                      <span style="color: #b22222;"># </span><span style="color: #b22222;">default is to sort by frequency</span>
vec_count(x)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;    key count</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1    g    24</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2    f    17</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3    e    12</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 4    h    12</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 5    d    11</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 6    c     9</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 7    i     5</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 8    j     4</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 9    b     2</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 10   m     1</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 11   l     1</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 12   k     1</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 13   a     1</span>
table(x)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; x</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  a  b  c  d  e  f  g  h  i  j  k  l  m </span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  1  2  9 11 12 17 24 12  5  4  1  1  1  </span>
</pre>
</div>
</div>
</div>

<div id="orgf1cec1b" class="outline-4">
<h4 id="orgf1cec1b"><span class="section-number-4">12.36.18</span> vec<sub>size</sub></h4>
<div class="outline-text-4" id="text-12-36-18">
<p>
Number of observations.
</p>
<div class="org-src-container">
<pre class="src src-R">vec_size(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">100</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 100</span>
vec_size(mtcars)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 32</span>
vec_size(array(dim = c(<span style="color: #008b8b;">3</span>, <span style="color: #008b8b;">5</span>, <span style="color: #008b8b;">10</span>)))
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 3      </span>
</pre>
</div>
</div>
</div>
<div id="orgadb6c72" class="outline-4">
<h4 id="orgadb6c72"><span class="section-number-4">12.36.19</span> vec<sub>slice</sub></h4>
<div class="outline-text-4" id="text-12-36-19">
<p>
Get or set observations in a vector.
</p>
<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> sample(<span style="color: #008b8b;">10</span>)
x
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [1]  1  3 10  6  5  8  7  9  4  2</span>
vec_slice(x, <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1]  1  3 10      </span>
</pre>
</div>
</div>
</div>
<div id="org97085f2" class="outline-4">
<h4 id="org97085f2"><span class="section-number-4">12.36.20</span> vec<sub>assign</sub></h4>
<div class="outline-text-4" id="text-12-36-20">
<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> sample(<span style="color: #008b8b;">10</span>)
x
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [1]  9  6  1  3  4  8 10  5  2  7</span>
vec_slice(x, <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 9 6 1</span>
y <span style="color: #008b8b;">&lt;-</span> vec_assign(x, <span style="color: #008b8b;">3</span>, <span style="color: #008b8b;">500</span>)
y
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [1]   9   6 500   3   4   8  10   5   2   7      </span>
</pre>
</div>
</div>
</div>
<div id="orgb6d489b" class="outline-4">
<h4 id="orgb6d489b"><span class="section-number-4">12.36.21</span> vec<sub>recycle</sub>/vec<sub>recycle</sub><sub>common</sub></h4>
<div class="outline-text-4" id="text-12-36-21">
<div class="org-src-container">
<pre class="src src-R">vec_recycle(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">5</span>, <span style="color: #008b8b;">5</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 1 2 3 4 5</span>
vec_recycle_common(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">5</span>, <span style="color: #008b8b;">5</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[1]]</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 1 2 3 4 5</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[2]]</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 5 5 5 5 5</span>
vec_recycle_common(integer(), <span style="color: #008b8b;">5</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[1]]</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; integer(0)</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[2]]</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; numeric(0)      </span>
</pre>
</div>
</div>
</div>
<div id="org4fd4db2" class="outline-4">
<h4 id="org4fd4db2"><span class="section-number-4">12.36.22</span> vec<sub>repeat</sub></h4>
<div class="outline-text-4" id="text-12-36-22">
<p>
Expand the length of a vector.This is a special case of rep() for the special case of integer times and each values, and works along size, rather than length.
</p>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #b22222;"># </span><span style="color: #b22222;">each repeats within</span>
vec_repeat(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>, each = <span style="color: #008b8b;">2</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 1 1 2 2 3 3</span>
                                  <span style="color: #b22222;"># </span><span style="color: #b22222;">times repeats whole thing</span>
vec_repeat(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">3</span>, times = <span style="color: #008b8b;">2</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 1 2 3 1 2 3</span>

df <span style="color: #008b8b;">&lt;-</span> data.frame(x = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">2</span>, y = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">2</span>)
                                  <span style="color: #b22222;"># </span><span style="color: #b22222;">rep() repeats columns of data frame, and returns list:</span>
rep(df, each = <span style="color: #008b8b;">2</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; $x</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 1 2</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; $x</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 1 2</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; $y</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 1 2</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; $y</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 1 2</span>
                                  <span style="color: #b22222;"># </span><span style="color: #b22222;">vec_repeat() repeats rows, and returns same data.frame</span>
vec_repeat(df, <span style="color: #008b8b;">2</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   x y</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1 1 1</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2 1 1</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3 2 2</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 4 2 2      </span>
</pre>
</div>
</div>
</div>
<div id="org0c4880b" class="outline-4">
<h4 id="org0c4880b"><span class="section-number-4">12.36.23</span> vec<sub>split</sub></h4>
<div class="outline-text-4" id="text-12-36-23">
<p>
Split a vector into groups.This is a generalisation of split() that can split by any type of vector, not just factors. Instead of returning the keys in the character names, the are returned in a separate parallel vector.
</p>
<div class="org-src-container">
<pre class="src src-R">vec_split(mtcars$cyl, mtcars$vs)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   key                                                  val</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1   0 6, 6, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 4, 8, 6, 8</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2   1             4, 6, 6, 4, 4, 6, 6, 4, 4, 4, 4, 4, 4, 4</span>
vec_split(mtcars$cyl, mtcars[c(<span style="color: #8b2252;">"vs"</span>, <span style="color: #8b2252;">"am"</span>)])
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   key.vs key.am                                val</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1      0      1                   6, 6, 4, 8, 6, 8</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2      1      1                4, 4, 4, 4, 4, 4, 4</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3      1      0                6, 6, 4, 4, 6, 6, 4</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 4      0      0 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8</span>
</pre>
</div>
</div>
</div>
<div id="org3e16a1a" class="outline-4">
<h4 id="org3e16a1a"><span class="section-number-4">12.36.24</span> vec<sub>unique</sub></h4>
<div class="outline-text-4" id="text-12-36-24">
<p>
Find and count unique values.
</p>

<p>
## 不同数值
vec<sub>unique</sub>(): the unique values. Equivalent to unique().
</p>

<p>
## 可以返回不同数值的位置
vec<sub>unique</sub><sub>loc</sub>(): the locations of the unique values.
</p>

<p>
##可以计算不同数值的个数
vec<sub>unique</sub><sub>count</sub>(): the number of unique values. 
</p>

<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> rpois(<span style="color: #008b8b;">100</span>, <span style="color: #008b8b;">8</span>)
x
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   [1]  9  8  8 11  8  4  7  9  9  5  6  5  6  7  3  3 10 10 10  5 16 10  5</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [24]  7  9  6  5 10  6  4  7  4  4  4  8 11  6 13 10  8 10  9  3  6  9  8</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [47] 13 10  9  8 12  3 10  8  3 11  6  9 10 11 11  4 11  8 10  8  5  5  9</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [70]  4 10  8  5  8  8 10 10 12  7 16  7  6 12  3  7  7 12  6  8  7 14  5</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [93]  6  3  6 11  7 10  8 10</span>
vec_unique(x)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [1]  9  8 11  4  7  5  6  3 10 16 13 12 14</span>
vec_unique_loc(x)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;  [1]  1  2  4  6  7 10 11 15 17 21 38 51 91</span>
vec_unique_count(x)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 13      </span>
</pre>
</div>
</div>
</div>
<div id="org4e5b065" class="outline-4">
<h4 id="org4e5b065"><span class="section-number-4">12.36.25</span> vec<sub>ptype</sub></h4>
<div class="outline-text-4" id="text-12-36-25">
<p>
vec<sub>ptype</sub>() returns the unfinalised prototype of a single vector. vec<sub>ptype</sub><sub>common</sub>() finds the common type of multiple vectors. vec<sub>ptype</sub><sub>show</sub>() nicely prints the common type of any number of inputs, and is designed for interactive exploration.
</p>
</div>

<div id="org910c30b" class="outline-5">
<h5 id="org910c30b"><span class="section-number-5">12.36.25.1</span> vec<sub>ptype</sub><sub>show</sub></h5>
<div class="outline-text-5" id="text-12-36-25-1">
<p>
可以快速显示数据类型。
</p>

<p>
vec<sub>ptype</sub><sub>common</sub>() first finds the prototype of each input, then successively calls vec<sub>ptype2</sub>() to find a common type.查看数据类型。
</p>
<div class="org-src-container">
<pre class="src src-R">vec_ptype_show(iris)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Prototype: data.frame&lt;</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   Sepal.Length: double</span>
  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   Sepal.Width : double</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   Petal.Length: double</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   Petal.Width : double</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   Species     : factor&lt;12d60&gt;</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; &gt;  </span>
</pre>
</div>
</div>
</div>
</div>
<div id="org5289449" class="outline-4">
<h4 id="org5289449"><span class="section-number-4">12.36.26</span> vec<sub>arith</sub></h4>
<div class="outline-text-4" id="text-12-36-26">
<p>
This generic provides a common double dispatch mechanism for all infix operators (+, -, /, *, ^, %%, %/%, !, &amp;, |). It is used to power the default arithmetic and boolean operators for vctrs objects, overcoming the limitations of the base Ops generic.
</p>

<p>
这个函数可以用来计算日期型数据。
</p>
<div class="org-src-container">
<pre class="src src-R">d <span style="color: #008b8b;">&lt;-</span> as.Date(<span style="color: #8b2252;">"2018-01-01"</span>)
dt <span style="color: #008b8b;">&lt;-</span> as.POSIXct(<span style="color: #8b2252;">"2018-01-02 12:00"</span>)
t <span style="color: #008b8b;">&lt;-</span> as.difftime(<span style="color: #008b8b;">12</span>, unit = <span style="color: #8b2252;">"hours"</span>)
vec_arith(<span style="color: #8b2252;">"-"</span>, dt, <span style="color: #008b8b;">1</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "2018-01-02 11:59:59 CST"</span>
vec_arith(<span style="color: #8b2252;">"-"</span>, dt, t)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "2018-01-02 CST"</span>
vec_arith(<span style="color: #8b2252;">"-"</span>, dt, d)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Time difference of 100800 secs</span>
vec_arith(<span style="color: #8b2252;">"+"</span>, dt, <span style="color: #008b8b;">86400</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "2018-01-03 12:00:00 CST"  </span>
</pre>
</div>
</div>
</div>
<div id="orgd602483" class="outline-4">
<h4 id="orgd602483"><span class="section-number-4">12.36.27</span> vec<sub>as</sub><sub>location</sub></h4>
<div class="outline-text-4" id="text-12-36-27">
<p>
Create a vector of locations.
</p>

<p>
These helpers provide a means of standardizing common indexing methods such as integer, character or logical indexing.
</p>

<p>
vec<sub>as</sub><sub>location</sub>() accepts integer, character, or logical vectors of any size. The output is always an integer vector that is suitable for subsetting with [ or vec<sub>slice</sub>(). It might be a different size than the input because negative selections are transformed to positive ones and logical vectors are transformed to a vector of indices for the TRUE locations.
</p>

<p>
vec<sub>as</sub><sub>location2</sub>() accepts a single number or string. It returns a single location as a integer vector of size 1. This is suitable for extracting with [[.
</p>

<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> array(<span style="color: #008b8b;">3</span>:<span style="color: #008b8b;">6</span>, c(<span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">3</span>))
dimnames(x) <span style="color: #008b8b;">&lt;-</span> list(c(<span style="color: #8b2252;">"r1"</span>, <span style="color: #8b2252;">"r2"</span>), c(<span style="color: #8b2252;">"c1"</span>, <span style="color: #8b2252;">"c2"</span>, <span style="color: #8b2252;">"c3"</span>))
                                      <span style="color: #b22222;"># </span><span style="color: #b22222;">The most common use case validates row indices</span>
vec_as_location(<span style="color: #008b8b;">3</span>, vec_size(x))
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Error: Can't subset elements that don't exist.</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; x The location 3 doesn't exist.</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; &#8505; There are only 2 elements.</span>
vec_as_location(-<span style="color: #008b8b;">1</span>, vec_size(x))
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 2</span>
vec_as_location(c(<span style="color: #8b2252;">"c2"</span>, <span style="color: #8b2252;">"c1"</span>), ncol(x), colnames(x))
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 2   </span>
</pre>
</div>
</div>
</div>

<div id="org4e988d6" class="outline-4">
<h4 id="org4e988d6"><span class="section-number-4">12.36.28</span> vec<sub>type</sub></h4>
<div class="outline-text-4" id="text-12-36-28">
<p>
Find the prototype of a set of vectors.
</p>
<div class="org-src-container">
<pre class="src src-R">      vec_ptype(c(<span style="color: #8b2252;">"1"</span>))
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; character(0)</span>
vec_ptype_show(<span style="color: #228b22;">NA</span>)
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Prototype: logical</span>
vec_ptype_common(<span style="color: #8b2252;">"1"</span>)
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; character(0)</span>
vec_ptype_show(letters)
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Prototype: character</span>
vec_ptype_show(
  data.frame(x = <span style="color: #228b22;">TRUE</span>),
  data.frame(y = <span style="color: #008b8b;">2</span>),
  data.frame(z = <span style="color: #8b2252;">"a"</span>)
)
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Prototype: &lt;data.frame&lt;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   x: logical</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   y: double</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   z: character</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; &gt;&gt;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 0. (                         , &lt;data.frame&lt;x:logical&gt;&gt;   ) = &lt;data.frame&lt;x:logical&gt;&gt;</span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1. &#9484; &lt;data.frame&lt;x:logical&gt;&gt; , &lt;data.frame&lt;y:double&gt;&gt;    &#9488; = &lt;data.frame&lt;           </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;    &#9474;                                                     &#9474;     x: logical           </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;    &#9474;                                                     &#9474;     y: double            </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;    &#9492;                                                     &#9496;   &gt;&gt;                     </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2. &#9484; &lt;data.frame&lt;            , &lt;data.frame&lt;z:character&gt;&gt; &#9488; = &lt;data.frame&lt;           </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;    &#9474;   x: logical                                        &#9474;     x: logical           </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;    &#9474;   y: double                                         &#9474;     y: double            </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;    &#9474; &gt;&gt;                                                  &#9474;     z: character         </span>
<span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;    &#9492;                                                     &#9496;   &gt;&gt;</span>
</pre>
</div>
</div>
</div>
<div id="org7931305" class="outline-4">
<h4 id="org7931305"><span class="section-number-4">12.36.29</span> %0%</h4>
<div class="outline-text-4" id="text-12-36-29">
<p>
default value for empty vectors.
</p>

<div class="org-src-container">
<pre class="src src-R">integer() <span style="color: #008b8b;">%0%</span> <span style="color: #008b8b;">5</span>
<span style="color: #b22222;"># </span><span style="color: #b22222;">5</span>
</pre>
</div>
</div>
</div>
<div id="orgdd31468" class="outline-4">
<h4 id="orgdd31468"><span class="section-number-4">12.36.30</span> vec<sub>cast.glue</sub></h4>
<div class="outline-text-4" id="text-12-36-30">
<p>
寻找例子！！
</p>
</div>
</div>
</div>

<div id="orgb7b0ed9" class="outline-3">
<h3 id="orgb7b0ed9"><span class="section-number-3">12.37</span> slider</h3>
<div class="outline-text-3" id="text-12-37">
<p>
窗口函数。
</p>
</div>
<div id="org0fc6e29" class="outline-4">
<h4 id="org0fc6e29"><span class="section-number-4">12.37.1</span> block</h4>
<div class="outline-text-4" id="text-12-37-1">
<p>
break a vector into blocks.
</p>

<div class="org-src-container">
<pre class="src src-R">i <span style="color: #008b8b;">&lt;-</span> as.Date(<span style="color: #8b2252;">"2019-01-01"</span>) + c(-<span style="color: #008b8b;">2</span>:<span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">31</span>)
i
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "2018-12-30" "2018-12-31" "2019-01-01" "2019-01-02" "2019-01-03"</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [6] "2019-02-01"</span>
block(i, i, period = <span style="color: #8b2252;">"year"</span>)
        <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[1]]</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "2018-12-30" "2018-12-31"</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[2]]</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] "2019-01-01" "2019-01-02" "2019-01-03" "2019-02-01"  </span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">6</span>
                                      <span style="color: #b22222;"># </span><span style="color: #b22222;">Data frames are split row wise</span>
df <span style="color: #008b8b;">&lt;-</span> data.frame(x = x, i = i)
df
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   x          i</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1 1 2018-12-30</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2 2 2018-12-31</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3 3 2019-01-01</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 4 4 2019-01-02</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 5 5 2019-01-03</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 6 6 2019-02-01</span>
block(df, i, period = <span style="color: #8b2252;">"month"</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[1]]</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   x          i</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1 1 2018-12-30</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2 2 2018-12-31</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[2]]</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   x          i</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1 3 2019-01-01</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 2 4 2019-01-02</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 3 5 2019-01-03</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[3]]</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt;   x          i</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; 1 6 2019-02-01  </span>
</pre>
</div>
</div>
</div>
<div id="org5250cac" class="outline-4">
<h4 id="org5250cac"><span class="section-number-4">12.37.2</span> hop</h4>
<div class="outline-text-4" id="text-12-37-2">
<p>
hop() is the lower level engine that powers slide() (at least in theory).这个函数类似于 slide.
</p>

<div class="org-src-container">
<pre class="src src-R">hop(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">2</span>, .starts = c(<span style="color: #008b8b;">0</span>, <span style="color: #008b8b;">1</span>), .stops = c(<span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">2</span>), ~.x)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[1]]</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 1</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[2]]</span>
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 1 2  </span>
</pre>
</div>
</div>
</div>
<div id="org5bea656" class="outline-4">
<h4 id="org5bea656"><span class="section-number-4">12.37.3</span> slide2</h4>
<div class="outline-text-4" id="text-12-37-3">
<p>
slide over multiple inputs simultaneously.
</p>

<p>
These are variants of slide() that iterate over multiple inputs in parallel. They are parallel in the sense that each input is processed in parallel with the others, not in the sense of multicore computing. These functions work similarly to map2() and pmap() from purrr.
</p>

<div class="org-src-container">
<pre class="src src-R">slide2(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">4</span>, <span style="color: #008b8b;">5</span>:<span style="color: #008b8b;">8</span>, ~list(.x, .y), .before = <span style="color: #008b8b;">2</span>)
slide2(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">4</span>, <span style="color: #008b8b;">5</span>:<span style="color: #008b8b;">8</span>, ~list(.x, .y), .before = <span style="color: #008b8b;">3</span>)
slide2(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">4</span>, <span style="color: #008b8b;">5</span>:<span style="color: #008b8b;">8</span>, ~list(.x, .y), .before = <span style="color: #008b8b;">1</span>)  
</pre>
</div>
</div>
</div>
<div id="org7393d81" class="outline-4">
<h4 id="org7393d81"><span class="section-number-4">12.37.4</span> slide<sub>period</sub></h4>
<div class="outline-text-4" id="text-12-37-4">
<p>
Slide relative to an index chunked by period.
</p>

<div class="org-src-container">
<pre class="src src-R">i2 <span style="color: #008b8b;">&lt;-</span> as.Date(c(<span style="color: #8b2252;">"2019-01-01"</span>, <span style="color: #8b2252;">"2019-02-01"</span>, <span style="color: #8b2252;">"2019-04-01"</span>, <span style="color: #8b2252;">"2019-05-01"</span>))
i2
slide_period(i2, i2, <span style="color: #8b2252;">"month"</span>, identity, .before = <span style="color: #008b8b;">1</span>)  
</pre>
</div>
</div>
</div>
</div>

<div id="org44379f8" class="outline-3">
<h3 id="org44379f8"><span class="section-number-3">12.38</span> Rcpp</h3>
<div class="outline-text-3" id="text-12-38">
<p>
为了提高 R 程序的运行效率，可以尽量使用向量化编程，减少循环，尽量使用内建函数。对于效率的瓶颈， 尤其是设计迭代算法时， 可以采用编译代码，而 Rcpp 扩展包可以很容易地将 C++代码连接到 R 程序中，并且支持在 C++中使用类似于 R 的数据类型。
</p>

<p>
Rcpp 的用途：
</p>

<ul class="org-ul">
<li>把已经用 R 代码完成的程序中运行速度瓶颈部分改写成 C++代码， 提高运行效率。</li>

<li>对于 C++或 C 程序源代码或二进制代码提供的函数库， 可以用 Rcpp 编写 C++界面程序进行 R 与 C++程序的输入、输出的传送， 并在 C++界面程序中调用外来的函数库。</li>

<li>注意，用 Rcpp 编写 C++程序， 不利于把程序脱离 R 运行或被其他的 C++程序调用。 当然，可以只把 Rcpp 作为界面， 主要的算法引擎完全不用 Rpp 的数据类型。</li>

<li>RInside 扩展包支持把 R 嵌入到 C++主程序中。</li>
</ul>

<p>
在 C++语言层面，数据类型对应 R 对象数据类型：
</p>

<p>
IntegerVector | integer
NumericVector | numeric
LogicalVector | logical
CharacterVector | character
GenericVector | List
ExpressionVector | expression
RawVector | raw
</p>
</div>

<div id="orgae64c19" class="outline-4">
<h4 id="orgae64c19"><span class="section-number-4">12.38.1</span> cppFunction</h4>
<div class="outline-text-4" id="text-12-38-1">
<p>
通过这个例子可知，在 function 里面其实可以 return 原值的。
</p>

<div class="org-src-container">
<pre class="src src-R">    cppFunction(
        <span style="color: #8b2252;">'int fib_cpp_0(int n){</span>
<span style="color: #8b2252;">     if(n==1||n==2) return 1;</span>
<span style="color: #8b2252;">     return(fib_cpp_0(n-1)+fib_cpp_0(n-2));</span>
<span style="color: #8b2252;">}'</span>
)
    fib_cpp_0(<span style="color: #008b8b;">10</span>)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 55</span>
</pre>
</div>
</div>
</div>

<div id="org0d2ce18" class="outline-4">
<h4 id="org0d2ce18"><span class="section-number-4">12.38.2</span> sourceCpp</h4>
<div class="outline-text-4" id="text-12-38-2">
<p>
可以用 sourceCpp 转换 C++ 程序。Rcpp 包为 C++ 提供了一个 NumericVector 数据类型，用来存储数值型向量。用成员函数 size() 访问其大小，用方括号下标访问其元素。
</p>

<p>
特殊的注释//[ [Rcpp::export ] ] 用来指定哪些 C++ 函数要转换为 R 函数的。这叫做 Rcpp 属性功能。
</p>

<div class="org-src-container">
<pre class="src src-R">sourceCpp(code = <span style="color: #8b2252;">'</span>
<span style="color: #8b2252;">#include &lt;Rcpp.h&gt;          </span>
<span style="color: #8b2252;">using namespace Rcpp;          </span>
<span style="color: #8b2252;">//[[Rcpp::export]]</span>
<span style="color: #8b2252;">NumericVector iters(NumericVector x){</span>
<span style="color: #8b2252;">int n = x.size();</span>
<span style="color: #8b2252;">NumericVector y(n);</span>
<span style="color: #8b2252;">y[0] = x[0];</span>
<span style="color: #8b2252;">double sign=-1;</span>
<span style="color: #8b2252;">for(int t=1;t&lt;n;t++){</span>
<span style="color: #8b2252;">sign *= -1;</span>
<span style="color: #8b2252;">y[t] = sign*y[t-1] + x[t];</span>
<span style="color: #8b2252;">}</span>
<span style="color: #8b2252;">return y;</span>
<span style="color: #8b2252;">}</span>
<span style="color: #8b2252;">        '</span>)
print(iters(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">5</span>))  
</pre>
</div>
</div>
</div>
</div>

<div id="orgea6e5a4" class="outline-3">
<h3 id="orgea6e5a4"><span class="section-number-3">12.39</span> usethis</h3>
<div class="outline-text-3" id="text-12-39">
</div>
<div id="org362e7e0" class="outline-4">
<h4 id="org362e7e0"><span class="section-number-4">12.39.1</span> ui<sub>done</sub></h4>
<div class="outline-text-4" id="text-12-39-1">
<div class="org-src-container">
<pre class="src src-R">ui_done(<span style="color: #8b2252;">"File saved at...."</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; &#10003; File saved at....</span>
ui_todo(<span style="color: #8b2252;">"Changes have been made, please review them!"</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; &#9679; Changes have been made, please review them!</span>
ui_oops(<span style="color: #8b2252;">"That should not have happened"</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; x That should not have happened</span>
start <span style="color: #008b8b;">&lt;-</span> Sys.time()
ui_info(<span style="color: #8b2252;">"It took {Sys.time() - start} seconds to get to this command!"</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; &#8505; It took 0.000996112823486328 seconds to get to this command!      </span>
</pre>
</div>
</div>
</div>

<div id="orge5dffb7" class="outline-4">
<h4 id="orge5dffb7"><span class="section-number-4">12.39.2</span> ui<sub>todo</sub></h4>
</div>
<div id="org115c04e" class="outline-4">
<h4 id="org115c04e"><span class="section-number-4">12.39.3</span> ui<sub>oops</sub></h4>
</div>
<div id="org787a03c" class="outline-4">
<h4 id="org787a03c"><span class="section-number-4">12.39.4</span> ui<sub>info</sub></h4>
</div>
<div id="org6071107" class="outline-4">
<h4 id="org6071107"><span class="section-number-4">12.39.5</span> ui<sub>yeah</sub></h4>
<div class="outline-text-4" id="text-12-39-5">
<div class="org-src-container">
<pre class="src src-R">ui_yeah(<span style="color: #8b2252;">"Want to overwrite that file?"</span>)
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Error: User input required, but session is not interactive.</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Query: Want to overwrite that file?</span>
overwrite <span style="color: #008b8b;">&lt;-</span> ui_yeah(<span style="color: #8b2252;">"Want to overwrite that file?"</span>,
                     yes = c(<span style="color: #8b2252;">"Oh hell yeah"</span>, <span style="color: #8b2252;">"You know it"</span>, <span style="color: #8b2252;">"Yeah clearly"</span>),
                     no = c(<span style="color: #8b2252;">"Broooo no way"</span>, <span style="color: #8b2252;">"Fuck no"</span>, <span style="color: #8b2252;">"Ok but no"</span>),
                     n_yes = <span style="color: #008b8b;">1</span>,
                     n_no = <span style="color: #008b8b;">1</span>
                     )
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Error: User input required, but session is not interactive.</span>
                                  <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Query: Want to overwrite that file?      </span>
</pre>
</div>
</div>
</div>
<div id="org3bb7c9e" class="outline-4">
<h4 id="org3bb7c9e"><span class="section-number-4">12.39.6</span> rename<sub>file</sub></h4>
<div class="outline-text-4" id="text-12-39-6">
<div class="org-src-container">
<pre class="src src-R">rename_files(<span style="color: #8b2252;">"new_function"</span>, <span style="color: #8b2252;">"new_function_new_name"</span>)
                                      <span style="color: #b22222;"># </span><span style="color: #b22222;">&#10003; Moving 'R/new_function.R' to 'R/new_function_new_name.R'</span>
                                      <span style="color: #b22222;"># </span><span style="color: #b22222;">&#10003; Moving 'tests/testthat/test-new_function.R' to 'tests/testthat/test-new_function_new_name.R'  </span>
</pre>
</div>
</div>
</div>
</div>

<div id="orgd139fec" class="outline-3">
<h3 id="orgd139fec"><span class="section-number-3">12.40</span> fs</h3>
<div class="outline-text-3" id="text-12-40">
</div>
<div id="org49aa6d8" class="outline-4">
<h4 id="org49aa6d8"><span class="section-number-4">12.40.1</span> is<sub>dir</sub></h4>
<div class="outline-text-4" id="text-12-40-1">
<p>
检验文件夹是否存在，很有用啊。
</p>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #008b8b;">library</span>(fs)
modelpath = <span style="color: #8b2252;">"/home/work/...."</span>
is_dir(modelpath)
<span style="color: #b22222;">#</span><span style="color: #b22222;">TRUE</span>
</pre>
</div>
</div>
</div>

<div id="org0aec594" class="outline-4">
<h4 id="org0aec594"><span class="section-number-4">12.40.2</span> file<sub>copy</sub></h4>
<div class="outline-text-4" id="text-12-40-2">
<p>
拷贝文件函数。
</p>
</div>
</div>

<div id="org0534c22" class="outline-4">
<h4 id="org0534c22"><span class="section-number-4">12.40.3</span> dir<sub>exists</sub></h4>
<div class="outline-text-4" id="text-12-40-3">
<p>
检验当前目录下是否存在查询文件。
</p>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #008b8b;">library</span>(fs)
file_exists(<span style="color: #8b2252;">"Document"</span>)  
<span style="color: #b22222;">#</span><span style="color: #b22222;">TRUE</span>
</pre>
</div>
</div>
</div>

<div id="org70c2270" class="outline-4">
<h4 id="org70c2270"><span class="section-number-4">12.40.4</span> dir<sub>ls</sub></h4>
<div class="outline-text-4" id="text-12-40-4">
<p>
List files.类似于 list.file.
</p>
</div>
</div>
<div id="org73ec2d0" class="outline-4">
<h4 id="org73ec2d0"><span class="section-number-4">12.40.5</span> dir<sub>tree</sub></h4>
<div class="outline-text-4" id="text-12-40-5">
<p>
可以显示文件目录树。
</p>
<div class="org-src-container">
<pre class="src src-R">fs::dir_tree(<span style="color: #8b2252;">"/Users/luyajun/Documents/"</span>)  
</pre>
</div>
</div>
</div>
<div id="orgac87653" class="outline-4">
<h4 id="orgac87653"><span class="section-number-4">12.40.6</span> dir<sub>info</sub></h4>
<div class="outline-text-4" id="text-12-40-6">
<p>
文件夹 summary 信息。
</p>
<div class="org-src-container">
<pre class="src src-R">dir_info(getwd())
</pre>
</div>
</div>
</div>
<div id="org2e3dde4" class="outline-4">
<h4 id="org2e3dde4"><span class="section-number-4">12.40.7</span> dir<sub>map</sub></h4>
<div class="outline-text-4" id="text-12-40-7">
<div class="org-src-container">
<pre class="src src-R">dir_map(getwd(), identity)      
</pre>
</div>
</div>
</div>
</div>

<div id="org2d923dd" class="outline-3">
<h3 id="org2d923dd"><span class="section-number-3">12.41</span> Rcpp</h3>
<div class="outline-text-3" id="text-12-41">
</div>
<div id="org27d5d5a" class="outline-4">
<h4 id="org27d5d5a"><span class="section-number-4">12.41.1</span> wrap</h4>
<div class="outline-text-4" id="text-12-41-1">
<p>
在 R api 中用.call() 函数调用 C 程序库函数时，R 对象的数据类型一般是 SEXP. Rcpp
提供了模板化的 wrap() 函数把 C++ 的函数返回值转换成 R 的 SEXP 数据类型。
</p>

<p>
R 与 C++的类型转换。
</p>

<p>
template &lt;typename T&gt; SEXP wrap(const T&amp; object);
</p>

<p>
wrap()能转换的类型包括：
</p>

<p>
把 int, double, bool 等基本类型转换为 R 的原子向量类型 （所有元素数据类型相同的向量）;
</p>

<p>
把 std::string 转换为 R 的字符型向量;
</p>

<p>
把 STL 容器如 std::vector&lt;T&gt;或 std::map&lt;T&gt; 转换成基本类型为 T 的向量，条件是 T 能够转换；
</p>

<p>
把 STL 的映射 std::map&lt;std::string, T&gt; 转换为基本类型为 T 的有名向量，条件是 T 能够转换；
</p>

<p>
可以转换定义了 operator SEXP()的 C++类的对象；
</p>

<p>
可以转换专门化过 wrap 模板的 C++对象。
</p>

<p>
是否可用 wrap()转换是在编译时确定的。
</p>
</div>
</div>

<div id="orgacc9f8e" class="outline-4">
<h4 id="orgacc9f8e"><span class="section-number-4">12.41.2</span> as()</h4>
<div class="outline-text-4" id="text-12-41-2">
<p>
可以用 as() 函数把 R 变量转换为 C++ 类型。
</p>

<p>
Rcpp 提供了模板化的 as() 用来把 SEXP 类型转换成适当的 C++ 类型。
</p>

<p>
template &lt;typename T&gt; T as(SEXP x);
</p>

<p>
as()可以把 R 对象转换为基础的类型如 int, double, bool, std::string 等，可以转换到元素为基础类型的 STL 向量如 std::vector 等。 
</p>

<p>
如果 C++类定义了以 SEXP 为输入的构造函数也可以利用 as()来转换。 as()可以针对用户自定义类作专门化。
</p>

<p>
as()和 wrap()的隐含调用
</p>

<p>
当 C++中赋值运算的右侧表达式是一个 R 对象或 R 对象的部分内容时， 可以隐含地调用 as()将其转换成左侧的 C++类型。
</p>

<p>
当 C++中赋值运算的左侧表达式是一个 R 对象或其部分内容时， 可以隐含地调用 wrap()将右侧的 C++类型转换成 R 类型。
</p>

<p>
在用 Rcpp 属性(Rcpp 属性见下一节)声明的 C++函数中， 可以直接以 IntegerVector, NumericVector, CharacterVector, Function 等作为自变量类型或返回值， 可以与 R 中相应的类型直接对应。
</p>

<p>
能自动转换到 R 中的缺省值类型还包括：
</p>

<p>
用双撇号界定的字符串常量；
</p>

<p>
十进数值如 10, 4.5;
</p>

<p>
预定义的常数如 true, false, R<sub>NilValue</sub>, NA<sub>STRING</sub>, NA<sub>INTEGER</sub>, NA<sub>REAL</sub>, NA<sub>LOGICAL</sub>；
</p>

<p>
Rcpp 属性的主要组成部分如下：
</p>

<ul class="org-ul">
<li>在 c++ 中，提供 Rcpp::export 标注要输出到 R 中的 C++函数。</li>

<li>在 R 中，提供 sourceCpp(), 用来自动编译链接保存在文件或 R 字符串中的 C++代码，并自动生成界面程序把 C++ 函数转换为 R 函数。</li>

<li>在 R 中，提供 cppFunction()函数， 用来把保存在 R 字符串中的 C++函数自动编译连接并转换成 R 函数。 提供 evalCpp()函数， 用来把保存在 R 字符串中的 C++代码片段自动编译连接并执行。</li>

<li>在 C++中，提供 Rcpp::depends 标注，说明编译连接时需要的外部头文件和库的位置。</li>

<li>在构建 R 扩展包时，提供 compileAttributes() R 函数， 自动给 C++函数生成相应的 extern C 声明和.Call 接口代码。</li>
</ul>
</div>
</div>

<div id="org3b4c33f" class="outline-4">
<h4 id="org3b4c33f"><span class="section-number-4">12.41.3</span> RObject 类</h4>
<div class="outline-text-4" id="text-12-41-3">
<p>
RObject 有如下导出类:
</p>

<p>
IntegerVector: 整数向量；
</p>

<p>
NumercicVector: 数值向量；
</p>

<p>
LogicalVector: 逻辑向量；
</p>

<p>
CharacterVector: 字符型向量；
</p>

<p>
GenericVector: 列表；
</p>

<p>
ExpressionVector: 表达式向量；
</p>

<p>
RawVector: 元素为 raw 类型的向量。
</p>

<p>
IntergerMatrix, NumericMatrix: 整数值或数值矩阵。
</p>
</div>
</div>

<div id="orge06d69f" class="outline-4">
<h4 id="orge06d69f"><span class="section-number-4">12.41.4</span> IntegerVector 类</h4>
<div class="outline-text-4" id="text-12-41-4">
<p>
在 R 中通常不严格区分整数与浮点实数， 但是在与 C++交互时，C++对整数与实数严格区分，所以 RCpp 中整数向量与数值向量是区分的。
</p>

<div class="org-src-container">
<pre class="src src-c">  <span style="color: #0000ff;">sourceCpp</span>(code = <span style="color: #ff0000; font-weight: bold;">'</span>
<span style="color: #483d8b;">#include</span> <span style="color: #8b2252;">&lt;Rcpp.h&gt;</span>
using namespace Rcpp;

<span style="color: #b22222;">//</span><span style="color: #b22222;">[[Rcpp::export]]</span>
<span style="color: #228b22;">IntegerVector</span> <span style="color: #0000ff;">wholeNumberA</span>(){
  <span style="color: #228b22;">IntegerVector</span> <span style="color: #0000ff;">epn</span>(<span style="color: #008b8b;">4</span>);
  epn[<span style="color: #008b8b;">0</span>] = <span style="color: #008b8b;">6</span>; epn[<span style="color: #008b8b;">1</span>] = <span style="color: #008b8b;">28</span>;
  epn[<span style="color: #008b8b;">2</span>] = <span style="color: #008b8b;">496</span>; epn[<span style="color: #008b8b;">3</span>] = <span style="color: #008b8b;">1123</span>;
  <span style="color: #a020f0;">return</span> epn;
}
          <span style="color: #ff0000; font-weight: bold;">'</span>)

  <span style="color: #0000ff;">print</span>(<span style="color: #228b22;">wholeNumberA</span>())
</pre>
</div>

<p>
对 IntegerVector 类型的 x,访问单个下标 i 格式为 x[i],下标从 0 开始计算，与 R 向量下标从 1 开始的规则不同。
</p>

<p>
可以在 C++中建立一个 IntegerVector,需要指定大小，逐个填入数值，直接返回
IntegerVector 到 R 即可，不需要 wrap() 显式地转换，函数返回值的声明可以用
IntegerVector 声明.
</p>

<div class="org-src-container">
<pre class="src src-c"><span style="color: #483d8b;">  #include</span> <span style="color: #8b2252;">&lt;Rcpp.h&gt;</span>
using <span style="color: #228b22;">namespace</span> <span style="color: #a0522d;">Rcpp</span>;

<span style="color: #b22222;">// </span><span style="color: #b22222;">This is a simple example of exporting a C++ function to R. You can</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">source this function into an R session using the Rcpp::sourceCpp </span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">function (or via the Source button on the editor toolbar). Learn</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">more about Rcpp at:</span>
<span style="color: #b22222;">//</span>
<span style="color: #b22222;">//   </span><span style="color: #b22222;">http://www.rcpp.org/</span>
<span style="color: #b22222;">//   </span><span style="color: #b22222;">http://adv-r.had.co.nz/Rcpp.html</span>
<span style="color: #b22222;">//   </span><span style="color: #b22222;">http://gallery.rcpp.org/</span>

<span style="color: #b22222;">//</span><span style="color: #b22222;">[[Rcpp::export]]</span>
<span style="color: #228b22;">IntegerVector</span> <span style="color: #0000ff;">prod1</span>(<span style="color: #228b22;">IntegerVector</span> <span style="color: #a0522d;">x</span>){
  <span style="color: #228b22;">int</span> <span style="color: #a0522d;">prod</span> = <span style="color: #008b8b;">1</span>;
  <span style="color: #a020f0;">for</span>(<span style="color: #228b22;">int</span> <span style="color: #a0522d;">i</span>=<span style="color: #008b8b;">0</span>; i &lt; x.size();i++){
    prod *= x[i];
  }
  <span style="color: #a020f0;">return</span> wrap(prod);
}
<span style="color: #b22222;">/***</span><span style="color: #b22222;">R</span>
<span style="color: #b22222;">prod1(1:5)</span>
<span style="color: #b22222;">  </span><span style="color: #b22222;">*/</span>
</pre>
</div>

<p>
std::accumlate() 可以对指定范围进行遍历累计运算。前两个参数是一个范围，用迭代器（iterators） 表示开始和结束，第三个参数是初值，第四个参数是对每个元素累计的计算。
</p>

<div class="org-src-container">
<pre class="src src-c"><span style="color: #483d8b;">  #include</span> <span style="color: #8b2252;">&lt;Rcpp.h&gt;</span>
using <span style="color: #228b22;">namespace</span> <span style="color: #a0522d;">Rcpp</span>;

<span style="color: #b22222;">// </span><span style="color: #b22222;">This is a simple example of exporting a C++ function to R. You can</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">source this function into an R session using the Rcpp::sourceCpp </span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">function (or via the Source button on the editor toolbar). Learn</span>
<span style="color: #b22222;">// </span><span style="color: #b22222;">more about Rcpp at:</span>
<span style="color: #b22222;">//</span>
<span style="color: #b22222;">//   </span><span style="color: #b22222;">http://www.rcpp.org/</span>
<span style="color: #b22222;">//   </span><span style="color: #b22222;">http://adv-r.had.co.nz/Rcpp.html</span>
<span style="color: #b22222;">//   </span><span style="color: #b22222;">http://gallery.rcpp.org/</span>

<span style="color: #b22222;">//</span><span style="color: #b22222;">[[Rcpp::export]]</span>
<span style="color: #228b22;">int</span> <span style="color: #0000ff;">prod3</span>(<span style="color: #228b22;">IntegerVector</span> <span style="color: #a0522d;">x</span>){
  <span style="color: #228b22;">int</span> <span style="color: #a0522d;">prod</span> = std::accumulate(
   x.begin(),x.end(),<span style="color: #008b8b;">1</span>,std::multiplies&lt;<span style="color: #228b22;">int</span>&gt;()); 
  <span style="color: #a020f0;">return</span> prod;
}
<span style="color: #b22222;">/***</span><span style="color: #b22222;">R</span>
<span style="color: #b22222;">prod3(1:5)</span>
<span style="color: #b22222;">  </span><span style="color: #b22222;">*/</span>  
</pre>
</div>
</div>
</div>

<div id="org0f4a647" class="outline-4">
<h4 id="org0f4a647"><span class="section-number-4">12.41.5</span> NumericVector 类</h4>
<div class="outline-text-4" id="text-12-41-5">
<p>
NumericVector 类在 C++中保存双精度型一维数组，可以与 R 的实数型向量（class 为
numeric）相互转换。这是用 C++程序与 R 交互时最常用到的数据类型。
x.size() 返回元素个数。
</p>
<div class="org-src-container">
<pre class="src src-python">  //[[Rcpp::export]]
  double ssp(NumericVector vec,double p){
      double <span style="color: #483d8b;">sum</span> = <span style="color: #008b8b;">0</span>.<span style="color: #008b8b;">0</span>;
  <span style="color: #a020f0;">for</span>(<span style="color: #483d8b;">int</span> i=<span style="color: #008b8b;">0</span>;i &lt; vec.size();i++){
          <span style="color: #483d8b;">sum</span> += <span style="color: #483d8b;">pow</span>(vec[i],p);
  }
  <span style="color: #a020f0;">return</span> <span style="color: #483d8b;">sum</span>;
  }
  /***R
  ssp(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">4</span>,<span style="color: #008b8b;">2</span>)
  */

<span style="color: #483d8b;">int</span> prod3(IntegerVector x){
    <span style="color: #483d8b;">int</span> prod = std::accumulate(
        x.begin(),x.end(),<span style="color: #008b8b;">1</span>,std::multiplies&lt;<span style="color: #483d8b;">int</span>&gt;()); 
    <span style="color: #a020f0;">return</span> prod;
}
/***R
prod3(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">5</span>)
  */  
</pre>
</div>

<p>
在自定义 R 函数时，输入的自变量的值不会被改变，相当于自变量都是局部变量。
</p>
<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">100</span>
<span style="color: #0000ff;">f</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>(x){
    print(x); x <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">99</span>; print(x)
}
c(f(x), x)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] 100</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] 99</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] 99 100  </span>
</pre>
</div>

<p>
但是，在用 Rcpp 编写 R 函数时， 因为 RObject 传递的是指针， 并不自动复制自变量值， 所以修改自变量值会真的修改原始的自变量变量值。 如：
</p>

<div class="org-src-container">
<pre class="src src-c">  <span style="color: #0000ff;">sourceCpp</span>(code=<span style="color: #ff0000; font-weight: bold;">'</span>
<span style="color: #483d8b;">#include</span> <span style="color: #8b2252;">&lt;Rcpp.h&gt;</span>
using namespace Rcpp;

<span style="color: #b22222;">//</span><span style="color: #b22222;">[[Rcpp::export]]</span>
<span style="color: #228b22;">NumericVector</span> <span style="color: #0000ff;">f2</span>(<span style="color: #228b22;">NumericVector</span> <span style="color: #a0522d;">x</span>){
  x[<span style="color: #008b8b;">0</span>] = <span style="color: #008b8b;">99.0</span>;
  <span style="color: #a020f0;">return</span>(x);
}
<span style="color: #ff0000; font-weight: bold;">'</span>)
x &lt;- <span style="color: #008b8b;">100</span>
c(f2(x), x)
<span style="color: #b22222;">/*</span><span style="color: #b22222;">[1] 99 99</span><span style="color: #b22222;">*/</span>
</pre>
</div>

<p>
可见自变量的值被修改了。 当然，对这个问题而言， 因为输入的是一个标量， 只要函数自变量不是 NumericVector 类型而是用 double 类型， 则自变量值会被复制，达到值传递的效果， 自变量值也就不会被真的修改。
</p>

<div class="org-src-container">
<pre class="src src-R"> sourceCpp(code=<span style="color: #8b2252;">'</span>
<span style="color: #8b2252;"> #include &lt;Rcpp.h&gt;</span>
<span style="color: #8b2252;"> using namespace Rcpp;</span>

<span style="color: #8b2252;"> //[[Rcpp::export]]</span>
<span style="color: #8b2252;"> NumericVector f3(double x){</span>
<span style="color: #8b2252;"> x = 99.0;</span>
<span style="color: #8b2252;"> return(wrap(x));</span>
<span style="color: #8b2252;"> }</span>
<span style="color: #8b2252;"> '</span>)
 x <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">100</span>
 c(f3(x), x)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] 99 100 </span>
</pre>
</div>

<p>
下面的程序把输入向量每个元素平方后返回， 为了不修改输入自变量的值而是返回一个修改后的副本， 使用了 Rcpp 的 clone 函数：
</p>

<div class="org-src-container">
<pre class="src src-R">sourceCpp(code=<span style="color: #8b2252;">'</span>
<span style="color: #8b2252;">#include &lt;Rcpp.h&gt;</span>
<span style="color: #8b2252;">using namespace Rcpp;</span>

<span style="color: #8b2252;">//[[Rcpp::export]]</span>
<span style="color: #8b2252;">NumericVector square(NumericVector x){</span>
<span style="color: #8b2252;">NumericVector y = clone(x);</span>
<span style="color: #8b2252;">for(int i=0; i &lt; x.size(); i++){</span>
<span style="color: #8b2252;">  y[i] = x[i]*x[i];</span>
<span style="color: #8b2252;">}</span>
<span style="color: #8b2252;">return(y);</span>
<span style="color: #8b2252;">}</span>
<span style="color: #8b2252;">'</span>)
x <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">7</span>)
cbind(square(x), x)
<span style="color: #b22222;">##         </span><span style="color: #b22222;">x</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1,]  4 2  </span>
</pre>
</div>
</div>
</div>

<div id="orga69703c" class="outline-4">
<h4 id="orga69703c"><span class="section-number-4">12.41.6</span> 排序</h4>
<div class="outline-text-4" id="text-12-41-6">
<p>
x.sort() 会对 x 从小到大的排序，同时返回排序结果，x 被修改了。
</p>
<div class="org-src-container">
<pre class="src src-c">  <span style="color: #228b22;">NumericVector</span> <span style="color: #0000ff;">test_sort</span>(<span style="color: #228b22;">NumericVector</span> <span style="color: #a0522d;">x</span>){
  <span style="color: #a020f0;">return</span> x.sort();
}

<span style="color: #b22222;">/***</span><span style="color: #b22222;">R</span>
<span style="color: #b22222;">x &lt;- c(3,5,1)</span>
<span style="color: #b22222;">test_sort(x)</span>
<span style="color: #b22222;">*/</span>
</pre>
</div>

<p>
上述代码的缺点就是 x 的值会被修改，可以用 clone 制作副本，避免修改 x。 
</p>
<div class="org-src-container">
<pre class="src src-C"><span style="color: #228b22;">NumericVector</span> <span style="color: #0000ff;">test_sort</span>(<span style="color: #228b22;">NumericVector</span> <span style="color: #a0522d;">x</span>){
    <span style="color: #228b22;">NumericVector</span> <span style="color: #a0522d;">y</span> = clone(x);
    <span style="color: #a020f0;">return</span> y.sort();
}

<span style="color: #b22222;">/***</span><span style="color: #b22222;">R</span>
<span style="color: #b22222;">x &lt;- c(3,5,1)</span>
<span style="color: #b22222;">test_sort(x)</span>
<span style="color: #b22222;">x</span>
<span style="color: #b22222;">*/</span>  
</pre>
</div>
</div>
</div>

<div id="orgeb160b6" class="outline-4">
<h4 id="orgeb160b6"><span class="section-number-4">12.41.7</span> 向量子集</h4>
<div class="outline-text-4" id="text-12-41-7">
<p>
 C++ 中 Rcpp 支持的向量和列表，仍可以用正整数向量作为下标。例如， 下面的 C++函数求指定的元素子集的和： 
</p>

<div class="org-src-container">
<pre class="src src-c">   <span style="color: #228b22;">double</span> <span style="color: #0000ff;">sumsub</span>(<span style="color: #228b22;">NumericVector</span> <span style="color: #a0522d;">x</span>, <span style="color: #228b22;">IntegerVector</span> <span style="color: #a0522d;">i</span>){
  <span style="color: #228b22;">NumericVector</span> <span style="color: #a0522d;">y</span> = x[i-<span style="color: #008b8b;">1</span>];
  <span style="color: #228b22;">double</span> <span style="color: #a0522d;">s</span> = <span style="color: #008b8b;">0.0</span>;
  <span style="color: #228b22;">int</span> <span style="color: #a0522d;">n</span> = y.size();
  <span style="color: #a020f0;">for</span>(<span style="color: #228b22;">int</span> <span style="color: #a0522d;">j</span> = <span style="color: #008b8b;">0</span>; j &lt;n; j++)
    s += y[j];
  <span style="color: #a020f0;">return</span> s;
}

<span style="color: #b22222;">/***</span><span style="color: #b22222;">R</span>
<span style="color: #b22222;">#x &lt;- c(3,5,1)</span>
<span style="color: #b22222;">#test_sort(x)</span>
<span style="color: #b22222;">#x</span>
<span style="color: #b22222;">x &lt;- 1:10</span>
<span style="color: #b22222;">sumsub(x, c(1,3,5))</span>
<span style="color: #b22222;">*/</span>   
</pre>
</div>

<p>
注意在程序中将输入的下标向量减了 1,以适应从 R 规则到 C++ 规则的变化。
</p>

<p>
Rcpp 也支持逻辑下标，比如，下面在 C++定义的函数可以取出向量的正值的子集。
</p>

<div class="org-src-container">
<pre class="src src-c">  <span style="color: #b22222;">//</span><span style="color: #b22222;">[[Rcpp::export]]</span>
<span style="color: #228b22;">NumericVector</span> <span style="color: #0000ff;">get_positive</span>(<span style="color: #228b22;">NumericVector</span> <span style="color: #a0522d;">x</span>){
  <span style="color: #228b22;">NumericVector</span> <span style="color: #a0522d;">y</span> = x[x &gt; <span style="color: #008b8b;">0</span>];
  <span style="color: #a020f0;">return</span> y;
}

<span style="color: #b22222;">/***</span><span style="color: #b22222;">R</span>
<span style="color: #b22222;">#x &lt;- c(3,5,1)</span>
<span style="color: #b22222;">#test_sort(x)</span>
<span style="color: #b22222;">#x</span>
<span style="color: #b22222;">x &lt;- c(1,-1,2,-2)</span>
<span style="color: #b22222;">get_positive(x)</span>

<span style="color: #b22222;">##[1] 1 2</span>
<span style="color: #b22222;">*/</span>  
</pre>
</div>
</div>
</div>

<div id="org6da646c" class="outline-4">
<h4 id="org6da646c"><span class="section-number-4">12.41.8</span> NumericMatrix 类</h4>
</div>
</div>

<div id="orgca0e9c4" class="outline-3">
<h3 id="orgca0e9c4"><span class="section-number-3">12.42</span> pillar</h3>
<div class="outline-text-3" id="text-12-42">
<p>
这个包可以对 vector 进行 format 展示。
</p>
<div class="org-src-container">
<pre class="src src-R">pillar(c(<span style="color: #008b8b;">1e10</span>, <span style="color: #008b8b;">1e</span>-<span style="color: #008b8b;">10</span>), width = <span style="color: #008b8b;">20</span>)
             <span style="color: #b22222;">## </span><span style="color: #b22222;">&lt;dbl&gt;</span>
          <span style="color: #b22222;">## </span><span style="color: #b22222;">1.00e+10</span>
          <span style="color: #b22222;">## </span><span style="color: #b22222;">1.00e-10</span>
</pre>
</div>
</div>
</div>

<div id="org3a73832" class="outline-3">
<h3 id="org3a73832"><span class="section-number-3">12.43</span> intrval</h3>
<div class="outline-text-3" id="text-12-43">
</div>
<div id="org1f3850f" class="outline-4">
<h4 id="org1f3850f"><span class="section-number-4">12.43.1</span> %[]%</h4>
<div class="outline-text-4" id="text-12-43-1">
<p>
Relational Operators Comparing Values to Intervals.
</p>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #008b8b;">library</span>(intrval)
ctl <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #008b8b;">4.17</span>,<span style="color: #008b8b;">5.58</span>,<span style="color: #008b8b;">5.18</span>,<span style="color: #008b8b;">6.11</span>,<span style="color: #008b8b;">4.50</span>,<span style="color: #008b8b;">4.61</span>,<span style="color: #008b8b;">5.17</span>,<span style="color: #008b8b;">4.53</span>,<span style="color: #008b8b;">5.33</span>,<span style="color: #008b8b;">5.14</span>)
trt <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #008b8b;">4.81</span>,<span style="color: #008b8b;">4.17</span>,<span style="color: #008b8b;">4.41</span>,<span style="color: #008b8b;">3.59</span>,<span style="color: #008b8b;">5.87</span>,<span style="color: #008b8b;">3.83</span>,<span style="color: #008b8b;">6.03</span>,<span style="color: #008b8b;">4.89</span>,<span style="color: #008b8b;">4.32</span>,<span style="color: #008b8b;">4.69</span>)
group <span style="color: #008b8b;">&lt;-</span> gl(<span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">10</span>, <span style="color: #008b8b;">20</span>, labels = c(<span style="color: #8b2252;">"Ctl"</span>,<span style="color: #8b2252;">"Trt"</span>))
weight <span style="color: #008b8b;">&lt;-</span> c(ctl, trt)
lm.D9 <span style="color: #008b8b;">&lt;-</span> lm(weight ~ group)
<span style="color: #b22222;">## </span><span style="color: #b22222;">compare 95% confidence intervals with 0</span>
(CI.D9 <span style="color: #008b8b;">&lt;-</span> confint(lm.D9))
<span style="color: #008b8b;">0</span> <span style="color: #008b8b;">%()%</span> CI.D9
<span style="color: #b22222;">## </span><span style="color: #b22222;">(Intercept)    groupTrt </span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">FALSE        TRUE </span>
</pre>
</div>
</div>
</div>
<div id="org913b506" class="outline-4">
<h4 id="org913b506"><span class="section-number-4">12.43.2</span> %()%</h4>
</div>
<div id="org5a2f9bc" class="outline-4">
<h4 id="org5a2f9bc"><span class="section-number-4">12.43.3</span> %[o]%</h4>
<div class="outline-text-4" id="text-12-43-3">
<p>
Functions for evaluating if two intervals overlap or not.
可以方便地评估两个区间是否存在覆盖。
</p>
<div class="org-src-container">
<pre class="src src-R">ctl <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #008b8b;">4.17</span>,<span style="color: #008b8b;">5.58</span>,<span style="color: #008b8b;">5.18</span>,<span style="color: #008b8b;">6.11</span>,<span style="color: #008b8b;">4.50</span>,<span style="color: #008b8b;">4.61</span>,<span style="color: #008b8b;">5.17</span>,<span style="color: #008b8b;">4.53</span>,<span style="color: #008b8b;">5.33</span>,<span style="color: #008b8b;">5.14</span>)
trt <span style="color: #008b8b;">&lt;-</span> c(<span style="color: #008b8b;">4.81</span>,<span style="color: #008b8b;">4.17</span>,<span style="color: #008b8b;">4.41</span>,<span style="color: #008b8b;">3.59</span>,<span style="color: #008b8b;">5.87</span>,<span style="color: #008b8b;">3.83</span>,<span style="color: #008b8b;">6.03</span>,<span style="color: #008b8b;">4.89</span>,<span style="color: #008b8b;">4.32</span>,<span style="color: #008b8b;">4.69</span>)
group <span style="color: #008b8b;">&lt;-</span> gl(<span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">10</span>, <span style="color: #008b8b;">20</span>, labels = c(<span style="color: #8b2252;">"Ctl"</span>,<span style="color: #8b2252;">"Trt"</span>))
weight <span style="color: #008b8b;">&lt;-</span> c(ctl, trt)
lm.D9 <span style="color: #008b8b;">&lt;-</span> lm(weight ~ group)
lm.D90 <span style="color: #008b8b;">&lt;-</span> lm(weight ~ group - <span style="color: #008b8b;">1</span>) <span style="color: #b22222;"># </span><span style="color: #b22222;">omitting intercept</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">compare 95% confidence intervals with 0</span>
(CI.D9 <span style="color: #008b8b;">&lt;-</span> confint(lm.D9))
<span style="color: #008b8b;">0</span> <span style="color: #008b8b;">%()%</span> CI.D9
(CI.D90 <span style="color: #008b8b;">&lt;-</span> confint(lm.D90))
CI.D90[<span style="color: #008b8b;">1</span>,] <span style="color: #008b8b;">%[o]%</span> CI.D90[<span style="color: #008b8b;">2</span>,]
</pre>
</div>
</div>
</div>
<div id="org943dcb0" class="outline-4">
<h4 id="org943dcb0"><span class="section-number-4">12.43.4</span> %(o)%</h4>
<div class="outline-text-4" id="text-12-43-4">
<div class="org-src-container">
<pre class="src src-R"> cbind(rep(<span style="color: #008b8b;">3</span>,<span style="color: #008b8b;">5</span>),rep(<span style="color: #008b8b;">4</span>,<span style="color: #008b8b;">5</span>)) <span style="color: #008b8b;">%(o)%</span> cbind(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">5</span>, <span style="color: #008b8b;">2</span>:<span style="color: #008b8b;">6</span>)
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] FALSE FALSE  TRUE FALSE FALSE   </span>
</pre>
</div>
</div>
</div>
<div id="org4518ced" class="outline-4">
<h4 id="org4518ced"><span class="section-number-4">12.43.5</span> %[]o[]%</h4>
<div class="outline-text-4" id="text-12-43-5">
<div class="org-src-container">
<pre class="src src-R">dt1 <span style="color: #008b8b;">&lt;-</span> as.Date(c(<span style="color: #8b2252;">"2000-01-01"</span>, <span style="color: #8b2252;">"2000-03-15"</span>))
dt2 <span style="color: #008b8b;">&lt;-</span> as.Date(c(<span style="color: #8b2252;">"2000-03-15"</span>, <span style="color: #8b2252;">"2000-06-07"</span>))
dt1 <span style="color: #008b8b;">%[]o[]%</span> dt2
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1] TRUE    </span>
</pre>
</div>
</div>
</div>
</div>

<div id="org005c309" class="outline-3">
<h3 id="org005c309"><span class="section-number-3">12.44</span> reprex</h3>
<div class="outline-text-3" id="text-12-44">
<p>
该包的主要目的用于报告的生成。
</p>
</div>
</div>
<div id="org2e0279d" class="outline-3">
<h3 id="org2e0279d"><span class="section-number-3">12.45</span> h2o</h3>
<div class="outline-text-3" id="text-12-45">
</div>
<div id="orgfb1a722" class="outline-4">
<h4 id="orgfb1a722"><span class="section-number-4">12.45.1</span> h2o.performance</h4>
<div class="outline-text-4" id="text-12-45-1">
<p>
该函数可以输出有关混淆矩阵的若干统计量。
</p>
<div class="org-src-container">
<pre class="src src-R">h2o.performance(model_object)  
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="org8fc6d22" class="outline-2">
<h2 id="org8fc6d22"><span class="section-number-2">13</span> 专题</h2>
<div class="outline-text-2" id="text-13">
</div>
<div id="org705e3ad" class="outline-3">
<h3 id="org705e3ad"><span class="section-number-3">13.1</span> 缺失值处理</h3>
<div class="outline-text-3" id="text-13-1">
</div>
<div id="org79c6369" class="outline-5">
<h5 id="org79c6369"><span class="section-number-5">13.1.0.1</span> 如何删掉缺失值？</h5>
<div class="outline-text-5" id="text-13-1-0-1">
<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> <span style="color: #228b22;">NA</span>
x &gt; <span style="color: #008b8b;">3</span>
class(x)
is.na(x)
x[!is.na(x)]
<span style="color: #b22222;">## </span><span style="color: #b22222;">list</span>
x <span style="color: #008b8b;">&lt;-</span> list(a = <span style="color: #228b22;">NA</span>, b = <span style="color: #008b8b;">1</span>)
x[!is.na(x)]
<span style="color: #b22222;">## </span><span style="color: #b22222;">matrix</span>
x <span style="color: #008b8b;">&lt;-</span> matrix(c(<span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">3</span>, <span style="color: #228b22;">NA</span>), <span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">2</span>)
x[!is.na(x)]
<span style="color: #b22222;">## </span><span style="color: #b22222;">data.frame</span>
x <span style="color: #008b8b;">&lt;-</span> data.frame(a = c(<span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">3</span>, <span style="color: #228b22;">NA</span>), b = c(<span style="color: #228b22;">NA</span>, <span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">2</span>, <span style="color: #008b8b;">3</span>))
x[!is.na(x)] <span style="color: #b22222;"># </span><span style="color: #b22222;">&#36807;&#28388;&#25481; NA &#30340;&#21516;&#26102;&#20063;&#25226;&#25968;&#25454;&#31867;&#22411;&#36716;&#25442;&#20026; double</span>
typeof(x[!is.na(x)])
</pre>
</div>
</div>
</div>
</div>

<div id="orge4fda19" class="outline-3">
<h3 id="orge4fda19"><span class="section-number-3">13.2</span> 向量化计算</h3>
<div class="outline-text-3" id="text-13-2">
<p>
对应在 purrr 包中的 map，map<sub>*</sub>,map2 等函数。 
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">func</td>
<td class="org-left">descriptions</td>
</tr>

<tr>
<td class="org-left">apply</td>
<td class="org-left">分组计算</td>
</tr>

<tr>
<td class="org-left">sapply</td>
<td class="org-left">lapply 的简化版本</td>
</tr>

<tr>
<td class="org-left">tapply</td>
<td class="org-left">分组计算</td>
</tr>

<tr>
<td class="org-left">mapply</td>
<td class="org-left">多参数计算</td>
</tr>

<tr>
<td class="org-left">vapply</td>
<td class="org-left">sapply safty 版本，可以设置返回值</td>
</tr>

<tr>
<td class="org-left">lapply</td>
<td class="org-left">循环迭代</td>
</tr>

<tr>
<td class="org-left">rapply</td>
<td class="org-left">lapply 的递归版本</td>
</tr>

<tr>
<td class="org-left">eapply</td>
<td class="org-left">环境空间遍历</td>
</tr>
</tbody>
</table>
</div>
<div id="org6d0e67e" class="outline-4">
<h4 id="org6d0e67e"><span class="section-number-4">13.2.1</span> for 循环</h4>
<div class="outline-text-4" id="text-13-2-1">
<div class="org-src-container">
<pre class="src src-R">output <span style="color: #008b8b;">&lt;-</span> vector(<span style="color: #8b2252;">"double"</span>, ncol(df))  <span style="color: #b22222;"># </span><span style="color: #b22222;">1. output</span>
<span style="color: #a020f0;">for</span> (i <span style="color: #a020f0;">in</span> seq_along(df)) {            <span style="color: #b22222;"># </span><span style="color: #b22222;">2. sequence</span>
    output[[i]] <span style="color: #008b8b;">&lt;-</span> median(df[[i]])      <span style="color: #b22222;"># </span><span style="color: #b22222;">3. body</span>
}
output      
</pre>
</div>
</div>
</div>

<div id="org59c059d" class="outline-4">
<h4 id="org59c059d"><span class="section-number-4">13.2.2</span> apply</h4>
<div class="outline-text-4" id="text-13-2-2">
<p>
Returns a vector or array or list of values obtained by applying a function to
margins of an array or matrix.
</p>

<p>
apply(X, MARGIN, FUN, &#x2026;)
</p>

<p>
Arguments:
</p>

<p>
X:an array, including a matrix.
</p>

<p>
MARGIN:a vector giving the subscripts which the function will be applied over. E.g., for a matrix 1 indicates rows, 2 indicates columns, c(1, 2) indicates rows and columns. Where X has named dimnames, it can be a character vector selecting dimension names.
</p>

<p>
FUN:the function to be applied: see ‘Details’. 
apply 函数是一个把某一命令应用在目标矩阵的每一个元素上的集合运算命令.
</p>
<div class="org-src-container">
<pre class="src src-R">mydata <span style="color: #008b8b;">&lt;-</span> matrix(rnorm(<span style="color: #008b8b;">30</span>), nrow = <span style="color: #008b8b;">6</span>)
apply(mydata, <span style="color: #008b8b;">1</span>, mean) <span style="color: #b22222;"># </span><span style="color: #b22222;">&#23545;&#34892;&#27714;&#22343;&#20540;</span>
mydata <span style="color: #008b8b;">%&gt;%</span>
    lapply(.,is.character)
t <span style="color: #008b8b;">&lt;-</span> data <span style="color: #008b8b;">%$%</span>
    loanbal <span style="color: #008b8b;">%&gt;%</span> 
lapply(.,mifimodel::is_character) <span style="color: #008b8b;">%&gt;%</span> 
unlist()
ma <span style="color: #008b8b;">&lt;-</span> matrix(c(<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">4</span>, <span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">6</span>:<span style="color: #008b8b;">8</span>), nrow = <span style="color: #008b8b;">2</span>)
ma
apply(ma, <span style="color: #008b8b;">1</span>, table) 
</pre>
</div>
</div>
</div>
<div id="org75fbec8" class="outline-4">
<h4 id="org75fbec8"><span class="section-number-4">13.2.3</span> lapply</h4>
<div class="outline-text-4" id="text-13-2-3">
<p>
lapply 的特殊之处在于，它的输出形式为列表（list），并且每一个运算结果（数值）都是一个单独的列表。这就是说，如果运算结果有六个数值，lapply 就会输出六个列表，每一个列表里为一个数值。
lapply 函数和 apply 不同的是，lapply 针对每一个元素进行 function 操作。lapply 输出的是 list 元素。 
</p>

<p>
lapply(X, FUN, &#x2026;)
参数列表：
    X:list、data.frame 数据
    FUN: 自定义的调用函数…: 更多参数，可选
</p>

<div class="org-src-container">
<pre class="src src-R">matrix1 <span style="color: #008b8b;">&lt;-</span> matrix(c(<span style="color: #008b8b;">4</span>,<span style="color: #008b8b;">9</span>,<span style="color: #008b8b;">16</span>,<span style="color: #008b8b;">25</span>,<span style="color: #008b8b;">36</span>,<span style="color: #008b8b;">49</span>),nc = <span style="color: #008b8b;">2</span>)
apply(matrix1,<span style="color: #008b8b;">1</span>,sqrt)
lapply(matrix1,sqrt)
</pre>
</div>

<p>
为啥 lapply 这么重要？因为我们在执行 lapply 的时候即可以预先对结果输出形式进行设计。比如说，合并列表做个矩阵啊（matrix）或者数据框（data frame）啊，想横着合就横着合，想竖着合就竖着合。
</p>

<p>
拿我们之前的 matrix1 举例，运行 lapply 的结果是得到了六个独立的列表，每个列表里含有一个元素。如果我们想把开平方根的结果设成矩阵，应该怎么做呢？
</p>

<p>
这就要应用到一个超神的命令 do.call()，翻译过来就是，呼唤神级运算命令。这个 do.call()命令要怎么用呢，简单说就是 do.call(结果要怎么处理，运算要怎么做)。我们可以在 R 中直观地看一下，如果我们要把运算结果按行排列（粘贴），最后得到一个大的矩阵，应该如何做：
</p>

<div class="org-src-container">
<pre class="src src-R">do.call(rbind,lapply(matrix1,sqrt))  
</pre>
</div>

<p>
如果我们想做一个数据框呢？
</p>

<p>
这时就不再需要 do.call 命令了，简单的 data.frame 就可以做到：
</p>

<div class="org-src-container">
<pre class="src src-R">data.frame(lapply(matrix1,sqrt))
</pre>
</div>
</div>
</div>

<div id="org271f9eb" class="outline-4">
<h4 id="org271f9eb"><span class="section-number-4">13.2.4</span> sapply</h4>
<div class="outline-text-4" id="text-13-2-4">
<p>
sapply 
函数是一个迭代器，它遍历一个向量中所有的元素，调用另外一个函数对向量中的每个元素进行处理，然后返回计算结果。可以看出 sapply 输出的是 vector 类型数据。
</p>

<p>
函数定义：
</p>

<p>
sapply(X, FUN, &#x2026;, simplify=TRUE, USE.NAMES = TRUE)
</p>

<p>
参数列表：
</p>

<p>
X:数组、矩阵、数据框
FUN: 自定义的调用函数…: 更多参数，可选
simplify: 是否数组化，当值 array 时，输出结果按数组进行分组
USE.NAMES: 如果 X 为字符串，TRUE 设置字符串为数据名，FALSE 不设置
</p>

<div class="org-src-container">
<pre class="src src-R">a <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">7</span>
sapply(a,sqrt)
matrix1 <span style="color: #008b8b;">&lt;-</span> matrix(c(<span style="color: #008b8b;">4</span>,<span style="color: #008b8b;">9</span>,<span style="color: #008b8b;">16</span>,<span style="color: #008b8b;">25</span>,<span style="color: #008b8b;">36</span>,<span style="color: #008b8b;">49</span>),nc = <span style="color: #008b8b;">2</span>)
apply(matrix1,<span style="color: #008b8b;">1</span>,sqrt)
sapply(matrix1,sqrt)
sapply(matrix1,sqrt) <span style="color: #008b8b;">%&gt;%</span>
    str
a<span style="color: #008b8b;">&lt;-</span><span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">2</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">&#25353;&#25968;&#32452;&#20998;&#32452;</span>
sapply(a,<span style="color: #a020f0;">function</span>(x) matrix(x,<span style="color: #008b8b;">2</span>,<span style="color: #008b8b;">2</span>), simplify=<span style="color: #8b2252;">'array'</span>)
<span style="color: #b22222;">## </span><span style="color: #b22222;">, , 1</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">[,1] [,2]</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1,]    1    1</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">[2,]    1    1</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">, , 2</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">[,1] [,2]</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1,]    2    2</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">[2,]    2    2</span>

                                      <span style="color: #b22222;"># </span><span style="color: #b22222;">&#40664;&#35748;&#24773;&#20917;&#65292;&#21017;&#33258;&#21160;&#21512;&#24182;&#20998;&#32452;</span>
sapply(a,<span style="color: #a020f0;">function</span>(x) matrix(x,<span style="color: #008b8b;">2</span>,<span style="color: #008b8b;">2</span>))
<span style="color: #b22222;">## </span><span style="color: #b22222;">[,1] [,2]</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">[1,]    1    2</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">[2,]    1    2</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">[3,]    1    2</span>
<span style="color: #b22222;">## </span><span style="color: #b22222;">[4,]    1    2</span>
</pre>
</div>

<p>
对于字符串的向量，还可以自动生成数据名。
</p>
<div class="org-src-container">
<pre class="src src-R">val<span style="color: #008b8b;">&lt;-</span>head(letters)
                                        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#40664;&#35748;&#35774;&#32622;&#25968;&#25454;&#21517;</span>
sapply(val,paste,USE.NAMES=<span style="color: #228b22;">TRUE</span>)
  <span style="color: #b22222;">## </span><span style="color: #b22222;">a   b   c   d   e   f </span>
  <span style="color: #b22222;">## </span><span style="color: #b22222;">"a" "b" "c" "d" "e" "f" </span>
                                        <span style="color: #b22222;"># </span><span style="color: #b22222;">USE.NAMES=FALSE&#65292;&#21017;&#19981;&#35774;&#32622;&#25968;&#25454;&#21517;</span>
sapply(val,paste,USE.NAMES=<span style="color: #228b22;">FALSE</span>)
  <span style="color: #b22222;">## </span><span style="color: #b22222;">[1] "a" "b" "c" "d" "e" "f"  </span>
</pre>
</div>
</div>
</div>

<div id="org5b1fed2" class="outline-4">
<h4 id="org5b1fed2"><span class="section-number-4">13.2.5</span> vapply</h4>
<div class="outline-text-4" id="text-13-2-5">
<p>
vapply(X, FUN, FUN.VALUE, &#x2026;, USE.NAMES = TRUE)
</p>

<p>
参数列表：
</p>

<p>
X:数组、矩阵、数据框
FUN: 自定义的调用函数
FUN.VALUE: 定义返回值的行名 row.names
…: 更多参数，可选
</p>

<p>
    USE.NAMES: 如果 X 为字符串，TRUE 设置字符串为数据名，FALSE 不设置通过使用 vapply 可以直接设置返回值的行名，这样子做其实可以节省一行的代码，让代码看起来更顺畅，当然如果不愿意多记一个函数，那么也可以直接忽略它，只用 sapply 就够了。
</p>
<div class="org-src-container">
<pre class="src src-R">      <span style="color: #b22222;"># </span><span style="color: #b22222;">&#29983;&#25104;&#25968;&#25454;&#38598;</span>
 x <span style="color: #008b8b;">&lt;-</span> data.frame(cbind(x1=<span style="color: #008b8b;">3</span>, x2=c(<span style="color: #008b8b;">2</span>:<span style="color: #008b8b;">1</span>,<span style="color: #008b8b;">4</span>:<span style="color: #008b8b;">5</span>)))
                                        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#35774;&#32622;&#34892;&#21517;&#65292;4&#34892;&#20998;&#21035;&#20026;a,b,c,d</span>
vapply(x,cumsum,FUN.VALUE=c(<span style="color: #8b2252;">'a'</span>=<span style="color: #008b8b;">0</span>,<span style="color: #8b2252;">'b'</span>=<span style="color: #008b8b;">0</span>,<span style="color: #8b2252;">'c'</span>=<span style="color: #008b8b;">0</span>,<span style="color: #8b2252;">'d'</span>=<span style="color: #008b8b;">0</span>))
      <span style="color: #b22222;">## </span><span style="color: #b22222;">x1 x2</span>
      <span style="color: #b22222;">## </span><span style="color: #b22222;">a  3  2</span>
      <span style="color: #b22222;">## </span><span style="color: #b22222;">b  6  3</span>
      <span style="color: #b22222;">## </span><span style="color: #b22222;">c  9  7</span>
      <span style="color: #b22222;">## </span><span style="color: #b22222;">d 12 12     </span>
                                        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#24403;&#19981;&#35774;&#32622;&#26102;&#65292;&#20026;&#40664;&#35748;&#30340;&#32034;&#24341;&#20540;</span>
a<span style="color: #008b8b;">&lt;-</span>sapply(x,cumsum);a
      <span style="color: #b22222;">## </span><span style="color: #b22222;">x1 x2</span>
      <span style="color: #b22222;">## </span><span style="color: #b22222;">[1,]  3  2</span>
      <span style="color: #b22222;">## </span><span style="color: #b22222;">[2,]  6  3</span>
      <span style="color: #b22222;">## </span><span style="color: #b22222;">[3,]  9  7</span>
      <span style="color: #b22222;">## </span><span style="color: #b22222;">[4,] 12 12</span>
                                        <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25163;&#21160;&#30340;&#26041;&#24335;&#35774;&#32622;&#34892;&#21517;</span>
row.names(a)<span style="color: #008b8b;">&lt;-</span>c(<span style="color: #8b2252;">'a'</span>,<span style="color: #8b2252;">'b'</span>,<span style="color: #8b2252;">'c'</span>,<span style="color: #8b2252;">'d'</span>)
</pre>
</div>
</div>
</div>
<div id="org417a10b" class="outline-4">
<h4 id="org417a10b"><span class="section-number-4">13.2.6</span> mapply</h4>
<div class="outline-text-4" id="text-13-2-6">
<p>
mapply 也是 sapply 的变形函数，类似多变量的 sapply，但是参数定义有些变化。第一参数为自定义的 FUN 函数，第二个参数’…’可以接收多个数据，作为 FUN 函数的参数调用。函数定义：
mapply(FUN, &#x2026;, MoreArgs = NULL, SIMPLIFY = TRUE,USE.NAMES = TRUE)
参数列表：
</p>

<p>
    FUN: 自定义的调用函数…: 接收多个数据
    MoreArgs: 参数列表
    SIMPLIFY: 是否数组化，当值 array 时，输出结果按数组进行分组
    USE.NAMES: 如果 X 为字符串，TRUE 设置字符串为数据名，FALSE 不设置比如，比较 3 个向量大小，按索引顺序取较大的值。
</p>
<div class="org-src-container">
<pre class="src src-R">set.seed(<span style="color: #008b8b;">1</span>)
                                  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#23450;&#20041;3&#20010;&#21521;&#37327;</span>
x<span style="color: #008b8b;">&lt;-</span><span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">10</span>
y<span style="color: #008b8b;">&lt;-</span><span style="color: #008b8b;">5</span>:-<span style="color: #008b8b;">4</span>
z<span style="color: #008b8b;">&lt;-</span>round(runif(<span style="color: #008b8b;">10</span>,-<span style="color: #008b8b;">5</span>,<span style="color: #008b8b;">5</span>))
                                  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#25353;&#32034;&#24341;&#39034;&#24207;&#21462;&#36739;&#22823;&#30340;&#20540;&#12290;</span>
mapply(max,x,y,z)      

n<span style="color: #008b8b;">&lt;-</span>rep(<span style="color: #008b8b;">4</span>,<span style="color: #008b8b;">4</span>)
m<span style="color: #008b8b;">&lt;-</span>v<span style="color: #008b8b;">&lt;-</span>c(<span style="color: #008b8b;">1</span>,<span style="color: #008b8b;">10</span>,<span style="color: #008b8b;">100</span>,<span style="color: #008b8b;">1000</span>)
                                  <span style="color: #b22222;"># </span><span style="color: #b22222;">&#29983;&#25104;4&#32452;&#25968;&#25454;&#65292;&#25353;&#21015;&#20998;&#32452;</span>
mapply(rnorm,n,m,v)
</pre>
</div>
</div>
</div>
<div id="org56fec34" class="outline-4">
<h4 id="org56fec34"><span class="section-number-4">13.2.7</span> tapply</h4>
<div class="outline-text-4" id="text-13-2-7">
<p>
tapply 用于分组的循环计算，通过 INDEX 参数可以把数据集 X 进行分组，相当于 group by 的操作。相当于 group<sub>map</sub>.
函数定义：
</p>

<p>
tapply(X, INDEX, FUN = NULL, &#x2026;, simplify = TRUE)
</p>

<p>
参数列表：
</p>

<p>
X: 向量
INDEX: 用于分组的索引
FUN: 自定义的调用函数…: 接收多个数据
simplify : 是否数组化，当值 array 时，输出结果按数组进行分组
</p>

<p>
比如，计算不同品种的鸢尾花的花瓣(iris)长度的均值。
</p>
<div class="org-src-container">
<pre class="src src-R">
</pre>
</div>
</div>
</div>
</div>
<div id="org7d11eae" class="outline-3">
<h3 id="org7d11eae"><span class="section-number-3">13.3</span> TODO:并行化运算</h3>
<div class="outline-text-3" id="text-13-3">
<div class="org-src-container">
<pre class="src src-R"> <span style="color: #008b8b;">library</span> (parallel)
<span style="color: #0000ff;">doit</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>(x)(x)^<span style="color: #008b8b;">2</span>+<span style="color: #008b8b;">2</span>*x
system.time(res <span style="color: #008b8b;">&lt;-</span> lapply (<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">5000000</span>, doit))
<span style="color: #008b8b;">rm</span>(res)
gc ()
cl <span style="color: #008b8b;">&lt;-</span> makeCluster(getOption(<span style="color: #8b2252;">"cl.cores"</span>,<span style="color: #008b8b;">3</span>))
system.time(res <span style="color: #008b8b;">&lt;-</span> parLapply (cl,<span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">5000000</span>,doit))
stopCluster(cl)
</pre>
</div>
</div>
<div id="org384f7b2" class="outline-5">
<h5 id="org384f7b2"><span class="section-number-5">13.3.0.1</span> future</h5>
</div>
<div id="orgd1fe72c" class="outline-4">
<h4 id="orgd1fe72c"><span class="section-number-4">13.3.1</span> foreach</h4>
<div class="outline-text-4" id="text-13-3-1">
<p>
foreach(&#x2026;, .combine, .init, .final=NULL, .inorder=TRUE,
       .multicombine=FALSE,
       .maxcombine=if (.multicombine) 100 else 2,
       .errorhandling=c('stop', 'remove', 'pass'),
       .packages=NULL, .export=NULL, .noexport=NULL,
       .verbose=FALSE)
when(cond)
e1 %:% e2
obj %do% ex
obj %dopar% ex
times(n)
</p>
</div>

<div id="orgb1783cd" class="outline-5">
<h5 id="orgb1783cd"><span class="section-number-5">13.3.1.1</span> %do%</h5>
<div class="outline-text-5" id="text-13-3-1-1">
<p>
%do% 运算符可以顺序执行表达式，而%dopar% 运算符可以用来并行执行表达式。来分析这个 foreach 包，它的逻辑其实更像是 lapply.
foreach(i = 1:5, .combine = "myfun") %do% rnorm(3) 
</p>

<p>
这个 i 其实不用管，i是迭代次数，.combine 是将数据连接的方式，后面 %do% 后面是真正需要迭代的函数。
</p>
<div class="org-src-container">
<pre class="src src-R">foreach(i = <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">5</span>) <span style="color: #008b8b;">%do%</span> sqrt(i)
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[1]]</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 1</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[2]]</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 1.414</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[3]]</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 1.732</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[4]]</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 2</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; </span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [[5]]</span>
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 2.236</span>
</pre>
</div>
<p>
这个函数很像是 lapply.
</p>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #000000; background-color: #ffffff;">``` r</span>
<span style="color: #000000; background-color: #ffffff;">library(foreach)</span>
<span style="color: #000000; background-color: #ffffff;">#&gt; </span>
<span style="color: #000000; background-color: #ffffff;">#&gt; Attaching package: 'foreach'</span>
<span style="color: #000000; background-color: #ffffff;">#&gt; The following objects are masked from 'package:purrr':</span>
<span style="color: #000000; background-color: #ffffff;">#&gt; </span>
<span style="color: #000000; background-color: #ffffff;">#&gt;     accumulate, when</span>
<span style="color: #000000; background-color: #ffffff;">foreach(i = 1:5, .combine = "cbind") %do% rnorm(3)</span>
<span style="color: #000000; background-color: #ffffff;">#&gt;      result.1 result.2 result.3 result.4 result.5</span>
<span style="color: #000000; background-color: #ffffff;">#&gt; [1,]  -0.8756  -2.0574   0.9808   1.3831   0.1927</span>
<span style="color: #000000; background-color: #ffffff;">#&gt; [2,]   1.0982  -1.3245   0.3525  -2.1013  -0.7644</span>
<span style="color: #000000; background-color: #ffffff;">#&gt; [3,]   1.1491  -0.1605   1.6125  -0.9601   0.4367</span>
<span style="color: #000000; background-color: #ffffff;">```</span>

&lt;sup&gt;Created on <span style="color: #008b8b;">2020</span>-<span style="color: #008b8b;">06</span>-<span style="color: #008b8b;">20</span> by the [reprex package](https://reprex.tidyverse.org) (v0.3.0)&lt;/sup&gt;  
</pre>
</div>
</div>
</div>

<div id="orgdcceb72" class="outline-5">
<h5 id="orgdcceb72"><span class="section-number-5">13.3.1.2</span> when</h5>
<div class="outline-text-5" id="text-13-3-1-2">
<p>
foreach 包可以支持条件执行。
</p>
<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> foreach(i = irnorm(<span style="color: #008b8b;">1</span>, count = <span style="color: #008b8b;">20</span>), .combine = <span style="color: #8b2252;">"c"</span>) <span style="color: #008b8b;">%:%</span> when(i &gt;= <span style="color: #008b8b;">0</span>) <span style="color: #008b8b;">%do%</span> 
    sqrt(i)
length(x)  
</pre>
</div>
</div>
</div>

<div id="org718a58e" class="outline-5">
<h5 id="org718a58e"><span class="section-number-5">13.3.1.3</span> %dopar%</h5>
<div class="outline-text-5" id="text-13-3-1-3">
<div class="org-src-container">
<pre class="src src-R">
<span style="color: #008b8b;">library</span>(doMC)
registerDoMC()
getDoParWorkers()
                                 <span style="color: #b22222;">#</span><span style="color: #b22222;">&#31995;&#32479;&#26102;&#38388;</span>
Sys.time()
system.time(x <span style="color: #008b8b;">&lt;-</span> foreach(i = irnorm(<span style="color: #008b8b;">1</span>, count = <span style="color: #008b8b;">1000</span>), .combine = <span style="color: #8b2252;">"c"</span>) <span style="color: #008b8b;">%:%</span> when(i &gt;= 
                                                                               <span style="color: #008b8b;">0</span>) <span style="color: #008b8b;">%do%</span> sqrt(i))
Sys.time()
system.time(x <span style="color: #008b8b;">&lt;-</span> foreach(i = irnorm(<span style="color: #008b8b;">1</span>, count = <span style="color: #008b8b;">1000</span>), .combine = <span style="color: #8b2252;">"c"</span>) <span style="color: #008b8b;">%:%</span> when(i &gt;= 
                                                                               <span style="color: #008b8b;">0</span>) <span style="color: #008b8b;">%dopar%</span> sqrt(i))


system.time(x <span style="color: #008b8b;">&lt;-</span> foreach(i = irnorm(<span style="color: #008b8b;">1</span>, count = <span style="color: #008b8b;">1000</span>), .combine = <span style="color: #8b2252;">"c"</span>) <span style="color: #008b8b;">%:%</span> when(i &gt;= 
                                                                               <span style="color: #008b8b;">0</span>) <span style="color: #008b8b;">%do%</span> {
                                                                                   Sys.sleep(<span style="color: #008b8b;">0.01</span>)
                                                                                   sqrt(i)
                                                                               })

system.time(x <span style="color: #008b8b;">&lt;-</span> foreach(i = irnorm(<span style="color: #008b8b;">1</span>, count = <span style="color: #008b8b;">1000</span>), .combine = <span style="color: #8b2252;">"c"</span>) <span style="color: #008b8b;">%:%</span> when(i &gt;= 
                                                                               <span style="color: #008b8b;">0</span>) <span style="color: #008b8b;">%dopar%</span> {
                                                                                   Sys.sleep(<span style="color: #008b8b;">0.01</span>)
                                                                                   sqrt(i)
                                                                               })       
</pre>
</div>
</div>
</div>

<div id="org4310288" class="outline-5">
<h5 id="org4310288"><span class="section-number-5">13.3.1.4</span> furrr</h5>
</div>
<div id="org2bbf0de" class="outline-5">
<h5 id="org2bbf0de"><span class="section-number-5">13.3.1.5</span> dofuture</h5>
</div>
<div id="org4b843fb" class="outline-5">
<h5 id="org4b843fb"><span class="section-number-5">13.3.1.6</span> future.apply</h5>
</div>
</div>

<div id="org60a7d55" class="outline-4">
<h4 id="org60a7d55"><span class="section-number-4">13.3.2</span> 文件批量处理</h4>
<div class="outline-text-4" id="text-13-3-2">
<p>
偶尔，我们可能想要以一种重复的、标准化的、无人值守的方式执行某个 R 程序，例如，你可能需要每个月生成一次相同的报告，这时就可以在 R 中编写程序，在批处理模式下执行它。
&gt; R CMD BATCH options infile outfile
</p>
</div>
</div>

<div id="org1268375" class="outline-4">
<h4 id="org1268375"><span class="section-number-4">13.3.3</span> 高级编程技巧</h4>
<div class="outline-text-4" id="text-13-3-3">
</div>
<div id="orgb615ae1" class="outline-5">
<h5 id="orgb615ae1"><span class="section-number-5">13.3.3.1</span> missing</h5>
<div class="outline-text-5" id="text-13-3-3-1">
<p>
可以使用 missing() 函数来确定某个参数是否已经提供了。
</p>
</div>
</div>
<div id="org1e6d56d" class="outline-5">
<h5 id="org1e6d56d"><span class="section-number-5">13.3.3.2</span> stopifnot</h5>
<div class="outline-text-5" id="text-13-3-3-2">
<p>
如果你的函数的输入参数不是向量化的，那么确保检查一下输入是不是标量的，可以使用 stopifnot(),assertthat 包。
</p>

<p>
有时需要对重要的前提条件进行检查，当其不为真就抛出一个错误（使用 stop()函数）。
</p>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #0000ff;">wt_mean</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>(x, w) {
    <span style="color: #a020f0;">if</span> (length(x) != length(w)) {
        <span style="color: #a020f0;">stop</span>(<span style="color: #8b2252;">"`x` and `w` must be the same length"</span>, call. = F)
    }
    sum(w * x) / sum(x)
}
wt_mean(x = c(<span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">2</span>), w = c(<span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">2</span>))
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 1.666667</span>
wt_mean(x = c(<span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">2</span>), w = c(<span style="color: #008b8b;">1</span>))
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; Error: `x` and `w` must be the same length  </span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #0000ff;">wt_mean</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>(x, w, na.rm = F) {
    stopifnot(is.logical(na.rm), length(na.rm) == <span style="color: #008b8b;">1</span>)
    stopifnot(length(x) == length(w))
    <span style="color: #a020f0;">if</span> (na.rm) {
        miss <span style="color: #008b8b;">&lt;-</span> is.na(x) | is.na(w)
        x <span style="color: #008b8b;">&lt;-</span> x[!miss]
        w <span style="color: #008b8b;">&lt;-</span> w[!miss]
    }
    sum(w * x) / sum(x)
}
wt_mean(c(<span style="color: #008b8b;">1</span>, <span style="color: #008b8b;">2</span>), c(<span style="color: #008b8b;">1</span>, <span style="color: #228b22;">NA</span>), na.rm = T)
                                      <span style="color: #b22222;">#</span><span style="color: #b22222;">&gt; [1] 1  </span>
</pre>
</div>


<div class="org-src-container">
<pre class="src src-R">x <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">10</span>
stopifnot(is.character(x))
                                 <span style="color: #b22222;"># </span><span style="color: #b22222;">Error: is.character(x) is not TRUE</span>
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="org8aa2986" class="outline-3">
<h3 id="org8aa2986"><span class="section-number-3">13.4</span> 3.sql 查询</h3>
<div class="outline-text-3" id="text-13-4">
<div class="org-src-container">
<pre class="src src-R">rimpala_zjy_init()
rimpala.switch(<span style="color: #008b8b;">5</span>)
rimpala.query2save(<span style="color: #8b2252;">"select miid,date,max(ishit) as ishit,max(cast(porvalue as int)) as DT_Num</span>
<span style="color: #8b2252;">                                       from anti_fraud_por_detail</span>
<span style="color: #8b2252;">                                       where date between 20190901 and 20190924 and porid=44</span>
<span style="color: #8b2252;">                                       and eventId=1018</span>
<span style="color: #8b2252;">                                      group by 1,2"</span>,file=sprintf(<span style="color: #8b2252;">"%s/duotou.csv"</span>, modelpath))
duotou=fread(sprintf(<span style="color: #8b2252;">"%s/duotou.csv"</span>, modelpath))
</pre>
</div>
</div>
</div>

<div id="org8a416f2" class="outline-3">
<h3 id="org8a416f2"><span class="section-number-3">13.5</span> mifi model package</h3>
<div class="outline-text-3" id="text-13-5">
</div>
<div id="org24a1d36" class="outline-4">
<h4 id="org24a1d36"><span class="section-number-4">13.5.1</span> mf<sub>dm</sub><sub>data</sub><sub>library</sub></h4>
<div class="outline-text-4" id="text-13-5-1">
<p>
常用数据列表。
</p>
<div class="org-src-container">
<pre class="src src-R"><span style="color: #008b8b;">library</span>(mifimodel)
mf_dm_data_library() <span style="color: #b22222;">#</span><span style="color: #b22222;">&#26174;&#31034;dm&#23618;&#21487;&#29992;&#30340;&#25968;&#25454;&#21015;&#34920;</span>
</pre>
</div>
</div>
</div>
</div>

<div id="org249c344" class="outline-3">
<h3 id="org249c344"><span class="section-number-3">13.6</span> 数据比对</h3>
<div class="outline-text-3" id="text-13-6">
<div class="org-src-container">
<pre class="src src-R"><span style="color: #008b8b;">library</span>(tidyverse)
df2 <span style="color: #008b8b;">&lt;-</span> data.frame(id = c(<span style="color: #008b8b;">1</span>,<span style="color: #008b8b;">2</span>),x1 = c(<span style="color: #8b2252;">"2001.1.2"</span>,<span style="color: #8b2252;">"2002.2.1"</span>),x2 = c(<span style="color: #8b2252;">"&#27979;&#35797;"</span>,<span style="color: #8b2252;">"&#22075;&#22075;"</span>),x3 = c(<span style="color: #008b8b;">3</span>,<span style="color: #008b8b;">4</span>))
df1 <span style="color: #008b8b;">&lt;-</span> data.frame(id = c(<span style="color: #008b8b;">1</span>,<span style="color: #008b8b;">2</span>),x1 = c(<span style="color: #8b2252;">"2001.1.2"</span>,<span style="color: #8b2252;">"2002.2.1"</span>),x2 = c(<span style="color: #8b2252;">"&#27979;&#35797;"</span>,<span style="color: #8b2252;">"--"</span>),x3 = c(<span style="color: #008b8b;">1</span>,<span style="color: #008b8b;">4</span>),x4 = c(<span style="color: #008b8b;">1</span>,<span style="color: #008b8b;">2</span>))

<span style="color: #0000ff;">vars_com</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>(df1,df2){
    map2_chr(bind_rows(
        df1 <span style="color: #008b8b;">%&gt;%</span> group_by_if(is.numeric, as.character) <span style="color: #008b8b;">%&gt;%</span> mutate(group = <span style="color: #8b2252;">"V1"</span>),
        df2 <span style="color: #008b8b;">%&gt;%</span> group_by_if(is.numeric, as.character) <span style="color: #008b8b;">%&gt;%</span> mutate(group = <span style="color: #8b2252;">"V2"</span>)
    ) <span style="color: #008b8b;">%&gt;%</span>
    split(.$group) <span style="color: #008b8b;">%$%</span> V1, bind_rows(
                               df1 <span style="color: #008b8b;">%&gt;%</span> group_by_if(is.numeric, as.character) <span style="color: #008b8b;">%&gt;%</span> mutate(group = <span style="color: #8b2252;">"V1"</span>),
                               df2 <span style="color: #008b8b;">%&gt;%</span> group_by_if(is.numeric, as.character) <span style="color: #008b8b;">%&gt;%</span> mutate(group = <span style="color: #8b2252;">"V2"</span>)
                           ) <span style="color: #008b8b;">%&gt;%</span>
                           split(.$group) <span style="color: #008b8b;">%$%</span> V2, setequal)
}

vars_com(df1,df2) 
</pre>
</div>
<p>
##具体定位错误
</p>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #0000ff;">diff</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>(df1, df2, colnames){
    <span style="color: #0000ff;">diff1</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>(df1, df2, colnames) {
        data <span style="color: #008b8b;">&lt;-</span> df1 <span style="color: #008b8b;">%&gt;%</span>
            select_if(is.numeric) <span style="color: #008b8b;">%&gt;%</span>
            inner_join(df2 <span style="color: #008b8b;">%&gt;%</span> select_if(is.numeric), by = <span style="color: #8b2252;">"id"</span>)
        var_diff <span style="color: #008b8b;">&lt;-</span> quo_name(str_c(colnames, <span style="color: #8b2252;">"_diff"</span>))
        var.x <span style="color: #008b8b;">&lt;-</span> sym(str_c(colnames, <span style="color: #8b2252;">".x"</span>))
        var.y <span style="color: #008b8b;">&lt;-</span> sym(str_c(colnames, <span style="color: #8b2252;">".y"</span>))
        bind_cols(
            data <span style="color: #008b8b;">%&gt;%</span> select(id),
            data <span style="color: #008b8b;">%&gt;%</span>
            select(contains(c(<span style="color: #8b2252;">"x"</span>, <span style="color: #8b2252;">"y"</span>))) <span style="color: #008b8b;">%&gt;%</span>
            select(contains(colnames)) <span style="color: #008b8b;">%&gt;%</span>
            mutate(!!var_diff := !!var.x - !!var.y) <span style="color: #008b8b;">%&gt;%</span>
            select(!!var_diff)    
        )
    }
    <span style="color: #a020f0;">return</span>(reduce(df2 <span style="color: #008b8b;">%&gt;%</span> select_if(is.numeric) <span style="color: #008b8b;">%&gt;%</span> colnames() <span style="color: #008b8b;">%&gt;%</span> tail(-<span style="color: #008b8b;">1</span>) <span style="color: #008b8b;">%&gt;%</span> 
                  map(~diff1(df1,df2, .x)),inner_join,by = <span style="color: #8b2252;">"id"</span>))  
}
</pre>
</div>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #0000ff;">diff</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>(df1, df2, var_name){
data <span style="color: #008b8b;">&lt;-</span> df1 <span style="color: #008b8b;">%&gt;%</span> inner_join(df2, by = <span style="color: #8b2252;">"id"</span>)
var_diff <span style="color: #008b8b;">&lt;-</span> quo_name(str_c(var_name, <span style="color: #8b2252;">"_diff"</span>))
var.x <span style="color: #008b8b;">&lt;-</span> sym(str_c(var_name, <span style="color: #8b2252;">".x"</span>))
var.y <span style="color: #008b8b;">&lt;-</span> sym(str_c(var_name, <span style="color: #8b2252;">".y"</span>))
<span style="color: #0000ff;">diff1</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>(df1, df2, var_name) {
          bind_cols(
              data <span style="color: #008b8b;">%&gt;%</span> select(id),
              data <span style="color: #008b8b;">%&gt;%</span>
              select(contains(c(<span style="color: #8b2252;">"x"</span>, <span style="color: #8b2252;">"y"</span>))) <span style="color: #008b8b;">%&gt;%</span>
              select(contains(var_name)) <span style="color: #008b8b;">%&gt;%</span>
              mutate(!!var_diff := !!var.x - !!var.y) <span style="color: #008b8b;">%&gt;%</span>
              select(!!var_diff)    
          )
  }
  <span style="color: #0000ff;">diff2</span> <span style="color: #008b8b;">&lt;-</span> <span style="color: #a020f0;">function</span>(df1, df2, colnames) {
bind_cols(
df1 <span style="color: #008b8b;">%&gt;%</span> 
  inner_join(df2, by = <span style="color: #8b2252;">"id"</span>) <span style="color: #008b8b;">%&gt;%</span> dplyr::select(id),
df1 <span style="color: #008b8b;">%&gt;%</span> 
  inner_join(df2, by = <span style="color: #8b2252;">"id"</span>) <span style="color: #008b8b;">%&gt;%</span> 
  dplyr::select(tidyselect::contains({{var_name}})) <span style="color: #008b8b;">%&gt;%</span> 
  rowwise() <span style="color: #008b8b;">%&gt;%</span> 
  summarise({{var_diff}} := setequal({{var.x}},{{var.y}})))
}
<span style="color: #a020f0;">return</span>(tibble(reduce(df2 <span style="color: #008b8b;">%&gt;%</span> select_if(is.character) <span style="color: #008b8b;">%&gt;%</span> colnames() <span style="color: #008b8b;">%&gt;%</span> tail(-<span style="color: #008b8b;">1</span>) <span style="color: #008b8b;">%&gt;%</span> 
                    map(~diff2(df1,df2, .x)),inner_join,by = <span style="color: #8b2252;">"id"</span>),
              reduce(df2 <span style="color: #008b8b;">%&gt;%</span> select_if(is.numeric) <span style="color: #008b8b;">%&gt;%</span> colnames() <span style="color: #008b8b;">%&gt;%</span> tail(-<span style="color: #008b8b;">1</span>) <span style="color: #008b8b;">%&gt;%</span> 
                    map(~diff1(df1,df2, .x)),inner_join,by = <span style="color: #8b2252;">"id"</span>))
)  
  }
</pre>
</div>
</div>
</div>

<div id="org9b091ab" class="outline-3">
<h3 id="org9b091ab"><span class="section-number-3">13.7</span> 识别异常字符</h3>
<div class="outline-text-3" id="text-13-7">
<div class="org-src-container">
<pre class="src src-R">df1 <span style="color: #008b8b;">%&gt;%</span> 
    map(~str_match_all(.x,<span style="color: #8b2252;">"[\\*|\\$|\\#]"</span>)) <span style="color: #008b8b;">%&gt;%</span> 
    flatten()     
</pre>
</div>
</div>
</div>
<div id="org13d9439" class="outline-3">
<h3 id="org13d9439"><span class="section-number-3">13.8</span> 进度条</h3>
<div class="outline-text-3" id="text-13-8">
<div class="org-src-container">
<pre class="src src-R"><span style="color: #008b8b;">library</span>(tcltk)
u <span style="color: #008b8b;">&lt;-</span> <span style="color: #008b8b;">1</span>:<span style="color: #008b8b;">20000</span>

                                   <span style="color: #b22222;">#</span><span style="color: #b22222;">&#24320;&#21551;&#36827;&#24230;&#26465;</span>
pb <span style="color: #008b8b;">&lt;-</span> tkProgressBar(<span style="color: #8b2252;">"&#36827;&#24230;"</span>, <span style="color: #8b2252;">"&#24050;&#23436;&#25104; %"</span>, <span style="color: #008b8b;">0</span>, <span style="color: #008b8b;">100</span>)

<span style="color: #a020f0;">for</span> (i <span style="color: #a020f0;">in</span> u) {
    info <span style="color: #008b8b;">&lt;-</span> sprintf(<span style="color: #8b2252;">"&#24050;&#23436;&#25104; %d%%"</span>, round(i * <span style="color: #008b8b;">100</span> / length(u)))
    setTkProgressBar(pb, i * <span style="color: #008b8b;">100</span> / length(u), sprintf(<span style="color: #8b2252;">"&#36827;&#24230; (%s)"</span>, info), info)
}

                                   <span style="color: #b22222;">#</span><span style="color: #b22222;">&#20851;&#38381;&#36827;&#24230;&#26465;</span>
close(pb)      
</pre>
</div>
</div>
</div>
<div id="orgaa3d26d" class="outline-3">
<h3 id="orgaa3d26d"><span class="section-number-3">13.9</span> </h3>
</div>
</div>
</div>
</body>
</html>
